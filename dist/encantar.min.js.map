{
  "version": 3,
  "sources": ["../node_modules/speedy-vision/dist/speedy-vision.js", "../src/utils/errors.ts", "../src/utils/resolution.ts", "../src/utils/utils.ts", "../src/utils/ar-events.ts", "../src/core/stats.ts", "../src/trackers/image-tracker/settings.ts", "../src/ui/gizmos.ts", "../src/core/frame.ts", "../src/trackers/tracker.ts", "../src/core/time-manager.ts", "../src/utils/asap.ts", "../src/core/session.ts", "../src/core/settings.ts", "../src/trackers/image-tracker/reference-image.ts", "../src/trackers/image-tracker/reference-image-database.ts", "../src/trackers/image-tracker/states/state.ts", "../src/trackers/image-tracker/states/initial.ts", "../src/geometry/pnp.ts", "../src/trackers/image-tracker/image-tracker-utils.ts", "../src/trackers/image-tracker/states/training.ts", "../src/trackers/image-tracker/states/scanning.ts", "../src/trackers/image-tracker/states/pre-tracking-a.ts", "../src/trackers/image-tracker/states/pre-tracking-b.ts", "../src/trackers/image-tracker/image-tracker-event.ts", "../src/geometry/quaternion.ts", "../src/geometry/vector3.ts", "../src/geometry/pose-filter.ts", "../src/geometry/camera-model.ts", "../src/geometry/pose.ts", "../src/geometry/transform.ts", "../src/geometry/viewer-pose.ts", "../src/geometry/view.ts", "../src/geometry/ray.ts", "../src/geometry/viewer.ts", "../src/trackers/image-tracker/states/tracking.ts", "../src/trackers/image-tracker/image-tracker.ts", "../src/geometry/vector2.ts", "../src/trackers/pointer-tracker/pointer-tracker.ts", "../src/trackers/tracker-factory.ts", "../src/sources/video-source.ts", "../src/sources/canvas-source.ts", "../src/sources/camera-source.ts", "../src/sources/pointer-source.ts", "../src/sources/source-factory.ts", "../src/ui/stats-panel.ts", "../src/ui/fullscreen-button.ts", "../src/ui/reminder-dialog.ts", "../src/core/hud.ts", "../src/core/viewport.ts", "../src/main.ts", "../src/index.ts"],
  "sourcesContent": ["/*!\n * Speedy Vision version 0.9.1\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com> (https://github.com/alemart)\n * https://github.com/alemart/speedy-vision\n *\n * @license Apache-2.0\n * Date: 2024-07-03T02:16:25.769Z\n */\n(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Speedy\"] = factory();\n\telse\n\t\troot[\"Speedy\"] = factory();\n})(self, () => {\nreturn /******/ (() => { // webpackBootstrap\n/******/ \tvar __webpack_modules__ = ({\n\n/***/ 2199:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   w: () => (/* binding */ Settings)\n/* harmony export */ });\n/* harmony import */ var _speedy_namespace__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(6634);\n/* harmony import */ var _gpu_speedy_gl__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(1001);\n/* harmony import */ var _utils_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(9037);\n/* harmony import */ var _utils_errors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(8581);\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * settings.js\n * Global settings\n */\n\n\n\n\n\n\n/** @typedef {import('../gpu/speedy-gl').PowerPreference} PowerPreference */\n/** @typedef {\"raf\" | \"asap\"} GPUPollingMode */\n/** @typedef {\"default\" | \"none\" | \"diagnostic\"} LoggingMode */\n\n/** @type {GPUPollingMode} Default GPU polling mode */\nconst DEFAULT_GPU_POLLING_MODE = 'raf';\n\n/** @type {GPUPollingMode} GPU polling mode */\nlet gpuPollingMode = DEFAULT_GPU_POLLING_MODE;\n\n/** @type {LoggingMode} logging mode */\nlet loggingMode = 'default';\n\n/**\n * Global settings\n */\nclass Settings extends _speedy_namespace__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyNamespace */ .Q {\n  /**\n   * Power preference of the WebGL context\n   * @returns {PowerPreference}\n   */\n  static get powerPreference() {\n    return _gpu_speedy_gl__WEBPACK_IMPORTED_MODULE_1__/* .SpeedyGL */ .c.powerPreference;\n  }\n\n  /**\n   * Power preference of the WebGL context\n   * @param {PowerPreference} value\n   */\n  static set powerPreference(value) {\n    _gpu_speedy_gl__WEBPACK_IMPORTED_MODULE_1__/* .SpeedyGL */ .c.powerPreference = value;\n  }\n\n  /**\n   * GPU polling mode\n   * @returns {GPUPollingMode}\n   */\n  static get gpuPollingMode() {\n    return gpuPollingMode;\n  }\n\n  /**\n   * GPU polling mode\n   * @param {GPUPollingMode} value\n   */\n  static set gpuPollingMode(value) {\n    if (value !== 'raf' && value !== 'asap') throw new _utils_errors__WEBPACK_IMPORTED_MODULE_3__/* .IllegalArgumentError */ .qw(`Invalid GPU polling mode: \"${value}\"`);\n    gpuPollingMode = value;\n  }\n\n  /**\n   * Logging mode\n   * @returns {LoggingMode}\n   */\n  static get logging() {\n    return loggingMode;\n  }\n\n  /**\n   * Logging mode\n   * @param {LoggingMode} mode\n   */\n  static set logging(mode) {\n    if (mode !== 'default' && mode !== 'none' && mode !== 'diagnostic') throw new _utils_errors__WEBPACK_IMPORTED_MODULE_3__/* .IllegalArgumentError */ .qw(`Invalid logging mode: \"${mode}\"`);else if (mode === 'diagnostic') _utils_utils__WEBPACK_IMPORTED_MODULE_2__/* .Utils */ .A.log('%c DIAGNOSTIC MODE ', 'background:red;color:white;font-size:36pt;font-weight:bold');\n    loggingMode = mode;\n  }\n}\n\n/***/ }),\n\n/***/ 6306:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   r: () => (/* binding */ SpeedyMatrixExpr)\n/* harmony export */ });\n/* harmony import */ var _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(6465);\n/* harmony import */ var _utils_utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(9037);\n/* harmony import */ var _utils_errors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(8581);\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-matrix-expr.js\n * Symbolic matrix expressions\n */\n\n\n\n\n\n/** @typedef {import('./speedy-matrix').SpeedyMatrixDtype} SpeedyMatrixDtype */\n/** @typedef {import('./speedy-matrix').SpeedyMatrixBufferType} SpeedyMatrixBufferType */\n/** @typedef {import('./speedy-matrix').SpeedyMatrixBufferTypeConstructor} SpeedyMatrixBufferTypeConstructor */\n/** @typedef {import('./speedy-matrix-wasm').SpeedyMatrixWASMMemory} SpeedyMatrixWASMMemory */\n\n/** @typedef {Object<SpeedyMatrixDtype,SpeedyMatrixBufferTypeConstructor>} Dtype2BufferType */\n\n/** @const {Dtype2BufferType} */\nconst DTYPE_TO_BUFFER_TYPE = Object.freeze({\n  'float32': Float32Array\n});\n\n/**\n * @abstract Matrix expression\n * It's an opaque object representing an algebraic\n * expression. It has no data attached to it.\n */\nclass SpeedyMatrixExpr {\n  /**\n   * Constructor\n   * @param {number} rows\n   * @param {number} columns\n   * @param {SpeedyMatrixDtype} dtype\n   */\n  constructor(rows, columns, dtype) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_1__/* .Utils */ .A.assert(rows > 0 && columns > 0);\n    _utils_utils__WEBPACK_IMPORTED_MODULE_1__/* .Utils */ .A.assert(dtype === SpeedyMatrixExpr.DEFAULT_DTYPE); // we only support float32 for now\n\n    /** @type {number} number of rows */\n    this._rows = rows | 0;\n\n    /** @type {number} number of columns */\n    this._columns = columns | 0;\n\n    /** @type {SpeedyMatrixDtype} data type */\n    this._dtype = dtype;\n  }\n\n  /**\n   * Number of rows\n   * @returns {number}\n   */\n  get rows() {\n    return this._rows;\n  }\n\n  /**\n   * Number of columns\n   * @returns {number}\n   */\n  get columns() {\n    return this._columns;\n  }\n\n  /**\n   * Data type\n   * @returns {SpeedyMatrixDtype}\n   */\n  get dtype() {\n    return this._dtype;\n  }\n\n  /**\n   * Default data type\n   * @returns {SpeedyMatrixDtype}\n   */\n  static get DEFAULT_DTYPE() {\n    return 'float32';\n  }\n\n  /**\n   * Buffer types\n   * @returns {Dtype2BufferType}\n   */\n  static get BUFFER_TYPE() {\n    return DTYPE_TO_BUFFER_TYPE;\n  }\n\n  /**\n   * Matrix addition\n   * @param {SpeedyMatrixExpr} expr\n   * @returns {SpeedyMatrixExpr}\n   */\n  plus(expr) {\n    return new SpeedyMatrixAddExpr(this, expr);\n  }\n\n  /**\n   * Matrix subtraction\n   * @param {SpeedyMatrixExpr} expr\n   * @returns {SpeedyMatrixExpr}\n   */\n  minus(expr) {\n    return new SpeedyMatrixSubtractExpr(this, expr);\n  }\n\n  /**\n   * Matrix multiplication\n   * @param {SpeedyMatrixExpr|number} expr\n   * @returns {SpeedyMatrixExpr}\n   */\n  times(expr) {\n    if (typeof expr === 'number') return new SpeedyMatrixScaleExpr(this, expr);else return new SpeedyMatrixMultiplyExpr(this, expr);\n  }\n\n  /**\n   * Matrix transposition\n   * @returns {SpeedyMatrixExpr}\n   */\n  transpose() {\n    return new SpeedyMatrixTransposeExpr(this);\n  }\n\n  /**\n   * Matrix inversion\n   * @returns {SpeedyMatrixExpr}\n   */\n  inverse() {\n    return new SpeedyMatrixInvertExpr(this);\n  }\n\n  /**\n   * Component-wise multiplication\n   * @param {SpeedyMatrixExpr} expr\n   * @returns {SpeedyMatrixExpr}\n   */\n  compMult(expr) {\n    return new SpeedyMatrixCompMultExpr(this, expr);\n  }\n\n  /**\n   * Left division: A \\ b, which is equivalent to (pseudo-)inverse(A) * b\n   * @param {SpeedyMatrixExpr} expr\n   * @returns {SpeedyMatrixExpr}\n   */\n  ldiv(expr) {\n    return new SpeedyMatrixLdivExpr(this, expr);\n  }\n\n  /**\n   * Returns a human-readable string representation of the matrix expression\n   * @returns {string}\n   */\n  toString() {\n    return `SpeedyMatrixExpr(rows=${this.rows}, columns=${this.columns})`;\n  }\n\n  /**\n   * Evaluate this expression\n   * @abstract\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @returns {SpeedyMatrix}\n   */\n  _evaluate(wasm, memory) {\n    throw new _utils_errors__WEBPACK_IMPORTED_MODULE_2__/* .AbstractMethodError */ .aQ();\n  }\n}\nconst {\n  SpeedyMatrix\n} = __webpack_require__(4188);\n\n/**\n * @abstract operation storing a temporary matrix\n */\nclass SpeedyMatrixTempExpr extends SpeedyMatrixExpr {\n  /**\n   * Constructor\n   * @param {number} rows\n   * @param {number} columns\n   * @param {SpeedyMatrixDtype} dtype\n   */\n  constructor(rows, columns, dtype) {\n    super(rows, columns, dtype);\n\n    /** @type {SpeedyMatrix} holds the results of a computation */\n    this._tempMatrix = SpeedyMatrix.Zeros(this.rows, this.columns, this.dtype);\n  }\n}\n\n/**\n * @abstract unary operation\n */\nclass SpeedyMatrixUnaryOperationExpr extends SpeedyMatrixTempExpr {\n  /**\n   * Constructor\n   * @param {number} rows rows of the output matrix\n   * @param {number} columns columns of the output matrix\n   * @param {SpeedyMatrixExpr} operand\n   */\n  constructor(rows, columns, operand) {\n    super(rows, columns, operand.dtype);\n\n    /** @type {SpeedyMatrixExpr} operand */\n    this._operand = operand;\n  }\n\n  /**\n   * Evaluate this expression\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @returns {SpeedyMatrix}\n   */\n  _evaluate(wasm, memory) {\n    const operand = this._operand._evaluate(wasm, memory);\n    const result = this._tempMatrix;\n\n    // allocate matrices\n    const resultptr = _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.allocateMat32(wasm, memory, result);\n    const operandptr = _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.allocateMat32(wasm, memory, operand);\n\n    // copy operand to WASM memory\n    _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.copyToMat32(wasm, memory, operandptr, operand);\n\n    // run the WASM routine\n    this._compute(wasm, memory, resultptr, operandptr);\n\n    // copy result from WASM memory\n    _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.copyFromMat32(wasm, memory, resultptr, result);\n\n    // deallocate matrices\n    _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.deallocateMat32(wasm, memory, operandptr);\n    _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.deallocateMat32(wasm, memory, resultptr);\n\n    // done!\n    return result;\n  }\n\n  /**\n   * Compute the result of this operation\n   * @abstract\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {number} resultptr pointer to Mat32\n   * @param {number} operandptr pointer to Mat32\n   */\n  _compute(wasm, memory, resultptr, operandptr) {\n    throw new _utils_errors__WEBPACK_IMPORTED_MODULE_2__/* .AbstractMethodError */ .aQ();\n  }\n}\n\n/**\n * @abstract binary operation\n */\nclass SpeedyMatrixBinaryOperationExpr extends SpeedyMatrixTempExpr {\n  /**\n   * Constructor\n   * @param {number} rows rows of the output matrix\n   * @param {number} columns columns of the output matrix\n   * @param {SpeedyMatrixExpr} left left operand\n   * @param {SpeedyMatrixExpr} right right operand\n   */\n  constructor(rows, columns, left, right) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_1__/* .Utils */ .A.assert(left.dtype === right.dtype);\n    super(rows, columns, left.dtype);\n\n    /** @type {SpeedyMatrixExpr} left operand */\n    this._left = left;\n\n    /** @type {SpeedyMatrixExpr} right operand */\n    this._right = right;\n  }\n\n  /**\n   * Evaluate this expression\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @returns {SpeedyMatrix}\n   */\n  _evaluate(wasm, memory) {\n    const left = this._left._evaluate(wasm, memory);\n    const right = this._right._evaluate(wasm, memory);\n    const result = this._tempMatrix;\n\n    // allocate matrices\n    const resultptr = _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.allocateMat32(wasm, memory, result);\n    const leftptr = _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.allocateMat32(wasm, memory, left);\n    const rightptr = _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.allocateMat32(wasm, memory, right);\n\n    // copy input matrices to WASM memory\n    _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.copyToMat32(wasm, memory, leftptr, left);\n    _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.copyToMat32(wasm, memory, rightptr, right);\n\n    // run the WASM routine\n    this._compute(wasm, memory, resultptr, leftptr, rightptr);\n\n    // copy output matrix from WASM memory\n    _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.copyFromMat32(wasm, memory, resultptr, result);\n\n    // deallocate matrices\n    _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.deallocateMat32(wasm, memory, rightptr);\n    _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.deallocateMat32(wasm, memory, leftptr);\n    _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixWASM */ .U.deallocateMat32(wasm, memory, resultptr);\n\n    // done!\n    return result;\n  }\n\n  /**\n   * Compute the result of this operation\n   * @abstract\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {number} resultptr pointer to Mat32\n   * @param {number} leftptr pointer to Mat32\n   * @param {number} rightptr pointer to Mat32\n   */\n  _compute(wasm, memory, resultptr, leftptr, rightptr) {\n    throw new _utils_errors__WEBPACK_IMPORTED_MODULE_2__/* .AbstractMethodError */ .aQ();\n  }\n}\n\n/**\n * Transpose matrix\n */\nclass SpeedyMatrixTransposeExpr extends SpeedyMatrixUnaryOperationExpr {\n  /**\n   * Constructor\n   * @param {SpeedyMatrixExpr} operand\n   */\n  constructor(operand) {\n    super(operand.columns, operand.rows, operand);\n  }\n\n  /**\n   * Compute result = operand^T\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {number} resultptr pointer to Mat32\n   * @param {number} operandptr pointer to Mat32\n   */\n  _compute(wasm, memory, resultptr, operandptr) {\n    wasm.exports.Mat32_transpose(resultptr, operandptr);\n  }\n}\n\n/**\n * Invert square matrix\n */\nclass SpeedyMatrixInvertExpr extends SpeedyMatrixUnaryOperationExpr {\n  /**\n   * Constructor\n   * @param {SpeedyMatrixExpr} operand\n   */\n  constructor(operand) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_1__/* .Utils */ .A.assert(operand.rows === operand.columns);\n    super(operand.rows, operand.columns, operand);\n\n    /** @type {number} size of the matrix */\n    this._size = operand.rows;\n  }\n\n  /**\n   * Compute result = operand ^ (-1)\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {number} resultptr pointer to Mat32\n   * @param {number} operandptr pointer to Mat32\n   */\n  _compute(wasm, memory, resultptr, operandptr) {\n    switch (this._size) {\n      case 0:\n        break;\n      case 1:\n        wasm.exports.Mat32_inverse1(resultptr, operandptr);\n        break;\n      case 2:\n        wasm.exports.Mat32_inverse2(resultptr, operandptr);\n        break;\n      case 3:\n        wasm.exports.Mat32_inverse3(resultptr, operandptr);\n        break;\n      default:\n        wasm.exports.Mat32_qr_inverse(resultptr, operandptr);\n        break;\n    }\n  }\n}\n\n/**\n * Multiply matrix by a scalar value\n */\nclass SpeedyMatrixScaleExpr extends SpeedyMatrixUnaryOperationExpr {\n  /**\n   * Constructor\n   * @param {SpeedyMatrixExpr} operand\n   * @param {number} scalar\n   */\n  constructor(operand, scalar) {\n    super(operand.rows, operand.columns, operand);\n\n    /** @type {number} scalar value */\n    this._scalar = +scalar;\n  }\n\n  /**\n   * Compute result = scalar * operand\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {number} resultptr pointer to Mat32\n   * @param {number} operandptr pointer to Mat32\n   */\n  _compute(wasm, memory, resultptr, operandptr) {\n    wasm.exports.Mat32_scale(resultptr, operandptr, this._scalar);\n  }\n}\n\n/**\n * Matrix addition\n */\nclass SpeedyMatrixAddExpr extends SpeedyMatrixBinaryOperationExpr {\n  /**\n   * Constructor\n   * @param {SpeedyMatrixExpr} left left operand\n   * @param {SpeedyMatrixExpr} right right operand\n   */\n  constructor(left, right) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_1__/* .Utils */ .A.assert(left.rows === right.rows && left.columns === right.columns);\n    super(left.rows, left.columns, left, right);\n  }\n\n  /**\n   * Compute result = left + right\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {number} resultptr pointer to Mat32\n   * @param {number} leftptr pointer to Mat32\n   * @param {number} rightptr pointer to Mat32\n   */\n  _compute(wasm, memory, resultptr, leftptr, rightptr) {\n    wasm.exports.Mat32_add(resultptr, leftptr, rightptr);\n  }\n}\n\n/**\n * Matrix subtraction\n */\nclass SpeedyMatrixSubtractExpr extends SpeedyMatrixBinaryOperationExpr {\n  /**\n   * Constructor\n   * @param {SpeedyMatrixExpr} left left operand\n   * @param {SpeedyMatrixExpr} right right operand\n   */\n  constructor(left, right) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_1__/* .Utils */ .A.assert(left.rows === right.rows && left.columns === right.columns);\n    super(left.rows, left.columns, left, right);\n  }\n\n  /**\n   * Compute result = left - right\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {number} resultptr pointer to Mat32\n   * @param {number} leftptr pointer to Mat32\n   * @param {number} rightptr pointer to Mat32\n   */\n  _compute(wasm, memory, resultptr, leftptr, rightptr) {\n    wasm.exports.Mat32_subtract(resultptr, leftptr, rightptr);\n  }\n}\n\n/**\n * Matrix multiplication\n */\nclass SpeedyMatrixMultiplyExpr extends SpeedyMatrixBinaryOperationExpr {\n  /**\n   * Constructor\n   * @param {SpeedyMatrixExpr} left left operand\n   * @param {SpeedyMatrixExpr} right right operand\n   */\n  constructor(left, right) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_1__/* .Utils */ .A.assert(left.columns === right.rows);\n    super(left.rows, right.columns, left, right);\n  }\n\n  /**\n   * Compute result = left * right\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {number} resultptr pointer to Mat32\n   * @param {number} leftptr pointer to Mat32\n   * @param {number} rightptr pointer to Mat32\n   */\n  _compute(wasm, memory, resultptr, leftptr, rightptr) {\n    wasm.exports.Mat32_multiply(resultptr, leftptr, rightptr);\n  }\n}\n\n/**\n * Component-wise multiplication\n */\nclass SpeedyMatrixCompMultExpr extends SpeedyMatrixBinaryOperationExpr {\n  /**\n   * Constructor\n   * @param {SpeedyMatrixExpr} left left operand\n   * @param {SpeedyMatrixExpr} right right operand\n   */\n  constructor(left, right) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_1__/* .Utils */ .A.assert(left.rows === right.rows && left.columns === right.columns);\n    super(right.rows, right.columns, left, right);\n  }\n\n  /**\n   * Compute result = left <compMult> right\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {number} resultptr pointer to Mat32\n   * @param {number} leftptr pointer to Mat32\n   * @param {number} rightptr pointer to Mat32\n   */\n  _compute(wasm, memory, resultptr, leftptr, rightptr) {\n    wasm.exports.Mat32_compmult(resultptr, leftptr, rightptr);\n  }\n}\n\n/**\n * Left-division. A \\ b is equivalent to (pseudo-)inverse(A) * b\n */\nclass SpeedyMatrixLdivExpr extends SpeedyMatrixBinaryOperationExpr {\n  /**\n   * Constructor\n   * @param {SpeedyMatrixExpr} left left operand\n   * @param {SpeedyMatrixExpr} right right operand\n   */\n  constructor(left, right) {\n    const m = left.rows,\n      n = left.columns;\n\n    // TODO right doesn't need to be a column vector\n    _utils_utils__WEBPACK_IMPORTED_MODULE_1__/* .Utils */ .A.assert(m >= n && right.rows === m && right.columns === 1);\n    super(n, 1, left, right);\n  }\n\n  /**\n   * Compute result = left \\ right\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {number} resultptr pointer to Mat32\n   * @param {number} leftptr pointer to Mat32\n   * @param {number} rightptr pointer to Mat32\n   */\n  _compute(wasm, memory, resultptr, leftptr, rightptr) {\n    wasm.exports.Mat32_qr_ols(resultptr, leftptr, rightptr, 2);\n  }\n}\n\n/***/ }),\n\n/***/ 6465:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   U: () => (/* binding */ SpeedyMatrixWASM)\n/* harmony export */ });\n/* harmony import */ var _speedy_promise__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(9192);\n/* harmony import */ var _utils_errors__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(8581);\n/* harmony import */ var _utils_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(9037);\n/* harmony import */ var _utils_globals__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(3816);\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-matrix-wasm.js\n * WebAssembly bridge\n */\n\n\n\n\n\n\n/** @typedef {import('./speedy-matrix').SpeedyMatrix} SpeedyMatrix */\n\n/**\n * @typedef {object} SpeedyMatrixWASMMemory a union-like helper for accessing a WebAssembly.Memory object\n * @property {object} as\n * @property {WebAssembly.Memory} as.object\n * @property {Uint8Array} as.uint8\n * @property {Int32Array} as.int32\n * @property {Uint32Array} as.uint32\n * @property {Float32Array} as.float32\n * @property {Float64Array} as.float64\n */\n\n/**\n * @typedef {object} SpeedyMatrixWASMHandle\n * @property {WebAssembly.Instance} wasm\n * @property {SpeedyMatrixWASMMemory} memory\n * @property {WebAssembly.Module} module\n */\n\n/** @type {Uint8Array} WebAssembly binary */\nconst WASM_BINARY = __webpack_require__(3575);\n\n/** @type {WebAssembly.Instance|null} WebAssembly Instance, to be loaded asynchronously */\nlet _instance = null;\n\n/** @type {WebAssembly.Module|null} WebAssembly Module, to be loaded asynchronously */\nlet _module = null;\n\n/** @type {SpeedyMatrixWASMMemory} Augmented WebAssembly Memory object */\nconst _memory = (mem => ({\n  as: {\n    object: mem,\n    uint8: new Uint8Array(mem.buffer),\n    int32: new Int32Array(mem.buffer),\n    uint32: new Uint32Array(mem.buffer),\n    float32: new Float32Array(mem.buffer),\n    float64: new Float64Array(mem.buffer)\n  }\n}))(typeof WebAssembly === 'undefined' ? new Uint8Array(1024) :\n// use a filler\nnew WebAssembly.Memory({\n  initial: 16,\n  // 1 MB\n  maximum: 256\n}));\n\n/**\n * WebAssembly utilities\n */\nclass SpeedyMatrixWASM {\n  /**\n   * Gets you the WASM instance, augmented memory & module\n   * @returns {SpeedyPromise<SpeedyMatrixWASMHandle>}\n   */\n  static ready() {\n    // Check if WebAssembly is supported\n    if (typeof WebAssembly === 'undefined') return _speedy_promise__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyPromise */ .i.reject(new _utils_errors__WEBPACK_IMPORTED_MODULE_1__/* .NotSupportedError */ .EM('This application requires WebAssembly. Please update your system.'));\n\n    // Endianness check\n    if (!_utils_globals__WEBPACK_IMPORTED_MODULE_3__.LITTLE_ENDIAN) return _speedy_promise__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyPromise */ .i.reject(new _utils_errors__WEBPACK_IMPORTED_MODULE_1__/* .NotSupportedError */ .EM(`Can't run WebAssembly code: not in a little-endian machine!`));\n\n    // Get the WASM instance\n    return new _speedy_promise__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyPromise */ .i((resolve, reject) => {\n      SpeedyMatrixWASM._ready(resolve, reject);\n    });\n  }\n\n  /**\n   * Synchronously gets you the WASM instance, augmented memory & module\n   * @returns {SpeedyMatrixWASMHandle}\n   */\n  static get handle() {\n    if (!_instance || !_module) throw new _utils_errors__WEBPACK_IMPORTED_MODULE_1__/* .WebAssemblyError */ .NO(`Can't get WASM handle: routines not yet loaded`);\n    return {\n      wasm: _instance,\n      memory: _memory,\n      module: _module\n    };\n  }\n\n  /**\n   * Gets you the WASM imports bound to a memory object\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @returns {Object<string,Function>}\n   */\n  static imports(memory) {\n    const obj = new SpeedyMatrixWASMImports(memory);\n    return Object.getOwnPropertyNames(SpeedyMatrixWASMImports.prototype).filter(property => typeof obj[property] === 'function' && property !== 'constructor').reduce((imports, methodName) => (imports[methodName] = obj[methodName], imports), Object.create(null));\n  }\n\n  /**\n   * Allocate a Mat32 in WebAssembly memory without copying any data\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {SpeedyMatrix} matrix\n   * @returns {number} pointer to the new Mat32\n   */\n  static allocateMat32(wasm, memory, matrix) {\n    const dataptr = wasm.exports.malloc(matrix.data.byteLength);\n    const matptr = wasm.exports.Mat32_create(matrix.rows, matrix.columns, matrix.step0, matrix.step1, matrix._data.length, dataptr);\n    return matptr;\n  }\n\n  /**\n   * Deallocate a Mat32 in WebAssembly\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {number} matptr pointer to the allocated Mat32\n   * @returns {number} NULL\n   */\n  static deallocateMat32(wasm, memory, matptr) {\n    const dataptr = wasm.exports.Mat32_data(matptr);\n    wasm.exports.free(matptr);\n    wasm.exports.free(dataptr);\n    return 0;\n  }\n\n  /**\n   * Copy the data of a matrix to a WebAssembly Mat32\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {number} matptr pointer to a Mat32\n   * @param {SpeedyMatrix} matrix\n   * @returns {number} matptr\n   */\n  static copyToMat32(wasm, memory, matptr, matrix) {\n    // We assume the following:\n    // 1. the host uses little-endian byte ordering (just like WebAssembly)\n    // 2. the allocated pointers are 4-byte aligned (the bump allocator guarantees this)\n    // 3. the data type is float32\n\n    _utils_utils__WEBPACK_IMPORTED_MODULE_2__/* .Utils */ .A.assert(\n    //matrix.dtype === 'float32' &&\n    matrix.data.byteLength === wasm.exports.Mat32_dataSize(matptr));\n    const dataptr = wasm.exports.Mat32_data(matptr);\n    memory.as.float32.set(matrix.data, dataptr / Float32Array.BYTES_PER_ELEMENT);\n    return matptr;\n  }\n\n  /**\n   * Copy the data of a WebAssembly Mat32 to a matrix\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @param {number} matptr pointer to a Mat32\n   * @param {SpeedyMatrix} matrix\n   * @returns {number} matptr\n   */\n  static copyFromMat32(wasm, memory, matptr, matrix) {\n    // We assume the following:\n    // 1. the host uses little-endian byte ordering (just like WebAssembly)\n    // 2. the allocated pointers are 4-byte aligned (the bump allocator guarantees this)\n    // 3. the data type is float32\n\n    _utils_utils__WEBPACK_IMPORTED_MODULE_2__/* .Utils */ .A.assert(\n    //matrix.dtype === 'float32' &&\n    matrix.data.byteLength === wasm.exports.Mat32_dataSize(matptr));\n    const base = wasm.exports.Mat32_data(matptr) / Float32Array.BYTES_PER_ELEMENT;\n    for (let offset = matrix.data.length - 1; offset >= 0; offset--) matrix.data[offset] = memory.as.float32[base + offset];\n    return matptr;\n  }\n\n  /**\n   * Polls the WebAssembly instance until it's ready\n   * @param {function(SpeedyMatrixWASMHandle): void} resolve\n   * @param {function(Error): void} reject\n   * @param {number} [counter]\n   */\n  static _ready(resolve, reject, counter = 1000) {\n    if (_instance !== null && _module !== null) resolve({\n      wasm: _instance,\n      memory: _memory,\n      module: _module\n    });else if (counter <= 0) reject(new _utils_errors__WEBPACK_IMPORTED_MODULE_1__/* .TimeoutError */ .MU(`Can't load WASM routines`));else setTimeout(SpeedyMatrixWASM._ready, 0, resolve, reject, counter - 1);\n  }\n}\n\n/**\n * Methods called from WASM\n */\nclass SpeedyMatrixWASMImports {\n  /**\n   * Constructor\n   * @param {SpeedyMatrixWASMMemory} memory will be bound to this object\n   */\n  constructor(memory) {\n    // find all methods of this object\n    const methodNames = Object.getOwnPropertyNames(this.constructor.prototype).filter(property => typeof this[property] === 'function').filter(property => property !== 'constructor');\n\n    // bind all methods to this object\n    methodNames.forEach(methodName => {\n      this[methodName] = this[methodName].bind(this);\n    });\n\n    /** @type {SpeedyMatrixWASMMemory} WASM memory */\n    this.memory = memory;\n\n    /** @type {CStringUtils} utilities related to C strings */\n    this.cstring = new CStringUtils(memory);\n\n    // done!\n    return Object.freeze(this);\n  }\n\n  /**\n   * Prints a message\n   * @param {number} ptr pointer to char\n   */\n  print(ptr) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_2__/* .Utils */ .A.log(this.cstring.get(ptr));\n  }\n\n  /**\n   * Throws an error\n   * @param {number} ptr pointer to char\n   */\n  fatal(ptr) {\n    throw new _utils_errors__WEBPACK_IMPORTED_MODULE_1__/* .WebAssemblyError */ .NO(this.cstring.get(ptr));\n  }\n\n  /**\n   * Fills a memory segment with a byte\n   * @param {number} value byte\n   * @param {number} start memory address, inclusive\n   * @param {number} end memory address greater than start, exclusive\n   */\n  bytefill(value, start, end) {\n    this.memory.as.uint8.fill(value, start, end);\n  }\n\n  /**\n   * Copy a memory segment to another segment\n   * @param {number} target memory address, where we'll start writing\n   * @param {number} start memory address, where we'll start copying (inclusive)\n   * @param {number} end memory address, where we'll end the copy (exclusive)\n   */\n  copyWithin(target, start, end) {\n    this.memory.as.uint8.copyWithin(target, start, end);\n  }\n}\n\n/**\n * Utilities related to C strings\n */\nclass CStringUtils {\n  /**\n   * Constructor\n   * @param {SpeedyMatrixWASMMemory} memory\n   */\n  constructor(memory) {\n    /** @type {TextDecoder} */\n    this._decoder = new TextDecoder('utf-8');\n\n    /** @type {SpeedyMatrixWASMMemory} */\n    this._memory = memory;\n  }\n\n  /**\n   * Convert a C string to a JavaScript string\n   * @param {number} ptr pointer to char\n   * @returns {string}\n   */\n  get(ptr) {\n    const byte = this._memory.as.uint8;\n    const size = this._memory.as.uint8.byteLength;\n    let p = ptr;\n    while (p < size && 0 !== byte[p]) ++p;\n    return this._decoder.decode(byte.subarray(ptr, p));\n  }\n}\n\n/**\n * WebAssembly loader\n * @param {SpeedyMatrixWASMMemory} memory\n */\n(function loadWASM(memory) {\n  const base64decode = data => Uint8Array.from(atob(data), v => v.charCodeAt(0));\n\n  // Skip if WebAssembly is unsupported\n  if (typeof WebAssembly === 'undefined') return;\n\n  // Load the WASM binary\n  _speedy_promise__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyPromise */ .i.resolve(WASM_BINARY).then(data => base64decode(data)).then(bytes => WebAssembly.instantiate(bytes, {\n    env: Object.assign({\n      memory: memory.as.object\n    }, SpeedyMatrixWASM.imports(memory))\n  })).then(wasm => {\n    _instance = wasm.instance;\n    _module = wasm.module;\n    wasm.instance.exports.srand(Date.now() * 0.001 & 0xffffffff); // srand(time(NULL))\n\n    _utils_utils__WEBPACK_IMPORTED_MODULE_2__/* .Utils */ .A.log(`The WebAssembly routines have been loaded!`);\n  }).catch(err => {\n    throw new _utils_errors__WEBPACK_IMPORTED_MODULE_1__/* .WebAssemblyError */ .NO(`Can't load the WebAssembly routines: ${err}`, err);\n  });\n})(_memory);\n\n/***/ }),\n\n/***/ 4188:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SpeedyMatrix: () => (/* binding */ SpeedyMatrix)\n/* harmony export */ });\n/* harmony import */ var _speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(6306);\n/* harmony import */ var _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(6465);\n/* harmony import */ var _speedy_promise__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(9192);\n/* harmony import */ var _utils_utils__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(9037);\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-matrix.js\n * Matrix class\n */\n\n\n\n\n\n\n/** @typedef {\"float32\"} SpeedyMatrixDtype Matrix data type */\n/** @typedef {Float32Array} SpeedyMatrixBufferType Buffer type */\n/** @typedef {Float32ArrayConstructor} SpeedyMatrixBufferTypeConstructor Buffer class */\n/** @typedef {import('./speedy-matrix-wasm').SpeedyMatrixWASMMemory} SpeedyMatrixWASMMemory */\n/** @typedef {import('./speedy-matrix-wasm').SpeedyMatrixWASMHandle} SpeedyMatrixWASMHandle */\n\n/**\n * Matrix class\n */\nclass SpeedyMatrix extends _speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r {\n  /**\n   * @private\n   * \n   * Low-level constructor\n   * @param {number} rows number of rows\n   * @param {number} columns number of columns\n   * @param {number} step0 step size between two consecutive elements (e.g., 1)\n   * @param {number} step1 step size between two consecutive columns (e.g., rows)\n   * @param {SpeedyMatrixBufferType} data entries in column-major format\n   */\n  constructor(rows, columns, step0, step1, data) {\n    super(rows, columns, _speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.DEFAULT_DTYPE);\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(data.constructor === _speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.BUFFER_TYPE[this.dtype]);\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(step0 > 0 && step1 >= step0);\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(data.length + rows * columns === 0 ||\n    // empty matrix and empty buffer, or\n    data.length === 1 + step0 * (rows - 1) + step1 * (columns - 1) // correctly sized buffer\n    );\n\n    /** @type {number} step size between two consecutive elements */\n    this._step0 = step0 | 0;\n\n    /** @type {number} step size between two consecutive columns */\n    this._step1 = step1 | 0;\n\n    /** @type {SpeedyMatrixBufferType} buffer containing the entries of the matrix in column-major order */\n    this._data = data;\n  }\n\n  /**\n   * Create a new matrix with the specified size and entries\n   * @param {number} rows number of rows\n   * @param {number} columns number of columns\n   * @param {number[]} entries in column-major format\n   * @param {SpeedyMatrixDtype} [dtype] data type\n   * @returns {SpeedyMatrix}\n   */\n  static Create(rows, columns, entries, dtype = _speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.DEFAULT_DTYPE) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(rows * columns > 0, `Can't create a matrix without a shape`);\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(rows * columns === entries.length, `Can't create matrix: expected ${rows * columns} entries, but found ${entries.length}`);\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(Object.prototype.hasOwnProperty.call(_speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.BUFFER_TYPE, dtype), `Invalid dtype: \"${dtype}\"`);\n    return new SpeedyMatrix(rows, columns, 1, rows, Reflect.construct(_speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.BUFFER_TYPE[dtype], [entries]));\n  }\n\n  /**\n   * Create a new matrix filled with zeros with the specified size\n   * @param {number} rows number of rows\n   * @param {number} [columns] number of columns\n   * @param {SpeedyMatrixDtype} [dtype] data type\n   * @returns {SpeedyMatrix}\n   */\n  static Zeros(rows, columns = rows, dtype = _speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.DEFAULT_DTYPE) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(rows * columns > 0, `Can't create a matrix without a shape`);\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(Object.prototype.hasOwnProperty.call(_speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.BUFFER_TYPE, dtype), `Invalid dtype: \"${dtype}\"`);\n    return new SpeedyMatrix(rows, columns, 1, rows, Reflect.construct(_speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.BUFFER_TYPE[dtype], [rows * columns]));\n  }\n\n  /**\n   * Create a new matrix filled with ones with the specified size\n   * @param {number} rows number of rows\n   * @param {number} [columns] number of columns\n   * @param {SpeedyMatrixDtype} [dtype] data type\n   * @returns {SpeedyMatrix}\n   */\n  static Ones(rows, columns = rows, dtype = _speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.DEFAULT_DTYPE) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(rows * columns > 0, `Can't create a matrix without a shape`);\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(Object.prototype.hasOwnProperty.call(_speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.BUFFER_TYPE, dtype), `Invalid dtype: \"${dtype}\"`);\n    return new SpeedyMatrix(rows, columns, 1, rows, Reflect.construct(_speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.BUFFER_TYPE[dtype], [rows * columns]).fill(1));\n  }\n\n  /**\n   * Create a new identity matrix with the specified size\n   * @param {number} rows number of rows\n   * @param {number} [columns] number of columns\n   * @param {SpeedyMatrixDtype} [dtype] data type\n   * @returns {SpeedyMatrix}\n   */\n  static Eye(rows, columns = rows, dtype = _speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.DEFAULT_DTYPE) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(rows * columns > 0, `Can't create a matrix without a shape`);\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(Object.prototype.hasOwnProperty.call(_speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.BUFFER_TYPE, dtype), `Invalid dtype: \"${dtype}\"`);\n    const data = Reflect.construct(_speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyMatrixExpr */ .r.BUFFER_TYPE[dtype], [rows * columns]);\n    for (let j = Math.min(rows, columns) - 1; j >= 0; j--) data[j * rows + j] = 1;\n    return new SpeedyMatrix(rows, columns, 1, rows, data);\n  }\n\n  /**\n   * Evaluate an expression synchronously and store the result in a new matrix\n   * @param {SpeedyMatrixExpr} expr matrix expression\n   * @returns {SpeedyMatrix}\n   */\n  static From(expr) {\n    return SpeedyMatrix.Zeros(expr.rows, expr.columns, expr.dtype).setToSync(expr);\n  }\n\n  /**\n   * Returns a promise that resolves immediately if the WebAssembly routines\n   * are ready to be used, or as soon as they do become ready\n   * @returns {SpeedyPromise<void>}\n   */\n  static ready() {\n    return _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_1__/* .SpeedyMatrixWASM */ .U.ready().then(_ => void 0);\n  }\n\n  /**\n   * Get the underlying buffer\n   * @returns {SpeedyMatrixBufferType}\n   */\n  get data() {\n    return this._data;\n  }\n\n  /**\n   * Row-step\n   * @returns {number} defaults to 1\n   */\n  get step0() {\n    return this._step0;\n  }\n\n  /**\n   * Column-step\n   * @returns {number} defaults to this.rows\n   */\n  get step1() {\n    return this._step1;\n  }\n\n  /**\n   * Extract a block from this matrix. Use a shared underlying buffer\n   * @param {number} firstRow\n   * @param {number} lastRow\n   * @param {number} firstColumn\n   * @param {number} lastColumn\n   * @returns {SpeedyMatrix}\n   */\n  block(firstRow, lastRow, firstColumn, lastColumn) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(firstRow <= lastRow && firstColumn <= lastColumn, `Invalid indices: [${firstRow}:${lastRow},${firstColumn}:${lastColumn}]`);\n\n    // ensure that the indices are within bounds\n    firstRow = Math.max(firstRow, 0);\n    lastRow = Math.min(lastRow, this._rows - 1);\n    firstColumn = Math.max(firstColumn, 0);\n    lastColumn = Math.min(lastColumn, this._columns - 1);\n\n    // compute the dimensions of the new submatrix\n    const rows = lastRow - firstRow + 1;\n    const columns = lastColumn - firstColumn + 1;\n\n    // obtain the relevant portion of the data\n    const step0 = this._step0,\n      step1 = this._step1;\n    const begin = firstRow * step0 + firstColumn * step1; // inclusive\n    const end = 1 + lastRow * step0 + lastColumn * step1; // exclusive\n\n    // create new matrix\n    return new SpeedyMatrix(rows, columns, step0, step1, this._data.subarray(begin, end));\n  }\n\n  /**\n   * Extract a row from this matrix\n   * @param {number} index 0-based\n   * @returns {SpeedyMatrix}\n   */\n  row(index) {\n    return this.block(index, index, 0, this._columns - 1);\n  }\n\n  /**\n   * Extract a column from this matrix\n   * @param {number} index 0-based\n   * @returns {SpeedyMatrix}\n   */\n  column(index) {\n    return this.block(0, this._rows - 1, index, index);\n  }\n\n  /**\n   * Extract the main diagonal from this matrix\n   * @returns {SpeedyMatrix} as a column-vector\n   */\n  diagonal() {\n    const diagsize = Math.min(this._rows, this._columns);\n\n    // compute the dimensions of the new submatrix\n    const rows = diagsize; // make it a column vector\n    const columns = 1;\n\n    // obtain the relevant portion of the data\n    const diagstep = this._step0 + this._step1; // jump a row and a column\n    const begin = 0; // inclusive\n    const end = 1 + (diagsize - 1) * diagstep; // exclusive\n\n    // create new matrix\n    return new SpeedyMatrix(rows, columns, diagstep, diagstep, this._data.subarray(begin, end));\n  }\n\n  /**\n   * Read a single entry of this matrix\n   * @param {number} row 0-based index\n   * @param {number} column 0-based index\n   * @returns {number}\n   */\n  at(row, column) {\n    if (row >= 0 && row < this._rows && column >= 0 && column < this._columns) return this._data[this._step0 * row + this._step1 * column];else return Number.NaN;\n  }\n\n  /**\n   * Read the entries of the matrix in column-major format\n   * @returns {number[]}\n   */\n  read() {\n    const entries = new Array(this._rows * this._columns);\n    const step0 = this._step0,\n      step1 = this._step1;\n    let i = 0;\n    for (let column = 0; column < this._columns; column++) {\n      for (let row = 0; row < this._rows; row++) entries[i++] = this._data[row * step0 + column * step1];\n    }\n    return entries;\n  }\n\n  /**\n   * Returns a human-readable string representation of the matrix\n   * @returns {string}\n   */\n  toString() {\n    const DECIMALS = 5;\n    const rows = this.rows,\n      columns = this.columns;\n    const entries = this.read();\n    const mat = /** @type {number[][]} */new Array(rows);\n    for (let i = 0; i < rows; i++) {\n      mat[i] = new Array(columns);\n      for (let j = 0; j < columns; j++) mat[i][j] = entries[j * rows + i];\n    }\n    const fix = x => x.toFixed(DECIMALS);\n    const fmt = mat.map(row => '    ' + row.map(fix).join(', ')).join(',\\n');\n    const str = `SpeedyMatrix(rows=${rows}, columns=${columns}, data=[\\n${fmt}\\n])`;\n    return str;\n  }\n\n  /**\n   * Set the contents of this matrix to the result of an expression\n   * @param {SpeedyMatrixExpr} expr matrix expression\n   * @returns {SpeedyPromise<SpeedyMatrix>} resolves to this\n   */\n  setTo(expr) {\n    return _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_1__/* .SpeedyMatrixWASM */ .U.ready().then(_ => {\n      // TODO: add support for WebWorkers\n      return this.setToSync(expr);\n    });\n  }\n\n  /**\n   * Synchronously set the contents of this matrix to the result of an expression\n   * @param {SpeedyMatrixExpr} expr matrix expression\n   * @returns {SpeedyMatrix} this\n   */\n  setToSync(expr) {\n    const {\n      wasm,\n      memory\n    } = _speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_1__/* .SpeedyMatrixWASM */ .U.handle;\n\n    // evaluate the expression\n    const result = expr._evaluate(wasm, memory);\n\n    /*\n    // shallow copy the results to this matrix\n    // limitation: can't handle blocks properly\n    // (a tree-like structure could be useful)\n    this._rows = result.rows;\n    this._columns = result.columns;\n    //this._dtype = result.dtype;\n    this._data = result.data;\n    this._step0 = result.step0;\n    this._step1 = result.step1;\n    */\n\n    // validate shape\n    _utils_utils__WEBPACK_IMPORTED_MODULE_3__/* .Utils */ .A.assert(this._rows === result._rows && this._columns === result._columns && this.dtype === result.dtype, `Can't set the values of a ${this.rows} x ${this.columns} ${this.dtype} matrix to those of a ${result.rows} x ${result.columns} ${result.dtype} matrix`);\n\n    // deep copy\n    const step0 = this._step0,\n      step1 = this._step1,\n      rstep0 = result._step0,\n      rstep1 = result._step1;\n    if (step0 === rstep0 && step1 === rstep1 && this._data.length === result._data.length) {\n      // fast copy\n      this._data.set(result._data);\n    } else {\n      // copy each element\n      for (let column = this._columns - 1; column >= 0; column--) {\n        for (let row = this._rows - 1; row >= 0; row--) this._data[row * step0 + column * step1] = result._data[row * rstep0 + column * rstep1];\n      }\n    }\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Fill this matrix with a scalar value\n   * @param {number} value\n   * @returns {SpeedyPromise<SpeedyMatrix>} resolves to this\n   */\n  fill(value) {\n    this.fillSync(value);\n    return _speedy_promise__WEBPACK_IMPORTED_MODULE_2__/* .SpeedyPromise */ .i.resolve(this);\n  }\n\n  /**\n   * Synchronously fill this matrix with a scalar value\n   * @param {number} value\n   * @returns {SpeedyMatrix} this\n   */\n  fillSync(value) {\n    value = +value;\n    if (this._rows * this._columns === this._data.length) {\n      this._data.fill(value);\n      return this;\n    }\n    for (let column = 0; column < this._columns; column++) {\n      for (let row = 0; row < this._rows; row++) {\n        this._data[row * this._step0 + column * this._step1] = value;\n      }\n    }\n    return this;\n  }\n\n  /**\n   * Evaluate this expression\n   * @param {WebAssembly.Instance} wasm\n   * @param {SpeedyMatrixWASMMemory} memory\n   * @returns {SpeedyMatrix}\n   */\n  _evaluate(wasm, memory) {\n    return this;\n  }\n}\n\n/***/ }),\n\n/***/ 6634:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Q: () => (/* binding */ SpeedyNamespace)\n/* harmony export */ });\n/* harmony import */ var _utils_errors__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(8581);\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-namespace.js\n * Symbolizes a namespace\n */\n\n\n\n/**\n * An abstract namespace\n * @abstract\n */\nclass SpeedyNamespace {\n  /**\n   * Namespaces can't be instantiated.\n   * Only static methods are allowed.\n   * @abstract\n   * @throws SpeedyError\n   */\n  constructor() {\n    // only static methods are allowed\n    throw new _utils_errors__WEBPACK_IMPORTED_MODULE_0__/* .AbstractMethodError */ .aQ(`Namespaces can't be instantiated`);\n  }\n}\n\n/***/ }),\n\n/***/ 9192:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   i: () => (/* binding */ SpeedyPromise)\n/* harmony export */ });\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-promise.js\n * Speedy Promises: a fast implementation of Promises\n */\n\nconst PENDING = 0;\nconst FULFILLED = 1;\nconst REJECTED = 2;\nconst SUSPEND_ASYNC = 1;\nconst asap = typeof queueMicrotask !== 'undefined' && queueMicrotask ||\n// browsers\ntypeof process !== 'undefined' && process.nextTick || (\n// node.js\nf => Promise.resolve().then(() => f())); // most compatible\n\n/**\n * SpeedyPromise: Super Fast Promises. SpeedyPromises can\n * interoperate with ES6 Promises. This implementation is\n * based on the Promises/A+ specification.\n * @template T\n */\nclass SpeedyPromise {\n  /**\n   * Constructor\n   * @param {function(function(T=): void, function(Error): void): void} callback\n   */\n  constructor(callback) {\n    this._state = PENDING;\n    this._value = undefined;\n    this._onFulfillment = null;\n    this._onRejection = null;\n    this._children = 0;\n    this[0] = this;\n    this._parent = undefined;\n    this._flags = 0;\n    this._fulfill = this._fulfill.bind(this);\n    this._reject = this._reject.bind(this);\n    this._resolve = this._resolve.bind(this);\n    this._broadcastIfAsync = this._broadcastIfAsync.bind(this);\n    callback(this._fulfill, this._reject);\n  }\n\n  /**\n   * Setup handlers\n   * @template U, V=never\n   * @param {null|undefined|(function(T): U|PromiseLike<U>|SpeedyPromise<U>)} onFulfillment called when the SpeedyPromise is fulfilled\n   * @param {null|undefined|(function(Error): V|PromiseLike<V>|SpeedyPromise<V>)} [onRejection] called when the SpeedyPromise is rejected\n   * @returns {SpeedyPromise<U>}\n   */\n  then(onFulfillment, onRejection = null) {\n    const child = new SpeedyPromise(this._nop);\n    child._onFulfillment = typeof onFulfillment === 'function' && onFulfillment;\n    child._onRejection = typeof onRejection === 'function' && onRejection;\n    child._parent = this;\n    this[this._children++] = child; // attach child\n    this._flags &= ~SUSPEND_ASYNC; // restore the async behavior\n    this._notify();\n    return child;\n  }\n\n  /**\n   * Setup rejection handler\n   * @template U, V=never\n   * @param {null|undefined|(function(Error): V|PromiseLike<V>|SpeedyPromise<V>)} [onRejection] called when the SpeedyPromise is rejected\n   * @returns {SpeedyPromise<V>}\n   */\n  catch(onRejection) {\n    return this.then(null, onRejection);\n  }\n\n  /**\n   * Execute a callback when the promise is settled\n   * (i.e., fulfilled or rejected)\n   * @param {function(): void} onFinally\n   * @returns {SpeedyPromise<T>}\n   */\n  finally(onFinally) {\n    const fn = val => {\n      onFinally();\n      return val;\n    };\n    return this.then(fn, fn);\n  }\n\n  /**\n   * Start the computation immediately, synchronously.\n   * Can't afford to spend any time at all waiting for micro-tasks, etc.\n   * @returns {SpeedyPromise<T>} this\n   */\n  turbocharge() {\n    let my = this;\n\n    // suspend the async behavior\n    this._flags |= SUSPEND_ASYNC;\n    while (my._parent !== undefined) {\n      my = my._parent;\n      my._flags |= SUSPEND_ASYNC;\n    }\n\n    // notify the children of the root\n    my._notify(); // will be synchronous\n\n    // return this SpeedyPromise\n    return this;\n  }\n\n  /**\n   * Convert to string\n   * @returns {string}\n   */\n  toString() {\n    switch (this._state) {\n      case PENDING:\n        return `SpeedyPromise { <pending> }`;\n      case FULFILLED:\n        return `SpeedyPromise { <fulfilled> ${this._value} }`;\n      case REJECTED:\n        return `SpeedyPromise { <rejected> ${this._value} }`;\n      default:\n        return '';\n    }\n  }\n\n  /**\n   * Symbol.toStringTag\n   * @returns {string}\n   */\n  get [Symbol.toStringTag]() {\n    return 'SpeedyPromise';\n  }\n\n  /**\n   * Creates a resolved SpeedyPromise\n   * @template U\n   * @param {U} [value]\n   * @returns {SpeedyPromise<U>}\n   */\n  static resolve(value) {\n    const promise = new SpeedyPromise(this._snop);\n    if (typeof value === 'object' && value !== null && 'then' in value || typeof value === 'function' && 'then' in value) {\n      // resolve asynchronously\n      promise._resolve(value);\n    } else {\n      // fulfill synchronously\n      promise._value = value;\n      promise._state = FULFILLED;\n    }\n    return promise;\n  }\n\n  /**\n   * Creates a rejected SpeedyPromise\n   * @template U\n   * @param {Error} reason\n   * @returns {SpeedyPromise<U>}\n   */\n  static reject(reason) {\n    const promise = new SpeedyPromise(this._snop);\n    promise._value = reason;\n    promise._state = REJECTED;\n    return promise;\n  }\n\n  /**\n   * Returns a SpeedyPromise that resolves to an array\n   * containing the results of the input promises/values,\n   * in their given order. The returned SpeedyPromise will\n   * resolve if all input promises resolve, or reject if\n   * any input promise rejects.\n   * @template U\n   * @param {Iterable<U>|Iterable<SpeedyPromise<U>>|Iterable<Promise<U>>} iterable e.g., a SpeedyPromise[], a thenable[]\n   * @returns {SpeedyPromise<U[]>}\n   *\n   * FIXME iterables need not be all <U>\n   */\n  static all(iterable) {\n    return new SpeedyPromise((resolve, reject) => {\n      const input = [];\n\n      // get elements\n      for (const element of iterable) input.push(element);\n\n      // resolve synchronously if there are no elements\n      const length = input.length;\n      if (length == 0) {\n        resolve([]);\n        return;\n      }\n\n      // resolve asynchronously\n      let counter = length;\n      const output = new Array(length);\n      const partialResolve = i => val => {\n        output[i] = val;\n        if (0 == --counter) resolve(output);\n      };\n      for (let i = 0; i < length; i++) {\n        const element = input[i];\n        if (element.__proto__ === SpeedyPromise.prototype || element.__proto__ === Promise.prototype) element.then(partialResolve(i), reject);else SpeedyPromise.resolve(element).then(partialResolve(i), reject);\n      }\n    });\n  }\n\n  /**\n   * Returns a promise that gets fulfilled or rejected as soon\n   * as the first promise in the iterable gets fulfilled or\n   * rejected (with its value/reason).\n   * @template U\n   * @param {Iterable<U>|Iterable<SpeedyPromise<U>>|Iterable<Promise<U>>} iterable e.g., a SpeedyPromise[], a thenable[]\n   * @returns {SpeedyPromise<U>}\n   */\n  static race(iterable) {\n    return new SpeedyPromise((resolve, reject) => {\n      const input = [];\n\n      // get elements\n      for (const element of iterable) input.push(element);\n\n      // if the iterable is empty, the promise\n      // will be pending forever...\n\n      // resolve asynchronously\n      const length = input.length;\n      for (let i = 0; i < length; i++) {\n        const element = input[i];\n        if (element.__proto__ === SpeedyPromise.prototype || element.__proto__ === Promise.prototype) element.then(resolve, reject);else SpeedyPromise.resolve(element).then(resolve, reject);\n      }\n    });\n  }\n\n  /**\n   * Fulfill this promise with a value\n   * @param {T} value\n   */\n  _fulfill(value) {\n    this._setState(FULFILLED, value);\n  }\n\n  /**\n   * Reject this promise with a reason\n   * @param {Error} reason\n   */\n  _reject(reason) {\n    this._setState(REJECTED, reason);\n  }\n\n  /**\n   * Set the state and the value of this promise\n   * @param {number} state\n   * @param {T|Error} value\n   */\n  _setState(state, value) {\n    // the promise is already fulfilled or rejected\n    if (this._state != PENDING) return;\n\n    // set the new state\n    this._state = state;\n    this._value = value;\n    this._notify();\n  }\n\n  /**\n   * Notify my children that this promise is no\n   * longer pending. This is an async operation:\n   * my childen will be notified \"as soon\n   * as possible\" (it will be scheduled).\n   * We may force this to be synchronous, though\n   */\n  _notify() {\n    // nothing to do\n    if (this._state == PENDING) return;\n\n    // have we turbocharged this promise?\n    if (this._flags & SUSPEND_ASYNC) {\n      this._broadcast(); // execute synchronously\n      return;\n    }\n\n    // install a timer (default behavior)\n    asap(this._broadcastIfAsync);\n  }\n\n  /**\n   * Helper method\n   */\n  _broadcastIfAsync() {\n    // we may have installed a timer at some\n    // point, but turbocharged the promise later\n    if (!(this._flags & SUSPEND_ASYNC)) this._broadcast();\n  }\n\n  /**\n   * Tell my children that this promise\n   * is either fulfilled or rejected.\n   * This is a synchronous operation\n   */\n  _broadcast() {\n    const children = this._children;\n    const state = this._state;\n    if (state === FULFILLED) {\n      for (let i = 0; i < children; i++) {\n        const child = this[i];\n        const callback = child._onFulfillment;\n        try {\n          if (callback) {\n            if (callback !== child._nop) {\n              child._resolve(callback(this._value)); // promise resolution procedure\n              child._onFulfillment = child._nop; // will not be called again\n            }\n          } else child._fulfill(this._value);\n        } catch (e) {\n          child._reject(e);\n        }\n      }\n    } else if (state === REJECTED) {\n      for (let i = 0; i < children; i++) {\n        const child = this[i];\n        const callback = child._onRejection;\n        try {\n          if (callback) {\n            if (callback !== child._nop) {\n              child._resolve(callback(this._value)); // promise resolution procedure\n              child._onRejection = child._nop; // will not be called again\n            }\n          } else child._reject(this._value);\n        } catch (e) {\n          child._reject(e);\n        }\n      }\n    }\n  }\n\n  /**\n   * Promise Resolution Procedure\n   * based on the Promises/A+ spec\n   * @param {T} x\n   */\n  _resolve(x) {\n    if (typeof x !== 'object' && typeof x !== 'function' || x === null) {\n      // if(x !== Object(x))\n      this._fulfill(x);\n      return;\n    }\n    if (x === this) throw new TypeError(); // Circular reference\n\n    if (x.__proto__ === SpeedyPromise.prototype || x.__proto__ === Promise.prototype) {\n      x.then(this._resolve, this._reject);\n      return;\n    }\n    try {\n      const then = x.then;\n      if (typeof then === 'function') {\n        let resolve = this._resolve,\n          reject = this._reject;\n        try {\n          then.call(x, y => {\n            resolve(y);\n            resolve = reject = this._nop;\n          }, r => {\n            reject(r);\n            resolve = reject = this._nop;\n          });\n        } catch (e) {\n          if (resolve !== this._nop && reject !== this._nop) this._reject(e);\n        }\n      } else {\n        this._fulfill(x);\n      }\n    } catch (e) {\n      this._reject(e);\n    }\n  }\n\n  /**\n   * No-operation\n   */\n  _nop() {}\n\n  /**\n   * Static no-operation\n   */\n  static _snop() {}\n}\n\n//module.exports = { SpeedyPromise };\n\n/*\n// Uncomment to test performance with regular Promises\nmodule.exports = { SpeedyPromise: Promise };\nPromise.prototype.turbocharge = function() { return this };\n*/\n\n/***/ }),\n\n/***/ 9420:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  gx: () => (/* binding */ createShader),\n  bf: () => (/* binding */ importShader)\n});\n\n// UNUSED EXPORTS: ShaderDeclaration, ShaderDeclarationBuilder\n\n// EXTERNAL MODULE: ./src/gpu/speedy-gl.js\nvar speedy_gl = __webpack_require__(1001);\n// EXTERNAL MODULE: ./src/utils/utils.js\nvar utils = __webpack_require__(9037);\n// EXTERNAL MODULE: ./src/utils/types.js\nvar types = __webpack_require__(6049);\n// EXTERNAL MODULE: ./src/utils/errors.js\nvar errors = __webpack_require__(8581);\n;// CONCATENATED MODULE: ./src/gpu/shader-preprocessor.js\nfunction _wrapRegExp() { _wrapRegExp = function (e, r) { return new BabelRegExp(e, void 0, r); }; var e = RegExp.prototype, r = new WeakMap(); function BabelRegExp(e, t, p) { var o = RegExp(e, t); return r.set(o, p || r.get(e)), _setPrototypeOf(o, BabelRegExp.prototype); } function buildGroups(e, t) { var p = r.get(t); return Object.keys(p).reduce(function (r, t) { var o = p[t]; if (\"number\" == typeof o) r[t] = e[o];else { for (var i = 0; void 0 === e[o[i]] && i + 1 < o.length;) i++; r[t] = e[o[i]]; } return r; }, Object.create(null)); } return _inherits(BabelRegExp, RegExp), BabelRegExp.prototype.exec = function (r) { var t = e.exec.call(this, r); if (t) { t.groups = buildGroups(t, this); var p = t.indices; p && (p.groups = buildGroups(p, this)); } return t; }, BabelRegExp.prototype[Symbol.replace] = function (t, p) { if (\"string\" == typeof p) { var o = r.get(this); return e[Symbol.replace].call(this, t, p.replace(/\\$<([^>]+)>/g, function (e, r) { var t = o[r]; return \"$\" + (Array.isArray(t) ? t.join(\"$\") : t); })); } if (\"function\" == typeof p) { var i = this; return e[Symbol.replace].call(this, t, function () { var e = arguments; return \"object\" != typeof e[e.length - 1] && (e = [].slice.call(e)).push(buildGroups(e, i)), p.apply(this, e); }); } return e[Symbol.replace].call(this, t, p); }, _wrapRegExp.apply(this, arguments); }\nfunction _inherits(t, e) { if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, \"prototype\", { writable: !1 }), e && _setPrototypeOf(t, e); }\nfunction _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * shader-preprocessor.js\n * Custom preprocessor for shaders\n */\n\n\n\n\n\n\n/** @typedef {Object<string,number>} ShaderPreprocessorTemplateOfConstants */\n/** @typedef {import('./shader-declaration').ShaderDeclarationPreprocessorConstants} ShaderPreprocessorConstants */\n\n// Import numeric globals\nconst globals = __webpack_require__(3816);\nconst numericGlobals = /** @type {ShaderPreprocessorTemplateOfConstants} */\nObject.keys(globals).filter(key => typeof globals[key] == 'number').reduce((obj, key) => (obj[key] = globals[key], obj), {});\n\n/** @type {ShaderPreprocessorTemplateOfConstants} Constants available to all shaders */\nconst basicConstants = Object.freeze(Object.assign(Object.assign({}, numericGlobals), {}, {\n  // fragment shader\n  'FS_USE_CUSTOM_PRECISION': 0,\n  // use default precision settings\n  'FS_OUTPUT_TYPE': 0,\n  // normalized RGBA\n\n  // colors\n  'PIXELCOMPONENT_RED': types/* PixelComponent */.kQ.RED,\n  'PIXELCOMPONENT_GREEN': types/* PixelComponent */.kQ.GREEN,\n  'PIXELCOMPONENT_BLUE': types/* PixelComponent */.kQ.BLUE,\n  'PIXELCOMPONENT_ALPHA': types/* PixelComponent */.kQ.ALPHA\n}));\n\n/** @type {function(string,string):ShaderPreprocessorTemplateOfConstants} Platform-related constants available to all shaders */\nconst platformConstants = (platform, glRenderer) => Object.freeze({\n  'APPLE': /(Mac|iOS|iPhone|iPad|iPod)/i.test(platform) | 0,\n  // \"MacIntel\", \"macOS\", \"iOS\", \"iPhone\", \"iPad\"...\n  'APPLE_GPU': /Apple/.test(glRenderer) | 0,\n  // the renderer is always \"Apple GPU\" on Safari and on Epiphany at the time of this writing; on Chrome, it may be \"Apple M1\" for example...\n  'INTEL_GRAPHICS': /Intel.*Graphics/.test(glRenderer) | 0 // Intel[(R)] ... [HD] Graphics xyz ...\n});\n\n// Regular Expressions\nconst commentsRegex = [/\\/\\*(.|\\s)*?\\*\\//g, /\\/\\/.*$/gm];\nconst includeRegex = /^\\s*@\\s*include\\s+\"(.*?)\"/gm;\nconst constantRegex = /@(\\w+)@/g;\nconst unrollRegex = [/*#__PURE__*/_wrapRegExp(/@\\s*unroll\\s+?for\\s*\\(\\s*(int|)\\s*(\\w+)\\s*=\\s*(\\x2D?\\d+|\\w+)\\s*;\\s*\\2\\s*(<=?)\\s*(\\x2D?\\d+|\\w+)\\s*;\\s*\\2\\s*\\+\\+()\\s*\\)\\s*\\{\\s*([\\s\\S]+?)\\s*\\}/g, {\n  counter: 2\n}), /*#__PURE__*/_wrapRegExp(/@\\s*unroll\\s+?for\\s*\\(\\s*(int|)\\s*(\\w+)\\s*=\\s*(\\x2D?\\d+|\\w+)\\s*;\\s*\\2\\s*(<=?)\\s*(\\x2D?\\d+|\\w+)\\s*;\\s*\\2\\s*\\+=\\s*(\\x2D?\\d+)\\s*\\)\\s*\\{\\s*([\\s\\S]+?)\\s*\\}/g, {\n  counter: 2\n})];\n\n/**\n * Custom preprocessor for the shaders\n */\nclass ShaderPreprocessor {\n  /**\n   * Runs the preprocessor and generates GLSL code\n   * @param {ShaderPreprocessorConstants} defines user-provided preprocessor constants for this shader\n   * @param {string} infix annotated GLSL code\n   * @param {string} [prefix]\n   * @param {string} [suffix]\n   * @returns {string} preprocessed GLSL code\n   */\n  static generateGLSL(defines, infix, prefix = null, suffix = null) {\n    //\n    // The preprocessor will remove comments from GLSL code,\n    // include requested GLSL files and import global constants\n    // defined for all shaders (see above)\n    //\n    const errors = []; // compile-time errors\n    const constants = generateConstants(defines);\n    const annotatedGLSL = generateUnprocessedGLSL(defines, infix, prefix, suffix);\n    return unrollLoops(annotatedGLSL.replace(commentsRegex[0], '').replace(commentsRegex[1], '').replace(constantRegex, (_, name) => String(\n    // Replace preprocessor @CONSTANTS@ by their numeric values\n    constants.has(name) ? Number(constants.get(name)) : (errors.push(`Undefined constant ${name}`), 0))).replace(includeRegex, (_, filename) =>\n    // Included files may include other files.\n    // XXX no cycle detection!\n    ShaderPreprocessor.generateGLSL(defines, readfileSync(filename))), defines) + errors.map(msg => `\\n#error ${msg}\\n`).join('');\n  }\n}\n\n/**\n * Generate GLSL code based on the input arguments\n * @param {ShaderPreprocessorConstants} defines\n * @param {string} infix\n * @param {string} [prefix]\n * @param {string} [suffix]\n * @returns {string} GLSL code\n */\nfunction generateUnprocessedGLSL(defines, infix, prefix = null, suffix = null) {\n  const parts = [];\n  if (prefix !== null) parts.push(prefix);\n  for (const [key, value] of defines) parts.push(`#define ${key} ${Number(value)}`);\n  parts.push(infix);\n  if (suffix !== null) parts.push(suffix);\n  return parts.join('\\n');\n}\n\n/**\n * Generate pre-processor constants. Constants provided by the\n * user have higher priority than globally available constants.\n * @param {ShaderPreprocessorConstants} defines user-provided\n * @returns {ShaderPreprocessorConstants}\n */\nfunction generateConstants(defines) {\n  utils/* Utils */.A.assert(speedy_gl/* SpeedyGL */.c.isInitialized());\n  const myConstants = /** @type {ShaderPreprocessorConstants} */new Map();\n  const globalConstants = Object.assign(Object.create(null), basicConstants, platformConstants(utils/* Utils */.A.platformString(), speedy_gl/* SpeedyGL */.c.instance.renderer));\n\n  // globally available constants have lower priority\n  for (const key in globalConstants) {\n    //if(Object.prototype.hasOwnProperty.call(globalConstants, key))\n    myConstants.set(key, globalConstants[key]);\n  }\n\n  // user-defined constants have higher priority\n  for (const [key, value] of defines) myConstants.set(key, value);\n\n  // done!\n  return myConstants;\n}\n\n/**\n* Reads a shader from the shaders/include/ folder\n* @param {string} filename\n* @returns {string}\n*/\nfunction readfileSync(filename) {\n  if (String(filename).match(/^[a-zA-Z0-9_-]+\\.glsl$/)) return __webpack_require__(5235)(\"./\" + filename);\n  throw new errors/* FileNotFoundError */.kG(`Shader preprocessor: can't read file \"${filename}\"`);\n}\n\n/**\n * Unroll for loops in our own preprocessor\n * @param {string} code\n * @param {ShaderPreprocessorConstants} defines\n * @returns {string}\n */\nfunction unrollLoops(code, defines) {\n  //\n  // Currently, only integer for loops with positive step values\n  // can be unrolled. (TODO: negative step values?)\n  //\n  // The current implementation does not support curly braces\n  // inside unrolled loops. You may define macros to get around\n  // this, but do you actually need to unroll such loops?\n  //\n  // Loops that don't fit the supported pattern will crash\n  // the preprocessor if you try to unroll them.\n  //\n  const fn = unroll.bind(defines); // CRAZY!\n  const n = unrollRegex.length;\n  for (let i = 0; i < n; i++) code = code.replace(unrollRegex[i], fn);\n  return code;\n}\n\n/**\n * Unroll a loop pattern (regexp)\n * @param {string} match the matched for loop\n * @param {string} type\n * @param {string} counter\n * @param {string} start\n * @param {string} cmp\n * @param {string} end\n * @param {string} step\n * @param {string} loopcode\n * @returns {string} unrolled loop\n */\nfunction unroll(match, type, counter, start, cmp, end, step, loopcode) {\n  const defines = /** @type {ShaderPreprocessorConstants} */this;\n\n  // check if the loop limits are numeric constants or #defined numbers from the outside\n  const hasStart = Number.isFinite(+start) || defines.has(start);\n  const hasEnd = Number.isFinite(+end) || defines.has(end);\n  if (!hasStart || !hasEnd) {\n    if (defines.size > 0) throw new errors/* ParseError */.mB(`Can't unroll loop: unknown limits (start=${start}, end=${end}). Code:\\n\\n${match}`);else return match; // don't unroll now, because defines is empty - maybe we'll succeed in the next pass\n  }\n\n  // parse and validate limits & step\n  let istart = defines.has(start) ? defines.get(start) : parseInt(start);\n  let iend = defines.has(end) ? defines.get(end) : parseInt(end);\n  let istep = step.length == 0 ? 1 : parseInt(step);\n  utils/* Utils */.A.assert(istart <= iend && istep > 0);\n\n  /*\n  // debug\n  console.log(`Encontrei \"${match}\"`);\n  console.log(`type=\"${type}\"`);\n  console.log(`counter=\"${counter}\"`);\n  console.log(`start=\"${start}\"`);\n  console.log(`cmp=\"${cmp}\"`);\n  console.log(`end=\"${end}\"`);\n  console.log(`step=\"${step}\"`);\n  console.log(`loopcode=\"${loopcode}\"`)\n  console.log('Defines:', defines);\n  */\n\n  // continue statements are not supported inside unrolled loops\n  // and will generate a compiler error. Using break is ok.\n  const hasBreak = loopcode.match(/\\bbreak\\s*;/) !== null;\n\n  // create a new scope\n  let unrolledCode = hasBreak ? 'switch(1) { default:\\n' : '{\\n';\n\n  // declare counter\n  unrolledCode += `${type} ${counter};\\n`;\n\n  // unroll loop\n  iend += cmp == '<=' ? 1 : 0;\n  for (let i = istart; i < iend; i += istep) unrolledCode += `{\\n${counter} = ${i};\\n${loopcode}\\n}\\n`;\n\n  // close scope\n  unrolledCode += '}\\n';\n  //console.log('Unrolled code:\\n\\n' + unrolledCode);\n\n  // done!\n  return unrolledCode;\n}\n;// CONCATENATED MODULE: ./src/gpu/shader-declaration.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * shader-declaration.js\n * Encapsulates a shader declaration\n */\n\n\n\n\nconst DEFAULT_ATTRIBUTES = Object.freeze({\n  position: 'a_position',\n  texCoord: 'a_texCoord'\n});\nconst DEFAULT_ATTRIBUTES_LOCATION = Object.freeze({\n  position: 0,\n  // use location 0; see https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices\n  texCoord: 1\n});\nconst DEFAULT_VERTEX_SHADER_PREFIX = `#version 300 es\nprecision highp float;\nprecision highp int;\n\nlayout (location=${DEFAULT_ATTRIBUTES_LOCATION.position}) in vec2 ${DEFAULT_ATTRIBUTES.position};\nlayout (location=${DEFAULT_ATTRIBUTES_LOCATION.texCoord}) in vec2 ${DEFAULT_ATTRIBUTES.texCoord};\nout highp vec2 texCoord;\nuniform highp vec2 texSize;\n\n#define vsinit() \\\ngl_Position = vec4(${DEFAULT_ATTRIBUTES.position}, 0.0f, 1.0f); \\\ntexCoord = ${DEFAULT_ATTRIBUTES.texCoord};\n\\n\\n`;\nconst DEFAULT_VERTEX_SHADER = `#define vsmain() ;`;\nconst DEFAULT_VERTEX_SHADER_SUFFIX = `\\n\\nvoid main() { vsinit(); vsmain(); }\\n`;\nconst DEFAULT_FRAGMENT_SHADER_PREFIX = `#version 300 es\n\n#if @FS_USE_CUSTOM_PRECISION@ == 0\nprecision mediump float; // ~float16\nprecision mediump sampler2D;\nprecision highp int; // int32\n#endif\n\n#if @FS_OUTPUT_TYPE@ == 0\n#define OUT_TYPE mediump vec4\n#elif @FS_OUTPUT_TYPE@ == 1\n#define OUT_TYPE mediump ivec4\n#elif @FS_OUTPUT_TYPE@ == 2\n#define OUT_TYPE mediump uvec4\n#else\n#error Unknown FS_OUTPUT_TYPE\n#endif\n\nout OUT_TYPE color;\nin highp vec2 texCoord;\nuniform highp vec2 texSize;\n\n@include \"global.glsl\"\\n\\n`;\nconst PRIVATE_TOKEN = Symbol();\n\n/** @typedef {string} ShaderDeclarationUnprocessedGLSL */\n/** @typedef {string[]} ShaderDeclarationArgumentList */\n/** @typedef {Map<string,string>} ShaderDeclarationUniformTypes */\n/** @typedef {Map<string,number>} ShaderDeclarationPreprocessorConstants */\n\n/**\n * Shader Declaration\n * @abstract\n */\nclass ShaderDeclaration {\n  /**\n   * @private Constructor\n   * @param {Symbol} privateToken\n   * @param {ShaderDeclarationArgumentList} argumentList\n   * @param {ShaderDeclarationPreprocessorConstants} defines\n   * @param {ShaderDeclarationUnprocessedGLSL} fsSource unprocessed GLSL code of the fragment shader\n   * @param {ShaderDeclarationUnprocessedGLSL} vsSource unprocessed GLSL code of the vertex shader\n   */\n  constructor(privateToken, argumentList, defines, fsSource, vsSource) {\n    // private constructor!\n    if (privateToken !== PRIVATE_TOKEN) throw new errors/* IllegalOperationError */.Er();\n\n    /** @type {ShaderDeclarationArgumentList} an ordered list of uniform names */\n    this._arguments = [...argumentList];\n\n    /** @type {ShaderDeclarationPreprocessorConstants} externally #defined pre-processor constants */\n    this._defines = new Map(defines);\n\n    /** @type {string} preprocessed source code of the fragment shader */\n    this._fragmentSource = ShaderPreprocessor.generateGLSL(this._defines, fsSource, DEFAULT_FRAGMENT_SHADER_PREFIX);\n\n    /** @type {string} preprocessed source code of the vertex shader */\n    this._vertexSource = ShaderPreprocessor.generateGLSL(this._defines, vsSource, DEFAULT_VERTEX_SHADER_PREFIX, DEFAULT_VERTEX_SHADER_SUFFIX);\n\n    /** @type {ShaderDeclarationUniformTypes} it maps uniform names to their types */\n    this._uniforms = this._autodetectUniforms(this._fragmentSource + '\\n' + this._vertexSource);\n\n    // validate arguments\n    this._validateArguments(this._arguments, this._uniforms);\n  }\n\n  /**\n   * Return the preprocessed GLSL source code of the fragment shader\n   * @returns {string}\n   */\n  get fragmentSource() {\n    return this._fragmentSource;\n  }\n\n  /**\n   * Return the preprocessed GLSL source code of the vertex shader\n   * @returns {string}\n   */\n  get vertexSource() {\n    return this._vertexSource;\n  }\n\n  /**\n   * Get the names of the vertex shader attributes\n   * @returns {typeof DEFAULT_ATTRIBUTES}\n   */\n  get attributes() {\n    return DEFAULT_ATTRIBUTES;\n  }\n\n  /**\n   * Get the pre-defined locations of the vertex shader attributes\n   * @returns {typeof DEFAULT_ATTRIBUTES_LOCATION}\n   */\n  get locationOfAttributes() {\n    return DEFAULT_ATTRIBUTES_LOCATION;\n  }\n\n  /**\n   * Names of the arguments that will be passed to the Shader,\n   * corresponding to GLSL uniforms, in the order they will be passed\n   * @returns {string[]}\n   */\n  get arguments() {\n    return [].concat(this._arguments);\n  }\n\n  /**\n   * Names of the uniforms declared in the shader\n   * @returns {string[]}\n   */\n  get uniforms() {\n    return Array.from(this._uniforms.keys());\n  }\n\n  /**\n   * The GLSL type of a uniform variable declared in the shader\n   * @param {string} name\n   * @returns {string}\n   */\n  uniformType(name) {\n    if (!this._uniforms.has(name)) throw new errors/* IllegalArgumentError */.qw(`Unrecognized uniform variable: \"${name}\"`);\n    return this._uniforms.get(name);\n  }\n\n  /**\n   * The value of an externally defined constant, i.e., via withDefines()\n   * @param {string} name \n   * @returns {number}\n   */\n  definedConstant(name) {\n    if (!this._defines.has(name)) throw new errors/* IllegalArgumentError */.qw(`Unrecognized externally defined constant: \"${name}\"`);\n    return this._defines.get(name);\n  }\n\n  /**\n   * Parses a GLSL source and detects the uniform variables,\n   * as well as their types\n   * @param {string} preprocessedSource \n   * @returns {ShaderDeclarationUniformTypes} specifies the types of all uniforms\n   */\n  _autodetectUniforms(preprocessedSource) {\n    const sourceWithoutComments = preprocessedSource; // assume we've preprocessed the source already\n    const regex = /^\\s*uniform\\s+(highp\\s+|mediump\\s+|lowp\\s+)?(\\w+)\\s+([^;]+)/gm;\n    const uniforms = /** @type {ShaderDeclarationUniformTypes} */new Map();\n    let match;\n    while ((match = regex.exec(sourceWithoutComments)) !== null) {\n      const type = match[2];\n      const names = match[3].split(',').map(name => name.trim()).filter(name => name); // trim & remove empty names\n\n      for (const name of names) {\n        if (name.endsWith(']')) {\n          // is it an array?\n          if (!(match = name.match(/(\\w+)\\s*\\[\\s*(\\d+)\\s*\\]$/))) throw new errors/* ParseError */.mB(`Unspecified array length for uniform \"${name}\" in the shader`);\n\n          // read array name & size\n          const [array, size] = [match[1], Number(match[2])];\n\n          // register uniforms\n          for (let i = 0; i < size; i++) uniforms.set(`${array}[${i}]`, type);\n        } else {\n          // register a regular uniform\n          if (!uniforms.has(name) || uniforms.get(name) === type) uniforms.set(name, type);else throw new errors/* IllegalOperationError */.Er(`Redefinition of uniform \"${name}\" in the shader`);\n        }\n      }\n    }\n    return uniforms;\n  }\n\n  /**\n   * Checks if all the arguments of the shader declaration are backed by a\n   * uniform variable in GLSL code\n   * @param {ShaderDeclarationArgumentList} argumentList\n   * @param {ShaderDeclarationUniformTypes} uniforms\n   * @throws {IllegalArgumentError}\n   */\n  _validateArguments(argumentList, uniforms) {\n    for (const argname of argumentList) {\n      if (!uniforms.has(argname)) {\n        if (!uniforms.has(argname + '[0]')) throw new errors/* IllegalArgumentError */.qw(`Argument \"${argname}\" has not been declared in the shader`);\n      }\n    }\n  }\n}\n\n/**\n * A ShaderDeclaration that has its GLSL code stored in-memory\n */\nclass MemoryShaderDeclaration extends ShaderDeclaration {\n  /**\n   * @private Constructor\n   * @param {Symbol} privateToken\n   * @param {ShaderDeclarationArgumentList} argumentList\n   * @param {ShaderDeclarationPreprocessorConstants} defines\n   * @param {ShaderDeclarationUnprocessedGLSL} fsSource unprocessed GLSL code of the fragment shader\n   * @param {ShaderDeclarationUnprocessedGLSL} [vsSource] unprocessed GLSL code of the vertex shader\n   */\n  constructor(privateToken, argumentList, defines, fsSource, vsSource = DEFAULT_VERTEX_SHADER) {\n    super(privateToken, argumentList, defines, fsSource, vsSource);\n\n    /** @type {ShaderDeclarationUnprocessedGLSL} unprocessed GLSL code of the fragment shader */\n    this._fsUnprocessedSource = String(fsSource);\n\n    /** @type {ShaderDeclarationUnprocessedGLSL} unprocessed GLSL code of the vertex shader */\n    this._vsUnprocessedSource = String(vsSource);\n  }\n}\n\n/**\n * A ShaderDeclaration that has its GLSL code stored in a file\n */\nclass FileShaderDeclaration extends ShaderDeclaration {\n  /**\n   * @private Constructor\n   * @param {Symbol} privateToken\n   * @param {ShaderDeclarationArgumentList} argumentList\n   * @param {ShaderDeclarationPreprocessorConstants} defines\n   * @param {string} fsFilepath path to the file of the unprocessed GLSL code of the fragment shader\n   * @param {string} [vsFilepath] path to the file of the unprocessed GLSL code of the vertex shader\n   */\n  constructor(privateToken, argumentList, defines, fsFilepath, vsFilepath = '') {\n    // validate paths\n    if (!String(fsFilepath).match(/^[a-zA-Z0-9_\\-/]+\\.glsl$/)) throw new errors/* FileNotFoundError */.kG(`Can't import fragment shader at \"${fsFilepath}\"`);else if (vsFilepath != '' && !String(vsFilepath).match(/^[a-zA-Z0-9_\\-/]+\\.vs\\.glsl$/)) throw new errors/* FileNotFoundError */.kG(`Can't import vertex shader at \"${vsFilepath}\"`);\n\n    // import files\n    const fsSource = __webpack_require__(4606)(\"./\" + String(fsFilepath));\n    const vsSource = vsFilepath != '' ? __webpack_require__(4606)(\"./\" + String(vsFilepath)) : DEFAULT_VERTEX_SHADER;\n\n    // super class\n    super(privateToken, argumentList, defines, fsSource, vsSource);\n\n    /** @type {string} filepath of the fragment shader */\n    this._fsFilepath = String(fsFilepath);\n\n    /** @type {string} filepath of the vertex shader */\n    this._vsFilepath = String(vsFilepath);\n  }\n\n  /**\n   * Return the preprocessed GLSL source code of the fragment shader\n   * @returns {string}\n   */\n  get fragmentSource() {\n    // we override this method to include the filepath. The motivation\n    // is to easily identify the file when debugging compiling errors.\n    return this._addHeader('// File: ' + this._fsFilepath, super.fragmentSource);\n  }\n\n  /**\n   * Return the preprocessed GLSL source code of the vertex shader\n   * @returns {string}\n   */\n  get vertexSource() {\n    // we override this method to include the filepath. The motivation\n    // is to easily identify the file when debugging compiling errors.\n    return this._addHeader('// File: ' + (this._vsFilepath != '' ? this._vsFilepath : '(default-vs) ' + this._fsFilepath), super.vertexSource);\n  }\n\n  /**\n   * Add a header to a GLSL code\n   * @param {string} header code to be added\n   * @param {string} src pre-processed GLSL code\n   * @returns {string} src with an added header\n   */\n  _addHeader(header, src) {\n    utils/* Utils */.A.assert(header.startsWith('//') && !header.includes('\\n'));\n    const j = src.indexOf('\\n');\n    const versionDirective = src.substr(0, j);\n    const body = src.substr(j);\n    utils/* Utils */.A.assert(versionDirective.startsWith('#version '));\n    const head = versionDirective + '\\n' + header;\n    return head + body;\n  }\n}\n\n/**\n * A builder of a ShaderDeclaration\n * @abstract\n */\nclass ShaderDeclarationBuilder {\n  /**\n   * @private Constructor\n   * @param {Symbol} privateToken\n   */\n  constructor(privateToken) {\n    if (privateToken !== PRIVATE_TOKEN) throw new errors/* IllegalOperationError */.Er(); // private constructor!\n\n    /** @type {string[]} ordered list of uniform names */\n    this._arguments = [];\n\n    /** @type {ShaderDeclarationPreprocessorConstants} externally #defined pre-processor constants */\n    this._defines = new Map();\n  }\n\n  /**\n   * Specify the list & order of arguments to be\n   * passed to the shader\n   * @param  {string[]} args argument names\n   * @returns {this}\n   */\n  withArguments(...args) {\n    // the list of arguments may be declared only once\n    if (this._arguments.length > 0) throw new errors/* IllegalOperationError */.Er(`Redefinition of shader arguments`);\n\n    // get arguments\n    for (let j = 0; j < args.length; j++) this._arguments.push(String(args[j]));\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Specify a set of #defines to be prepended to the shader\n   * @param {Object<string,number>} defines key-value pairs\n   * @returns {this}\n   */\n  withDefines(defines) {\n    // the list of #defines may be defined only once\n    if (this._defines.size > 0) throw new errors/* IllegalOperationError */.Er(`Redefinition of externally defined constants of a shader`);\n\n    // store and write the #defines\n    const keys = Object.keys(defines);\n    for (const key of keys) {\n      const value = Number(defines[key]); // force numeric values (just in case)\n      this._defines.set(key, value);\n    }\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Build a ShaderDeclaration\n   * @returns {ShaderDeclaration}\n   */\n  build() {\n    throw new errors/* AbstractMethodError */.aQ();\n  }\n}\n\n/**\n * A builder of a MemoryShaderDeclaration\n */\nclass MemoryShaderDeclarationBuilder extends ShaderDeclarationBuilder {\n  /**\n   * @private Constructor\n   * @param {Symbol} privateToken\n   * @param {ShaderDeclarationUnprocessedGLSL} fsSource\n   * @param {ShaderDeclarationUnprocessedGLSL} [vsSource]\n   */\n  constructor(privateToken, fsSource, vsSource) {\n    super(privateToken);\n\n    /** @type {ShaderDeclarationUnprocessedGLSL} the unprocessed GLSL code of the fragment shader */\n    this._fsSource = String(fsSource);\n\n    /** @type {ShaderDeclarationUnprocessedGLSL|undefined} the unprocessed GLSL code of the vertex shader */\n    this._vsSource = vsSource !== undefined ? String(vsSource) : undefined;\n  }\n\n  /**\n   * Build a MemoryShaderDeclaration\n   * @returns {ShaderDeclaration}\n   */\n  build() {\n    return new MemoryShaderDeclaration(PRIVATE_TOKEN, this._arguments, this._defines, this._fsSource, this._vsSource);\n  }\n}\n\n/**\n * A builder of a FileShaderDeclaration\n */\nclass FileShaderDeclarationBuilder extends ShaderDeclarationBuilder {\n  /**\n   * @private Constructor\n   * @param {Symbol} privateToken\n   * @param {string} fsFilepath\n   * @param {string} [vsFilepath]\n   */\n  constructor(privateToken, fsFilepath, vsFilepath) {\n    super(privateToken);\n\n    /** @type {string} path to the unprocessed GLSL code of the fragment shader */\n    this._fsFilepath = String(fsFilepath);\n\n    /** @type {string|undefined} path to the unprocessed GLSL code of the vertex shader */\n    this._vsFilepath = vsFilepath !== undefined ? String(vsFilepath) : undefined;\n  }\n\n  /**\n   * Build a FileShaderDeclaration\n   * @returns {ShaderDeclaration}\n   */\n  build() {\n    return new FileShaderDeclaration(PRIVATE_TOKEN, this._arguments, this._defines, this._fsFilepath, this._vsFilepath);\n  }\n}\n\n/**\n * Import a ShaderDeclaration from a GLSL file\n * @param {string} filepath relative to the shaders/ folder (a .glsl file)\n * @param {string} [vsfilepath] optional vertex shader (a .vs.glsl file)\n * @returns {ShaderDeclaration}\n */\nfunction importShader(filepath, vsfilepath = undefined) {\n  return new FileShaderDeclarationBuilder(PRIVATE_TOKEN, filepath, vsfilepath);\n}\n\n/**\n * Create a ShaderDeclaration from a GLSL source code\n * @param {string} source fragment shader\n * @param {string} [vssource] optional vertex shader\n * @returns {ShaderDeclaration}\n */\nfunction createShader(source, vssource = undefined) {\n  return new MemoryShaderDeclarationBuilder(PRIVATE_TOKEN, source, vssource);\n}\n\n/***/ }),\n\n/***/ 1672:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   conv2D: () => (/* binding */ conv2D),\n/* harmony export */   convX: () => (/* binding */ convX),\n/* harmony export */   convY: () => (/* binding */ convY)\n/* harmony export */ });\n/* harmony import */ var _shader_declaration__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(9420);\n/* harmony import */ var _utils_utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(9037);\n/* harmony import */ var _utils_errors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(8581);\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * convolution.js\n * Convolution shader generators\n */\n\n\n\n\n\n/**\n * Generate a 2D convolution with a square kernel\n * @param {number[]} kernel convolution kernel\n * @param {number} [normalizationConstant] will be multiplied by all kernel entries\n * @returns {ShaderDeclarationBuilder}\n */\nfunction conv2D(kernel, normalizationConstant = 1.0) {\n  const kernel32 = new Float32Array(kernel.map(x => +x * +normalizationConstant));\n  const kSize = Math.sqrt(kernel32.length) | 0;\n  const N = kSize >> 1; // idiv 2\n\n  // validate input\n  if (kSize < 1 || kSize % 2 == 0) throw new _utils_errors__WEBPACK_IMPORTED_MODULE_2__/* .IllegalArgumentError */ .qw(`Can't perform a 2D convolution with an invalid kSize of ${kSize}`);else if (kSize * kSize != kernel32.length) throw new _utils_errors__WEBPACK_IMPORTED_MODULE_2__/* .IllegalArgumentError */ .qw(`Invalid 2D convolution kernel of ${kernel32.length} elements (expected: square)`);\n\n  // select the appropriate pixel function\n  const pixelAtOffset = N <= 7 ? 'pixelAtShortOffset' : 'pixelAtLongOffset';\n\n  // code generator\n  const foreachKernelElement = fn => _utils_utils__WEBPACK_IMPORTED_MODULE_1__/* .Utils */ .A.cartesian(_utils_utils__WEBPACK_IMPORTED_MODULE_1__/* .Utils */ .A.symmetricRange(N), _utils_utils__WEBPACK_IMPORTED_MODULE_1__/* .Utils */ .A.symmetricRange(N)).map(cur => fn(kernel32[(cur[0] + N) * kSize + (cur[1] + N)], cur[0], cur[1])).join('\\n');\n  const generateCode = (k, dy, dx) => `\n        result += ${pixelAtOffset}(image, ivec2(${-dx | 0}, ${-dy | 0})) * float(${+k});\n    `;\n\n  // shader\n  const source = `\n    uniform sampler2D image;\n\n    void main()\n    {\n        float alpha = threadPixel(image).a;\n        vec4 result = vec4(0.0f);\n\n        ${foreachKernelElement(generateCode)}\n\n        color = vec4(result.rgb, alpha);\n    }\n    `;\n\n  // done!\n  return (0,_shader_declaration__WEBPACK_IMPORTED_MODULE_0__/* .createShader */ .gx)(source).withArguments('image');\n}\n\n/**\n * Generate a 1D convolution function on the x-axis\n * @param {number[]} kernel convolution kernel\n * @param {number} [normalizationConstant] will be multiplied by all kernel entries\n * @returns {ShaderDeclarationBuilder}\n */\nfunction convX(kernel, normalizationConstant = 1.0) {\n  return conv1D('x', kernel, normalizationConstant);\n}\n\n/**\n * Generate a 1D convolution function on the y-axis\n * @param {number[]} kernel convolution kernel\n * @param {number} [normalizationConstant] will be multiplied by all kernel entries\n * @returns {ShaderDeclarationBuilder}\n */\nfunction convY(kernel, normalizationConstant = 1.0) {\n  return conv1D('y', kernel, normalizationConstant);\n}\n\n/**\n * 1D convolution function generator\n * @param {string} axis either \"x\" or \"y\"\n * @param {number[]} kernel convolution kernel\n * @param {number} [normalizationConstant] will be multiplied by all kernel entries\n * @returns {ShaderDeclarationBuilder}\n */\nfunction conv1D(axis, kernel, normalizationConstant = 1.0) {\n  const kernel32 = new Float32Array(kernel.map(x => +x * +normalizationConstant));\n  const kSize = kernel32.length;\n  const N = kSize >> 1; // idiv 2\n\n  // validate input\n  if (kSize < 1 || kSize % 2 == 0) throw new _utils_errors__WEBPACK_IMPORTED_MODULE_2__/* .IllegalArgumentError */ .qw(`Can't perform a 1D convolution with an invalid kSize of ${kSize}`);else if (axis != 'x' && axis != 'y') throw new _utils_errors__WEBPACK_IMPORTED_MODULE_2__/* .IllegalArgumentError */ .qw(`Can't perform 1D convolution: invalid axis \"${axis}\"`); // this should never happen\n\n  // select the appropriate pixel function\n  const pixelAtOffset = N <= 7 ? 'pixelAtShortOffset' : 'pixelAtLongOffset';\n\n  // code generator\n  const foreachKernelElement = fn => _utils_utils__WEBPACK_IMPORTED_MODULE_1__/* .Utils */ .A.symmetricRange(N).reduce((acc, cur) => acc + fn(kernel32[cur + N], cur), '');\n  const generateCode = (k, i) => axis == 'x' ? `\n        pixel += ${pixelAtOffset}(image, ivec2(${-i | 0}, 0)) * float(${+k});\n    ` : `\n        pixel += ${pixelAtOffset}(image, ivec2(0, ${-i | 0})) * float(${+k});\n    `;\n\n  // shader\n  const source = `\n    uniform sampler2D image;\n\n    void main()\n    {\n        float alpha = threadPixel(image).a;\n        vec4 pixel = vec4(0.0f);\n\n        ${foreachKernelElement(generateCode)}\n\n        color = vec4(pixel.rgb, alpha);\n    }\n    `;\n\n  // done!\n  return (0,_shader_declaration__WEBPACK_IMPORTED_MODULE_0__/* .createShader */ .gx)(source).withArguments('image');\n}\n\n/***/ }),\n\n/***/ 1001:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   c: () => (/* binding */ SpeedyGL)\n/* harmony export */ });\n/* harmony import */ var _utils_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(9037);\n/* harmony import */ var _core_settings__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(2199);\n/* harmony import */ var _utils_observable__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(3211);\n/* harmony import */ var _core_speedy_promise__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(9192);\n/* harmony import */ var _utils_errors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(8581);\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-gl.js\n * A wrapper around the WebGL Rendering Context\n */\n\n\n\n\n\n\n\n/** @typedef {'default' | 'low-power' | 'high-performance'} PowerPreference */\n\n// Constants\nconst SINGLETON_KEY = Symbol();\nconst DEFAULT_POWER_PREFERENCE = 'default';\n\n//\n// We use a small canvas to improve the performance\n// of createImageBitmap() on Firefox.\n//\n// A large canvas (2048x2048) causes a FPS drop, even\n// if we only extract a small region of it (this is\n// unlike Chrome, which is fast).\n//\n// Note: we automatically increase the size of the\n// canvas (as needed) when rendering to it.\n//\nconst CANVAS_WIDTH = 16,\n  CANVAS_HEIGHT = 16;\n\n/** @type {SpeedyGL} Singleton */\nlet instance = null;\n\n/** @type {PowerPreference} power preference */\nlet powerPreference = DEFAULT_POWER_PREFERENCE;\n\n/**\n * A wrapper around a WebGL Rendering Context\n */\nclass SpeedyGL extends _utils_observable__WEBPACK_IMPORTED_MODULE_4__/* .Observable */ .c {\n  /**\n   * Constructor\n   * @param {Symbol} key\n   * @private\n   */\n  constructor(key) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_0__/* .Utils */ .A.assert(key === SINGLETON_KEY);\n    super();\n\n    /** @type {boolean} internal flag */\n    this._reinitializeOnContextLoss = true;\n\n    /** @type {HTMLCanvasElement} internal canvas */\n    this._canvas = this._createCanvas(this._reinitialize.bind(this));\n\n    /** @type {WebGL2RenderingContext} WebGL rendering context */\n    this._gl = this._createContext(this._canvas);\n\n    /** @type {string} vendor string of the video driver */\n    this._vendor = '';\n\n    /** @type {string} renderer string of the video driver */\n    this._renderer = '';\n\n    // read driver info\n    this._readDriverInfo();\n\n    // log driver info\n    if (_core_settings__WEBPACK_IMPORTED_MODULE_1__/* .Settings */ .w.logging === 'diagnostic') this._logDriverInfo();\n  }\n\n  /**\n   * Get Singleton\n   * @returns {SpeedyGL}\n   */\n  static get instance() {\n    return instance || (instance = new SpeedyGL(SINGLETON_KEY));\n  }\n\n  /**\n   * The WebGL Rendering Context\n   * Be careful not to cache this rendering context, as it may be lost!\n   * @returns {WebGL2RenderingContext}\n   */\n  get gl() {\n    return this._gl;\n  }\n\n  /**\n   * The internal canvas\n   * @returns {HTMLCanvasElement}\n   */\n  get canvas() {\n    return this._canvas;\n  }\n\n  /**\n   * Renderer string of the video driver\n   * @returns {string}\n   */\n  get renderer() {\n    return this._renderer;\n  }\n\n  /**\n   * Vendor string of the video driver\n   * @returns {string}\n   */\n  get vendor() {\n    return this._vendor;\n  }\n\n  /**\n   * Create a WebGL-capable canvas\n   * @param {Function} reinitialize to be called if we get a WebGL context loss event\n   * @returns {HTMLCanvasElement}\n   */\n  _createCanvas(reinitialize) {\n    const canvas = _utils_utils__WEBPACK_IMPORTED_MODULE_0__/* .Utils */ .A.createCanvas(CANVAS_WIDTH, CANVAS_HEIGHT);\n    canvas.addEventListener('webglcontextlost', ev => {\n      _utils_utils__WEBPACK_IMPORTED_MODULE_0__/* .Utils */ .A.warning(`Lost WebGL2 context`);\n      setTimeout(reinitialize, 0);\n      ev.preventDefault();\n    }, false);\n\n    /*canvas.addEventListener('webglcontextrestored', ev => {\n        Utils.warning(`Restored WebGL2 context`);\n        ev.preventDefault();\n    }, false);*/\n\n    return canvas;\n  }\n\n  /**\n   * Create a WebGL2 Rendering Context\n   * @param {HTMLCanvasElement} canvas\n   * @returns {WebGL2RenderingContext}\n   */\n  _createContext(canvas) {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_0__/* .Utils */ .A.log(`Creating a ${powerPreference} WebGL2 rendering context...`);\n\n    // does the browser support WebGL2?\n    if (typeof WebGL2RenderingContext === 'undefined') throw new _utils_errors__WEBPACK_IMPORTED_MODULE_3__/* .NotSupportedError */ .EM(`This application requires WebGL2. Please update your system.`);\n    const gl = canvas.getContext('webgl2', {\n      premultipliedAlpha: false,\n      preserveDrawingBuffer: false,\n      powerPreference: powerPreference,\n      alpha: true,\n      // see https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#avoid_alphafalse_which_can_be_expensive\n      antialias: false,\n      depth: false,\n      stencil: false,\n      desynchronized: true\n    });\n    if (!gl) throw new _utils_errors__WEBPACK_IMPORTED_MODULE_3__/* .NotSupportedError */ .EM(`Can't create a WebGL2 Rendering Context. Try a different browser!`);\n    return gl;\n  }\n\n  /**\n   * Reinitialize WebGL\n   */\n  _reinitialize() {\n    // disable reinitialization?\n    if (!this._reinitializeOnContextLoss) return;\n\n    // warning\n    _utils_utils__WEBPACK_IMPORTED_MODULE_0__/* .Utils */ .A.warning(`Reinitializing WebGL2...`);\n\n    // create new canvas\n    this._canvas.remove();\n    this._canvas = this._createCanvas(this._reinitialize.bind(this));\n\n    // create new context\n    this._gl = this._createContext(this._canvas);\n\n    // is this needed?\n    this._readDriverInfo();\n\n    // notify observers: we have a new context!\n    // we need to recreate all textures...\n    this._notify();\n  }\n\n  /**\n   * Read debugging information about the video driver of the user\n   */\n  _readDriverInfo() {\n    // Depending on the privacy settings of the browser, this information\n    // may be unavailable. When available, it may not be entirely correct.\n    // See https://developer.mozilla.org/en-US/docs/Web/API/WEBGL_debug_renderer_info\n    const gl = this._gl;\n    let debugInfo = null;\n    if (navigator.userAgent.includes('Firefox')) {\n      this._vendor = ''; //gl.getParameter(gl.VENDOR); // not useful\n      this._renderer = gl.getParameter(gl.RENDERER); // only useful on Firefox, apparently\n    } else if (null != (debugInfo = gl.getExtension('WEBGL_debug_renderer_info'))) {\n      this._vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);\n      this._renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);\n    } else {\n      this._vendor = ''; // unavailable information\n      this._renderer = '';\n    }\n  }\n\n  /**\n   * Log debugging information about the video driver and the platform\n   */\n  _logDriverInfo() {\n    _utils_utils__WEBPACK_IMPORTED_MODULE_0__/* .Utils */ .A.log('Platform: ' + _utils_utils__WEBPACK_IMPORTED_MODULE_0__/* .Utils */ .A.platformString());\n    _utils_utils__WEBPACK_IMPORTED_MODULE_0__/* .Utils */ .A.log('GL vendor: ' + this.vendor);\n    _utils_utils__WEBPACK_IMPORTED_MODULE_0__/* .Utils */ .A.log('GL renderer: ' + this.renderer);\n  }\n\n  /**\n   * Lose the WebGL context. This is used to manually\n   * free resources, and also for purposes of testing\n   * @returns {WEBGL_lose_context}\n   */\n  loseContext() {\n    const gl = this._gl;\n\n    // find the appropriate extension\n    const ext = gl.getExtension('WEBGL_lose_context');\n    if (!ext) throw new _utils_errors__WEBPACK_IMPORTED_MODULE_3__/* .NotSupportedError */ .EM('WEBGL_lose_context extension is unavailable');\n\n    // nothing to do?\n    if (gl.isContextLost()) return ext;\n\n    // disable reinitialization\n    this._reinitializeOnContextLoss = false;\n\n    // lose context\n    ext.loseContext();\n\n    // done!\n    return ext;\n  }\n\n  /**\n   * Lose & restore the WebGL context\n   * @param {number} [secondsToRestore]\n   * @return {SpeedyPromise<WEBGL_lose_context>} resolves as soon as the context is restored\n   */\n  loseAndRestoreContext(secondsToRestore = 1) {\n    const ms = Math.max(secondsToRestore, 0) * 1000;\n    const ext = this.loseContext();\n    return new _core_speedy_promise__WEBPACK_IMPORTED_MODULE_2__/* .SpeedyPromise */ .i(resolve => {\n      setTimeout(() => {\n        //ext.restoreContext();\n        this._reinitializeOnContextLoss = true;\n        this._reinitialize();\n        setTimeout(() => resolve(ext), 0); // next frame\n      }, ms);\n    });\n  }\n\n  /**\n   * Power preference for the WebGL context\n   * @returns {PowerPreference}\n   */\n  static get powerPreference() {\n    return powerPreference;\n  }\n\n  /**\n   * Power preference for the WebGL context\n   * @param {PowerPreference} value\n   */\n  static set powerPreference(value) {\n    // validate\n    if (!(value === 'default' || value === 'low-power' || value === 'high-performance')) throw new _utils_errors__WEBPACK_IMPORTED_MODULE_3__/* .IllegalArgumentError */ .qw(`Invalid powerPreference: \"${value}\"`);\n\n    // the power preference should be set before we create the WebGL context\n    if (instance == null || powerPreference !== value) {\n      powerPreference = value;\n\n      // recreate the context if it already exists. Experimental.\n      if (instance != null) instance.loseAndRestoreContext();\n    }\n  }\n\n  /**\n   * Check if an instance of SpeedyGL has already been created\n   * @returns {boolean}\n   */\n  static isInitialized() {\n    return instance != null;\n  }\n}\n\n/***/ }),\n\n/***/ 8581:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EM: () => (/* binding */ NotSupportedError),\n/* harmony export */   Er: () => (/* binding */ IllegalOperationError),\n/* harmony export */   FJ: () => (/* binding */ ResourceNotLoadedError),\n/* harmony export */   MU: () => (/* binding */ TimeoutError),\n/* harmony export */   NO: () => (/* binding */ WebAssemblyError),\n/* harmony export */   Uk: () => (/* binding */ AccessDeniedError),\n/* harmony export */   aQ: () => (/* binding */ AbstractMethodError),\n/* harmony export */   kG: () => (/* binding */ FileNotFoundError),\n/* harmony export */   l: () => (/* binding */ OutOfMemoryError),\n/* harmony export */   mB: () => (/* binding */ ParseError),\n/* harmony export */   pf: () => (/* binding */ AssertionError),\n/* harmony export */   qw: () => (/* binding */ IllegalArgumentError),\n/* harmony export */   wB: () => (/* binding */ GLError),\n/* harmony export */   xB: () => (/* binding */ SpeedyError)\n/* harmony export */ });\n/* unused harmony export NotImplementedError */\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * errors.js\n * Error classes\n */\n\n/** @typedef {SpeedyError|Error|null} SpeedyErrorCause */\n\n/**\n * Generic error class for Speedy\n */\nclass SpeedyError extends Error {\n  /**\n   * Class constructor\n   * @param {string} message message text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message, cause = null) {\n    super([message, cause ? cause.toString() : '[speedy-vision.js]'].join('\\n-> '));\n\n    /** @type {SpeedyErrorCause} cause of the error */\n    this._cause = cause;\n  }\n\n  /**\n   * Error name\n   * @returns {string}\n   */\n  get name() {\n    return this.constructor.name;\n  }\n\n  /**\n   * Set error name (ignored)\n   * @param {string} _ ignored\n   */\n  set name(_) {\n    void 0;\n  }\n\n  /**\n   * Get the cause of the error. Available if\n   * it has been specified in the constructor\n   * @returns {SpeedyErrorCause}\n   */\n  get cause() {\n    return this._cause;\n  }\n}\n\n/**\n * Unsupported operation error\n * The requested operation is not supported\n */\nclass NotSupportedError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`Unsupported operation. ${message}`, cause);\n  }\n}\n\n/**\n * Not implemented error\n * The called method is not implemented\n */\nclass NotImplementedError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`Method not implemented. ${message}`, cause);\n  }\n}\n\n/**\n * WebGL error\n */\nclass GLError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`WebGL error. ${message}`, cause);\n  }\n\n  /**\n   * Get an error object describing the latest WebGL error\n   * @param {WebGL2RenderingContext} gl\n   * @returns {GLError}\n   */\n  static from(gl) {\n    const recognizedErrors = ['NO_ERROR', 'INVALID_ENUM', 'INVALID_VALUE', 'INVALID_OPERATION', 'INVALID_FRAMEBUFFER_OPERATION', 'OUT_OF_MEMORY', 'CONTEXT_LOST_WEBGL'];\n    const glError = gl.getError();\n    const message = recognizedErrors.find(error => gl[error] == glError) || 'Unknown';\n    return new GLError(message);\n  }\n}\n\n/**\n * AbstractMethodError\n * Thrown when one tries to call an abstract method\n */\nclass AbstractMethodError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`Can't call abstract method. ${message}`, cause);\n  }\n}\n\n/**\n * Illegal argument error\n * A method has received one or more illegal arguments\n */\nclass IllegalArgumentError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`Illegal argument. ${message}`, cause);\n  }\n}\n\n/**\n * Illegal operation error\n * The method arguments are valid, but the method can't\n * be called due to the current the state of the object\n */\nclass IllegalOperationError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`Illegal operation. ${message}`, cause);\n  }\n}\n\n/**\n * Out of memory\n */\nclass OutOfMemoryError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`Out of memory. ${message}`, cause);\n  }\n}\n\n/**\n * File not found error\n */\nclass FileNotFoundError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`File not found. ${message}`, cause);\n  }\n}\n\n/**\n * Resource not loaded error\n */\nclass ResourceNotLoadedError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`Resource not loaded. ${message}`, cause);\n  }\n}\n\n/**\n * Timeout error\n */\nclass TimeoutError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`Timeout error. ${message}`, cause);\n  }\n}\n\n/**\n * Parse error\n */\nclass ParseError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`Parse error. ${message}`, cause);\n  }\n}\n\n/**\n * Assertion error\n */\nclass AssertionError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`Assertion failed. ${message}`, cause);\n  }\n}\n\n/**\n * Access denied\n */\nclass AccessDeniedError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`Access denied. ${message}`, cause);\n  }\n}\n\n/**\n * WebAssembly error\n */\nclass WebAssemblyError extends SpeedyError {\n  /**\n   * Class constructor\n   * @param {string} [message] additional text\n   * @param {SpeedyErrorCause} [cause] cause of the error\n   */\n  constructor(message = '', cause = null) {\n    super(`WebAssembly error. ${message}`, cause);\n  }\n}\n\n/***/ }),\n\n/***/ 3816:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DEFAULT_ENCODER_CAPACITY: () => (/* binding */ DEFAULT_ENCODER_CAPACITY),\n/* harmony export */   FIX_BITS: () => (/* binding */ FIX_BITS),\n/* harmony export */   FIX_RESOLUTION: () => (/* binding */ FIX_RESOLUTION),\n/* harmony export */   LITTLE_ENDIAN: () => (/* binding */ LITTLE_ENDIAN),\n/* harmony export */   LOG2_MAX_DESCRIPTOR_SIZE: () => (/* binding */ LOG2_MAX_DESCRIPTOR_SIZE),\n/* harmony export */   LOG2_PYRAMID_MAX_SCALE: () => (/* binding */ LOG2_PYRAMID_MAX_SCALE),\n/* harmony export */   MATCH_INDEX_BITS: () => (/* binding */ MATCH_INDEX_BITS),\n/* harmony export */   MATCH_INDEX_MASK: () => (/* binding */ MATCH_INDEX_MASK),\n/* harmony export */   MATCH_MAX_DISTANCE: () => (/* binding */ MATCH_MAX_DISTANCE),\n/* harmony export */   MATCH_MAX_INDEX: () => (/* binding */ MATCH_MAX_INDEX),\n/* harmony export */   MAX_DESCRIPTOR_SIZE: () => (/* binding */ MAX_DESCRIPTOR_SIZE),\n/* harmony export */   MAX_ENCODER_CAPACITY: () => (/* binding */ MAX_ENCODER_CAPACITY),\n/* harmony export */   MAX_TEXTURE_LENGTH: () => (/* binding */ MAX_TEXTURE_LENGTH),\n/* harmony export */   MIN_ENCODER_LENGTH: () => (/* binding */ MIN_ENCODER_LENGTH),\n/* harmony export */   MIN_KEYPOINT_SIZE: () => (/* binding */ MIN_KEYPOINT_SIZE),\n/* harmony export */   PYRAMID_MAX_LEVELS: () => (/* binding */ PYRAMID_MAX_LEVELS),\n/* harmony export */   PYRAMID_MAX_SCALE: () => (/* binding */ PYRAMID_MAX_SCALE)\n/* harmony export */ });\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * globals.js\n * Global constants\n */\n\n// -----------------------------------------------------------------\n// IMAGE PYRAMIDS & SCALE-SPACE\n// -----------------------------------------------------------------\n\n/** @type {number} The maximum number of levels in a pyramid, considering a scale factor of 2x between levels */\nconst PYRAMID_MAX_LEVELS = 8;\n\n/** @type {number} The base-2 logarithm of PYRAMID_MAX_SCALE */\nconst LOG2_PYRAMID_MAX_SCALE = 0;\n\n/** @type {number} The maximum supported scale for a pyramid level */\nconst PYRAMID_MAX_SCALE = 1 << LOG2_PYRAMID_MAX_SCALE;\n\n// -----------------------------------------------------------------\n// FIXED-POINT MATH\n// -----------------------------------------------------------------\n\n/** @type {number} How many bits do we use to store fractional data? */\nconst FIX_BITS = 3; // step size: 0.125 = 1/2^FIX_BITS\n\n/** @type {number} Fixed-point resolution */\nconst FIX_RESOLUTION = 1 << FIX_BITS; // float(2^(FIX_BITS))\n\n// -----------------------------------------------------------------\n// TEXTURE LIMITS\n// -----------------------------------------------------------------\n\n/** @type {number} Maximum texture length (width, height) */\nconst MAX_TEXTURE_LENGTH = (1 << 16 - FIX_BITS) - 1; // must be 2^n - 1 due to keypoint encoding\n\n// -----------------------------------------------------------------\n// KEYPOINTS\n// -----------------------------------------------------------------\n\n/** @type {number} Size of a keypoint header, in bytes (must be divisible by 4) */\nconst MIN_KEYPOINT_SIZE = 8;\n\n/** @type {number} Minimum length of a keypoint encoder, in pixels (encodes at least 1 keypoint) */\nconst MIN_ENCODER_LENGTH = 2; // capacity computations are based on this // Math.ceil(Math.sqrt(MIN_KEYPOINT_SIZE / 4));\n\n/** @type {number} Maximum number of keypoints we can encode (the actual length of the encoder may vary) */\nconst MAX_ENCODER_CAPACITY = 8192;\n\n/** @type {number} Default capacity of a keypoint encoder (64x64 texture with 2 pixels per keypoint) */\nconst DEFAULT_ENCODER_CAPACITY = 2048;\n\n/** @type {number} log2 of MAX_DESCRIPTOR_SIZE */\nconst LOG2_MAX_DESCRIPTOR_SIZE = 6;\n\n/** @type {number} maximum size of a keypoint descriptor, in bytes */\nconst MAX_DESCRIPTOR_SIZE = 1 << LOG2_MAX_DESCRIPTOR_SIZE;\n\n/** @type {number} How many bits will we use when encoding the index of a keypoint match? */\nconst MATCH_INDEX_BITS = 32 - (LOG2_MAX_DESCRIPTOR_SIZE + 3); // 32 - log2(MAX_DESCRIPTOR_SIZE * 8)\n\n/** @type {number} Bitwise mask to extract a keypoint index from an encoded match */\nconst MATCH_INDEX_MASK = (1 << MATCH_INDEX_BITS) - 1;\n\n/** @type {number} Maximum size of the database of keypoints for matching */\nconst MATCH_MAX_INDEX = (1 << MATCH_INDEX_BITS) - 1;\n\n/** @type {number} The maximum distance that can be stored in a match */\nconst MATCH_MAX_DISTANCE = (1 << 32 - MATCH_INDEX_BITS) - 1;\n\n// -----------------------------------------------------------------\n// MISC\n// -----------------------------------------------------------------\n\n/** @type {boolean} Are we in a little-endian machine? */\nconst LITTLE_ENDIAN = function () {\n  return 0xCAFE === new Uint16Array(new Uint8Array([0xFE, 0xCA]).buffer)[0];\n}();\n\n/***/ }),\n\n/***/ 3211:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   c: () => (/* binding */ Observable)\n/* harmony export */ });\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * observable.js\n * Observer design pattern\n */\n\n/**\n * Implementation of the Observer design pattern\n * @abstract\n */\nclass Observable {\n  /**\n   * Constructor\n   */\n  constructor() {\n    /** @type {Function[]} subscribers / callbacks */\n    this._subscribers = [];\n\n    /** @type {object[]} \"this\" pointers */\n    this._thisptr = [];\n\n    /** @type {Array<any[]>} function arguments */\n    this._args = [];\n  }\n\n  /**\n   * Add subscriber\n   * @param {Function} fn callback\n   * @param {object} [thisptr] \"this\" pointer to be used when invoking the callback\n   * @param {...any} args arguments to be passed to the callback\n   */\n  subscribe(fn, thisptr, ...args) {\n    this._subscribers.push(fn);\n    this._thisptr.push(thisptr);\n    this._args.push(args);\n  }\n\n  /**\n   * Remove subscriber\n   * @param {Function} fn previously added callback\n   * @param {object} [thisptr] \"this\" pointer\n   */\n  unsubscribe(fn, thisptr) {\n    for (let j = this._subscribers.length - 1; j >= 0; j--) {\n      if (this._subscribers[j] === fn && this._thisptr[j] === thisptr) {\n        this._subscribers.splice(j, 1);\n        this._thisptr.splice(j, 1);\n        this._args.splice(j, 1);\n        break;\n      }\n    }\n  }\n\n  /**\n   * Notify all subscribers about a state change\n   * @protected\n   */\n  _notify() {\n    for (let i = 0; i < this._subscribers.length; i++) this._subscribers[i].apply(this._thisptr[i], this._args[i]);\n  }\n}\n\n/***/ }),\n\n/***/ 6049:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   f5: () => (/* binding */ ImageFormat),\n/* harmony export */   kQ: () => (/* binding */ PixelComponent),\n/* harmony export */   kg: () => (/* binding */ ColorComponentId),\n/* harmony export */   zu: () => (/* binding */ MediaType)\n/* harmony export */ });\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * types.js\n * Types & formats\n */\n\n/**\n * Media types\n * @enum {Symbol}\n */\nconst MediaType = Object.freeze({\n  Image: Symbol('Image'),\n  Video: Symbol('Video'),\n  Canvas: Symbol('Canvas'),\n  OffscreenCanvas: Symbol('OffscreenCanvas'),\n  Bitmap: Symbol('Bitmap'),\n  Data: Symbol('Data')\n});\n\n/**\n * Image formats\n * @enum {Symbol}\n */\nconst ImageFormat = Object.freeze({\n  RGBA: Symbol('RGBA'),\n  GREY: Symbol('GREY')\n});\n\n/**\n * Pixel component (bitwise flags)\n * @typedef {number} PixelComponent\n */\nconst PixelComponent = Object.freeze({\n  RED: 1,\n  GREEN: 2,\n  BLUE: 4,\n  ALPHA: 8,\n  ALL: 15 // = RED | GREEN | BLUE | ALPHA\n});\n\n/**\n * Component ID utility\n */\nconst ColorComponentId = Object.freeze({\n  [PixelComponent.RED]: 0,\n  [PixelComponent.GREEN]: 1,\n  [PixelComponent.BLUE]: 2,\n  [PixelComponent.ALPHA]: 3\n});\n\n/***/ }),\n\n/***/ 9037:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   A: () => (/* binding */ Utils)\n/* harmony export */ });\n/* harmony import */ var _errors__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(8581);\n/* harmony import */ var _core_speedy_promise__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(9192);\n/* harmony import */ var _core_settings__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(2199);\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * utils.js\n * Generic utilities\n */\n\n\n\n\n\n/**\n * Generic utilities\n */\nclass Utils {\n  /**\n   * Generates a warning\n   * @param {string} text message text\n   * @param  {...string} args optional text\n   */\n  static warning(text, ...args) {\n    //if(Settings.logging === 'default' || Settings.logging === 'diagnostic') // TODO: warnings & errors only?\n    if (_core_settings__WEBPACK_IMPORTED_MODULE_2__/* .Settings */ .w.logging !== 'none') console.warn('[speedy-vision] ' + text, ...args);\n  }\n\n  /**\n   * Logs a message\n   * @param {string} text message text\n   * @param  {...string} args optional text\n   */\n  static log(text, ...args) {\n    if (_core_settings__WEBPACK_IMPORTED_MODULE_2__/* .Settings */ .w.logging !== 'none') console.log('[speedy-vision] ' + text, ...args);\n  }\n\n  /**\n   * Assertion\n   * @param {boolean} expr expression\n   * @param {string} [text] error message\n   * @throws {AssertionError}\n   */\n  static assert(expr, text = '') {\n    if (!expr) throw new _errors__WEBPACK_IMPORTED_MODULE_0__/* .AssertionError */ .pf(text);\n  }\n\n  /**\n   * Gets the names of the arguments of the specified function\n   * @param {Function} fun \n   * @returns {string[]}\n   */\n  static functionArguments(fun) {\n    const code = fun.toString();\n    const regex = code.startsWith('function') ? 'function\\\\s.*\\\\(([^)]*)\\\\)' : code.startsWith('(') ? '\\\\(([^)]*)\\\\).*=>' : '([^=]+).*=>';\n    const match = new RegExp(regex).exec(code);\n    if (match !== null) {\n      const args = match[1].replace(/\\/\\*.*?\\*\\//g, ''); // remove comments\n      return args.split(',').map(argname => argname.replace(/=.*$/, '').trim() // remove default params & trim\n      ).filter(argname => argname // handle trailing commas\n      );\n    } else throw new _errors__WEBPACK_IMPORTED_MODULE_0__/* .ParseError */ .mB(`Can't detect function arguments of ${code}`);\n  }\n\n  /**\n   * Get all property descriptors from an object,\n   * traversing its entire prototype chain\n   * @param {object} obj \n   * @returns {object}\n   */\n  static getAllPropertyDescriptors(obj) {\n    if (obj) {\n      const proto = Object.getPrototypeOf(obj);\n      return Object.assign(Object.assign({}, Utils.getAllPropertyDescriptors(proto)), Object.getOwnPropertyDescriptors(obj));\n    } else return Object.create(null);\n  }\n\n  /**\n   * Creates a HTMLCanvasElement with the given dimensions\n   * @param {number} width in pixels\n   * @param {number} height in pixels\n   * @returns {HTMLCanvasElement}\n   */\n  static createCanvas(width, height) {\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    return canvas;\n  }\n\n  /**\n   * Generate a 1D gaussian kernel with custom sigma\n   * Tip: use kernelSize >= (5 * sigma), kernelSize odd\n   * @param {number} sigma gaussian sigma\n   * @param {number} [kernelSize] kernel size, odd number\n   * @param {boolean} [normalized] normalize entries so that their sum is 1\n   * @returns {number[]}\n   */\n  static gaussianKernel(sigma, kernelSize = 0, normalized = true) {\n    /*\n     * Let G(x) be a Gaussian function centered at 0 with fixed sigma:\n     *\n     * G(x) = (1 / (sigma * sqrt(2 * pi))) * exp(-(x / (sqrt(2) * sigma))^2)\n     * \n     * In addition, let f(p) be a kernel value at pixel p, -k/2 <= p <= k/2:\n     * \n     * f(p) = \\int_{p - 0.5}^{p + 0.5} G(x) dx (integrate around p)\n     *      = \\int_{0}^{p + 0.5} G(x) dx - \\int_{0}^{p - 0.5} G(x) dx\n     * \n     * Setting a constant c := sqrt(2) * sigma, it follows that:\n     * \n     * f(p) = (1 / 2c) * (erf((p + 0.5) / c) - erf((p - 0.5) / c))\n     */\n\n    // default kernel size\n    if (kernelSize == 0) {\n      kernelSize = Math.ceil(5.0 * sigma) | 0;\n      kernelSize += 1 - kernelSize % 2;\n    }\n\n    // validate input\n    kernelSize |= 0;\n    if (kernelSize < 1 || kernelSize % 2 == 0) throw new _errors__WEBPACK_IMPORTED_MODULE_0__/* .IllegalArgumentError */ .qw(`Invalid kernel size given to gaussianKernel: ${kernelSize} x 1`);else if (sigma <= 0.0) throw new _errors__WEBPACK_IMPORTED_MODULE_0__/* .IllegalArgumentError */ .qw(`Invalid sigma given to gaussianKernel: ${sigma}`);\n\n    // function erf(x) = -erf(-x) can be approximated numerically. See:\n    // https://en.wikipedia.org/wiki/Error_function#Numerical_approximations\n    const kernel = new Array(kernelSize);\n\n    // set constants\n    const N = kernelSize >> 1; // integer (floor, div 2)\n    const c = +sigma * 1.4142135623730951; // sigma * sqrt(2)\n    const m = 0.3275911;\n    const a1 = 0.254829592;\n    const a2 = -0.284496736;\n    const a3 = 1.421413741;\n    const a4 = -1.453152027;\n    const a5 = 1.061405429;\n\n    // compute the kernel\n    let sum = 0.0;\n    for (let j = 0; j < kernelSize; j++) {\n      let xa = (j - N + 0.5) / c;\n      let xb = (j - N - 0.5) / c;\n      let sa = 1.0,\n        sb = 1.0;\n      if (xa < 0.0) {\n        sa = -1.0;\n        xa = -xa;\n      }\n      if (xb < 0.0) {\n        sb = -1.0;\n        xb = -xb;\n      }\n      const ta = 1.0 / (1.0 + m * xa);\n      const tb = 1.0 / (1.0 + m * xb);\n      const pa = ((((a5 * ta + a4) * ta + a3) * ta + a2) * ta + a1) * ta;\n      const pb = ((((a5 * tb + a4) * tb + a3) * tb + a2) * tb + a1) * tb;\n      const ya = 1.0 - pa * Math.exp(-xa * xa);\n      const yb = 1.0 - pb * Math.exp(-xb * xb);\n      const erfa = sa * ya;\n      const erfb = sb * yb;\n      const fp = (erfa - erfb) / (2.0 * c);\n      kernel[j] = fp;\n      sum += fp;\n    }\n\n    // normalize the kernel\n    if (normalized) {\n      for (let j = 0; j < kernelSize; j++) kernel[j] /= sum;\n    }\n\n    // done!\n    return kernel;\n  }\n\n  /**\n   * Generate a 2D kernel in column-major format using two separable 1D kernels\n   * @param {number[]} ka 1D kernel\n   * @param {number[]} [kb]\n   * @returns {number[]}\n   */\n  static kernel2d(ka, kb = ka) {\n    const ksize = ka.length;\n    Utils.assert(ka.length == ka.length);\n    Utils.assert(ksize >= 1 && ksize % 2 == 1);\n\n    // compute the outer product ka x kb\n    let kernel2d = new Array(ksize * ksize),\n      k = 0;\n    for (let col = 0; col < ksize; col++) {\n      for (let row = 0; row < ksize; row++) kernel2d[k++] = ka[row] * kb[col];\n    }\n    return kernel2d;\n  }\n\n  /**\n   * Cartesian product a x b: [ [ai, bj] for all i, j ]\n   * @param {number[]} a\n   * @param {number[]} b\n   * @returns {Array<[number,number]>}\n   */\n  static cartesian(a, b) {\n    return [].concat(...a.map(a => b.map(b => [a, b])));\n  }\n\n  /**\n   * Symmetric range\n   * @param {number} n non-negative integer\n   * @returns {number[]} [ -n, ..., n ]\n   */\n  static symmetricRange(n) {\n    if ((n |= 0) < 0) throw new _errors__WEBPACK_IMPORTED_MODULE_0__/* .IllegalArgumentError */ .qw(`Expected a non-negative integer as input`);\n    return [...Array(2 * n + 1).keys()].map(x => x - n);\n  }\n\n  /**\n   * Compute the [0, n) range of integers\n   * @param {number} n positive integer\n   * @returns {number[]} [ 0, 1, ..., n-1 ]\n   */\n  static range(n) {\n    if ((n |= 0) <= 0) throw new _errors__WEBPACK_IMPORTED_MODULE_0__/* .IllegalArgumentError */ .qw(`Expected a positive integer as input`);\n    return [...Array(n).keys()];\n  }\n\n  /**\n   * Shuffle in-place\n   * @template T\n   * @param {T[]} arr\n   * @returns {T[]} arr\n   */\n  static shuffle(arr) {\n    const len = arr.length;\n    const m = len - 1;\n\n    // Fisher-Yattes\n    for (let i = 0; i < m; i++) {\n      const j = i + (Math.random() * (len - i) | 0); // i <= j < arr.length\n\n      if (i !== j) {\n        const t = arr[i];\n        arr[i] = arr[j];\n        arr[j] = t;\n      }\n    }\n    return arr;\n  }\n\n  /**\n   * Flatten an array (1 level only)\n   * @template U\n   * @param {U[]} array\n   * @returns {U[]}\n   */\n  static flatten(array) {\n    //return array.flat();\n    //return array.reduce((arr, val) => arr.concat(val), []);\n\n    const flat = [];\n    for (let i = 0, n = array.length; i < n; i++) {\n      const entry = array[i];\n      if (Array.isArray(entry)) {\n        for (let j = 0, m = entry.length; j < m; j++) flat.push(entry[j]);\n      } else flat.push(entry);\n    }\n    return flat;\n  }\n\n  /**\n   * Decode a 16-bit float from a\n   * unsigned 16-bit integer\n   * @param {number} uint16\n   * @returns {number}\n   */\n  static decodeFloat16(uint16) {\n    // decode according to sec 2.1.2\n    // 16-Bit Floating Point Numbers\n    // of the OpenGL ES 3 spec\n    const s = (uint16 & 0xFFFF) >> 15; // sign bit\n    const e = (uint16 & 0x7FFF) >> 10; // exponent\n    const m = uint16 & 0x3FF; // mantissa\n    const sign = 1 - 2 * s; // (-1)^s\n\n    if (e == 0) return m == 0 ? sign * 0.0 : sign * m * 5.960464477539063e-8; // zero / subnormal\n    else if (e == 31) return m == 0 ? sign * Number.POSITIVE_INFINITY : Number.NaN;\n    const f = e >= 15 ? 1 << e - 15 : 1.0 / (1 << 15 - e); // 2^(e-15)\n    return sign * f * (1.0 + m * 0.0009765625); // normal\n  }\n\n  /**\n   * Wrapper around getUserMedia()\n   * @param {MediaStreamConstraints} [constraints] will be passed to getUserMedia()\n   * @returns {SpeedyPromise<HTMLVideoElement>}\n   */\n  static requestCameraStream(constraints = {\n    audio: false,\n    video: true\n  }) {\n    Utils.log('Accessing the webcam...');\n    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) throw new _errors__WEBPACK_IMPORTED_MODULE_0__/* .NotSupportedError */ .EM('Unsupported browser: no mediaDevices.getUserMedia()');\n    return new _core_speedy_promise__WEBPACK_IMPORTED_MODULE_1__/* .SpeedyPromise */ .i((resolve, reject) => {\n      navigator.mediaDevices.getUserMedia(constraints).then(stream => {\n        const video = document.createElement('video');\n        video.onloadedmetadata = () => {\n          video.play();\n          Utils.log(`The camera is on! Resolution: ${video.videoWidth} x ${video.videoHeight}`);\n          resolve(video);\n        };\n        video.setAttribute('playsinline', '');\n        video.setAttribute('autoplay', '');\n        if (constraints.audio === false || constraints.audio === undefined) video.setAttribute('muted', '');\n        video.srcObject = stream;\n      }).catch(err => {\n        if (err.name === 'NotAllowedError') {\n          reject(new _errors__WEBPACK_IMPORTED_MODULE_0__/* .AccessDeniedError */ .Uk(`Please give access to the camera and reload the page.`, err));\n        } else if (err.name === 'OverconstrainedError' || err.name === 'NotFoundError') {\n          reject(new _errors__WEBPACK_IMPORTED_MODULE_0__/* .NotSupportedError */ .EM(`Can't access the webcam with the requested constraints: ${JSON.stringify(constraints)}.`, err));\n        } else {\n          reject(new _errors__WEBPACK_IMPORTED_MODULE_0__/* .SpeedyError */ .xB(`Can't access the webcam.`, err));\n        }\n      });\n    });\n  }\n\n  /**\n   * Format binary data as a string with hex values\n   * @param {ArrayBuffer} bytes\n   * @returns {string}\n   */\n  static formatBinaryData(bytes) {\n    const uint8 = new Uint8Array(bytes);\n    const array = Array.from(uint8, b => b.toString(16).padStart(2, '0'));\n    return array.join(' ');\n  }\n\n  /**\n   * Returns a string containing platform brand information\n   * @returns {string}\n   */\n  static platformString() {\n    // navigator.userAgent is easily and often spoofed, and thus is unreliable\n\n    // use the NavigatorUAData interface if available\n    if (typeof navigator.userAgentData === 'object') {\n      // use only low entropy data, so we don't need to ask the permission\n      // of the user to read this string\n      return navigator.userAgentData.platform;\n    }\n\n    // navigator.platform is deprecated. It can be spoofed on Firefox, but,\n    // at the time of this writing, there is no alternative apparently.\n    return navigator.platform;\n  }\n}\n\n/***/ }),\n\n/***/ 5235:\n/***/ ((module, __unused_webpack_exports, __webpack_require__) => {\n\nvar map = {\n\t\"./colors.glsl\": 8609,\n\t\"./filters.glsl\": 4672,\n\t\"./fixed-point.glsl\": 9778,\n\t\"./float16.glsl\": 8710,\n\t\"./global.glsl\": 2434,\n\t\"./int32.glsl\": 439,\n\t\"./keypoint-descriptors.glsl\": 8545,\n\t\"./keypoint-matches.glsl\": 6762,\n\t\"./keypoints.glsl\": 7639,\n\t\"./math.glsl\": 431,\n\t\"./platform.glsl\": 6822,\n\t\"./pyramids.glsl\": 2728,\n\t\"./subpixel.glsl\": 6823\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 5235;\n\n/***/ }),\n\n/***/ 4606:\n/***/ ((module, __unused_webpack_exports, __webpack_require__) => {\n\nvar map = {\n\t\"./filters/convolution\": 1672,\n\t\"./filters/convolution.js\": 1672,\n\t\"./filters/convolution1d.glsl\": 8211,\n\t\"./filters/convolution2d.glsl\": 7360,\n\t\"./filters/fast-median.glsl\": 8191,\n\t\"./filters/nightvision.glsl\": 4438,\n\t\"./filters/normalize-image.glsl\": 5867,\n\t\"./filters/rgb2grey.glsl\": 9252,\n\t\"./include/colors.glsl\": 8609,\n\t\"./include/filters.glsl\": 4672,\n\t\"./include/fixed-point.glsl\": 9778,\n\t\"./include/float16.glsl\": 8710,\n\t\"./include/global.glsl\": 2434,\n\t\"./include/int32.glsl\": 439,\n\t\"./include/keypoint-descriptors.glsl\": 8545,\n\t\"./include/keypoint-matches.glsl\": 6762,\n\t\"./include/keypoints.glsl\": 7639,\n\t\"./include/math.glsl\": 431,\n\t\"./include/platform.glsl\": 6822,\n\t\"./include/pyramids.glsl\": 2728,\n\t\"./include/subpixel.glsl\": 6823,\n\t\"./keypoints/allocate-descriptors.glsl\": 1341,\n\t\"./keypoints/allocate-extra.glsl\": 7833,\n\t\"./keypoints/apply-homography.glsl\": 2352,\n\t\"./keypoints/bf-knn.glsl\": 7541,\n\t\"./keypoints/clip-border.glsl\": 4868,\n\t\"./keypoints/clip.glsl\": 5591,\n\t\"./keypoints/distance-filter.glsl\": 191,\n\t\"./keypoints/encode-keypoint-long-offsets.glsl\": 5467,\n\t\"./keypoints/encode-keypoint-offsets.glsl\": 336,\n\t\"./keypoints/encode-keypoint-positions.glsl\": 8968,\n\t\"./keypoints/encode-keypoint-properties.glsl\": 1733,\n\t\"./keypoints/encode-keypoints.glsl\": 9674,\n\t\"./keypoints/encode-null-keypoints.glsl\": 2090,\n\t\"./keypoints/fast.glsl\": 1855,\n\t\"./keypoints/fast.vs.glsl\": 4824,\n\t\"./keypoints/hamming-distance-filter.glsl\": 2381,\n\t\"./keypoints/harris-cutoff.glsl\": 6060,\n\t\"./keypoints/harris.glsl\": 9974,\n\t\"./keypoints/knn-init.glsl\": 3047,\n\t\"./keypoints/knn-transfer.glsl\": 3266,\n\t\"./keypoints/laplacian.glsl\": 8018,\n\t\"./keypoints/lk.glsl\": 3168,\n\t\"./keypoints/lookup-of-locations.glsl\": 3890,\n\t\"./keypoints/lookup-of-locations.vs.glsl\": 8647,\n\t\"./keypoints/lsh-knn.glsl\": 4776,\n\t\"./keypoints/mix-keypoints.glsl\": 2648,\n\t\"./keypoints/nonmax-scale.glsl\": 8825,\n\t\"./keypoints/nonmax-space.glsl\": 5693,\n\t\"./keypoints/nonmax-suppression.glsl\": 9280,\n\t\"./keypoints/orb-descriptor.glsl\": 9108,\n\t\"./keypoints/orb-orientation.glsl\": 7137,\n\t\"./keypoints/refine-scale.glsl\": 9739,\n\t\"./keypoints/score-findmax.glsl\": 8231,\n\t\"./keypoints/shuffle.glsl\": 2518,\n\t\"./keypoints/sort-keypoints.glsl\": 8096,\n\t\"./keypoints/subpixel-refinement.glsl\": 5795,\n\t\"./keypoints/transfer-flow.glsl\": 3169,\n\t\"./keypoints/transfer-orientation.glsl\": 1337,\n\t\"./keypoints/transfer-to-extra.glsl\": 6187,\n\t\"./keypoints/upload-keypoints.glsl\": 477,\n\t\"./pyramids/downsample2.glsl\": 4050,\n\t\"./pyramids/upsample2.glsl\": 5545,\n\t\"./transforms/additive-mix.glsl\": 7113,\n\t\"./transforms/resize.glsl\": 1202,\n\t\"./transforms/warp-perspective.glsl\": 7971,\n\t\"./utils/copy-components.glsl\": 6122,\n\t\"./utils/copy-raster.glsl\": 371,\n\t\"./utils/copy.glsl\": 7307,\n\t\"./utils/fill-components.glsl\": 8614,\n\t\"./utils/fill.glsl\": 6271,\n\t\"./utils/flip-y.vs.glsl\": 3016,\n\t\"./utils/scan-minmax2d.glsl\": 3630,\n\t\"./utils/sobel-derivatives.glsl\": 8508,\n\t\"./utils/sobel-derivatives.vs.glsl\": 8073\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 4606;\n\n/***/ }),\n\n/***/ 8211:\n/***/ ((module) => {\n\nmodule.exports = \"#if !defined(KERNEL_SIZE) || !defined(AXIS) || (AXIS != 0 && AXIS != 1)\\n#error Undefined KERNEL_SIZE / AXIS\\n#endif\\nuniform sampler2D image;\\nuniform float kernel[@KERNEL_SIZE@];\\nconst ivec2 axis = ivec2(1-AXIS, AXIS);\\n#define S(x,k) result += pixelAtShortOffset(image, ivec2((x),(x)) * axis) * kernel[k]\\nvoid main()\\n{\\nvec4 result = vec4(0.0f);\\n#if KERNEL_SIZE == 3\\nS(-1, 2);\\nS( 0, 1);\\nS( 1, 0);\\n#elif KERNEL_SIZE == 5\\nS(-2, 4);\\nS(-1, 3);\\nS( 0, 2);\\nS( 1, 1);\\nS( 2, 0);\\n#elif KERNEL_SIZE == 7\\nS(-3, 6);\\nS(-2, 5);\\nS(-1, 4);\\nS( 0, 3);\\nS( 1, 2);\\nS( 2, 1);\\nS( 3, 0);\\n#elif KERNEL_SIZE == 9\\nS(-4, 8);\\nS(-3, 7);\\nS(-2, 6);\\nS(-1, 5);\\nS( 0, 4);\\nS( 1, 3);\\nS( 2, 2);\\nS( 3, 1);\\nS( 4, 0);\\n#elif KERNEL_SIZE == 11\\nS(-5, 10);\\nS(-4, 9);\\nS(-3, 8);\\nS(-2, 7);\\nS(-1, 6);\\nS( 0, 5);\\nS( 1, 4);\\nS( 2, 3);\\nS( 3, 2);\\nS( 4, 1);\\nS( 5, 0);\\n#elif KERNEL_SIZE == 13\\nS(-6, 12);\\nS(-5, 11);\\nS(-4, 10);\\nS(-3, 9);\\nS(-2, 8);\\nS(-1, 7);\\nS( 0, 6);\\nS( 1, 5);\\nS( 2, 4);\\nS( 3, 3);\\nS( 4, 2);\\nS( 5, 1);\\nS( 6, 0);\\n#elif KERNEL_SIZE == 15\\nS(-7, 14);\\nS(-6, 13);\\nS(-5, 12);\\nS(-4, 11);\\nS(-3, 10);\\nS(-2, 9);\\nS(-1, 8);\\nS( 0, 7);\\nS( 1, 6);\\nS( 2, 5);\\nS( 3, 4);\\nS( 4, 3);\\nS( 5, 2);\\nS( 6, 1);\\nS( 7, 0);\\n#else\\n#error Invalid parameters\\n#endif\\ncolor = vec4(result.rgb, 1.0f);\\n}\"\n\n/***/ }),\n\n/***/ 7360:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef KERNEL_SIZE_SQUARED\\n#error Must define KERNEL_SIZE_SQUARED\\n#endif\\nuniform sampler2D image;\\nuniform float kernel[@KERNEL_SIZE_SQUARED@];\\n#define S(x,y,k) result += pixelAtShortOffset(image, ivec2((x),(y))) * kernel[k]\\nvoid main()\\n{\\nvec4 result = vec4(0.0f);\\n#if KERNEL_SIZE_SQUARED == 9\\nS(-1,-1, 8);\\nS(-1, 0, 7);\\nS(-1, 1, 6);\\nS( 0,-1, 5);\\nS( 0, 0, 4);\\nS( 0, 1, 3);\\nS( 1,-1, 2);\\nS( 1, 0, 1);\\nS( 1, 1, 0);\\n#elif KERNEL_SIZE_SQUARED == 25\\nS(-2,-2, 24);\\nS(-2,-1, 23);\\nS(-2, 0, 22);\\nS(-2, 1, 21);\\nS(-2, 2, 20);\\nS(-1,-2, 19);\\nS(-1,-1, 18);\\nS(-1, 0, 17);\\nS(-1, 1, 16);\\nS(-1, 2, 15);\\nS( 0,-2, 14);\\nS( 0,-1, 13);\\nS( 0, 0, 12);\\nS( 0, 1, 11);\\nS( 0, 2, 10);\\nS( 1,-2, 9);\\nS( 1,-1, 8);\\nS( 1, 0, 7);\\nS( 1, 1, 6);\\nS( 1, 2, 5);\\nS( 2,-2, 4);\\nS( 2,-1, 3);\\nS( 2, 0, 2);\\nS( 2, 1, 1);\\nS( 2, 2, 0);\\n#elif KERNEL_SIZE_SQUARED == 49\\nS(-3,-3, 48);\\nS(-3,-2, 47);\\nS(-3,-1, 46);\\nS(-3, 0, 45);\\nS(-3, 1, 44);\\nS(-3, 2, 43);\\nS(-3, 3, 42);\\nS(-2,-3, 41);\\nS(-2,-2, 40);\\nS(-2,-1, 39);\\nS(-2, 0, 38);\\nS(-2, 1, 37);\\nS(-2, 2, 36);\\nS(-2, 3, 35);\\nS(-1,-3, 34);\\nS(-1,-2, 33);\\nS(-1,-1, 32);\\nS(-1, 0, 31);\\nS(-1, 1, 30);\\nS(-1, 2, 29);\\nS(-1, 3, 28);\\nS( 0,-3, 27);\\nS( 0,-2, 26);\\nS( 0,-1, 25);\\nS( 0, 0, 24);\\nS( 0, 1, 23);\\nS( 0, 2, 22);\\nS( 0, 3, 21);\\nS( 1,-3, 20);\\nS( 1,-2, 19);\\nS( 1,-1, 18);\\nS( 1, 0, 17);\\nS( 1, 1, 16);\\nS( 1, 2, 15);\\nS( 1, 3, 14);\\nS( 2,-3, 13);\\nS( 2,-2, 12);\\nS( 2,-1, 11);\\nS( 2, 0, 10);\\nS( 2, 1, 9);\\nS( 2, 2, 8);\\nS( 2, 3, 7);\\nS( 3,-3, 6);\\nS( 3,-2, 5);\\nS( 3,-1, 4);\\nS( 3, 0, 3);\\nS( 3, 1, 2);\\nS( 3, 2, 1);\\nS( 3, 3, 0);\\n#else\\n#error Invalid KERNEL_SIZE_SQUARED\\n#endif\\ncolor = vec4(result.rgb, 1.0f);\\n}\"\n\n/***/ }),\n\n/***/ 8191:\n/***/ ((module) => {\n\nmodule.exports = \"uniform sampler2D image;\\n#define X(i,j) t = vec2(min(p[i], p[j]), max(p[i], p[j])); p[i] = t.x; p[j] = t.y;\\n#define S(i,x,y) p[i] = pixelAtShortOffset(image, ivec2((x),(y))).g\\nvoid main()\\n{\\nfloat median;\\nvec2 t;\\n#if !defined(KERNEL_SIZE)\\n#error Must define KERNEL_SIZE\\n#elif KERNEL_SIZE == 3\\nfloat p[9];\\nS(0,-1,-1);\\nS(1, 0,-1);\\nS(2, 1,-1);\\nS(3,-1, 0);\\nS(4, 0, 0);\\nS(5, 1, 0);\\nS(6,-1, 1);\\nS(7, 0, 1);\\nS(8, 1, 1);\\nX(1,2);X(4,5);X(7,8);X(0,1);X(3,4);X(6,7);X(1,2);X(4,5);X(7,8);X(0,3);X(5,8);X(4,7);X(3,6);X(1,4);X(2,5);X(4,7);X(4,2);X(6,4);X(4,2);\\nmedian = p[4];\\n#elif KERNEL_SIZE == 5\\nfloat p[25];\\nS( 0,-2,-2);\\nS( 1,-1,-2);\\nS( 2, 0,-2);\\nS( 3, 1,-2);\\nS( 4, 2,-2);\\nS( 5,-2,-1);\\nS( 6,-1,-1);\\nS( 7, 0,-1);\\nS( 8, 1,-1);\\nS( 9, 2,-1);\\nS(10,-2, 0);\\nS(11,-1, 0);\\nS(12, 0, 0);\\nS(13, 1, 0);\\nS(14, 2, 0);\\nS(15,-2, 1);\\nS(16,-1, 1);\\nS(17, 0, 1);\\nS(18, 1, 1);\\nS(19, 2, 1);\\nS(20,-2, 2);\\nS(21,-1, 2);\\nS(22, 0, 2);\\nS(23, 1, 2);\\nS(24, 2, 2);\\nX(0,1);X(3,4);X(2,4);X(2,3);X(6,7);X(5,7);X(5,6);X(9,10);X(8,10);X(8,9);X(12,13);X(11,13);X(11,12);X(15,16);X(14,16);X(14,15);X(18,19);X(17,19);X(17,18);X(21,22);X(20,22);X(20,21);X(23,24);X(2,5);X(3,6);X(0,6);X(0,3);X(4,7);X(1,7);X(1,4);X(11,14);X(8,14);X(8,11);X(12,15);X(9,15);X(9,12);X(13,16);X(10,16);X(10,13);X(20,23);X(17,23);X(17,20);X(21,24);X(18,24);X(18,21);X(19,22);X(8,17);X(9,18);X(0,18);X(0,9);X(10,19);X(1,19);X(1,10);X(11,20);X(2,20);X(2,11);X(12,21);X(3,21);X(3,12);X(13,22);X(4,22);X(4,13);X(14,23);X(5,23);X(5,14);X(15,24);X(6,24);X(6,15);X(7,16);X(7,19);X(13,21);X(15,23);X(7,13);X(7,15);X(1,9);X(3,11);X(5,17);X(11,17);X(9,17);X(4,10);X(6,12);X(7,14);X(4,6);X(4,7);X(12,14);X(10,14);X(6,7);X(10,12);X(6,10);X(6,17);X(12,17);X(7,17);X(7,10);X(12,18);X(7,12);X(10,18);X(12,20);X(10,20);X(10,12);\\nmedian = p[12];\\n#elif KERNEL_SIZE == 7\\nfloat p[49];\\nS( 0,-3,-3);\\nS( 1,-2,-3);\\nS( 2,-1,-3);\\nS( 3, 0,-3);\\nS( 4, 1,-3);\\nS( 5, 2,-3);\\nS( 6, 3,-3);\\nS( 7,-3,-2);\\nS( 8,-2,-2);\\nS( 9,-1,-2);\\nS(10, 0,-2);\\nS(11, 1,-2);\\nS(12, 2,-2);\\nS(13, 3,-2);\\nS(14,-3,-1);\\nS(15,-2,-1);\\nS(16,-1,-1);\\nS(17, 0,-1);\\nS(18, 1,-1);\\nS(19, 2,-1);\\nS(20, 3,-1);\\nS(21,-3, 0);\\nS(22,-2, 0);\\nS(23,-1, 0);\\nS(24, 0, 0);\\nS(25, 1, 0);\\nS(26, 2, 0);\\nS(27, 3, 0);\\nS(28,-3, 1);\\nS(29,-2, 1);\\nS(30,-1, 1);\\nS(31, 0, 1);\\nS(32, 1, 1);\\nS(33, 2, 1);\\nS(34, 3, 1);\\nS(35,-3, 2);\\nS(36,-2, 2);\\nS(37,-1, 2);\\nS(38, 0, 2);\\nS(39, 1, 2);\\nS(40, 2, 2);\\nS(41, 3, 2);\\nS(42,-3, 3);\\nS(43,-2, 3);\\nS(44,-1, 3);\\nS(45, 0, 3);\\nS(46, 1, 3);\\nS(47, 2, 3);\\nS(48, 3, 3);\\nX(0,1);X(2,3);X(0,2);X(1,3);X(1,2);X(4,5);X(6,7);X(4,6);X(5,7);X(5,6);X(0,4);X(2,6);X(2,4);X(1,5);X(3,7);X(3,5);X(1,2);X(3,4);X(5,6);X(8,9);X(10,11);X(8,10);X(9,11);X(9,10);X(12,13);X(14,15);X(12,14);X(13,15);X(13,14);X(8,12);X(10,14);X(10,12);X(9,13);X(11,15);X(11,13);X(9,10);X(11,12);X(13,14);X(0,8);X(4,12);X(4,8);X(2,10);X(6,14);X(6,10);X(2,4);X(6,8);X(10,12);X(1,9);X(5,13);X(5,9);X(3,11);X(7,15);X(7,11);X(3,5);X(7,9);X(11,13);X(1,2);X(3,4);X(5,6);X(7,8);X(9,10);X(11,12);X(13,14);X(16,17);X(18,19);X(16,18);X(17,19);X(17,18);X(20,21);X(22,23);X(20,22);X(21,23);X(21,22);X(16,20);X(18,22);X(18,20);X(17,21);X(19,23);X(19,21);X(17,18);X(19,20);X(21,22);X(24,25);X(26,27);X(24,26);X(25,27);X(25,26);X(28,29);X(30,31);X(28,30);X(29,31);X(29,30);X(24,28);X(26,30);X(26,28);X(25,29);X(27,31);X(27,29);X(25,26);X(27,28);X(29,30);X(16,24);X(20,28);X(20,24);X(18,26);X(22,30);X(22,26);X(18,20);X(22,24);X(26,28);X(17,25);X(21,29);X(21,25);X(19,27);X(23,31);X(23,27);X(19,21);X(23,25);X(27,29);X(17,18);X(19,20);X(21,22);X(23,24);X(25,26);X(27,28);X(29,30);X(0,16);X(8,24);X(8,16);X(4,20);X(12,28);X(12,20);X(4,8);X(12,16);X(20,24);X(2,18);X(10,26);X(10,18);X(6,22);X(14,30);X(14,22);X(6,10);X(14,18);X(22,26);X(2,4);X(6,8);X(10,12);X(14,16);X(18,20);X(22,24);X(26,28);X(1,17);X(9,25);X(9,17);X(5,21);X(13,29);X(13,21);X(5,9);X(13,17);X(21,25);X(3,19);X(11,27);X(11,19);X(7,23);X(15,31);X(15,23);X(7,11);X(15,19);X(23,27);X(3,5);X(7,9);X(11,13);X(15,17);X(19,21);X(23,25);X(27,29);X(1,2);X(3,4);X(5,6);X(7,8);X(9,10);X(11,12);X(13,14);X(15,16);X(17,18);X(19,20);X(21,22);X(23,24);X(25,26);X(27,28);X(29,30);X(32,33);X(34,35);X(32,34);X(33,35);X(33,34);X(36,37);X(38,39);X(36,38);X(37,39);X(37,38);X(32,36);X(34,38);X(34,36);X(33,37);X(35,39);X(35,37);X(33,34);X(35,36);X(37,38);X(40,41);X(42,43);X(40,42);X(41,43);X(41,42);X(44,45);X(46,47);X(44,46);X(45,47);X(45,46);X(40,44);X(42,46);X(42,44);X(41,45);X(43,47);X(43,45);X(41,42);X(43,44);X(45,46);X(32,40);X(36,44);X(36,40);X(34,42);X(38,46);X(38,42);X(34,36);X(38,40);X(42,44);X(33,41);X(37,45);X(37,41);X(35,43);X(39,47);X(39,43);X(35,37);X(39,41);X(43,45);X(33,34);X(35,36);X(37,38);X(39,40);X(41,42);X(43,44);X(45,46);X(32,48);X(40,48);X(36,40);X(44,48);X(38,42);X(34,36);X(38,40);X(42,44);X(46,48);X(37,41);X(39,43);X(35,37);X(39,41);X(43,45);X(33,34);X(35,36);X(37,38);X(39,40);X(41,42);X(43,44);X(45,46);X(47,48);X(0,32);X(16,48);X(16,32);X(8,40);X(24,40);X(8,16);X(24,32);X(40,48);X(4,36);X(20,36);X(12,44);X(28,44);X(12,20);X(28,36);X(4,8);X(12,16);X(20,24);X(28,32);X(36,40);X(44,48);X(2,34);X(18,34);X(10,42);X(26,42);X(10,18);X(26,34);X(6,38);X(22,38);X(14,46);X(30,46);X(14,22);X(30,38);X(6,10);X(14,18);X(22,26);X(30,34);X(38,42);X(2,4);X(6,8);X(10,12);X(14,16);X(18,20);X(22,24);X(26,28);X(30,32);X(34,36);X(38,40);X(42,44);X(46,48);X(1,33);X(17,33);X(9,41);X(25,41);X(9,17);X(25,33);X(5,37);X(21,37);X(13,45);X(29,45);X(13,21);X(29,37);X(5,9);X(13,17);X(21,25);X(29,33);X(37,41);X(3,35);X(19,35);X(11,43);X(27,43);X(11,19);X(27,35);X(7,39);X(23,39);X(15,47);X(31,47);X(15,23);X(31,39);X(7,11);X(15,19);X(23,27);X(31,35);X(39,43);X(3,5);X(7,9);X(11,13);X(15,17);X(19,21);X(23,25);X(27,29);X(31,33);X(35,37);X(39,41);X(43,45);X(1,2);X(3,4);X(5,6);X(7,8);X(9,10);X(11,12);X(13,14);X(15,16);X(17,18);X(19,20);X(21,22);X(23,24);\\nmedian = p[24];\\n#else\\n#error Unsupported kernel size\\n#endif\\ncolor = vec4(median, median, median, 1.0f);\\n}\"\n\n/***/ }),\n\n/***/ 4438:\n/***/ ((module) => {\n\nmodule.exports = \"uniform sampler2D image;\\nuniform sampler2D illuminationMap;\\nuniform float gain;\\nuniform float offset;\\nuniform float decay;\\n#ifndef GREYSCALE\\n#error Must define GREYSCALE\\n#endif\\n#if GREYSCALE == 0\\nconst mat3 rgb2yuv = mat3(\\n0.299f, -0.14713f, 0.615f,\\n0.587f, -0.28886f, -0.51499f,\\n0.114f, 0.436f, -0.10001f\\n);\\nconst mat3 yuv2rgb = mat3(\\n1.0f, 1.0f, 1.0f,\\n0.0f, -0.39465f, 2.03211f,\\n1.13983f, -0.58060f, 0.0f\\n);\\n#endif\\nconst float eps = 0.0001f;\\nconst float sqrt2 = 1.4142135623730951f;\\nconst float magic = 20.0f;\\nconst vec2 center = vec2(0.5f);\\nvoid main()\\n{\\nvec4 pixel = threadPixel(image);\\nvec4 imapPixel = threadPixel(illuminationMap);\\nfloat lambda = -sqrt2 * log(max(1.0f - decay, eps));\\nfloat dist = length(texCoord - center);\\nfloat vgain = gain * exp(-lambda * dist);\\nfloat normalizedGain = 2.0f * vgain;\\nfloat normalizedOffset = 2.0f * offset - 1.0f;\\n#if GREYSCALE != 0\\nfloat luma = 1.0 / (1.0 + exp(-normalizedGain * magic * (pixel.g - imapPixel.g)));\\nluma = clamp(luma + normalizedOffset, 0.0f, 1.0f);\\ncolor = vec4(luma, luma, luma, 1.0f);\\n#else\\nvec3 yuvPixel = rgb2yuv * pixel.rgb;\\nvec3 yuvImapPixel = rgb2yuv * imapPixel.rgb;\\nfloat luma = 1.0 / (1.0 + exp(-normalizedGain * magic * (yuvPixel.r - yuvImapPixel.r)));\\nluma += normalizedOffset;\\nvec3 rgbCorrectedPixel = yuv2rgb * vec3(luma, yuvPixel.gb);\\nrgbCorrectedPixel = clamp(rgbCorrectedPixel, 0.0f, 1.0f);\\ncolor = vec4(rgbCorrectedPixel, 1.0f);\\n#endif\\n}\"\n\n/***/ }),\n\n/***/ 5867:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef GREYSCALE\\n#error Must define GREYSCALE\\n#endif\\n#if GREYSCALE != 0\\nuniform sampler2D minmax2d;\\n#else\\nuniform sampler2D minmax2dRGB[3];\\n#endif\\nuniform float minValue;\\nuniform float maxValue;\\nconst float eps = 1.0f / 255.0f;\\nvoid main()\\n{\\nvec2 minmax = clamp(vec2(minValue, maxValue), 0.0f, 255.0f) / 255.0f;\\nvec4 newMin = vec4(minmax.x);\\nvec4 newRange = vec4(minmax.y - minmax.x);\\nvec4 alpha = vec4(1.0f, newMin.x, newRange.x, 1.0f);\\n#if GREYSCALE != 0\\nvec4 pixel = threadPixel(minmax2d);\\nmat4 channel = mat4(pixel, pixel, pixel, alpha);\\n#else\\nmat4 channel = mat4(\\nthreadPixel(minmax2dRGB[0]),\\nthreadPixel(minmax2dRGB[1]),\\nthreadPixel(minmax2dRGB[2]),\\nalpha\\n);\\n#endif\\nvec4 oldMin = vec4(channel[0].g, channel[1].g, channel[2].g, channel[3].g);\\nvec4 oldRange = max(vec4(channel[0].b, channel[1].b, channel[2].b, channel[3].b), eps);\\nvec4 oldIntensity = vec4(channel[0].a, channel[1].a, channel[2].a, channel[3].a);\\nvec4 newIntensity = (oldIntensity - oldMin) * newRange / oldRange + newMin;\\ncolor = newIntensity;\\n}\"\n\n/***/ }),\n\n/***/ 9252:\n/***/ ((module) => {\n\nmodule.exports = \"const vec4 grey = vec4(0.299f, 0.587f, 0.114f, 0.0f);\\nuniform sampler2D image;\\nvoid main()\\n{\\nvec4 pixel = threadPixel(image);\\nfloat g = dot(pixel, grey);\\ncolor = vec4(g, g, g, 1.0f);\\n}\"\n\n/***/ }),\n\n/***/ 8609:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef _COLORS_GLSL\\n#define _COLORS_GLSL\\n#define PIXELCOMPONENT_RED   @PIXELCOMPONENT_RED@\\n#define PIXELCOMPONENT_GREEN @PIXELCOMPONENT_GREEN@\\n#define PIXELCOMPONENT_BLUE  @PIXELCOMPONENT_BLUE@\\n#define PIXELCOMPONENT_ALPHA @PIXELCOMPONENT_ALPHA@\\n#endif\"\n\n/***/ }),\n\n/***/ 4672:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef _FILTERS_GLSL\\n#define _FILTERS_GLSL\\nfloat laplacian(sampler2D pyramid, vec2 position, float lod)\\n{\\nfloat pot = exp2(lod);\\nivec2 pyrBaseSize = textureSize(pyramid, 0);\\nconst vec3 ones = vec3(1.0f);\\nconst mat3 kernel = mat3(\\n0,-1, 0,\\n-1, 4,-1,\\n0,-1, 0\\n);\\n#define LPC(x,y) pyrSubpixelAtExOffset(pyramid, position, lod, pot, ivec2((x),(y)), pyrBaseSize).g\\nmat3 neighborhood = mat3(\\n0.0f, LPC(0,-1), 0.0f,\\nLPC(-1,0), LPC(0,0), LPC(1,0),\\n0.0f, LPC(0,1), 0.0f\\n);\\nmat3 m = matrixCompMult(neighborhood, kernel);\\nreturn dot(ones, vec3(\\ndot(m[0], ones),\\ndot(m[1], ones),\\ndot(m[2], ones)\\n)) * (1.0f + lod);\\n}\\n#endif\"\n\n/***/ }),\n\n/***/ 9778:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef _FIXEDPOINT_GLSL\\n#define _FIXEDPOINT_GLSL\\n#define fixed_t int\\n#define fixed2_t ivec2\\nconst int FIX_BITS = int(@FIX_BITS@);\\nconst float FIX_RESOLUTION = float(@FIX_RESOLUTION@);\\n#define itofix(x) fixed_t((x) << FIX_BITS)\\n#define fixtoi(f) int((x) >> FIX_BITS)\\n#define ftofix(x) fixed_t((x) * FIX_RESOLUTION + 0.5f)\\n#define fixtof(f) (float(f) / FIX_RESOLUTION)\\n#define ivec2tofix(x) fixed2_t((x) << FIX_BITS)\\n#define fixtoivec2(f) ivec2((f) >> FIX_BITS)\\n#define vec2tofix(v) fixed2_t((v) * FIX_RESOLUTION + vec2(0.5f))\\n#define fixtovec2(f) (vec2(f) / FIX_RESOLUTION)\\n#endif\"\n\n/***/ }),\n\n/***/ 8710:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef _FLOAT16_GLSL\\n#define _FLOAT16_GLSL\\n#define encodeFloat16(f) (vec2(packf16(f)) / 255.0f)\\n#define decodeFloat16(v) unpackf16(uvec2((v) * 255.0f))\\n#define encodePairOfFloat16(f) vec4(encodeFloat16((f).x), encodeFloat16((f).y))\\n#define decodePairOfFloat16(v) vec2(decodeFloat16((v).rg), decodeFloat16((v).ba))\\n#define encodeNullPairOfFloat16() vec4(1.0f)\\n#define isNullPairOfFloat16(v) all(equal((v), encodeNullPairOfFloat16()))\\n#define encodeDiscardedPairOfFloat16() vec4(0.0f, 1.0f, 0.0f, 1.0f)\\n#define isDiscardedPairOfFloat16(v) all(equal((v), encodeDiscardedPairOfFloat16()))\\n#define encodeFloat16NaN() vec2(0.5f, 1.0f)\\n#define isEncodedFloat16NaN(v) all(equal((v), encodeFloat16NaN()))\\nuvec2 packf16( float f)\\n{\\nuint y = packHalf2x16(vec2(f, 0.0f));\\nreturn uvec2(y, y >> 8u) & 0xFFu;\\n}\\nfloat unpackf16(uvec2 v)\\n{\\nv &= 0xFFu;\\nreturn unpackHalf2x16(v.x | (v.y << 8u)).x;\\n}\\nbool isEncodedFloat16Zero(vec2 v)\\n{\\nuvec2 w = uvec2(v * 255.0f);\\nreturn 0u == w.x + w.y * (0x80u - w.y);\\n}\\n#endif\"\n\n/***/ }),\n\n/***/ 2434:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef _GLOBAL_GLSL\\n#define _GLOBAL_GLSL\\n#define threadLocation() ivec2(texCoord * texSize)\\n#define outputSize() ivec2(texSize)\\n#define threadPixel(img) textureLod((img), texCoord, 0.0f)\\n#define pixelAt(img, pos) texelFetch((img), (pos), 0)\\n#define pixelAtShortOffset(img, offset) textureLodOffset((img), texCoord, 0.0f, (offset))\\n#define pixelAtLongOffset(img, offset) textureLod((img), texCoord + vec2(offset) / texSize, 0.0f)\\n#endif\"\n\n/***/ }),\n\n/***/ 439:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef _INT32_GLSL\\n#define _INT32_GLSL\\n@include \\\"platform.glsl\\\"\\nuint decodeUint32(vec4 rgba)\\n{\\nuvec4 v = uvec4(rgba * 255.0f) & 255u;\\nreturn v.x | (v.y << 8u) | (v.z << 16u) | (v.w << 24u);\\n}\\nvec4 encodeUint32(uint value)\\n{\\n#if defined(APPLE_GPU) || (defined(APPLE) && defined(INTEL_GRAPHICS))\\nuvec4 v = uvec4(value, value / 256u, value / 65536u, value / 16777216u) % 256u;\\nreturn vec4(v) / 255.0f;\\n#else\\nuvec4 v = uvec4(value, value >> 8u, value >> 16u, value >> 24u) & 255u;\\nreturn vec4(v) / 255.0f;\\n#endif\\n}\\n#endif\"\n\n/***/ }),\n\n/***/ 8545:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef _KEYPOINT_DESCRIPTORS_GLSL\\n#define _KEYPOINT_DESCRIPTORS_GLSL\\n#if !defined(DESCRIPTOR_SIZE)\\n#error Must define DESCRIPTOR_SIZE\\n#elif !defined(_KEYPOINTS_GLSL)\\n#error Must include keypoints.glsl\\n#endif\\nuint[DESCRIPTOR_SIZE] readKeypointDescriptor(sampler2D encodedKeypoints, int descriptorSize, int extraSize, int encoderLength, KeypointAddress address)\\n{\\nint descriptorOffset = sizeofEncodedKeypoint(0, extraSize) / 4;\\nKeypointAddress descriptorAddress = KeypointAddress(address.base, descriptorOffset);\\nuint[DESCRIPTOR_SIZE] descriptor;\\nvec4 pixel; uvec4 bytes;\\n@unroll\\nfor(int i = 0; i < DESCRIPTOR_SIZE; i += 4) {\\npixel = readKeypointData(encodedKeypoints, encoderLength, descriptorAddress);\\nbytes = uvec4(pixel * 255.0f);\\ndescriptor[i]   = bytes.r;\\ndescriptor[i+1] = bytes.g;\\ndescriptor[i+2] = bytes.b;\\ndescriptor[i+3] = bytes.a;\\ndescriptorAddress.offset++;\\n}\\nreturn descriptor;\\n}\\nuint[DESCRIPTOR_SIZE] readKeypointDescriptorFromDB(sampler2D descriptorDB, int descriptorDBStride, int index)\\n{\\nuint[DESCRIPTOR_SIZE] descriptor;\\nint rasterIndex = index * (DESCRIPTOR_SIZE / 4) * int(index >= 0);\\nvec4 pixel; uvec4 bytes; ivec2 pos;\\n@unroll\\nfor(int i = 0; i < DESCRIPTOR_SIZE; i += 4) {\\npos = ivec2(rasterIndex % descriptorDBStride, rasterIndex / descriptorDBStride);\\npixel = (index >= 0) ? texelFetch(descriptorDB, pos, 0) : vec4(0.0f);\\nbytes = uvec4(pixel * 255.0f);\\ndescriptor[i]   = bytes.r;\\ndescriptor[i+1] = bytes.g;\\ndescriptor[i+2] = bytes.b;\\ndescriptor[i+3] = bytes.a;\\nrasterIndex++;\\n}\\nreturn descriptor;\\n}\\nint distanceBetweenKeypointDescriptors(uint[DESCRIPTOR_SIZE] a, uint[DESCRIPTOR_SIZE] b)\\n{\\nconst int[256] POPCNT = int[256](0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,5,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,5,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,5,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,3,4,4,5,4,5,5,6,4,5,5,6,5,6,6,7,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,5,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,3,4,4,5,4,5,5,6,4,5,5,6,5,6,6,7,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,3,4,4,5,4,5,5,6,4,5,5,6,5,6,6,7,3,4,4,5,4,5,5,6,4,5,5,6,5,6,6,7,4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8);\\nuvec4 xor, u, v;\\nint dist = 0;\\nivec4 bits;\\n@unroll\\nfor(int i = 0; i < DESCRIPTOR_SIZE; i += 4) {\\nu = uvec4(a[i], a[i+1], a[i+2], a[i+3]);\\nv = uvec4(b[i], b[i+1], b[i+2], b[i+3]);\\nxor = (u ^ v) & 255u;\\nbits = ivec4(POPCNT[xor.x], POPCNT[xor.y], POPCNT[xor.z], POPCNT[xor.w]);\\ndist += bits.x + bits.y + bits.z + bits.w;\\n}\\nreturn dist;\\n}\\n#endif\"\n\n/***/ }),\n\n/***/ 6762:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef _KEYPOINT_MATCHES_GLSL\\n#define _KEYPOINT_MATCHES_GLSL\\n@include \\\"int32.glsl\\\"\\nconst int MATCH_INDEX_BITS = int(@MATCH_INDEX_BITS@);\\nconst int MATCH_INDEX_MASK = int(@MATCH_INDEX_MASK@);\\nconst int MATCH_MAX_INDEX = int(@MATCH_MAX_INDEX@);\\nconst int MATCH_MAX_DISTANCE = int(@MATCH_MAX_DISTANCE@);\\nstruct KeypointMatch\\n{\\nint index;\\nint dist;\\n};\\nvec4 encodeKeypointMatch(KeypointMatch candidate)\\n{\\nuint index = uint(candidate.index) & uint(MATCH_INDEX_MASK);\\nuint dist = uint(clamp(candidate.dist, 0, MATCH_MAX_DISTANCE));\\nuint u32 = index | (dist << MATCH_INDEX_BITS);\\nreturn encodeUint32(u32);\\n}\\nKeypointMatch decodeKeypointMatch(vec4 rgba)\\n{\\nuint u32 = decodeUint32(rgba);\\nint dist = int(u32 >> MATCH_INDEX_BITS);\\nint index = int(u32 & uint(MATCH_INDEX_MASK));\\nreturn KeypointMatch(index, dist);\\n}\\nconst KeypointMatch MATCH_NOT_FOUND = KeypointMatch(MATCH_MAX_INDEX, MATCH_MAX_DISTANCE);\\n#endif\"\n\n/***/ }),\n\n/***/ 7639:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef _KEYPOINTS_GLSL\\n#define _KEYPOINTS_GLSL\\n@include \\\"math.glsl\\\"\\n@include \\\"fixed-point.glsl\\\"\\n@include \\\"float16.glsl\\\"\\n@include \\\"pyramids.glsl\\\"\\nstruct Keypoint\\n{\\nvec2 position;\\nfloat lod;\\nfloat orientation;\\nfloat score;\\nuint flags;\\n};\\nstruct KeypointAddress\\n{\\nint base;\\nint offset;\\n};\\nconst int MIN_KEYPOINT_SIZE = int(@MIN_KEYPOINT_SIZE@);\\nconst int MAX_DESCRIPTOR_SIZE = int(@MAX_DESCRIPTOR_SIZE@);\\nconst uint KPF_NONE = 0u;\\nconst uint KPF_NULL = 1u;\\nconst uint KPF_DISCARDED = 2u;\\n#define encodeKeypointScore(score) encodeFloat16(score)\\n#define decodeKeypointScore(encodedScore) decodeFloat16(encodedScore)\\n#define encodeKeypointOrientation(angle) ((angle) * INV_PI_OVER_2 + 0.5f)\\n#define decodeKeypointOrientation(value) ((value) * TWO_PI - PI)\\n#define encodeNullKeypoint() (vec4(1.0f))\\n#define encodeDiscardedKeypoint() (vec4(0.0f))\\n#define isNullKeypoint(keypoint) ((((keypoint).flags) & KPF_NULL) != 0u)\\n#define isDiscardedKeypoint(keypoint) ((((keypoint).flags) & KPF_DISCARDED) != 0u)\\n#define isBadKeypoint(keypoint) ((keypoint).score < 0.0f)\\n#define sizeofEncodedKeypoint(descriptorSize, extraSize) (MIN_KEYPOINT_SIZE + (descriptorSize) + (extraSize))\\n#define sizeofEncodedKeypointHeader() sizeofEncodedKeypoint(0,0)\\n#define findKeypointIndex(address, descriptorSize, extraSize) ((address).base / ((sizeofEncodedKeypoint((descriptorSize), (extraSize))) / 4))\\nvec4 readKeypointData(sampler2D encodedKeypoints, int encoderLength, KeypointAddress address)\\n{\\nint rasterIndex = address.base + address.offset;\\nvec4 data = pixelAt(encodedKeypoints, ivec2(rasterIndex % encoderLength, rasterIndex / encoderLength));\\nreturn rasterIndex < encoderLength * encoderLength ? data : encodeNullKeypoint();\\n}\\nKeypointAddress findKeypointAddress(ivec2 thread, int encoderLength, int descriptorSize, int extraSize)\\n{\\nint threadRaster = thread.y * encoderLength + thread.x;\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nint keypointIndex = int(threadRaster / pixelsPerKeypoint);\\nKeypointAddress address = KeypointAddress(\\nkeypointIndex * pixelsPerKeypoint,\\nthreadRaster % pixelsPerKeypoint\\n);\\nreturn address;\\n}\\nKeypoint decodeKeypoint(sampler2D encodedKeypoints, int encoderLength, KeypointAddress address)\\n{\\nKeypoint keypoint;\\nKeypointAddress positionAddress = KeypointAddress(address.base, 0);\\nKeypointAddress propertiesAddress = KeypointAddress(address.base, 1);\\nvec4 rawEncodedPosition = readKeypointData(encodedKeypoints, encoderLength, positionAddress);\\nivec4 encodedPosition = ivec4(rawEncodedPosition * 255.0f);\\nkeypoint.position = fixtovec2(fixed2_t(\\nencodedPosition.r | (encodedPosition.g << 8),\\nencodedPosition.b | (encodedPosition.a << 8)\\n));\\nvec4 rawEncodedProperties = readKeypointData(encodedKeypoints, encoderLength, propertiesAddress);\\nkeypoint.lod = decodeLod(rawEncodedProperties.r);\\nkeypoint.orientation = decodeKeypointOrientation(rawEncodedProperties.g);\\nkeypoint.score = decodeKeypointScore(rawEncodedProperties.ba);\\nbool isNull = all(equal(rawEncodedPosition, vec4(1)));\\nbool isDiscarded = all(equal(rawEncodedPosition + rawEncodedProperties, vec4(0)));\\nkeypoint.score = (isNull || isDiscarded) ? -1.0f : keypoint.score;\\nkeypoint.flags = KPF_NONE;\\nkeypoint.flags |= KPF_NULL * uint(isNull);\\nkeypoint.flags |= KPF_DISCARDED * uint(isDiscarded);\\nreturn keypoint;\\n}\\nvec4 encodeKeypointPosition(vec2 position)\\n{\\nconst vec2 zeros = vec2(0.0f);\\nfixed2_t pos = vec2tofix(max(position, zeros));\\nfixed2_t lo = pos & 255;\\nfixed2_t hi = (pos >> 8) & 255;\\nreturn vec4(lo.x, hi.x, lo.y, hi.y) / 255.0f;\\n}\\n#endif\"\n\n/***/ }),\n\n/***/ 431:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef _MATH_GLSL\\n#define _MATH_GLSL\\n#define TWO_PI          6.28318530718f\\n#define PI              3.14159265359f\\n#define PI_OVER_2       1.57079632679f\\n#define PI_OVER_4       0.78539816339f\\n#define INV_PI          0.3183098861837907f\\n#define INV_PI_OVER_2   0.15915494309189535f\\nconst highp float INFINITY = 1.0f / 0.0f;\\nfloat fastAtan(float x)\\n{\\nfloat w = 1.0f - abs(x);\\nreturn (w >= 0.0f) ? ((PI_OVER_4 + 0.273f * w) * x) :\\n(sign(x) * PI_OVER_2 - (PI_OVER_4 + 0.273f * (1.0f - abs(1.0f / x))) / x);\\n}\\nfloat fastAtan2(float y, float x)\\n{\\nreturn (x == 0.0f) ? PI_OVER_2 * sign(y) : fastAtan(y / x) + float(x < 0.0f) * PI * sign(y);\\n}\\n#endif\"\n\n/***/ }),\n\n/***/ 6822:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef _PLATFORM_GLSL\\n#define _PLATFORM_GLSL\\n#if @APPLE@\\n#define APPLE 1\\n#endif\\n#if @APPLE_GPU@\\n#define APPLE_GPU 1\\n#endif\\n#if @INTEL_GRAPHICS@\\n#define INTEL_GRAPHICS 1\\n#endif\\n#endif\"\n\n/***/ }),\n\n/***/ 2728:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef _PYRAMIDS_GLSL\\n#define _PYRAMIDS_GLSL\\n#define pyrPixel(pyr, lod) textureLod((pyr), texCoord, (lod))\\n#define pyrPixelAtOffset(pyr, lod, pot, offset) textureLod((pyr), texCoord + ((pot) * vec2(offset)) / texSize, (lod))\\n#define pyrPixelAt(pyr, pos, lod) textureLod((pyr), (vec2(pos) + vec2(0.5f)) / texSize, (lod))\\n#define pyrPixelAtEx(pyr, pos, lod, pyrBaseSize) textureLod((pyr), (vec2(pos) + vec2(0.5f)) / vec2(pyrBaseSize), (lod))\\n#define pyrSubpixelAtEx(pyr, pos, lod, pyrBaseSize) textureLod((pyr), ((pos) + vec2(0.5f)) / vec2(pyrBaseSize), (lod))\\n#define pyrSubpixelAtExOffset(pyr, pos, lod, pot, offset, pyrBaseSize) textureLod((pyr), (((pos) + vec2(0.5f)) + ((pot) * vec2(offset))) / vec2(pyrBaseSize), (lod))\\nconst int PYRAMID_MAX_LEVELS = int(@PYRAMID_MAX_LEVELS@);\\nconst float F_PYRAMID_MAX_LEVELS = float(@PYRAMID_MAX_LEVELS@);\\nconst float LOG2_PYRAMID_MAX_SCALE = float(@LOG2_PYRAMID_MAX_SCALE@);\\n#define encodeLod(lod) ((LOG2_PYRAMID_MAX_SCALE + (lod)) / (LOG2_PYRAMID_MAX_SCALE + F_PYRAMID_MAX_LEVELS))\\nfloat decodeLod(float encodedLod)\\n{\\nfloat lod = encodedLod * (LOG2_PYRAMID_MAX_SCALE + F_PYRAMID_MAX_LEVELS) - LOG2_PYRAMID_MAX_SCALE;\\nreturn lod - lod * step(1.0f, encodedLod);\\n}\\n#define LOD_EPS 0.0625f\\nconst float ENCODED_LOD_EPS = (LOD_EPS / (LOG2_PYRAMID_MAX_SCALE + F_PYRAMID_MAX_LEVELS));\\n#define isSameLod(lod1, lod2) (abs((lod1) - (lod2)) < LOD_EPS)\\n#define isSameEncodedLod(alpha1, alpha2) (abs((alpha1) - (alpha2)) < ENCODED_LOD_EPS)\\n#endif\"\n\n/***/ }),\n\n/***/ 6823:\n/***/ ((module) => {\n\nmodule.exports = \"#ifndef _SUBPIXEL_GLSL\\n#define _SUBPIXEL_GLSL\\n#define subpixelAt(image, pos) textureLod((image), ((pos) + vec2(0.5f)) / texSize, 0.0f)\\nvec4 subpixelAtBI(sampler2D image, vec2 pos)\\n{\\nvec2 frc = fract(pos);\\nvec2 ifrc = vec2(1.0f) - frc;\\nvec2 p = (floor(pos) + vec2(0.5f)) / vec2(textureSize(image, 0));\\nvec4 pix00 = textureLod(image, p, 0.0f);\\nvec4 pix10 = textureLodOffset(image, p, 0.0f, ivec2(1,0));\\nvec4 pix01 = textureLodOffset(image, p, 0.0f, ivec2(0,1));\\nvec4 pix11 = textureLodOffset(image, p, 0.0f, ivec2(1,1));\\nmat4 pix = mat4(pix00, pix10, pix01, pix11);\\nvec4 mul = vec4(ifrc.x * ifrc.y, frc.x * ifrc.y, ifrc.x * frc.y, frc.x * frc.y);\\nreturn pix * mul;\\n}\\n#endif\"\n\n/***/ }),\n\n/***/ 1341:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform sampler2D inputEncodedKeypoints;\\nuniform int inputDescriptorSize;\\nuniform int inputExtraSize;\\nuniform int inputEncoderLength;\\nuniform int outputDescriptorSize;\\nuniform int outputExtraSize;\\nuniform int outputEncoderLength;\\nconst vec4 EMPTY_DESCRIPTOR = vec4(0.0f);\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nKeypointAddress myAddress = findKeypointAddress(thread, outputEncoderLength, outputDescriptorSize, outputExtraSize);\\nint myIndex = findKeypointIndex(myAddress, outputDescriptorSize, outputExtraSize);\\nint headerSize = sizeofEncodedKeypointHeader();\\nbool isDescriptor = (myAddress.offset >= (headerSize + outputExtraSize) / 4);\\nint addressOffset = myAddress.offset;\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(inputDescriptorSize, inputExtraSize) / 4;\\nKeypointAddress otherAddress = KeypointAddress(myIndex * pixelsPerKeypoint, addressOffset);\\ncolor = isDescriptor ? EMPTY_DESCRIPTOR : readKeypointData(inputEncodedKeypoints, inputEncoderLength, otherAddress);\\n}\"\n\n/***/ }),\n\n/***/ 7833:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform sampler2D inputEncodedKeypoints;\\nuniform int inputDescriptorSize;\\nuniform int inputExtraSize;\\nuniform int inputEncoderLength;\\nuniform int outputDescriptorSize;\\nuniform int outputExtraSize;\\nuniform int outputEncoderLength;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nKeypointAddress myAddress = findKeypointAddress(thread, outputEncoderLength, outputDescriptorSize, outputExtraSize);\\nint myIndex = findKeypointIndex(myAddress, outputDescriptorSize, outputExtraSize);\\nint headerSize = sizeofEncodedKeypointHeader();\\nbool isHead = (myAddress.offset < headerSize / 4);\\nbool isDescriptor = (myAddress.offset >= (headerSize + outputExtraSize) / 4);\\nbool isExtra = (!isHead && !isDescriptor);\\nint numberOfExtraPixels = outputExtraSize / 4;\\nint addressOffset = myAddress.offset - int(isDescriptor) * numberOfExtraPixels;\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(inputDescriptorSize, inputExtraSize) / 4;\\nKeypointAddress otherAddress = KeypointAddress(myIndex * pixelsPerKeypoint, addressOffset);\\ncolor = isExtra ? vec4(0.0f) : readKeypointData(inputEncodedKeypoints, inputEncoderLength, otherAddress);\\n}\"\n\n/***/ }),\n\n/***/ 2352:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform mat3 homography;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\nvoid main()\\n{\\nvec4 pixel = threadPixel(encodedKeypoints);\\nivec2 thread = threadLocation();\\nKeypointAddress address = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\ncolor = pixel;\\nif(address.offset != 0)\\nreturn;\\nKeypoint keypoint = decodeKeypoint(encodedKeypoints, encoderLength, address);\\nif(isBadKeypoint(keypoint))\\nreturn;\\nvec3 pos3 = homography * vec3(keypoint.position, 1.0f);\\ncolor = encodeKeypointPosition(pos3.xy / pos3.z);\\n}\"\n\n/***/ }),\n\n/***/ 7541:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\n@include \\\"keypoint-descriptors.glsl\\\"\\n@include \\\"keypoint-matches.glsl\\\"\\nuniform sampler2D encodedMatches;\\nuniform sampler2D encodedFilters;\\nuniform int matcherLength;\\nuniform sampler2D dbEncodedKeypoints;\\nuniform int dbDescriptorSize;\\nuniform int dbExtraSize;\\nuniform int dbEncoderLength;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\nuniform int passId;\\n#ifndef NUMBER_OF_KEYPOINTS_PER_PASS\\n#error Undefined NUMBER_OF_KEYPOINTS_PER_PASS\\n#endif\\nconst int INFINITE_DISTANCE = MATCH_MAX_DISTANCE + 1;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nint keypointIndex = thread.x + thread.y * matcherLength;\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nKeypointAddress address = KeypointAddress(keypointIndex * pixelsPerKeypoint, 0);\\nKeypoint keypoint = decodeKeypoint(encodedKeypoints, encoderLength, address);\\ncolor = encodeKeypointMatch(MATCH_NOT_FOUND);\\nif(isBadKeypoint(keypoint))\\nreturn;\\nKeypointMatch bestMatch = decodeKeypointMatch(threadPixel(encodedMatches));\\nKeypointMatch filterMatch = decodeKeypointMatch(threadPixel(encodedFilters));\\nuint[DESCRIPTOR_SIZE] descriptor = readKeypointDescriptor(encodedKeypoints, descriptorSize, extraSize, encoderLength, address);\\nuint[DESCRIPTOR_SIZE] dbDescriptor;\\nint dbPixelsPerKeypoint = sizeofEncodedKeypoint(dbDescriptorSize, dbExtraSize) / 4;\\nfor(int i = 0; i < NUMBER_OF_KEYPOINTS_PER_PASS; i++) {\\nint dbKeypointIndex = passId * NUMBER_OF_KEYPOINTS_PER_PASS + i;\\nKeypointAddress dbAddress = KeypointAddress(dbKeypointIndex * dbPixelsPerKeypoint, 0);\\nKeypoint dbKeypoint = decodeKeypoint(dbEncodedKeypoints, dbEncoderLength, dbAddress);\\ndbDescriptor = readKeypointDescriptor(dbEncodedKeypoints, dbDescriptorSize, dbExtraSize, dbEncoderLength, dbAddress);\\nint dist = !isBadKeypoint(dbKeypoint) ? distanceBetweenKeypointDescriptors(descriptor, dbDescriptor) : INFINITE_DISTANCE;\\nbestMatch.index = all(bvec2(\\ndist < bestMatch.dist || (dist == bestMatch.dist && dbKeypointIndex > bestMatch.index),\\ndist > filterMatch.dist || (dist == filterMatch.dist && dbKeypointIndex < filterMatch.index)\\n)) ? dbKeypointIndex : bestMatch.index;\\nbestMatch.dist = dbKeypointIndex == bestMatch.index ? dist : bestMatch.dist;\\n}\\ncolor = encodeKeypointMatch(bestMatch);\\n}\"\n\n/***/ }),\n\n/***/ 4868:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform int imageWidth;\\nuniform int imageHeight;\\nuniform int borderTop;\\nuniform int borderRight;\\nuniform int borderBottom;\\nuniform int borderLeft;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nKeypointAddress addr = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nKeypoint keypoint = decodeKeypoint(encodedKeypoints, encoderLength, addr);\\nvec2 p = keypoint.position;\\nbool withinBorder = any(lessThan(\\nvec4(p.x, p.y, -p.x, -p.y),\\nvec4(borderLeft, borderTop, borderRight - (imageWidth - 1), borderBottom - (imageHeight - 1))\\n));\\nvec4 pixel = threadPixel(encodedKeypoints);\\nvec4 nullPixel = encodeNullKeypoint();\\ncolor = withinBorder ? nullPixel : pixel;\\n}\"\n\n/***/ }),\n\n/***/ 5591:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\nuniform int maxKeypoints;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nint newEncoderLength = outputSize().x;\\nKeypointAddress address = findKeypointAddress(thread, newEncoderLength, descriptorSize, extraSize);\\nint index = findKeypointIndex(address, descriptorSize, extraSize);\\nvec4 pixel = readKeypointData(encodedKeypoints, encoderLength, address);\\ncolor = index < maxKeypoints ? pixel : encodeNullKeypoint();\\n}\"\n\n/***/ }),\n\n/***/ 191:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform sampler2D encodedKeypointsA;\\nuniform int encoderLengthA;\\nuniform sampler2D encodedKeypointsB;\\nuniform int encoderLengthB;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\nuniform float threshold;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nKeypointAddress address = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nint index = findKeypointIndex(address, descriptorSize, extraSize);\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nvec4 data = readKeypointData(encodedKeypointsA, encoderLengthA, address);\\ncolor = data;\\nif(address.offset >= sizeofEncodedKeypointHeader() / 4)\\nreturn;\\nKeypoint keypointA = decodeKeypoint(encodedKeypointsA, encoderLengthA, address);\\nKeypoint keypointB = decodeKeypoint(encodedKeypointsB, encoderLengthB, address);\\ncolor = encodeNullKeypoint();\\nif(isNullKeypoint(keypointA) && isNullKeypoint(keypointB))\\nreturn;\\ncolor = encodeDiscardedKeypoint();\\nif(isDiscardedKeypoint(keypointA) || isDiscardedKeypoint(keypointB))\\nreturn;\\ncolor = encodeDiscardedKeypoint();\\nif(isNullKeypoint(keypointA) || isNullKeypoint(keypointB))\\nreturn;\\nvec2 delta = keypointA.position - keypointB.position;\\nbool shouldKeep = (dot(delta, delta) <= threshold * threshold);\\ncolor = shouldKeep ? data : encodeDiscardedKeypoint();\\n}\"\n\n/***/ }),\n\n/***/ 5467:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"float16.glsl\\\"\\nuniform sampler2D offsetsImage;\\nuniform ivec2 imageSize;\\n#ifndef MAX_ITERATIONS\\n#error Undefined MAX_ITERATIONS\\n#endif\\n#define decodeSkipOffset(pixel) (int((pixel).g * 255.0f) | (int((pixel).a * 255.0f) << 8))\\n#define encodeSkipOffset(offset) (vec2((offset) & 255, (offset) >> 8) / 255.0f)\\nvoid main()\\n{\\nvec4 pixel = threadPixel(offsetsImage);\\nivec2 thread = threadLocation();\\nint rasterIndex = thread.y * imageSize.x + thread.x;\\nint offset = decodeSkipOffset(pixel);\\nint totalOffset = offset;\\nvec2 encodedScore = pixel.rb;\\nivec2 pos = thread; int allow = 1;\\n@unroll\\nfor(int i = 0; i < MAX_ITERATIONS; i++) {\\nallow *= int(pos.y < imageSize.y) * int(isEncodedFloat16Zero(pixel.rb));\\nrasterIndex += allow * offset;\\npos = ivec2(rasterIndex % imageSize.x, rasterIndex / imageSize.x);\\npixel = pixelAt(offsetsImage, pos);\\noffset = decodeSkipOffset(pixel);\\ntotalOffset += allow * offset;\\n}\\ntotalOffset = min(totalOffset, 65535);\\ncolor.rb = encodedScore;\\ncolor.ga = encodeSkipOffset(totalOffset);\\n}\"\n\n/***/ }),\n\n/***/ 336:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"float16.glsl\\\"\\nuniform sampler2D corners;\\nuniform ivec2 imageSize;\\nvoid main()\\n{\\nvec4 pixel = threadPixel(corners);\\nivec2 pos = threadLocation();\\nvec2 encodedScore = pixel.rb;\\nint offset = 0, allow = 1, jumped = 0;\\n#define READ(j) ; \\\\\\nallow *= int(pos.y < imageSize.y) * int(isEncodedFloat16Zero(pixel.rb)); \\\\\\noffset += allow; \\\\\\npos.x = (pos.x + 1) % imageSize.x; \\\\\\npos.y += int(pos.x == 0); \\\\\\npixel = (0 != (jumped |= int(pos.x == 0))) ? pixelAtShortOffset(corners, ivec2((j),1)) : pixelAtShortOffset(corners, ivec2((j),0))\\nREAD(1); READ(2); READ(3); READ(4); READ(5); READ(6); READ(7);\\ncolor.rb = encodedScore;\\ncolor.ga = vec2(offset, 0) / 255.0f;\\n}\"\n\n/***/ }),\n\n/***/ 8968:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform sampler2D offsetsImage;\\nuniform ivec2 imageSize;\\nuniform int passId;\\nuniform int numPasses;\\nuniform int keypointLimit;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\n#define decodeSkipOffset(pixel) (int((pixel).g * 255.0f) | (int((pixel).a * 255.0f) << 8))\\nbool findQthKeypoint(int q, int p, inout ivec2 position, out vec4 pixel)\\n{\\nint notFirstPass = int(passId > 0);\\nposition *= notFirstPass;\\np |= -(1 - notFirstPass);\\np -= notFirstPass;\\nint rasterIndex = position.y * imageSize.x + position.x;\\nwhile(position.y < imageSize.y && p != q) {\\nposition = ivec2(rasterIndex % imageSize.x, rasterIndex / imageSize.x);\\npixel = texelFetch(offsetsImage, position, 0);\\np += int(!isEncodedFloat16Zero(pixel.rb));\\nrasterIndex += max(1, decodeSkipOffset(pixel));\\n}\\nreturn (p == q);\\n}\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nKeypointAddress address = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nint q = findKeypointIndex(address, descriptorSize, extraSize);\\ncolor = vec4(0.0f);\\nif(address.offset != 0)\\nreturn;\\ncolor = threadPixel(encodedKeypoints);\\nint numPixels = encoderLength * encoderLength;\\nint maxKeypoints = numPixels / pixelsPerKeypoint;\\nint maxKeypointsPerPass = maxKeypoints / numPasses + int(maxKeypoints % numPasses != 0);\\nint targetPassId = q / maxKeypointsPerPass;\\nif(passId != targetPassId)\\nreturn;\\nint lastIndexFromPrevPass = passId * maxKeypointsPerPass - 1;\\nKeypointAddress lastAddressFromPrevPass = KeypointAddress(max(0, lastIndexFromPrevPass) * pixelsPerKeypoint, 0);\\nKeypoint lastKeypointFromPrevPass = decodeKeypoint(encodedKeypoints, encoderLength, lastAddressFromPrevPass);\\nivec2 position = passId > 0 ? ivec2(lastKeypointFromPrevPass.position) : ivec2(0);\\nvec4 pixel;\\ncolor = encodeNullKeypoint();\\nif(q >= min(maxKeypoints, keypointLimit) || !findQthKeypoint(q, lastIndexFromPrevPass, position, pixel))\\nreturn;\\ncolor = encodeKeypointPosition(vec2(position));\\n}\"\n\n/***/ }),\n\n/***/ 1733:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform sampler2D corners;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nvec4 pixel = threadPixel(encodedKeypoints);\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nKeypointAddress address = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nint q = findKeypointIndex(address, descriptorSize, extraSize);\\ncolor = pixel;\\nif(address.offset != 1)\\nreturn;\\nKeypoint keypoint = decodeKeypoint(encodedKeypoints, encoderLength, address);\\nvec4 kpix = pixelAt(corners, ivec2(keypoint.position));\\nkeypoint.score = decodeFloat16(kpix.rb);\\ncolor.r = kpix.a;\\ncolor.g = encodeKeypointOrientation(0.0f);\\ncolor.ba = encodeKeypointScore(keypoint.score);\\n}\"\n\n/***/ }),\n\n/***/ 9674:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform sampler2D corners;\\nuniform mediump usampler2D lookupTable;\\nuniform int stride;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\nuniform int encoderCapacity;\\nconst uvec2 NULL_ELEMENT = uvec2(0xFFFFu);\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nKeypointAddress address = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nint index = findKeypointIndex(address, descriptorSize, extraSize);\\nivec2 pos = ivec2(index % stride, index / stride);\\nuvec4 entry = texelFetch(lookupTable, pos, 0);\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nint rasterIndex = address.base + address.offset;\\nint numberOfPixels = encoderLength * encoderLength;\\nint numberOfValidPixels = numberOfPixels - (numberOfPixels % pixelsPerKeypoint);\\nint maxEncoderCapacity = numberOfValidPixels / pixelsPerKeypoint;\\ncolor = encodeNullKeypoint();\\nif(all(equal(entry.xy, NULL_ELEMENT)) || index >= min(encoderCapacity, maxEncoderCapacity))\\nreturn;\\ncolor = encodeKeypointPosition(vec2(entry.xy));\\nif(address.offset == 0)\\nreturn;\\ncolor = vec4(0.0f);\\nif(address.offset >= sizeofEncodedKeypointHeader() / 4)\\nreturn;\\nvec4 pixel = texelFetch(corners, ivec2(entry.xy), 0);\\nvec2 encodedScore = encodeKeypointScore(decodeFloat16(pixel.rb));\\nfloat encodedOrientation = encodeKeypointOrientation(0.0f);\\nfloat encodedLod = pixel.a;\\ncolor = vec4(encodedLod, encodedOrientation, encodedScore);\\n}\"\n\n/***/ }),\n\n/***/ 2090:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nvoid main()\\n{\\ncolor = encodeNullKeypoint();\\n}\"\n\n/***/ }),\n\n/***/ 1855:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"pyramids.glsl\\\"\\n@include \\\"float16.glsl\\\"\\nuniform sampler2D corners;\\nuniform sampler2D pyramid;\\nuniform float lod;\\nuniform int threshold;\\n#define USE_VARYINGS 1\\n#if !defined(FAST_TYPE)\\n#error Undefined FAST_TYPE\\n#elif FAST_TYPE == 916\\nin vec2 v_pix0, v_pix1, v_pix2, v_pix3, v_pix4, v_pix5, v_pix6, v_pix7,\\nv_pix8, v_pix9, v_pix10,v_pix11,v_pix12,v_pix13,v_pix14,v_pix15;\\n#else\\n#error Invalid FAST_TYPE\\n#endif\\n#define PIX(x,y) pyrPixelAtOffset(pyramid, lod, pot, ivec2((x),(y))).g\\n#define XIP(v) textureLod(pyramid, (v), lod).g\\nvoid main()\\n{\\nfloat pixel = threadPixel(pyramid).g;\\nvec4 prev = threadPixel(corners);\\nivec2 thread = threadLocation();\\nivec2 size = outputSize();\\nfloat pot = exp2(lod);\\nfloat t = float(clamp(threshold, 0, 255)) / 255.0f;\\nfloat ct = pixel + t, c_t = pixel - t;\\ncolor = vec4(prev.r, pixel, prev.ba);\\n#if FAST_TYPE == 916\\nconst ivec4 margin = ivec4(3, 3, 4, 4);\\nif(any(lessThan(ivec4(thread, size - thread), margin)))\\nreturn;\\n#if USE_VARYINGS\\nfloat p0 = XIP(v_pix0), p4 = XIP(v_pix4), p8 = XIP(v_pix8), p12 = XIP(v_pix12);\\n#else\\nfloat p0 = PIX(0,3), p4 = PIX(3,0), p8 = PIX(0,-3), p12 = PIX(-3,0);\\n#endif\\nbvec4 brighter = bvec4(p0 > ct, p4 > ct, p8 > ct, p12 > ct);\\nbvec4 darker = bvec4(p0 < c_t, p4 < c_t, p8 < c_t, p12 < c_t);\\nbvec4 bpairs = bvec4(all(brighter.xy), all(brighter.yz), all(brighter.zw), all(brighter.wx));\\nbvec4 dpairs = bvec4(all(darker.xy), all(darker.yz), all(darker.zw), all(darker.wx));\\nif(!(any(bpairs) || any(dpairs)))\\nreturn;\\n#if USE_VARYINGS\\nfloat p1 = XIP(v_pix1), p2 = XIP(v_pix2), p3 = XIP(v_pix3),\\np5 = XIP(v_pix5), p6 = XIP(v_pix6), p7 = XIP(v_pix7),\\np9 = XIP(v_pix9), p10 = XIP(v_pix10), p11 = XIP(v_pix11),\\np13 = XIP(v_pix13), p14 = XIP(v_pix14), p15 = XIP(v_pix15);\\n#else\\nfloat p1 = PIX(1,3), p2 = PIX(2,2), p3 = PIX(3,1),\\np5 = PIX(3,-1), p6 = PIX(2,-2), p7 = PIX(1,-3),\\np9 = PIX(-1,-3), p10 = PIX(-2,-2), p11 = PIX(-3,-1),\\np13 = PIX(-3,1), p14 = PIX(-2,2), p15 = PIX(-1,3);\\n#endif\\nbool A=(p0>ct),B=(p1>ct),C=(p2>ct),D=(p3>ct),E=(p4>ct),F=(p5>ct),G=(p6>ct),H=(p7>ct),I=(p8>ct),J=(p9>ct),K=(p10>ct),L=(p11>ct),M=(p12>ct),N=(p13>ct),O=(p14>ct),P=(p15>ct),a=(p0<c_t),b=(p1<c_t),c=(p2<c_t),d=(p3<c_t),e=(p4<c_t),f=(p5<c_t),g=(p6<c_t),h=(p7<c_t),i=(p8<c_t),j=(p9<c_t),k=(p10<c_t),l=(p11<c_t),m=(p12<c_t),n=(p13<c_t),o=(p14<c_t),p=(p15<c_t);\\nbool isCorner=A&&(B&&(K&&L&&J&&(M&&N&&O&&P||G&&H&&I&&(M&&N&&O||F&&(M&&N||E&&(M||D))))||C&&(K&&L&&M&&(N&&O&&P||G&&H&&I&&J&&(N&&O||F&&(N||E)))||D&&(N&&(L&&M&&(K&&G&&H&&I&&J&&(O||F)||O&&P)||k&&l&&m&&e&&f&&g&&h&&i&&j)||E&&(O&&(M&&N&&(K&&L&&G&&H&&I&&J||P)||k&&l&&m&&n&&f&&g&&h&&i&&j)||F&&(P&&(N&&O||k&&l&&m&&n&&o&&g&&h&&i&&j)||G&&(O&&P||H&&(P||I)||k&&l&&m&&n&&o&&p&&h&&i&&j)||k&&l&&m&&n&&o&&h&&i&&j&&(p||g))||k&&l&&m&&n&&h&&i&&j&&(o&&(p||g)||f&&(o&&p||g)))||k&&l&&m&&h&&i&&j&&(n&&(o&&p||g&&(o||f))||e&&(n&&o&&p||g&&(n&&o||f))))||k&&l&&h&&i&&j&&(m&&(n&&o&&p||g&&(n&&o||f&&(n||e)))||d&&(m&&n&&o&&p||g&&(m&&n&&o||f&&(m&&n||e)))))||k&&h&&i&&j&&(l&&(m&&n&&o&&p||g&&(m&&n&&o||f&&(m&&n||e&&(m||d))))||c&&(l&&m&&n&&o&&p||g&&(l&&m&&n&&o||f&&(l&&m&&n||e&&(l&&m||d))))))||K&&I&&J&&(L&&M&&N&&O&&P||G&&H&&(L&&M&&N&&O||F&&(L&&M&&N||E&&(L&&M||D&&(L||C)))))||h&&i&&j&&(b&&(k&&l&&m&&n&&o&&p||g&&(k&&l&&m&&n&&o||f&&(k&&l&&m&&n||e&&(k&&l&&m||d&&(k&&l||c)))))||k&&(l&&m&&n&&o&&p||g&&(l&&m&&n&&o||f&&(l&&m&&n||e&&(l&&m||d&&(l||c)))))))||B&&(H&&I&&J&&(K&&L&&M&&N&&O&&P&&a||G&&(K&&L&&M&&N&&O&&a||F&&(K&&L&&M&&N&&a||E&&(K&&L&&M&&a||D&&(K&&L&&a||C)))))||a&&k&&i&&j&&(l&&m&&n&&o&&p||g&&h&&(l&&m&&n&&o||f&&(l&&m&&n||e&&(l&&m||d&&(l||c))))))||C&&(K&&H&&I&&J&&(L&&M&&N&&O&&P&&a&&b||G&&(L&&M&&N&&O&&a&&b||F&&(L&&M&&N&&a&&b||E&&(L&&M&&a&&b||D))))||a&&b&&k&&l&&j&&(m&&n&&o&&p||g&&h&&i&&(m&&n&&o||f&&(m&&n||e&&(m||d)))))||D&&(K&&L&&H&&I&&J&&(M&&N&&O&&P&&a&&b&&c||G&&(M&&N&&O&&a&&b&&c||F&&(M&&N&&a&&b&&c||E)))||a&&b&&k&&l&&m&&c&&(n&&o&&p||g&&h&&i&&j&&(n&&o||f&&(n||e))))||E&&(K&&L&&M&&H&&I&&J&&(N&&O&&P&&a&&b&&c&&d||G&&(N&&O&&a&&b&&c&&d||F))||a&&b&&l&&m&&n&&c&&d&&(k&&g&&h&&i&&j&&(o||f)||o&&p))||F&&(K&&L&&M&&N&&H&&I&&J&&(O&&P&&a&&b&&c&&d&&e||G)||a&&b&&m&&n&&o&&c&&d&&e&&(k&&l&&g&&h&&i&&j||p))||G&&(K&&L&&M&&N&&O&&H&&I&&J||a&&b&&n&&o&&p&&c&&d&&e&&f)||H&&(K&&L&&M&&N&&O&&P&&I&&J||a&&b&&o&&p&&c&&d&&e&&f&&g)||a&&(b&&(k&&l&&j&&(m&&n&&o&&p||g&&h&&i&&(m&&n&&o||f&&(m&&n||e&&(m||d))))||c&&(k&&l&&m&&(n&&o&&p||g&&h&&i&&j&&(n&&o||f&&(n||e)))||d&&(l&&m&&n&&(k&&g&&h&&i&&j&&(o||f)||o&&p)||e&&(m&&n&&o&&(k&&l&&g&&h&&i&&j||p)||f&&(n&&o&&p||g&&(o&&p||h&&(p||i)))))))||k&&i&&j&&(l&&m&&n&&o&&p||g&&h&&(l&&m&&n&&o||f&&(l&&m&&n||e&&(l&&m||d&&(l||c))))))||h&&i&&j&&(k&&l&&m&&n&&o&&p||g&&(k&&l&&m&&n&&o||f&&(k&&l&&m&&n||e&&(k&&l&&m||d&&(k&&l||c&&(b||k))))));\\nif(!isCorner)\\nreturn;\\nmat4 mp = mat4(p0,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13,p14,p15);\\nmat4 mct = mp - mat4(ct,ct,ct,ct,ct,ct,ct,ct,ct,ct,ct,ct,ct,ct,ct,ct);\\nmat4 mc_t = mat4(c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t) - mp;\\nconst vec4 zeros = vec4(0.0f), ones = vec4(1.0f);\\nvec4 bs = max(mct[0], zeros), ds = max(mc_t[0], zeros);\\nbs += max(mct[1], zeros);     ds += max(mc_t[1], zeros);\\nbs += max(mct[2], zeros);     ds += max(mc_t[2], zeros);\\nbs += max(mct[3], zeros);     ds += max(mc_t[3], zeros);\\nfloat thisScore = max(dot(bs, ones), dot(ds, ones)) / 16.0f;\\nfloat prevScore = decodeFloat16(prev.rb);\\nvec3 thisResult = vec3(encodeFloat16(thisScore), encodeLod(lod));\\ncolor.rba = thisScore > prevScore ? thisResult : color.rba;\\n#endif\\n}\"\n\n/***/ }),\n\n/***/ 4824:\n/***/ ((module) => {\n\nmodule.exports = \"uniform mediump float lod;\\n#if !defined(FAST_TYPE)\\n#error Undefined FAST_TYPE\\n#elif FAST_TYPE == 916\\nout vec2 v_pix0, v_pix1, v_pix2, v_pix3, v_pix4, v_pix5, v_pix6, v_pix7,\\nv_pix8, v_pix9, v_pix10,v_pix11,v_pix12,v_pix13,v_pix14,v_pix15;\\n#else\\n#error Invalid FAST_TYPE\\n#endif\\n#define PIX(x,y) (texCoord + ((pot) * vec2((x),(y))) / texSize)\\nvoid vsmain()\\n{\\nfloat pot = exp2(lod);\\n#if FAST_TYPE == 916\\nv_pix0 = PIX(0,3); v_pix1 = PIX(1,3), v_pix2 = PIX(2,2), v_pix3 = PIX(3,1);\\nv_pix4 = PIX(3,0); v_pix5 = PIX(3,-1), v_pix6 = PIX(2,-2), v_pix7 = PIX(1,-3);\\nv_pix8 = PIX(0,-3); v_pix9 = PIX(-1,-3), v_pix10 = PIX(-2,-2), v_pix11 = PIX(-3,-1);\\nv_pix12 = PIX(-3,0); v_pix13 = PIX(-3,1), v_pix14 = PIX(-2,2), v_pix15 = PIX(-1,3);\\n#endif\\n}\"\n\n/***/ }),\n\n/***/ 2381:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\n@include \\\"keypoint-descriptors.glsl\\\"\\nuniform sampler2D encodedKeypointsA;\\nuniform int encoderLengthA;\\nuniform sampler2D encodedKeypointsB;\\nuniform int encoderLengthB;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\nuniform int threshold;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nKeypointAddress address = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nint index = findKeypointIndex(address, descriptorSize, extraSize);\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nvec4 data = readKeypointData(encodedKeypointsA, encoderLengthA, address);\\ncolor = data;\\nif(address.offset >= sizeofEncodedKeypointHeader() / 4)\\nreturn;\\nKeypoint keypointA = decodeKeypoint(encodedKeypointsA, encoderLengthA, address);\\nKeypoint keypointB = decodeKeypoint(encodedKeypointsB, encoderLengthB, address);\\ncolor = encodeNullKeypoint();\\nif(isNullKeypoint(keypointA) && isNullKeypoint(keypointB))\\nreturn;\\ncolor = encodeDiscardedKeypoint();\\nif(isDiscardedKeypoint(keypointA) || isDiscardedKeypoint(keypointB))\\nreturn;\\ncolor = encodeDiscardedKeypoint();\\nif(isNullKeypoint(keypointA) || isNullKeypoint(keypointB))\\nreturn;\\nuint[DESCRIPTOR_SIZE] descriptorA, descriptorB;\\ndescriptorA = readKeypointDescriptor(encodedKeypointsA, descriptorSize, extraSize, encoderLengthA, address);\\ndescriptorB = readKeypointDescriptor(encodedKeypointsB, descriptorSize, extraSize, encoderLengthB, address);\\nint dist = distanceBetweenKeypointDescriptors(descriptorA, descriptorB);\\nbool shouldKeep = (dist <= threshold);\\ncolor = shouldKeep ? data : encodeDiscardedKeypoint();\\n}\"\n\n/***/ }),\n\n/***/ 6060:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"float16.glsl\\\"\\nuniform sampler2D corners;\\nuniform sampler2D maxScore;\\nuniform float quality;\\nvoid main()\\n{\\nvec4 pixel = threadPixel(corners);\\nfloat score = decodeFloat16(pixel.rb);\\nfloat maxval = decodeFloat16(threadPixel(maxScore).rb);\\nfloat threshold = maxval * clamp(quality, 0.0f, 1.0f);\\ncolor = pixel;\\ncolor.rb = score >= threshold ? color.rb : encodeFloat16(0.0f);\\n}\"\n\n/***/ }),\n\n/***/ 9974:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"pyramids.glsl\\\"\\n@include \\\"float16.glsl\\\"\\n@include \\\"filters.glsl\\\"\\n#if !defined(WINDOW_SIZE)\\n#error Undefined WINDOW_SIZE\\n#endif\\n#define WINDOW_RADIUS ((WINDOW_SIZE - 1) / 2)\\nuniform sampler2D corners;\\nuniform sampler2D pyramid;\\nuniform sampler2D derivatives;\\nuniform float lod;\\nuniform float lodStep;\\nuniform float gaussian[@WINDOW_SIZE@];\\n#define G(x) gaussian[(x) + WINDOW_RADIUS]\\n#define W(x,y) (G(x) * G(y))\\n#define H(ox,oy) dpix = pixelAtShortOffset(derivatives, ivec2((ox),(oy))); \\\\\\ndf = (1.0f + lod) * decodePairOfFloat16(dpix); \\\\\\nh += vec3(df.x * df.x, df.x * df.y, df.y * df.y) * W((ox),(oy))\\nvoid main()\\n{\\nfloat intensity = 0.0f;\\nivec2 thread = threadLocation();\\nvec4 pixel = threadPixel(corners);\\nvec4 dpix = vec4(0.0f);\\nvec2 df = vec2(0.0f);\\nvec3 h = vec3(0.0f);\\ncolor = pixel;\\n#if WINDOW_SIZE == 1\\nH(0,0);\\n#elif WINDOW_SIZE == 3\\nH(-1,-1); H(0,-1); H(1,-1);\\nH(-1,0); H(0,0); H(1,0);\\nH(-1,1); H(0,1); H(1,1);\\n#elif WINDOW_SIZE == 5\\nH(-2,-2); H(-1,-2); H(0,-2); H(1,-2); H(2,-2);\\nH(-2,-1); H(-1,-1); H(0,-1); H(1,-1); H(2,-1);\\nH(-2,0); H(-1,0); H(0,0); H(1,0); H(2,0);\\nH(-2,1); H(-1,1); H(0,1); H(1,1); H(2,1);\\nH(-2,2); H(-1,2); H(0,2); H(1,2); H(2,2);\\n#elif WINDOW_SIZE == 7\\nH(-3,-3); H(-2,-3); H(-1,-3); H(0,-3); H(1,-3); H(2,-3); H(3,-3);\\nH(-3,-2); H(-2,-2); H(-1,-2); H(0,-2); H(1,-2); H(2,-2); H(3,-2);\\nH(-3,-1); H(-2,-1); H(-1,-1); H(0,-1); H(1,-1); H(2,-1); H(3,-1);\\nH(-3,0); H(-2,0); H(-1,0); H(0,0); H(1,0); H(2,0); H(3,0);\\nH(-3,1); H(-2,1); H(-1,1); H(0,1); H(1,1); H(2,1); H(3,1);\\nH(-3,2); H(-2,2); H(-1,2); H(0,2); H(1,2); H(2,2); H(3,2);\\nH(-3,3); H(-2,3); H(-1,3); H(0,3); H(1,3); H(2,3); H(3,3);\\n#else\\n#error Invalid WINDOW_SIZE\\n#endif\\nfloat response = 0.5f * (h.x + h.z - sqrt((h.x - h.z) * (h.x - h.z) + 4.0f * h.y * h.y));\\nresponse /= float(WINDOW_SIZE * WINDOW_SIZE);\\nfloat lodPlus = min(float(PYRAMID_MAX_LEVELS - 1), lod + lodStep);\\nfloat currentScaleStrength = abs(laplacian(pyramid, vec2(thread), lod));\\nfloat previousScaleStrength = abs(laplacian(pyramid, vec2(thread), lodPlus));\\nfloat previousResponse = decodeFloat16(pixel.rb);\\nvec4 result = vec4(encodeFloat16(response), encodeLod(lod), intensity);\\ncolor.rbag = (currentScaleStrength >= previousScaleStrength || previousResponse == 0.0f) ? result : pixel.rbag;\\n}\"\n\n/***/ }),\n\n/***/ 3047:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoint-matches.glsl\\\"\\nvoid main()\\n{\\n#if ENCODE_FILTERS != 0\\nKeypointMatch initial = KeypointMatch(MATCH_MAX_INDEX, 0);\\n#else\\nKeypointMatch initial = KeypointMatch(MATCH_MAX_INDEX, MATCH_MAX_DISTANCE);\\n#endif\\ncolor = encodeKeypointMatch(initial);\\n}\"\n\n/***/ }),\n\n/***/ 3266:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoint-matches.glsl\\\"\\nuniform sampler2D encodedMatches;\\nuniform sampler2D encodedKthMatches;\\nuniform int numberOfMatchesPerKeypoint;\\nuniform int kthMatch;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nivec2 matcherSize = textureSize(encodedMatches, 0);\\nivec2 kthMatcherSize = textureSize(encodedKthMatches, 0);\\nint rasterIndex = thread.y * matcherSize.x + thread.x;\\nint matchIndex = rasterIndex / numberOfMatchesPerKeypoint;\\nint matchCell = rasterIndex % numberOfMatchesPerKeypoint;\\ncolor = threadPixel(encodedMatches);\\nif(matchCell != kthMatch)\\nreturn;\\ncolor = encodeKeypointMatch(MATCH_NOT_FOUND);\\nif(matchIndex >= kthMatcherSize.x * kthMatcherSize.y)\\nreturn;\\nivec2 pos = ivec2(matchIndex % kthMatcherSize.x, matchIndex / kthMatcherSize.x);\\ncolor = texelFetch(encodedKthMatches, pos, 0);\\n}\"\n\n/***/ }),\n\n/***/ 8018:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"pyramids.glsl\\\"\\n@include \\\"float16.glsl\\\"\\n@include \\\"filters.glsl\\\"\\nuniform sampler2D corners;\\nuniform sampler2D pyramid;\\nuniform float lodStep;\\nuniform float lodOffset;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nvec4 pixel = threadPixel(corners);\\nfloat lod = decodeLod(pixel.a);\\nfloat lodMinus = max(0.0f, lod - lodStep + lodOffset);\\nfloat lodPlus = min(float(PYRAMID_MAX_LEVELS - 1), lod + lodStep + lodOffset);\\nfloat lapMinus = laplacian(pyramid, vec2(thread), lodMinus);\\nfloat lapPlus = abs(lodPlus - lodMinus) < 1e-5 ? lapMinus : laplacian(pyramid, vec2(thread), lodPlus);\\ncolor = encodePairOfFloat16(vec2(lapMinus, lapPlus));\\n}\"\n\n/***/ }),\n\n/***/ 3168:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\n@include \\\"float16.glsl\\\"\\nuniform sampler2D nextPyramid;\\nuniform sampler2D prevPyramid;\\nuniform sampler2D encodedFlow;\\nuniform sampler2D prevKeypoints;\\nuniform int level;\\nuniform int depth;\\nuniform int numberOfIterations;\\nuniform float discardThreshold;\\nuniform float epsilon;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\n#ifndef WINDOW_SIZE\\n#error Undefined WINDOW_SIZE\\n#endif\\n#define NEXT_IMAGE 1\\n#define PREV_IMAGE 0\\nconst int WINDOW_RADIUS = (WINDOW_SIZE - 1) / 2;\\nconst int WINDOW_SIZE_SQUARED = (WINDOW_SIZE) * (WINDOW_SIZE);\\nconst int WINDOW_SIZE_PLUS = (WINDOW_SIZE) + 2;\\nconst int WINDOW_SIZE_PLUS_SQUARED = WINDOW_SIZE_PLUS * WINDOW_SIZE_PLUS;\\nconst int DBL_WINDOW_SIZE_PLUS_SQUARED = 2 * WINDOW_SIZE_PLUS_SQUARED;\\nconst int WINDOW_RADIUS_PLUS = (WINDOW_SIZE_PLUS - 1) / 2;\\nconst highp float FLT_SCALE = 9.5367431640625e-7;\\nconst highp float FLT_EPSILON = 0.00000011920929f;\\nint pixelBuffer[DBL_WINDOW_SIZE_PLUS_SQUARED];\\n#define prevPixel(index) pixelBuffer[(index)]\\n#define nextPixel(index) pixelBuffer[WINDOW_SIZE_PLUS_SQUARED + (index)]\\n#define pixelIndex(i, j) (((j) + WINDOW_RADIUS_PLUS) * WINDOW_SIZE_PLUS + ((i) + WINDOW_RADIUS_PLUS))\\nivec2 derivBuffer[WINDOW_SIZE_SQUARED];\\n#define derivativesAt(x, y) derivBuffer[((y) + WINDOW_RADIUS) * WINDOW_SIZE + ((x) + WINDOW_RADIUS)]\\nvoid readWindow(vec2 center, float lod)\\n{\\nconst int r = WINDOW_RADIUS;\\nivec2 pyrBaseSize = textureSize(prevPyramid, 0);\\nfloat pot = exp2(lod);\\nivec2 offset; int idx;\\n#define readPixelsAt(ox, oy) offset = ivec2((ox), (oy)); \\\\\\nidx = pixelIndex(offset.x, offset.y); \\\\\\nnextPixel(idx) = int(255.0f * pyrSubpixelAtExOffset(nextPyramid, center, lod, pot, offset, pyrBaseSize).g); \\\\\\nprevPixel(idx) = int(255.0f * pyrSubpixelAtExOffset(prevPyramid, center, lod, pot, offset, pyrBaseSize).g)\\nfor(int j = 0; j < WINDOW_SIZE; j++) {\\nfor(int i = 0; i < WINDOW_SIZE; i++) {\\nreadPixelsAt(i-r, j-r);\\n}\\n}\\nint r1 = r+1;\\nfor(int k = 0; k < WINDOW_SIZE; k++) {\\nreadPixelsAt(-r1, k-r);\\nreadPixelsAt( r1, k-r);\\nreadPixelsAt(k-r,-r1);\\nreadPixelsAt(k-r, r1);\\n}\\nreadPixelsAt(-r1,-r1);\\nreadPixelsAt( r1,-r1);\\nreadPixelsAt(-r1, r1);\\nreadPixelsAt( r1, r1);\\n}\\nivec2 computeDerivatives(int imageCode, ivec2 offset)\\n{\\nconst mat3 dx = mat3(\\n3, 0, -3,\\n10, 0, -10,\\n3, 0, -3\\n);\\nconst mat3 dy = mat3(\\n3, 10, 3,\\n0, 0, 0,\\n-3, -10, -3\\n);\\nint indexOffset = imageCode * WINDOW_SIZE_PLUS_SQUARED;\\nmat3 window = mat3(\\npixelBuffer[indexOffset + pixelIndex(offset.x-1, offset.y-1)],\\npixelBuffer[indexOffset + pixelIndex(offset.x+0, offset.y-1)],\\npixelBuffer[indexOffset + pixelIndex(offset.x+1, offset.y-1)],\\npixelBuffer[indexOffset + pixelIndex(offset.x-1, offset.y+0)],\\n0.0f,\\npixelBuffer[indexOffset + pixelIndex(offset.x+1, offset.y+0)],\\npixelBuffer[indexOffset + pixelIndex(offset.x-1, offset.y+1)],\\npixelBuffer[indexOffset + pixelIndex(offset.x+0, offset.y+1)],\\npixelBuffer[indexOffset + pixelIndex(offset.x+1, offset.y+1)]\\n);\\nmat3 fx = matrixCompMult(dx, window);\\nmat3 fy = matrixCompMult(dy, window);\\nconst vec3 ones = vec3(1.0f);\\nreturn ivec2(\\ndot(fx[0], ones) + dot(fx[1], ones) + dot(fx[2], ones),\\ndot(fy[0], ones) + dot(fy[1], ones) + dot(fy[2], ones)\\n);\\n}\\nint readBufferedPixel(int imageCode, ivec2 offset)\\n{\\nconst int r = WINDOW_RADIUS;\\noffset = clamp(offset, -r, r);\\nint indexOffset = imageCode * WINDOW_SIZE_PLUS_SQUARED;\\nreturn pixelBuffer[indexOffset + pixelIndex(offset.x, offset.y)];\\n}\\nint readBufferedSubpixel(int imageCode, vec2 offset)\\n{\\nivec2 p = ivec2(floor(offset));\\nvec2 frc = fract(offset);\\nvec2 ifrc = vec2(1.0f) - frc;\\nvec4 pix = vec4(\\nreadBufferedPixel(imageCode, p),\\nreadBufferedPixel(imageCode, p + ivec2(1,0)),\\nreadBufferedPixel(imageCode, p + ivec2(0,1)),\\nreadBufferedPixel(imageCode, p + ivec2(1,1))\\n);\\nvec4 sub = vec4(\\nifrc.x * ifrc.y,\\nfrc.x * ifrc.y,\\nifrc.x * frc.y,\\nfrc.x * frc.y\\n);\\nreturn int(0.5f + dot(sub*pix, vec4(1.0f)));\\n}\\nvec2 computeMismatch(vec2 pyrGuess, vec2 localGuess)\\n{\\nconst int r = WINDOW_RADIUS;\\nint timeDerivative;\\nivec2 mismatch = ivec2(0);\\nint x, y, _x, _y;\\nvec2 d = pyrGuess + localGuess;\\n#define innerLoop() \\\\\\nfor(_x = 0; _x < WINDOW_SIZE; _x++) { \\\\\\nx = _x - r; y = _y - r; \\\\\\ntimeDerivative = ( \\\\\\nreadBufferedSubpixel(NEXT_IMAGE, vec2(x, y) + d) - \\\\\\nreadBufferedPixel(PREV_IMAGE, ivec2(x, y)) \\\\\\n); \\\\\\nmismatch += derivativesAt(x, y) * timeDerivative; \\\\\\n}\\n@unroll\\nfor(_y = 0; _y < WINDOW_SIZE; _y++) {\\ninnerLoop();\\n}\\nreturn vec2(mismatch) * FLT_SCALE;\\n}\\nbool isInsideImage(vec2 position)\\n{\\nvec2 imageSize = vec2(textureSize(nextPyramid, 0));\\nvec2 border = vec2(WINDOW_SIZE);\\nreturn all(bvec4(\\ngreaterThanEqual(position, border),\\nlessThan(position, imageSize - border)\\n));\\n}\\nvoid main()\\n{\\nvec4 pixel = threadPixel(encodedFlow);\\nivec2 thread = threadLocation();\\nfloat windowArea = float(WINDOW_SIZE * WINDOW_SIZE);\\nconst int r = WINDOW_RADIUS;\\nint keypointIndex = thread.x + thread.y * outputSize().x;\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nKeypointAddress address = KeypointAddress(keypointIndex * pixelsPerKeypoint, 0);\\nKeypoint keypoint = decodeKeypoint(prevKeypoints, encoderLength, address);\\ncolor = encodeNullPairOfFloat16();\\nif(isNullKeypoint(keypoint))\\nreturn;\\ncolor = encodeDiscardedPairOfFloat16();\\nif(isBadKeypoint(keypoint))\\nreturn;\\nvec2 pyrGuess = (level < depth - 1) ? decodePairOfFloat16(pixel) : vec2(0.0f);\\npyrGuess *= 2.0f;\\nreadWindow(keypoint.position, float(level));\\nivec2 derivatives;\\nivec3 harris3i = ivec3(0);\\nfor(int j = 0; j < WINDOW_SIZE; j++) {\\nfor(int i = 0; i < WINDOW_SIZE; i++) {\\nderivatives = computeDerivatives(PREV_IMAGE, ivec2(i-r, j-r));\\nharris3i += ivec3(\\nderivatives.x * derivatives.x,\\nderivatives.x * derivatives.y,\\nderivatives.y * derivatives.y\\n);\\nderivativesAt(i-r, j-r) = derivatives;\\n}\\n}\\nhighp vec3 harris = vec3(harris3i) * FLT_SCALE;\\nhighp mat2 invHarris = mat2(harris.z, -harris.y, -harris.y, harris.x);\\nhighp float det = harris.x * harris.z - harris.y * harris.y;\\nhighp float invDet = abs(det) >= FLT_EPSILON ? 1.0f / det : 0.0f;\\nhighp float minEigenvalue = 0.5f * ((harris.x + harris.z) - sqrt(\\n(harris.x - harris.z) * (harris.x - harris.z) + 4.0f * (harris.y * harris.y)\\n));\\nint niceNumbers = int(abs(det) >= FLT_EPSILON && minEigenvalue >= discardThreshold * windowArea);\\nbool goodKeypoint = (level > 0) || (niceNumbers != 0);\\nhighp float eps2 = epsilon * epsilon;\\nhighp vec2 mismatch, delta, localGuess = vec2(0.0f);\\nfor(int k = 0; k < numberOfIterations; k++) {\\nmismatch = niceNumbers != 0 ? computeMismatch(pyrGuess, localGuess) : vec2(0.0f);\\ndelta = mismatch * invHarris * invDet;\\nniceNumbers *= int(eps2 <= dot(delta, delta));\\nlocalGuess += float(niceNumbers) * delta;\\n}\\nvec2 opticalFlow = pyrGuess + localGuess;\\nbool mustDiscard = (level == 0) && any(bvec2(\\n!goodKeypoint,\\n!isInsideImage(keypoint.position + opticalFlow)\\n));\\ncolor = !mustDiscard ? encodePairOfFloat16(opticalFlow) : encodeDiscardedPairOfFloat16();\\n}\"\n\n/***/ }),\n\n/***/ 3890:\n/***/ ((module) => {\n\nmodule.exports = \"#if @FS_USE_CUSTOM_PRECISION@\\nprecision mediump int;\\nprecision mediump float;\\n#endif\\n#if !defined(STAGE)\\n#error Undefined STAGE\\n#elif STAGE == 1\\n@include \\\"float16.glsl\\\"\\nuniform sampler2D corners;\\n#elif STAGE < 1\\nuniform mediump usampler2D lookupTable;\\n#else\\n#define SKIP_TEXTURE_READS 1\\n#define DENSITY_FACTOR 0.10\\nuniform mediump usampler2D lookupTable;\\nuniform int blockSize;\\nuniform int width;\\nuniform int height;\\nin vec2 v_topLeft, v_top, v_topRight,\\nv_left, v_center, v_right,\\nv_bottomLeft, v_bottom, v_bottomRight;\\n#endif\\nconst uvec2 NULL_ELEMENT = uvec2(0xFFFFu);\\nvoid main()\\n{\\n#if STAGE == 1\\nuvec2 outSize = uvec2(outputSize());\\nuvec2 thread = uvec2(threadLocation());\\nuvec2 size = uvec2(textureSize(corners, 0));\\nuint location = thread.y * outSize.x + thread.x;\\nivec2 pos = ivec2(location % size.x, location / size.x);\\nvec4 pixel = location < size.x * size.y ? texelFetch(corners, pos, 0) : vec4(0.0f);\\nbool isCorner = !isEncodedFloat16Zero(pixel.rb);\\ncolor = isCorner ? uvec4(uvec2(pos), 1u, 0u) : uvec4(NULL_ELEMENT, 0u, 0u);\\n#elif STAGE > 1\\nint dblBlockSize = 2 * blockSize;\\nivec2 thread = threadLocation();\\nivec2 offset = thread % dblBlockSize;\\nivec2 delta = thread - offset;\\n#if SKIP_TEXTURE_READS\\nif(blockSize >= 8) {\\nuint sb = texture(lookupTable, texCoord).z;\\nfloat p = max((float(sb) / float(blockSize)) / float(blockSize), DENSITY_FACTOR);\\nfloat rowthr = float(dblBlockSize) * p + 3.0f * sqrt(p * (1.0f - p));\\ncolor = uvec4(NULL_ELEMENT, 4u * sb, 0u);\\nif(offset.y >= max(1, int(ceil(rowthr))))\\nreturn;\\n}\\n#endif\\n#define deltaCenter ivec2(0,0)\\n#define deltaTop ivec2(0,-blockSize)\\n#define deltaTopRight ivec2(blockSize,-blockSize)\\n#define deltaRight ivec2(blockSize,0)\\n#define deltaBottomRight ivec2(blockSize,blockSize)\\n#define deltaBottom ivec2(0,blockSize)\\n#define deltaBottomLeft ivec2(-blockSize,blockSize)\\n#define deltaLeft ivec2(-blockSize,0)\\n#define deltaTopLeft ivec2(-blockSize,-blockSize)\\nivec2 boundary = ivec2(width - 1, height - 1) / blockSize;\\nivec2 bottomRightPos = thread + deltaBottomRight;\\nuvec2 valid = uvec2(\\nbottomRightPos.x < width  || bottomRightPos.x / blockSize == boundary.x,\\nbottomRightPos.y < height || bottomRightPos.y / blockSize == boundary.y\\n);\\nuvec4 mask[4];\\nmask[0] = uvec4(1u, valid.x, valid.y, valid.x * valid.y);\\nmask[1] = uvec4(1u, 1u, valid.y, valid.y);\\nmask[2] = uvec4(1u, valid.x, 1u, valid.x);\\nmask[3] = uvec4(1u);\\n#if SKIP_TEXTURE_READS\\n#define calcSb(delta) texelFetch(lookupTable, blockSize * ((thread + (delta)) / blockSize), 0).z\\nuint center = calcSb(deltaCenter);\\nuint top = calcSb(deltaTop);\\nuint topRight = calcSb(deltaTopRight);\\nuint right = calcSb(deltaRight);\\nuint bottomRight = calcSb(deltaBottomRight);\\nuint bottom = calcSb(deltaBottom);\\nuint bottomLeft = calcSb(deltaBottomLeft);\\nuint left = calcSb(deltaLeft);\\nuint topLeft = calcSb(deltaTopLeft);\\n#else\\n#define calcSb(pos) texture(lookupTable, (pos)).z\\nuint center = calcSb(v_center);\\nuint top = calcSb(v_top);\\nuint topRight = calcSb(v_topRight);\\nuint right = calcSb(v_right);\\nuint bottomRight = calcSb(v_bottomRight);\\nuint bottom = calcSb(v_bottom);\\nuint bottomLeft = calcSb(v_bottomLeft);\\nuint left = calcSb(v_left);\\nuint topLeft = calcSb(v_topLeft);\\n#endif\\nuvec4 sums[4];\\nsums[0] = uvec4(center, right, bottom, bottomRight);\\nsums[1] = uvec4(left, center, bottomLeft, bottom);\\nsums[2] = uvec4(top, topRight, center, right);\\nsums[3] = uvec4(topLeft, top, left, center);\\nivec2 cmp = ivec2(greaterThanEqual(offset, ivec2(blockSize)));\\nint option = 2 * cmp.y + cmp.x;\\nuvec4 cdef = sums[option] * mask[option];\\nuint c2b = cdef.x, d2b = cdef.y, e2b = cdef.z, f2b = cdef.w;\\nuint sb = center;\\nuint s2b = c2b + d2b + e2b + f2b;\\ns2b = s2b < sb ? 0xFFFFu : min(0xFFFFu, s2b);\\nuint w2b = uint(min(dblBlockSize, width - delta.x));\\nuvec2 uoffset = uvec2(offset);\\nuint ceiling = s2b >= uoffset.x ? (s2b - uoffset.x) / w2b + uint((s2b - uoffset.x) % w2b > 0u) : 0u;\\ncolor = uvec4(NULL_ELEMENT, s2b, 0u);\\nif(uoffset.y >= ceiling)\\nreturn;\\nuint i2b = uoffset.y * w2b + uoffset.x;\\nuint j2b = i2b >= c2b ? i2b - c2b : 0u;\\nuint k2b = j2b >= d2b ? j2b - d2b : 0u;\\nuint l2b = k2b >= e2b ? k2b - e2b : 0u;\\nuint wl = uint(min(blockSize, width - delta.x));\\nuint wr = uint(min(blockSize, width - delta.x - blockSize));\\nivec2 magicOffset = (\\n(i2b < c2b) ? ivec2(i2b % wl, i2b / wl) : (\\n(j2b < d2b) ? ivec2(j2b % wr, j2b / wr) + ivec2(blockSize, 0) : (\\n(k2b < e2b) ? ivec2(k2b % wl, k2b / wl) + ivec2(0, blockSize) : (\\n(l2b < f2b) ? ivec2(l2b % wr, l2b / wr) + ivec2(blockSize) : ivec2(0)\\n))));\\nuvec2 a2b = texelFetch(lookupTable, delta + magicOffset, 0).xy;\\ncolor = uvec4(a2b, s2b, 0u);\\n#else\\nuvec4 pix = texture(lookupTable, texCoord);\\ncolor = all(equal(pix.xy, NULL_ELEMENT)) ? vec4(0,1,1,1) : vec4(1,0,0,1);\\n#endif\\n}\"\n\n/***/ }),\n\n/***/ 8647:\n/***/ ((module) => {\n\nmodule.exports = \"#if !defined(STAGE) || STAGE < 1\\n#error Invalid STAGE\\n#else\\nuniform mediump int blockSize;\\nout vec2 v_topLeft, v_top, v_topRight,\\nv_left, v_center, v_right,\\nv_bottomLeft, v_bottom, v_bottomRight;\\nvoid vsmain()\\n{\\nfloat b = float(blockSize);\\n#define V(x,y) (texCoord + (vec2((x),(y)) * b) / texSize)\\nv_topLeft = V(-1,-1); v_top = V(0,-1); v_topRight = V(1,-1);\\nv_left = V(-1,0); v_center = V(0,0); v_right = V(1,0);\\nv_bottomLeft = V(-1,1); v_bottom = V(0,1); v_bottomRight = V(1,1);\\n}\\n#endif\"\n\n/***/ }),\n\n/***/ 4776:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\n@include \\\"keypoint-matches.glsl\\\"\\n@include \\\"keypoint-descriptors.glsl\\\"\\nuniform sampler2D candidates;\\nuniform sampler2D filters;\\nuniform int matcherLength;\\nuniform sampler2D tables;\\nuniform sampler2D descriptorDB;\\nuniform int tableIndex;\\nuniform int bucketCapacity;\\nuniform int bucketsPerTable;\\nuniform int tablesStride;\\nuniform int descriptorDBStride;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\n#if HASH_SIZE > SEQUENCE_MAXLEN\\n#error LSH: invalid HASH_SIZE\\n#elif SEQUENCE_COUNT * SEQUENCE_MAXLEN * 4 > 16384\\n#error LSH: sequences are too large!\\n#elif (SEQUENCE_COUNT * SEQUENCE_MAXLEN) % 4 > 0\\n#error LSH: sequences of invalid size!\\n#endif\\nlayout(std140) uniform LSHSequences\\n{\\nuvec4 sequences[(SEQUENCE_COUNT * SEQUENCE_MAXLEN) / 4];\\n};\\n#if HASH_SIZE == 10\\nconst int SWAP_COUNT[3] = int[3](1, 11, 56);\\nconst int[56] SWAP = int[56](0,1,2,4,8,16,32,64,128,256,512,3,5,6,9,10,12,17,18,20,24,33,34,36,40,48,65,66,68,72,80,96,129,130,132,136,144,160,192,257,258,260,264,272,288,320,384,513,514,516,520,528,544,576,640,768);\\n#elif HASH_SIZE == 11\\nconst int SWAP_COUNT[3] = int[3](1, 12, 67);\\nconst int[67] SWAP = int[67](0,1,2,4,8,16,32,64,128,256,512,1024,3,5,6,9,10,12,17,18,20,24,33,34,36,40,48,65,66,68,72,80,96,129,130,132,136,144,160,192,257,258,260,264,272,288,320,384,513,514,516,520,528,544,576,640,768,1025,1026,1028,1032,1040,1056,1088,1152,1280,1536);\\n#elif HASH_SIZE == 12\\nconst int SWAP_COUNT[3] = int[3](1, 13, 79);\\nconst int[79] SWAP = int[79](0,1,2,4,8,16,32,64,128,256,512,1024,2048,3,5,6,9,10,12,17,18,20,24,33,34,36,40,48,65,66,68,72,80,96,129,130,132,136,144,160,192,257,258,260,264,272,288,320,384,513,514,516,520,528,544,576,640,768,1025,1026,1028,1032,1040,1056,1088,1152,1280,1536,2049,2050,2052,2056,2064,2080,2112,2176,2304,2560,3072);\\n#elif HASH_SIZE == 13\\nconst int SWAP_COUNT[3] = int[3](1, 14, 92);\\nconst int[92] SWAP = int[92](0,1,2,4,8,16,32,64,128,256,512,1024,2048,4096,3,5,6,9,10,12,17,18,20,24,33,34,36,40,48,65,66,68,72,80,96,129,130,132,136,144,160,192,257,258,260,264,272,288,320,384,513,514,516,520,528,544,576,640,768,1025,1026,1028,1032,1040,1056,1088,1152,1280,1536,2049,2050,2052,2056,2064,2080,2112,2176,2304,2560,3072,4097,4098,4100,4104,4112,4128,4160,4224,4352,4608,5120,6144);\\n#elif HASH_SIZE == 14\\nconst int SWAP_COUNT[3] = int[3](1, 15, 106);\\nconst int[106] SWAP = int[106](0,1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,3,5,6,9,10,12,17,18,20,24,33,34,36,40,48,65,66,68,72,80,96,129,130,132,136,144,160,192,257,258,260,264,272,288,320,384,513,514,516,520,528,544,576,640,768,1025,1026,1028,1032,1040,1056,1088,1152,1280,1536,2049,2050,2052,2056,2064,2080,2112,2176,2304,2560,3072,4097,4098,4100,4104,4112,4128,4160,4224,4352,4608,5120,6144,8193,8194,8196,8200,8208,8224,8256,8320,8448,8704,9216,10240,12288);\\n#elif HASH_SIZE == 15\\nconst int SWAP_COUNT[3] = int[3](1, 16, 121);\\nconst int[121] SWAP = int[121](0,1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,3,5,6,9,10,12,17,18,20,24,33,34,36,40,48,65,66,68,72,80,96,129,130,132,136,144,160,192,257,258,260,264,272,288,320,384,513,514,516,520,528,544,576,640,768,1025,1026,1028,1032,1040,1056,1088,1152,1280,1536,2049,2050,2052,2056,2064,2080,2112,2176,2304,2560,3072,4097,4098,4100,4104,4112,4128,4160,4224,4352,4608,5120,6144,8193,8194,8196,8200,8208,8224,8256,8320,8448,8704,9216,10240,12288,16385,16386,16388,16392,16400,16416,16448,16512,16640,16896,17408,18432,20480,24576);\\n#elif HASH_SIZE == 16\\nconst int SWAP_COUNT[3] = int[3](1, 17, 137);\\nconst int[137] SWAP = int[137](0,1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,3,5,6,9,10,12,17,18,20,24,33,34,36,40,48,65,66,68,72,80,96,129,130,132,136,144,160,192,257,258,260,264,272,288,320,384,513,514,516,520,528,544,576,640,768,1025,1026,1028,1032,1040,1056,1088,1152,1280,1536,2049,2050,2052,2056,2064,2080,2112,2176,2304,2560,3072,4097,4098,4100,4104,4112,4128,4160,4224,4352,4608,5120,6144,8193,8194,8196,8200,8208,8224,8256,8320,8448,8704,9216,10240,12288,16385,16386,16388,16392,16400,16416,16448,16512,16640,16896,17408,18432,20480,24576,32769,32770,32772,32776,32784,32800,32832,32896,33024,33280,33792,34816,36864,40960,49152);\\n#elif HASH_SIZE == 17\\nconst int SWAP_COUNT[3] = int[3](1, 18, 154);\\nconst int[154] SWAP = int[154](0,1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,3,5,6,9,10,12,17,18,20,24,33,34,36,40,48,65,66,68,72,80,96,129,130,132,136,144,160,192,257,258,260,264,272,288,320,384,513,514,516,520,528,544,576,640,768,1025,1026,1028,1032,1040,1056,1088,1152,1280,1536,2049,2050,2052,2056,2064,2080,2112,2176,2304,2560,3072,4097,4098,4100,4104,4112,4128,4160,4224,4352,4608,5120,6144,8193,8194,8196,8200,8208,8224,8256,8320,8448,8704,9216,10240,12288,16385,16386,16388,16392,16400,16416,16448,16512,16640,16896,17408,18432,20480,24576,32769,32770,32772,32776,32784,32800,32832,32896,33024,33280,33792,34816,36864,40960,49152,65537,65538,65540,65544,65552,65568,65600,65664,65792,66048,66560,67584,69632,73728,81920,98304);\\n#elif HASH_SIZE == 18\\nconst int SWAP_COUNT[3] = int[3](1, 19, 172);\\nconst int[172] SWAP = int[172](0,1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,3,5,6,9,10,12,17,18,20,24,33,34,36,40,48,65,66,68,72,80,96,129,130,132,136,144,160,192,257,258,260,264,272,288,320,384,513,514,516,520,528,544,576,640,768,1025,1026,1028,1032,1040,1056,1088,1152,1280,1536,2049,2050,2052,2056,2064,2080,2112,2176,2304,2560,3072,4097,4098,4100,4104,4112,4128,4160,4224,4352,4608,5120,6144,8193,8194,8196,8200,8208,8224,8256,8320,8448,8704,9216,10240,12288,16385,16386,16388,16392,16400,16416,16448,16512,16640,16896,17408,18432,20480,24576,32769,32770,32772,32776,32784,32800,32832,32896,33024,33280,33792,34816,36864,40960,49152,65537,65538,65540,65544,65552,65568,65600,65664,65792,66048,66560,67584,69632,73728,81920,98304,131073,131074,131076,131080,131088,131104,131136,131200,131328,131584,132096,133120,135168,139264,147456,163840,196608);\\n#elif HASH_SIZE == 19\\nconst int SWAP_COUNT[3] = int[3](1, 20, 191);\\nconst int[191] SWAP = int[191](0,1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,3,5,6,9,10,12,17,18,20,24,33,34,36,40,48,65,66,68,72,80,96,129,130,132,136,144,160,192,257,258,260,264,272,288,320,384,513,514,516,520,528,544,576,640,768,1025,1026,1028,1032,1040,1056,1088,1152,1280,1536,2049,2050,2052,2056,2064,2080,2112,2176,2304,2560,3072,4097,4098,4100,4104,4112,4128,4160,4224,4352,4608,5120,6144,8193,8194,8196,8200,8208,8224,8256,8320,8448,8704,9216,10240,12288,16385,16386,16388,16392,16400,16416,16448,16512,16640,16896,17408,18432,20480,24576,32769,32770,32772,32776,32784,32800,32832,32896,33024,33280,33792,34816,36864,40960,49152,65537,65538,65540,65544,65552,65568,65600,65664,65792,66048,66560,67584,69632,73728,81920,98304,131073,131074,131076,131080,131088,131104,131136,131200,131328,131584,132096,133120,135168,139264,147456,163840,196608,262145,262146,262148,262152,262160,262176,262208,262272,262400,262656,263168,264192,266240,270336,278528,294912,327680,393216);\\n#elif HASH_SIZE == 20\\nconst int SWAP_COUNT[3] = int[3](1, 21, 211);\\nconst int[211] SWAP = int[211](0,1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,3,5,6,9,10,12,17,18,20,24,33,34,36,40,48,65,66,68,72,80,96,129,130,132,136,144,160,192,257,258,260,264,272,288,320,384,513,514,516,520,528,544,576,640,768,1025,1026,1028,1032,1040,1056,1088,1152,1280,1536,2049,2050,2052,2056,2064,2080,2112,2176,2304,2560,3072,4097,4098,4100,4104,4112,4128,4160,4224,4352,4608,5120,6144,8193,8194,8196,8200,8208,8224,8256,8320,8448,8704,9216,10240,12288,16385,16386,16388,16392,16400,16416,16448,16512,16640,16896,17408,18432,20480,24576,32769,32770,32772,32776,32784,32800,32832,32896,33024,33280,33792,34816,36864,40960,49152,65537,65538,65540,65544,65552,65568,65600,65664,65792,66048,66560,67584,69632,73728,81920,98304,131073,131074,131076,131080,131088,131104,131136,131200,131328,131584,132096,133120,135168,139264,147456,163840,196608,262145,262146,262148,262152,262160,262176,262208,262272,262400,262656,263168,264192,266240,270336,278528,294912,327680,393216,524289,524290,524292,524296,524304,524320,524352,524416,524544,524800,525312,526336,528384,532480,540672,557056,589824,655360,786432);\\n#else\\n#error Invalid HASH_SIZE\\n#endif\\n#if LEVEL < 0 || LEVEL > 2\\n#error Invalid LEVEL\\n#endif\\nconst uint END_OF_LIST = 0xFFFFFFFFu;\\nconst int NUMBER_OF_HASHES = SWAP_COUNT[LEVEL];\\nuint sequenceElement(int sequenceIndex, int elementIndex)\\n{\\nint offset = (SEQUENCE_MAXLEN) * sequenceIndex + elementIndex;\\nuvec4 tuple = sequences[offset / 4];\\nreturn tuple[offset & 3];\\n}\\nint descriptorHash(uint[DESCRIPTOR_SIZE] descriptor, int sequenceIndex)\\n{\\nuint bit, b, m;\\nint hash = 0;\\n@unroll\\nfor(int i = 0; i < HASH_SIZE; i++) {\\nbit = sequenceElement(sequenceIndex, i);\\nb = bit >> 3u;\\nm = 1u << (bit & 7u);\\nhash = (hash << 1) | int((descriptor[b] & m) != 0u);\\n}\\nreturn hash;\\n}\\n#define readTableData(tables, tablesStride, rasterIndex) decodeUint32(texelFetch((tables), ivec2((rasterIndex) % (tablesStride), (rasterIndex) / (tablesStride)), 0))\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nint keypointIndex = thread.x + thread.y * matcherLength;\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nKeypointAddress address = KeypointAddress(keypointIndex * pixelsPerKeypoint, 0);\\nKeypoint keypoint = decodeKeypoint(encodedKeypoints, encoderLength, address);\\ncolor = encodeKeypointMatch(MATCH_NOT_FOUND);\\nif(isBadKeypoint(keypoint))\\nreturn;\\nKeypointMatch candidate = decodeKeypointMatch(threadPixel(candidates));\\nKeypointMatch mfilter = decodeKeypointMatch(threadPixel(filters));\\nuint[DESCRIPTOR_SIZE] candidateDescriptor;\\nuint[DESCRIPTOR_SIZE] descriptor = readKeypointDescriptor(encodedKeypoints, descriptorSize, extraSize, encoderLength, address);\\nint hash0 = descriptorHash(descriptor, tableIndex);\\nfor(int h = 0; h < NUMBER_OF_HASHES; h++) {\\nint hash = hash0 ^ SWAP[h];\\nint tableAddress = tableIndex * bucketsPerTable * bucketCapacity;\\nint bucketAddress = tableAddress + hash * bucketCapacity;\\nbool validEntry = true;\\nfor(int b = 0; b < bucketCapacity; b++) {\\nint entryAddress = bucketAddress + b;\\nuint entry = validEntry ? readTableData(tables, tablesStride, entryAddress) : END_OF_LIST;\\nvalidEntry = (validEntry && entry != END_OF_LIST);\\nint candidateIndex = int(entry);\\ncandidateDescriptor = readKeypointDescriptorFromDB(descriptorDB, descriptorDBStride, validEntry ? candidateIndex : -1);\\nint descriptorDistance = distanceBetweenKeypointDescriptors(descriptor, candidateDescriptor);\\nKeypointMatch match = KeypointMatch(candidateIndex, descriptorDistance);\\nbool betterThanCandidate = (match.dist < candidate.dist) || (match.dist == candidate.dist && match.index > candidate.index);\\nbool worseThanFilter = (match.dist > mfilter.dist) || (match.dist == mfilter.dist && match.index < mfilter.index);\\nbool nicerMatch = (validEntry && betterThanCandidate && worseThanFilter);\\nivec2 v = nicerMatch ? ivec2(match.index, match.dist) : ivec2(candidate.index, candidate.dist);\\ncandidate = KeypointMatch(v.x, v.y);\\n}\\n}\\ncolor = encodeKeypointMatch(candidate);\\n}\"\n\n/***/ }),\n\n/***/ 2648:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\n@include \\\"int32.glsl\\\"\\n#if !defined(STAGE)\\n#error Undefined STAGE\\n#elif STAGE == 1\\nuniform sampler2D encodedKeypointsA;\\nuniform sampler2D encodedKeypointsB;\\nuniform int encoderLengthA;\\nuniform int encoderLengthB;\\nuniform int encoderCapacityA;\\nuniform int encoderCapacityB;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\n#elif STAGE == 2\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\nuniform int maxKeypoints;\\n#elif STAGE == 3\\nuniform sampler2D array;\\nuniform int blockSize;\\n#elif STAGE == 4\\nuniform sampler2D array;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\n#elif STAGE == 5\\nuniform sampler2D array;\\n#else\\n#error Invalid STAGE\\n#endif\\n#define NULL_KEYPOINT_INDEX 0xFFFF\\nconst highp uint UNIT = 0x10000u;\\nvoid main()\\n{\\n#if STAGE == 1\\nivec2 thread = threadLocation();\\nKeypointAddress addr = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nint keypointIndex = findKeypointIndex(addr, descriptorSize, extraSize);\\nint newKeypointIndex = keypointIndex < encoderCapacityA ? keypointIndex : keypointIndex - encoderCapacityA;\\ncolor = encodeNullKeypoint();\\nif(newKeypointIndex >= max(encoderCapacityA, encoderCapacityB))\\nreturn;\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\naddr = KeypointAddress(newKeypointIndex * pixelsPerKeypoint, addr.offset);\\nvec4 dataA = readKeypointData(encodedKeypointsA, encoderLengthA, addr);\\nvec4 dataB = readKeypointData(encodedKeypointsB, encoderLengthB, addr);\\ncolor = keypointIndex < encoderCapacityA ? dataA : dataB;\\n#elif STAGE == 2\\nivec2 thread = threadLocation();\\nint keypointIndex = thread.y * outputSize().x + thread.x;\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nKeypointAddress addr = KeypointAddress(keypointIndex * pixelsPerKeypoint, 0);\\nKeypoint keypoint = decodeKeypoint(encodedKeypoints, encoderLength, addr);\\nbool isValid = !isNullKeypoint(keypoint) && keypointIndex < maxKeypoints;\\nkeypointIndex = isValid ? keypointIndex : NULL_KEYPOINT_INDEX;\\ncolor = encodeUint32(uint(keypointIndex & 0xFFFF) | (isValid ? UNIT : 0u));\\n#elif STAGE == 3\\nivec2 thread = threadLocation();\\nivec2 size = outputSize();\\nint arrayLength = size.x * size.y;\\nint arrayIndex = thread.y * size.x + thread.x;\\nint arrayIndexLeft = arrayIndex - blockSize;\\nint arrayIndexRight = arrayIndex + blockSize;\\nint mask = int(arrayIndexRight < arrayLength || arrayIndexRight / blockSize == (arrayLength - 1) / blockSize);\\narrayIndexLeft = max(0, arrayIndexLeft);\\narrayIndexRight = min(arrayLength - 1, arrayIndexRight);\\n#define raster2pos(k) ivec2((k) % size.x, (k) / size.x)\\nuvec3 entries32 = uvec3(\\ndecodeUint32(threadPixel(array)),\\ndecodeUint32(texelFetch(array, raster2pos(arrayIndexLeft), 0)),\\ndecodeUint32(texelFetch(array, raster2pos(arrayIndexRight), 0))\\n);\\nivec3 sb = ivec3((entries32 >> 16u) & 0xFFFFu);\\nsb.z *= mask;\\nint dblBlockSize = 2 * blockSize;\\nint offset = arrayIndex % dblBlockSize;\\nint s2b = sb.x + (offset < blockSize ? sb.z : sb.y);\\nint l2b = offset < blockSize ? sb.x : sb.y;\\nuint keypointIndex = entries32.x & 0xFFFFu;\\nuint shiftedS2b = uint(s2b) << 16u;\\ncolor = encodeUint32(uint(NULL_KEYPOINT_INDEX) | shiftedS2b);\\nif(offset >= s2b)\\nreturn;\\ncolor = encodeUint32(keypointIndex | shiftedS2b);\\nif(offset < l2b)\\nreturn;\\nvec4 entry = texelFetch(array, raster2pos(arrayIndex + blockSize - l2b), 0);\\nkeypointIndex = decodeUint32(entry) & 0xFFFFu;\\ncolor = encodeUint32(keypointIndex | shiftedS2b);\\n#elif STAGE == 4\\nivec2 thread = threadLocation();\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nKeypointAddress addr = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nint keypointIndex = findKeypointIndex(addr, descriptorSize, extraSize);\\n#define raster2pos(k) ivec2((k) % size.x, (k) / size.x)\\nivec2 size = textureSize(array, 0);\\nuint sortedPair = decodeUint32(texelFetch(array, raster2pos(keypointIndex), 0));\\nint newKeypointIndex = int(sortedPair & 0xFFFFu);\\ncolor = encodeNullKeypoint();\\nif(newKeypointIndex == NULL_KEYPOINT_INDEX || keypointIndex >= size.x * size.y)\\nreturn;\\nKeypointAddress newAddr = KeypointAddress(newKeypointIndex * pixelsPerKeypoint, addr.offset);\\ncolor = readKeypointData(encodedKeypoints, encoderLength, newAddr);\\n#elif STAGE == 5\\nuint val = decodeUint32(threadPixel(array));\\ncolor = (val & 0xFFFFu) == uint(NULL_KEYPOINT_INDEX) ? vec4(0,1,1,1) : vec4(1,0,0,1);\\n#endif\\n}\"\n\n/***/ }),\n\n/***/ 8825:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"pyramids.glsl\\\"\\n@include \\\"float16.glsl\\\"\\n@include \\\"filters.glsl\\\"\\n#if !defined(USE_LAPLACIAN)\\n#error Undefined USE_LAPLACIAN\\n#endif\\nuniform sampler2D corners;\\nuniform sampler2D pyramid;\\nuniform float lodStep;\\n#if USE_LAPLACIAN\\nuniform sampler2D pyrLaplacian;\\n#endif\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nvec4 pixel = threadPixel(corners);\\nfloat score = decodeFloat16(pixel.rb);\\nfloat myEncodedLod = pixel.a;\\nfloat lod = decodeLod(myEncodedLod);\\nfloat lodPlus = lod + lodStep;\\nfloat lodMinus = lod - lodStep;\\nfloat pot = exp2(lod);\\nfloat potPlus = exp2(lodPlus);\\nfloat potMinus = exp2(lodMinus);\\ncolor = pixel;\\nif(score == 0.0f)\\nreturn;\\n#define P(p,u,v) textureLod(corners, texCoord + (p) * vec2((u),(v)) / texSize, 0.0f)\\nvec4 pix[18];\\n#define D(u,v) P(potMinus,(u),(v))\\npix[0] = D(-1,-1); pix[1] = D(0,-1); pix[2] = D(1,-1);\\npix[3] = D(-1,0); pix[4] = D(0,0); pix[5] = D(1,0);\\npix[6] = D(-1,1); pix[7] = D(0,1); pix[8] = D(1,1);\\n#define U(u,v) P(potPlus,(u),(v))\\npix[9] = U(-1,-1); pix[10] = U(0,-1); pix[11] = U(1,-1);\\npix[12] = U(-1,0); pix[13] = U(0,0); pix[14] = U(1,0);\\npix[15] = U(-1,1); pix[16] = U(0,1); pix[17] = U(1,1);\\nfloat scores[18];\\n#define C(j) decodeFloat16(pix[j].rb)\\nscores[0] = C(0); scores[1] = C(1); scores[2] = C(2);\\nscores[3] = C(3); scores[4] = C(4); scores[5] = C(5);\\nscores[6] = C(6); scores[7] = C(7); scores[8] = C(8);\\nscores[9] = C(9); scores[10] = C(10); scores[11] = C(11);\\nscores[12] = C(12); scores[13] = C(13); scores[14] = C(14);\\nscores[15] = C(15); scores[16] = C(16); scores[17] = C(17);\\nfloat lods[18];\\n#define E(j) decodeLod(pix[j].a)\\nlods[0] = E(0); lods[1] = E(1); lods[2] = E(2);\\nlods[3] = E(3); lods[4] = E(4); lods[5] = E(5);\\nlods[6] = E(6); lods[7] = E(7); lods[8] = E(8);\\nlods[9] = E(9); lods[10] = E(10); lods[11] = E(11);\\nlods[12] = E(12); lods[13] = E(13); lods[14] = E(14);\\nlods[15] = E(15); lods[16] = E(16); lods[17] = E(17);\\n#if USE_LAPLACIAN\\n#define L(p,u,v) textureLod(pyrLaplacian, texCoord + (p) * vec2((u),(v)) / texSize, 0.0f)\\nmat3 strengths[2];\\nstrengths[0] = mat3(\\n#define Lm(u,v) abs(decodeFloat16(L(potMinus,(u),(v)).xy))\\nLm(-1,-1), Lm(0,-1), Lm(1,-1),\\nLm(-1,0), Lm(0,0), Lm(1,0),\\nLm(-1,1), Lm(0,1), Lm(1,1)\\n);\\nstrengths[1] = mat3(\\n#define Lp(u,v) abs(decodeFloat16(L(potPlus,(u),(v)).zw))\\nLp(-1,-1), Lp(0,-1), Lp(1,-1),\\nLp(-1,0), Lp(0,0), Lp(1,0),\\nLp(-1,1), Lp(0,1), Lp(1,1)\\n);\\nfloat myStrength = abs(laplacian(pyramid, vec2(thread), lod));\\n#else\\n#define L(u,v) (((v)+1)*3 + ((u)+1))\\nmat3 strengths[2];\\nstrengths[0] = mat3(\\n#define Lm(u,v) scores[L((u),(v))]\\nLm(-1,-1), Lm(0,-1), Lm(1,-1),\\nLm(-1,0), Lm(0,0), Lm(1,0),\\nLm(-1,1), Lm(0,1), Lm(1,1)\\n);\\nstrengths[1] = mat3(\\n#define Lp(u,v) scores[9 + L((u),(v))]\\nLp(-1,-1), Lp(0,-1), Lp(1,-1),\\nLp(-1,0), Lp(0,0), Lp(1,0),\\nLp(-1,1), Lp(0,1), Lp(1,1)\\n);\\nfloat myStrength = score;\\n#endif\\n#define B(j,lod) float(isSameLod(lods[j], (lod))) * float(scores[j] > 0.0f)\\nmat3 nearLod[2];\\nnearLod[0] = mat3(\\n#define Bm(j) B((j), lodMinus)\\nBm(0), Bm(1), Bm(2),\\nBm(3), Bm(4), Bm(5),\\nBm(6), Bm(7), Bm(8)\\n);\\nnearLod[1] = mat3(\\n#define Bp(j) B((j), lodPlus)\\nBp(9), Bp(10), Bp(11),\\nBp(12), Bp(13), Bp(14),\\nBp(15), Bp(16), Bp(17)\\n);\\nmat3 upStrengths = matrixCompMult(strengths[1], nearLod[1]);\\nmat3 downStrengths = matrixCompMult(strengths[0], nearLod[0]);\\nvec3 maxUpStrength3 = max(upStrengths[0], max(upStrengths[1], upStrengths[2]));\\nvec3 maxDownStrength3 = max(downStrengths[0], max(downStrengths[1], downStrengths[2]));\\nvec3 maxStrength3 = max(maxUpStrength3, maxDownStrength3);\\nfloat maxStrength = max(maxStrength3.x, max(maxStrength3.y, maxStrength3.z));\\ncolor.rb = encodeFloat16(score * step(maxStrength, myStrength));\\n}\"\n\n/***/ }),\n\n/***/ 5693:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"pyramids.glsl\\\"\\n@include \\\"float16.glsl\\\"\\nuniform sampler2D corners;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nvec4 pixel = threadPixel(corners);\\nfloat encodedLod = pixel.a;\\nfloat score = decodeFloat16(pixel.rb);\\nfloat lod = decodeLod(encodedLod);\\nfloat pot = exp2(lod);\\ncolor = pixel;\\nif(score == 0.0f)\\nreturn;\\n#if 1\\nvec2 gridSize = vec2(pot);\\nvec2 gridLocation = floor(mod(texCoord * texSize, gridSize));\\nvec2 gridDelta = gridLocation / gridSize - vec2(0.5f);\\nfloat gridStep = 1.0f / pot;\\nconst float adjustment = 1.25f;\\ncolor.rb = encodeFloat16(0.0f);\\nif(max(abs(gridDelta.x), abs(gridDelta.y)) > adjustment * gridStep)\\nreturn;\\n#endif\\n#define P(x,y) textureLod(corners, texCoord + pot * vec2((x), (y)) / texSize, 0.0f)\\nvec4 pix[9];\\npix[0] = P(-1,-1); pix[1] = P(0,-1); pix[2] = P(1,-1);\\npix[3] = P(-1, 0); pix[4] = pixel;   pix[5] = P(1, 0);\\npix[6] = P(-1, 1); pix[7] = P(0, 1); pix[8] = P(1, 1);\\n#define S(j) decodeFloat16(pix[j].rb)\\nmat3 scores = mat3(\\nS(0), S(1), S(2),\\nS(3), S(4), S(5),\\nS(6), S(7), S(8)\\n);\\n#define B(j) float(isSameLod(decodeLod(pix[j].a), lod))\\nmat3 sameLod = mat3(\\nB(0), B(1), B(2),\\nB(3), B(4), B(5),\\nB(6), B(7), B(8)\\n);\\nmat3 sameLodScores = matrixCompMult(scores, sameLod);\\nvec3 maxScore3 = max(sameLodScores[0], max(sameLodScores[1], sameLodScores[2]));\\nfloat maxScore = max(maxScore3.x, max(maxScore3.y, maxScore3.z));\\ncolor.rb = encodeFloat16(score * step(maxScore, score));\\n}\"\n\n/***/ }),\n\n/***/ 9280:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"pyramids.glsl\\\"\\n@include \\\"float16.glsl\\\"\\nuniform sampler2D image;\\nuniform float lodStep;\\n#if !defined(MULTISCALE)\\n#error Must define MULTISCALE\\n#elif MULTISCALE != 0\\n#define LOD_STEP (lodStep)\\n#define USE_MIDDLE_RING\\n#else\\n#define LOD_STEP (0.0f)\\n#endif\\n#define PIX(x,y) pixelAtShortOffset(image, ivec2((x),(y)))\\n#define L2(v,i) bvec2(isSameEncodedLod(v[i].a, alphaMinus), isSameEncodedLod(v[i].a, alphaPlus))\\n#define L3(v,i) bvec3(isSameEncodedLod(v[i].a, alpha), isSameEncodedLod(v[i].a, alphaMinus), isSameEncodedLod(v[i].a, alphaPlus))\\n#define S3(v,i) decodeFloat16(v[i].rb) * float(any(L3(v,i)))\\n#define S2(v,i) decodeFloat16(v[i].rb) * float(any(L2(v,i)))\\n#define P(i) S3(p,i)\\n#define Q(i) S2(q,i)\\n#define R(i) S2(r,i)\\nconst vec4 O = vec4(0.0f);\\nvoid main()\\n{\\nvec4 pixel = threadPixel(image);\\nfloat lod = decodeLod(pixel.a);\\nfloat score = decodeFloat16(pixel.rb);\\ncolor = pixel;\\nif(score == 0.0f)\\nreturn;\\nvec4 p[8];\\np[0] = PIX(0,1); p[1] = PIX(1,1); p[2] = PIX(1,0); p[3] = PIX(1,-1);\\np[4] = PIX(0,-1); p[5] = PIX(-1,-1); p[6] = PIX(-1,0); p[7] = PIX(-1,1);\\n#ifdef USE_MIDDLE_RING\\nvec4 q[16];\\nq[0] = PIX(0,2); q[1] = PIX(1,2); q[2] = PIX(2,2); q[3] = PIX(2,1);\\nq[4] = PIX(2,0); q[5] = PIX(2,-1); q[6] = PIX(2,-2); q[7] = PIX(1,-2);\\nq[8] = PIX(0,-2); q[9] = PIX(-1,-2); q[10] = PIX(-2,-2); q[11] = PIX(-2,-1);\\nq[12] = PIX(-2,0); q[13] = PIX(-2,1); q[14] = PIX(-2,2); q[15] = PIX(-1,2);\\n#else\\nvec4 q[16];\\nq[0] = O; q[1] = O; q[2] = O; q[3] = O;\\nq[4] = O; q[5] = O; q[6] = O; q[7] = O;\\nq[8] = O; q[9] = O; q[10] = O; q[11] = O;\\nq[12] = O; q[13] = O; q[14] = O; q[15] = O;\\n#endif\\n#ifdef USE_OUTER_RING\\nvec4 r[16];\\nr[0] = PIX(0,3); r[1] = PIX(1,3); r[2] = PIX(3,1); r[3] = PIX(3,0);\\nr[4] = PIX(3,-1); r[5] = PIX(1,-3); r[6] = PIX(0,-3); r[7] = PIX(-1,-3);\\nr[8] = PIX(-3,-1); r[9] = PIX(-3,0); r[10] = PIX(-3,1); r[11] = PIX(-1,3);\\nr[12] = PIX(0,4); r[13] = PIX(4,0); r[14] = PIX(0,-4); r[15] = PIX(-4,0);\\n#else\\nvec4 r[16];\\nr[0] = O; r[1] = O; r[2] = O; r[3] = O;\\nr[4] = O; r[5] = O; r[6] = O; r[7] = O;\\nr[8] = O; r[9] = O; r[10] = O; r[11] = O;\\nr[12] = O; r[13] = O; r[14] = O; r[15] = O;\\n#endif\\nfloat alphaPlus = encodeLod(lod + LOD_STEP);\\nfloat alphaMinus = encodeLod(lod - LOD_STEP);\\nfloat alpha = encodeLod(lod);\\nmat3 innerScore = mat3(\\nP(0), P(1), P(2), P(3),\\nP(4), P(5), P(6), P(7),\\n0.0f);\\nmat4 middleScore = mat4(\\nQ(0), Q(1), Q(2), Q(3),\\nQ(4), Q(5), Q(6), Q(7),\\nQ(8), Q(9), Q(10), Q(11),\\nQ(12), Q(13), Q(14), Q(15)\\n);\\nmat4 outerScore = mat4(\\nR(0), R(1), R(2), R(3),\\nR(4), R(5), R(6), R(7),\\nR(8), R(9), R(10), R(11),\\nR(12), R(13), R(14), R(15)\\n);\\nvec3 maxInnerScore3 = max(innerScore[0], max(innerScore[1], innerScore[2]));\\nvec4 maxMiddleScore4 = max(max(middleScore[0], middleScore[1]), max(middleScore[2], middleScore[3]));\\nvec4 maxOuterScore4 = max(max(outerScore[0], outerScore[1]), max(outerScore[2], outerScore[3]));\\nfloat maxInnerScore = max(maxInnerScore3.x, max(maxInnerScore3.y, maxInnerScore3.z));\\nfloat maxMiddleScore = max(max(maxMiddleScore4.x, maxMiddleScore4.y), max(maxMiddleScore4.z, maxMiddleScore4.w));\\nfloat maxOuterScore = max(max(maxOuterScore4.x, maxOuterScore4.y), max(maxOuterScore4.z, maxOuterScore4.w));\\nfloat maxScore = max(maxInnerScore, max(maxMiddleScore, maxOuterScore));\\nfloat finalScore = step(maxScore, score) * score;\\ncolor.rb = encodeFloat16(finalScore);\\n}\"\n\n/***/ }),\n\n/***/ 9108:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform sampler2D encodedCorners;\\nuniform int encoderLength;\\nuniform sampler2D image;\\nuniform int extraSize;\\nconst int descriptorSize = 32;\\n#define P(a,b,c,d) ivec4((a),(b),(c),(d))\\nconst ivec4 pat31[256] = ivec4[256](\\nP(8,-3,9,5),\\nP(4,2,7,-12),\\nP(-11,9,-8,2),\\nP(7,-12,12,-13),\\nP(2,-13,2,12),\\nP(1,-7,1,6),\\nP(-2,-10,-2,-4),\\nP(-13,-13,-11,-8),\\nP(-13,-3,-12,-9),\\nP(10,4,11,9),\\nP(-13,-8,-8,-9),\\nP(-11,7,-9,12),\\nP(7,7,12,6),\\nP(-4,-5,-3,0),\\nP(-13,2,-12,-3),\\nP(-9,0,-7,5),\\nP(12,-6,12,-1),\\nP(-3,6,-2,12),\\nP(-6,-13,-4,-8),\\nP(11,-13,12,-8),\\nP(4,7,5,1),\\nP(5,-3,10,-3),\\nP(3,-7,6,12),\\nP(-8,-7,-6,-2),\\nP(-2,11,-1,-10),\\nP(-13,12,-8,10),\\nP(-7,3,-5,-3),\\nP(-4,2,-3,7),\\nP(-10,-12,-6,11),\\nP(5,-12,6,-7),\\nP(5,-6,7,-1),\\nP(1,0,4,-5),\\nP(9,11,11,-13),\\nP(4,7,4,12),\\nP(2,-1,4,4),\\nP(-4,-12,-2,7),\\nP(-8,-5,-7,-10),\\nP(4,11,9,12),\\nP(0,-8,1,-13),\\nP(-13,-2,-8,2),\\nP(-3,-2,-2,3),\\nP(-6,9,-4,-9),\\nP(8,12,10,7),\\nP(0,9,1,3),\\nP(7,-5,11,-10),\\nP(-13,-6,-11,0),\\nP(10,7,12,1),\\nP(-6,-3,-6,12),\\nP(10,-9,12,-4),\\nP(-13,8,-8,-12),\\nP(-13,0,-8,-4),\\nP(3,3,7,8),\\nP(5,7,10,-7),\\nP(-1,7,1,-12),\\nP(3,-10,5,6),\\nP(2,-4,3,-10),\\nP(-13,0,-13,5),\\nP(-13,-7,-12,12),\\nP(-13,3,-11,8),\\nP(-7,12,-4,7),\\nP(6,-10,12,8),\\nP(-9,-1,-7,-6),\\nP(-2,-5,0,12),\\nP(-12,5,-7,5),\\nP(3,-10,8,-13),\\nP(-7,-7,-4,5),\\nP(-3,-2,-1,-7),\\nP(2,9,5,-11),\\nP(-11,-13,-5,-13),\\nP(-1,6,0,-1),\\nP(5,-3,5,2),\\nP(-4,-13,-4,12),\\nP(-9,-6,-9,6),\\nP(-12,-10,-8,-4),\\nP(10,2,12,-3),\\nP(7,12,12,12),\\nP(-7,-13,-6,5),\\nP(-4,9,-3,4),\\nP(7,-1,12,2),\\nP(-7,6,-5,1),\\nP(-13,11,-12,5),\\nP(-3,7,-2,-6),\\nP(7,-8,12,-7),\\nP(-13,-7,-11,-12),\\nP(1,-3,12,12),\\nP(2,-6,3,0),\\nP(-4,3,-2,-13),\\nP(-1,-13,1,9),\\nP(7,1,8,-6),\\nP(1,-1,3,12),\\nP(9,1,12,6),\\nP(-1,-9,-1,3),\\nP(-13,-13,-10,5),\\nP(7,7,10,12),\\nP(12,-5,12,9),\\nP(6,3,7,11),\\nP(5,-13,6,10),\\nP(2,-12,2,3),\\nP(3,8,4,-6),\\nP(2,6,12,-13),\\nP(9,-12,10,3),\\nP(-8,4,-7,9),\\nP(-11,12,-4,-6),\\nP(1,12,2,-8),\\nP(6,-9,7,-4),\\nP(2,3,3,-2),\\nP(6,3,11,0),\\nP(3,-3,8,-8),\\nP(7,8,9,3),\\nP(-11,-5,-6,-4),\\nP(-10,11,-5,10),\\nP(-5,-8,-3,12),\\nP(-10,5,-9,0),\\nP(8,-1,12,-6),\\nP(4,-6,6,-11),\\nP(-10,12,-8,7),\\nP(4,-2,6,7),\\nP(-2,0,-2,12),\\nP(-5,-8,-5,2),\\nP(7,-6,10,12),\\nP(-9,-13,-8,-8),\\nP(-5,-13,-5,-2),\\nP(8,-8,9,-13),\\nP(-9,-11,-9,0),\\nP(1,-8,1,-2),\\nP(7,-4,9,1),\\nP(-2,1,-1,-4),\\nP(11,-6,12,-11),\\nP(-12,-9,-6,4),\\nP(3,7,7,12),\\nP(5,5,10,8),\\nP(0,-4,2,8),\\nP(-9,12,-5,-13),\\nP(0,7,2,12),\\nP(-1,2,1,7),\\nP(5,11,7,-9),\\nP(3,5,6,-8),\\nP(-13,-4,-8,9),\\nP(-5,9,-3,-3),\\nP(-4,-7,-3,-12),\\nP(6,5,8,0),\\nP(-7,6,-6,12),\\nP(-13,6,-5,-2),\\nP(1,-10,3,10),\\nP(4,1,8,-4),\\nP(-2,-2,2,-13),\\nP(2,-12,12,12),\\nP(-2,-13,0,-6),\\nP(4,1,9,3),\\nP(-6,-10,-3,-5),\\nP(-3,-13,-1,1),\\nP(7,5,12,-11),\\nP(4,-2,5,-7),\\nP(-13,9,-9,-5),\\nP(7,1,8,6),\\nP(7,-8,7,6),\\nP(-7,-4,-7,1),\\nP(-8,11,-7,-8),\\nP(-13,6,-12,-8),\\nP(2,4,3,9),\\nP(10,-5,12,3),\\nP(-6,-5,-6,7),\\nP(8,-3,9,-8),\\nP(2,-12,2,8),\\nP(-11,-2,-10,3),\\nP(-12,-13,-7,-9),\\nP(-11,0,-10,-5),\\nP(5,-3,11,8),\\nP(-2,-13,-1,12),\\nP(-1,-8,0,9),\\nP(-13,-11,-12,-5),\\nP(-10,-2,-10,11),\\nP(-3,9,-2,-13),\\nP(2,-3,3,2),\\nP(-9,-13,-4,0),\\nP(-4,6,-3,-10),\\nP(-4,12,-2,-7),\\nP(-6,-11,-4,9),\\nP(6,-3,6,11),\\nP(-13,11,-5,5),\\nP(11,11,12,6),\\nP(7,-5,12,-2),\\nP(-1,12,0,7),\\nP(-4,-8,-3,-2),\\nP(-7,1,-6,7),\\nP(-13,-12,-8,-13),\\nP(-7,-2,-6,-8),\\nP(-8,5,-6,-9),\\nP(-5,-1,-4,5),\\nP(-13,7,-8,10),\\nP(1,5,5,-13),\\nP(1,0,10,-13),\\nP(9,12,10,-1),\\nP(5,-8,10,-9),\\nP(-1,11,1,-13),\\nP(-9,-3,-6,2),\\nP(-1,-10,1,12),\\nP(-13,1,-8,-10),\\nP(8,-11,10,-6),\\nP(2,-13,3,-6),\\nP(7,-13,12,-9),\\nP(-10,-10,-5,-7),\\nP(-10,-8,-8,-13),\\nP(4,-6,8,5),\\nP(3,12,8,-13),\\nP(-4,2,-3,-3),\\nP(5,-13,10,-12),\\nP(4,-13,5,-1),\\nP(-9,9,-4,3),\\nP(0,3,3,-9),\\nP(-12,1,-6,1),\\nP(3,2,4,-8),\\nP(-10,-10,-10,9),\\nP(8,-13,12,12),\\nP(-8,-12,-6,-5),\\nP(2,2,3,7),\\nP(10,6,11,-8),\\nP(6,8,8,-12),\\nP(-7,10,-6,5),\\nP(-3,-9,-3,9),\\nP(-1,-13,-1,5),\\nP(-3,-7,-3,4),\\nP(-8,-2,-8,3),\\nP(4,2,12,12),\\nP(2,-5,3,11),\\nP(6,-9,11,-13),\\nP(3,-1,7,12),\\nP(11,-1,12,4),\\nP(-3,0,-3,6),\\nP(4,-11,4,12),\\nP(2,-4,2,1),\\nP(-10,-6,-8,1),\\nP(-13,7,-11,1),\\nP(-13,12,-11,-13),\\nP(6,0,11,-13),\\nP(0,-1,1,4),\\nP(-13,3,-9,-2),\\nP(-9,8,-6,-3),\\nP(-13,-6,-8,-2),\\nP(5,-9,8,10),\\nP(2,7,3,-9),\\nP(-1,-6,-1,-1),\\nP(9,5,11,-2),\\nP(11,-3,12,-8),\\nP(3,0,3,5),\\nP(-1,4,0,10),\\nP(3,-6,4,5),\\nP(-13,0,-10,5),\\nP(5,8,12,11),\\nP(8,9,9,-6),\\nP(7,-4,8,-12),\\nP(-10,4,-10,9),\\nP(7,3,12,4),\\nP(9,-7,10,-2),\\nP(7,0,12,-2),\\nP(-1,-6,0,-11)\\n);\\nvoid getPair(int index, mat2 rot, out vec2 p, out vec2 q)\\n{\\nivec4 data = pat31[index];\\nvec2 op = vec2(data.xy);\\nvec2 oq = vec2(data.zw);\\np = rot * op;\\nq = rot * oq;\\n}\\nvoid main()\\n{\\nvec4 pixel = threadPixel(encodedCorners);\\nivec2 thread = threadLocation();\\nKeypointAddress address = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nint descriptorCell = address.offset - sizeofEncodedKeypoint(0, extraSize) / 4;\\ncolor = pixel;\\nif(descriptorCell < 0)\\nreturn;\\nKeypoint keypoint = decodeKeypoint(encodedCorners, encoderLength, address);\\nif(isBadKeypoint(keypoint))\\nreturn;\\nfloat degreesOrientation = round(360.0f + degrees(keypoint.orientation));\\nfloat orientation = radians(degreesOrientation - mod(degreesOrientation, 12.0f));\\nfloat kcos = cos(orientation);\\nfloat ksin = sin(orientation);\\nmat2 rot = mat2(kcos, ksin, -ksin, kcos);\\nfloat pot = exp2(keypoint.lod);\\nint patternStart = 32 * descriptorCell;\\nuint test[4] = uint[4](0u, 0u, 0u, 0u);\\nfor(int t = 0; t < 4; t++) {\\nuint bits = 0u;\\nvec2 p, q;\\nvec4 a, b;\\nint i = t * 8;\\n@unroll\\nfor(int j = 0; j < 8; j++) {\\ngetPair(patternStart + i + j, rot, p, q);\\na = texelFetch(image, ivec2(round(keypoint.position + pot * p)), 0);\\nb = texelFetch(image, ivec2(round(keypoint.position + pot * q)), 0);\\nbits |= uint(a.g < b.g) << j;\\n}\\ntest[t] = bits;\\n}\\ncolor = vec4(test[0], test[1], test[2], test[3]) / 255.0f;\\n}\"\n\n/***/ }),\n\n/***/ 7137:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform sampler2D image;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\n#define P(x,y) ivec2((x),(y))\\nconst int diskPointCount[16] = int[16](0, 4, 12, 28, 48, 80, 112, 148, 196, 252, 316, 376, 440, 528, 612, 708);\\nconst ivec2 diskPoint[708] = ivec2[708](\\nP(0,-1),P(-1,0),P(1,0),P(0,1),\\nP(-1,-1),P(1,-1),P(-1,1),P(1,1),P(0,-2),P(-2,0),P(2,0),P(0,2),\\nP(-1,-2),P(1,-2),P(-2,-1),P(2,-1),P(-2,1),P(2,1),P(-1,2),P(1,2),P(-2,-2),P(2,-2),P(-2,2),P(2,2),P(0,-3),P(-3,0),P(3,0),P(0,3),\\nP(-1,-3),P(1,-3),P(-3,-1),P(3,-1),P(-3,1),P(3,1),P(-1,3),P(1,3),P(-2,-3),P(2,-3),P(-3,-2),P(3,-2),P(-3,2),P(3,2),P(-2,3),P(2,3),P(0,-4),P(-4,0),P(4,0),P(0,4),\\nP(-1,-4),P(1,-4),P(-4,-1),P(4,-1),P(-4,1),P(4,1),P(-1,4),P(1,4),P(-3,-3),P(3,-3),P(-3,3),P(3,3),P(-2,-4),P(2,-4),P(-4,-2),P(4,-2),P(-4,2),P(4,2),P(-2,4),P(2,4),P(0,-5),P(-3,-4),P(3,-4),P(-4,-3),P(4,-3),P(-5,0),P(5,0),P(-4,3),P(4,3),P(-3,4),P(3,4),P(0,5),\\nP(-1,-5),P(1,-5),P(-5,-1),P(5,-1),P(-5,1),P(5,1),P(-1,5),P(1,5),P(-2,-5),P(2,-5),P(-5,-2),P(5,-2),P(-5,2),P(5,2),P(-2,5),P(2,5),P(-4,-4),P(4,-4),P(-4,4),P(4,4),P(-3,-5),P(3,-5),P(-5,-3),P(5,-3),P(-5,3),P(5,3),P(-3,5),P(3,5),P(0,-6),P(-6,0),P(6,0),P(0,6),\\nP(-1,-6),P(1,-6),P(-6,-1),P(6,-1),P(-6,1),P(6,1),P(-1,6),P(1,6),P(-2,-6),P(2,-6),P(-6,-2),P(6,-2),P(-6,2),P(6,2),P(-2,6),P(2,6),P(-4,-5),P(4,-5),P(-5,-4),P(5,-4),P(-5,4),P(5,4),P(-4,5),P(4,5),P(-3,-6),P(3,-6),P(-6,-3),P(6,-3),P(-6,3),P(6,3),P(-3,6),P(3,6),P(0,-7),P(-7,0),P(7,0),P(0,7),\\nP(-1,-7),P(1,-7),P(-5,-5),P(5,-5),P(-7,-1),P(7,-1),P(-7,1),P(7,1),P(-5,5),P(5,5),P(-1,7),P(1,7),P(-4,-6),P(4,-6),P(-6,-4),P(6,-4),P(-6,4),P(6,4),P(-4,6),P(4,6),P(-2,-7),P(2,-7),P(-7,-2),P(7,-2),P(-7,2),P(7,2),P(-2,7),P(2,7),P(-3,-7),P(3,-7),P(-7,-3),P(7,-3),P(-7,3),P(7,3),P(-3,7),P(3,7),P(-5,-6),P(5,-6),P(-6,-5),P(6,-5),P(-6,5),P(6,5),P(-5,6),P(5,6),P(0,-8),P(-8,0),P(8,0),P(0,8),\\nP(-1,-8),P(1,-8),P(-4,-7),P(4,-7),P(-7,-4),P(7,-4),P(-8,-1),P(8,-1),P(-8,1),P(8,1),P(-7,4),P(7,4),P(-4,7),P(4,7),P(-1,8),P(1,8),P(-2,-8),P(2,-8),P(-8,-2),P(8,-2),P(-8,2),P(8,2),P(-2,8),P(2,8),P(-6,-6),P(6,-6),P(-6,6),P(6,6),P(-3,-8),P(3,-8),P(-8,-3),P(8,-3),P(-8,3),P(8,3),P(-3,8),P(3,8),P(-5,-7),P(5,-7),P(-7,-5),P(7,-5),P(-7,5),P(7,5),P(-5,7),P(5,7),P(-4,-8),P(4,-8),P(-8,-4),P(8,-4),P(-8,4),P(8,4),P(-4,8),P(4,8),P(0,-9),P(-9,0),P(9,0),P(0,9),\\nP(-1,-9),P(1,-9),P(-9,-1),P(9,-1),P(-9,1),P(9,1),P(-1,9),P(1,9),P(-2,-9),P(2,-9),P(-6,-7),P(6,-7),P(-7,-6),P(7,-6),P(-9,-2),P(9,-2),P(-9,2),P(9,2),P(-7,6),P(7,6),P(-6,7),P(6,7),P(-2,9),P(2,9),P(-5,-8),P(5,-8),P(-8,-5),P(8,-5),P(-8,5),P(8,5),P(-5,8),P(5,8),P(-3,-9),P(3,-9),P(-9,-3),P(9,-3),P(-9,3),P(9,3),P(-3,9),P(3,9),P(-4,-9),P(4,-9),P(-9,-4),P(9,-4),P(-9,4),P(9,4),P(-4,9),P(4,9),P(-7,-7),P(7,-7),P(-7,7),P(7,7),P(0,-10),P(-6,-8),P(6,-8),P(-8,-6),P(8,-6),P(-10,0),P(10,0),P(-8,6),P(8,6),P(-6,8),P(6,8),P(0,10),\\nP(-1,-10),P(1,-10),P(-10,-1),P(10,-1),P(-10,1),P(10,1),P(-1,10),P(1,10),P(-2,-10),P(2,-10),P(-10,-2),P(10,-2),P(-10,2),P(10,2),P(-2,10),P(2,10),P(-5,-9),P(5,-9),P(-9,-5),P(9,-5),P(-9,5),P(9,5),P(-5,9),P(5,9),P(-3,-10),P(3,-10),P(-10,-3),P(10,-3),P(-10,3),P(10,3),P(-3,10),P(3,10),P(-7,-8),P(7,-8),P(-8,-7),P(8,-7),P(-8,7),P(8,7),P(-7,8),P(7,8),P(-4,-10),P(4,-10),P(-10,-4),P(10,-4),P(-10,4),P(10,4),P(-4,10),P(4,10),P(-6,-9),P(6,-9),P(-9,-6),P(9,-6),P(-9,6),P(9,6),P(-6,9),P(6,9),P(0,-11),P(-11,0),P(11,0),P(0,11),\\nP(-1,-11),P(1,-11),P(-11,-1),P(11,-1),P(-11,1),P(11,1),P(-1,11),P(1,11),P(-2,-11),P(2,-11),P(-5,-10),P(5,-10),P(-10,-5),P(10,-5),P(-11,-2),P(11,-2),P(-11,2),P(11,2),P(-10,5),P(10,5),P(-5,10),P(5,10),P(-2,11),P(2,11),P(-8,-8),P(8,-8),P(-8,8),P(8,8),P(-3,-11),P(3,-11),P(-7,-9),P(7,-9),P(-9,-7),P(9,-7),P(-11,-3),P(11,-3),P(-11,3),P(11,3),P(-9,7),P(9,7),P(-7,9),P(7,9),P(-3,11),P(3,11),P(-6,-10),P(6,-10),P(-10,-6),P(10,-6),P(-10,6),P(10,6),P(-6,10),P(6,10),P(-4,-11),P(4,-11),P(-11,-4),P(11,-4),P(-11,4),P(11,4),P(-4,11),P(4,11),P(0,-12),P(-12,0),P(12,0),P(0,12),\\nP(-1,-12),P(1,-12),P(-8,-9),P(8,-9),P(-9,-8),P(9,-8),P(-12,-1),P(12,-1),P(-12,1),P(12,1),P(-9,8),P(9,8),P(-8,9),P(8,9),P(-1,12),P(1,12),P(-5,-11),P(5,-11),P(-11,-5),P(11,-5),P(-11,5),P(11,5),P(-5,11),P(5,11),P(-2,-12),P(2,-12),P(-12,-2),P(12,-2),P(-12,2),P(12,2),P(-2,12),P(2,12),P(-7,-10),P(7,-10),P(-10,-7),P(10,-7),P(-10,7),P(10,7),P(-7,10),P(7,10),P(-3,-12),P(3,-12),P(-12,-3),P(12,-3),P(-12,3),P(12,3),P(-3,12),P(3,12),P(-6,-11),P(6,-11),P(-11,-6),P(11,-6),P(-11,6),P(11,6),P(-6,11),P(6,11),P(-4,-12),P(4,-12),P(-12,-4),P(12,-4),P(-12,4),P(12,4),P(-4,12),P(4,12),P(-9,-9),P(9,-9),P(-9,9),P(9,9),P(-8,-10),P(8,-10),P(-10,-8),P(10,-8),P(-10,8),P(10,8),P(-8,10),P(8,10),P(0,-13),P(-5,-12),P(5,-12),P(-12,-5),P(12,-5),P(-13,0),P(13,0),P(-12,5),P(12,5),P(-5,12),P(5,12),P(0,13),\\nP(-1,-13),P(1,-13),P(-7,-11),P(7,-11),P(-11,-7),P(11,-7),P(-13,-1),P(13,-1),P(-13,1),P(13,1),P(-11,7),P(11,7),P(-7,11),P(7,11),P(-1,13),P(1,13),P(-2,-13),P(2,-13),P(-13,-2),P(13,-2),P(-13,2),P(13,2),P(-2,13),P(2,13),P(-3,-13),P(3,-13),P(-13,-3),P(13,-3),P(-13,3),P(13,3),P(-3,13),P(3,13),P(-6,-12),P(6,-12),P(-12,-6),P(12,-6),P(-12,6),P(12,6),P(-6,12),P(6,12),P(-9,-10),P(9,-10),P(-10,-9),P(10,-9),P(-10,9),P(10,9),P(-9,10),P(9,10),P(-4,-13),P(4,-13),P(-8,-11),P(8,-11),P(-11,-8),P(11,-8),P(-13,-4),P(13,-4),P(-13,4),P(13,4),P(-11,8),P(11,8),P(-8,11),P(8,11),P(-4,13),P(4,13),P(-7,-12),P(7,-12),P(-12,-7),P(12,-7),P(-12,7),P(12,7),P(-7,12),P(7,12),P(-5,-13),P(5,-13),P(-13,-5),P(13,-5),P(-13,5),P(13,5),P(-5,13),P(5,13),P(0,-14),P(-14,0),P(14,0),P(0,14),\\nP(-1,-14),P(1,-14),P(-14,-1),P(14,-1),P(-14,1),P(14,1),P(-1,14),P(1,14),P(-2,-14),P(2,-14),P(-10,-10),P(10,-10),P(-14,-2),P(14,-2),P(-14,2),P(14,2),P(-10,10),P(10,10),P(-2,14),P(2,14),P(-9,-11),P(9,-11),P(-11,-9),P(11,-9),P(-11,9),P(11,9),P(-9,11),P(9,11),P(-3,-14),P(3,-14),P(-6,-13),P(6,-13),P(-13,-6),P(13,-6),P(-14,-3),P(14,-3),P(-14,3),P(14,3),P(-13,6),P(13,6),P(-6,13),P(6,13),P(-3,14),P(3,14),P(-8,-12),P(8,-12),P(-12,-8),P(12,-8),P(-12,8),P(12,8),P(-8,12),P(8,12),P(-4,-14),P(4,-14),P(-14,-4),P(14,-4),P(-14,4),P(14,4),P(-4,14),P(4,14),P(-7,-13),P(7,-13),P(-13,-7),P(13,-7),P(-13,7),P(13,7),P(-7,13),P(7,13),P(-5,-14),P(5,-14),P(-10,-11),P(10,-11),P(-11,-10),P(11,-10),P(-14,-5),P(14,-5),P(-14,5),P(14,5),P(-11,10),P(11,10),P(-10,11),P(10,11),P(-5,14),P(5,14),P(0,-15),P(-9,-12),P(9,-12),P(-12,-9),P(12,-9),P(-15,0),P(15,0),P(-12,9),P(12,9),P(-9,12),P(9,12),P(0,15)\\n);\\nconst int DEFAULT_PATCH_RADIUS = 15;\\nconst int MIN_PATCH_RADIUS = 2;\\nvoid main()\\n{\\nvec4 pixel = threadPixel(encodedKeypoints);\\nivec2 thread = threadLocation();\\nint keypointIndex = thread.x + thread.y * outputSize().x;\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nKeypointAddress address = KeypointAddress(keypointIndex * pixelsPerKeypoint, 0);\\nKeypoint keypoint = decodeKeypoint(encodedKeypoints, encoderLength, address);\\nvec2 m = vec2(0.0f);\\nfloat pot = exp2(keypoint.lod);\\nvec2 imageSize = vec2(textureSize(image, 0));\\nint scaledRadius = int(ceil(float(DEFAULT_PATCH_RADIUS) / pot));\\nint radius = max(scaledRadius, MIN_PATCH_RADIUS);\\nint count = diskPointCount[radius];\\nfor(int j = 0; j < count; j++) {\\nvec2 offset = vec2(diskPoint[j]);\\nvec2 position = keypoint.position + round(pot * offset);\\nvec4 patchPixel = texture(image, (position + vec2(0.5f)) / imageSize);\\nm += offset * patchPixel.g;\\n}\\nfloat angle = fastAtan2(m.y, m.x);\\nfloat encodedOrientation = encodeKeypointOrientation(angle);\\ncolor = vec4(0.0f, encodedOrientation, 0.0f, 0.0f);\\n}\"\n\n/***/ }),\n\n/***/ 9739:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\n@include \\\"filters.glsl\\\"\\n#if !defined(METHOD)\\n#error Undefined METHOD\\n#endif\\nuniform sampler2D pyramid;\\nuniform float lodStep;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\n#if METHOD == 1\\nuniform int threshold;\\n#endif\\nconst float eps = 1e-6;\\nfloat cornerStrength(vec2 position, float lod)\\n{\\n#if METHOD == 0\\nreturn laplacian(pyramid, position, lod);\\n#elif METHOD == 1\\nfloat pot = exp2(lod);\\nfloat t = float(clamp(threshold, 0, 255)) / 255.0f;\\n#define P(x,y) pyrPixelAtOffset(pyramid, lod, pot, ivec2((x),(y))).g\\nmat4 mp = mat4(\\nP(0,3),P(3,0),P(0,-3),P(-3,0),\\nP(1,3),P(2,2),P(3,1),P(3,-1),\\nP(2,-2),P(1,-3),P(-1,-3),P(-2,-2),\\nP(-3,-1),P(-3,1),P(-2,2),P(-1,3)\\n);\\nfloat c = P(0,0);\\nfloat ct = c + t, c_t = c - t;\\nmat4 mct = mp - mat4(ct,ct,ct,ct,ct,ct,ct,ct,ct,ct,ct,ct,ct,ct,ct,ct);\\nmat4 mc_t = mat4(c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t,c_t) - mp;\\nconst vec4 zeros = vec4(0.0f), ones = vec4(1.0f);\\nvec4 bs = max(mct[0], zeros), ds = max(mc_t[0], zeros);\\nbs += max(mct[1], zeros);     ds += max(mc_t[1], zeros);\\nbs += max(mct[2], zeros);     ds += max(mc_t[2], zeros);\\nbs += max(mct[3], zeros);     ds += max(mc_t[3], zeros);\\nreturn max(dot(bs, ones), dot(ds, ones)) / 16.0f;\\n#else\\n#error Invalid method\\n#endif\\n}\\nvoid main()\\n{\\nvec4 pixel = threadPixel(encodedKeypoints);\\nivec2 thread = threadLocation();\\nKeypointAddress address = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\ncolor = pixel;\\nif(address.offset != 1)\\nreturn;\\nKeypoint keypoint = decodeKeypoint(encodedKeypoints, encoderLength, address);\\nif(isBadKeypoint(keypoint))\\nreturn;\\nvec3 strength = vec3(\\ncornerStrength(keypoint.position, max(0.0f, keypoint.lod - lodStep)),\\ncornerStrength(keypoint.position, keypoint.lod),\\ncornerStrength(keypoint.position, keypoint.lod + lodStep)\\n);\\nvec3 p = mat3(\\n2, -3, 1,\\n-4, 4, 0,\\n2, -1, 0\\n) * strength;\\nfloat maxStrength = max(strength.x, max(strength.y, strength.z));\\nvec3 diffStrength = abs(strength - vec3(maxStrength));\\nvec3 strengthIndicators = vec3(lessThan(diffStrength, vec3(eps)));\\nfloat maxPoint = min(1.0f, dot(vec3(0.0f, 0.5f, 1.0f), strengthIndicators));\\nbool hasMax = p.x < -eps;\\nfloat pmax = hasMax ? -0.5f * p.y / p.x : maxPoint;\\nfloat alpha = abs(pmax - 0.5f) <= 0.5f ? pmax : maxPoint;\\nfloat lodOffset = mix(-lodStep, lodStep, alpha);\\nfloat lod = keypoint.lod + lodOffset;\\ncolor.r = encodeLod(lod);\\n}\"\n\n/***/ }),\n\n/***/ 8231:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"float16.glsl\\\"\\nuniform sampler2D corners;\\nuniform int iterationNumber;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nivec2 bounds = outputSize();\\nint jump = (1 << iterationNumber);\\nint clusterLength = jump << 1;\\nint clusterMask = clusterLength - 1;\\nivec2 clusterPos = ivec2(thread >> (1 + iterationNumber)) << (1 + iterationNumber);\\nivec2 next1 = clusterPos + ((thread - clusterPos + ivec2(jump, 0)) & clusterMask);\\nivec2 next2 = clusterPos + ((thread - clusterPos + ivec2(0, jump)) & clusterMask);\\nivec2 next3 = clusterPos + ((thread - clusterPos + ivec2(jump, jump)) & clusterMask);\\nvec4 p0 = threadPixel(corners);\\nvec4 p1 = texelFetch(corners, next1 % bounds, 0);\\nvec4 p2 = texelFetch(corners, next2 % bounds, 0);\\nvec4 p3 = texelFetch(corners, next3 % bounds, 0);\\nfloat s0 = decodeFloat16(p0.rb);\\nfloat s1 = decodeFloat16(p1.rb);\\nfloat s2 = decodeFloat16(p2.rb);\\nfloat s3 = decodeFloat16(p3.rb);\\nbool b0 = s0 >= s1 && s0 >= s2 && s0 >= s3;\\nbool b1 = s1 >= s0 && s1 >= s2 && s1 >= s3;\\nbool b2 = s2 >= s0 && s2 >= s1 && s2 >= s3;\\ncolor = vec4(0.0f);\\ncolor.rb = b0 ? p0.rb : (\\nb1 ? p1.rb : (\\nb2 ? p2.rb : p3.rb\\n)\\n);\\n}\"\n\n/***/ }),\n\n/***/ 2518:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\n#if PERMUTATION_MAXLEN % 4 > 0 || PERMUTATION_MAXLEN * 4 > 16384\\n#error Invalid PERMUTATION_MAXLEN\\n#endif\\nlayout(std140) uniform Permutation\\n{\\nivec4 permutation[PERMUTATION_MAXLEN / 4];\\n};\\nint permutationElement(int index)\\n{\\nint base = index - (index % PERMUTATION_MAXLEN);\\nint offset = index - base;\\nivec4 tuple = permutation[offset / 4];\\nint newOffset = tuple[offset & 3];\\nreturn base + newOffset;\\n}\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nKeypointAddress myAddress = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nint myIndex = findKeypointIndex(myAddress, descriptorSize, extraSize);\\nint otherIndex = permutationElement(myIndex);\\nKeypointAddress otherAddress = KeypointAddress(otherIndex * pixelsPerKeypoint, myAddress.offset);\\nKeypoint myKeypoint = decodeKeypoint(encodedKeypoints, encoderLength, myAddress);\\nKeypoint otherKeypoint = decodeKeypoint(encodedKeypoints, encoderLength, otherAddress);\\ncolor = readKeypointData(encodedKeypoints, encoderLength, otherAddress);\\n}\"\n\n/***/ }),\n\n/***/ 8096:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\n#if !defined(STAGE)\\n#error Undefined STAGE\\n#elif STAGE == 1\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\n#elif STAGE == 2\\nuniform sampler2D permutation;\\nuniform int blockSize;\\nuniform int dblLog2BlockSize;\\n#elif STAGE == 3\\nuniform sampler2D permutation;\\nuniform int maxKeypoints;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\n#else\\n#error Invalid STAGE\\n#endif\\nstruct PermutationElement\\n{\\nint keypointIndex;\\nfloat score;\\nbool valid;\\n};\\nvec4 encodePermutationElement(PermutationElement element)\\n{\\nconst vec2 ONES = vec2(1.0f);\\nvec2 encodedScore = element.valid ? encodeFloat16(element.score) : ONES;\\nvec2 encodedIndex = vec2(element.keypointIndex & 255, (element.keypointIndex >> 8) & 255) / 255.0f;\\nreturn vec4(encodedIndex, encodedScore);\\n}\\nPermutationElement decodePermutationElement(vec4 pixel)\\n{\\nconst vec2 ONES = vec2(1.0f);\\nPermutationElement element;\\nelement.keypointIndex = int(pixel.r * 255.0f) | (int(pixel.g * 255.0f) << 8);\\nelement.valid = !all(equal(pixel.ba, ONES));\\nelement.score = element.valid ? decodeFloat16(pixel.ba) : -1.0f;\\nreturn element;\\n}\\nPermutationElement readPermutationElement(sampler2D permutation, int elementIndex, int stride, int height)\\n{\\nconst vec4 INVALID_PIXEL = vec4(1.0f);\\nivec2 pos = ivec2(elementIndex % stride, elementIndex / stride);\\nvec4 pixel = pos.y < height ? pixelAt(permutation, pos) : INVALID_PIXEL;\\nreturn decodePermutationElement(pixel);\\n}\\n#if STAGE == 2\\nPermutationElement selectKth(sampler2D permutation, int k, int la, int ra, int lb, int rb)\\n{\\nfloat scoreA, scoreB;\\nint ha, hb, ma, mb;\\nbool discard1stHalf, altb;\\nbool locked = false;\\nint tmp, result = 0;\\nint stride = outputSize().x;\\nint height = outputSize().y;\\nfor(int i = 0; i < dblLog2BlockSize; i++) {\\ntmp = (lb > rb && !locked) ? (la+k) : result;\\nresult = (la > ra && !locked) ? (lb+k) : tmp;\\nlocked = locked || (la > ra) || (lb > rb);\\nha = (ra - la + 1) / 2;\\nhb = (rb - lb + 1) / 2;\\nma = la + ha;\\nmb = lb + hb;\\nscoreA = readPermutationElement(permutation, ma, stride, height).score;\\nscoreB = readPermutationElement(permutation, mb, stride, height).score;\\ndiscard1stHalf = (k > ha + hb);\\naltb = (-scoreA < -scoreB);\\nk -= int(discard1stHalf && altb) * (ha + 1);\\nk -= int(discard1stHalf && !altb) * (hb + 1);\\nla += int(discard1stHalf && altb) * (ma + 1 - la);\\nlb += int(discard1stHalf && !altb) * (mb + 1 - lb);\\nra += int(!discard1stHalf && !altb) * (ma - 1 - ra);\\nrb += int(!discard1stHalf && altb) * (mb - 1 - rb);\\n}\\nreturn readPermutationElement(permutation, result, stride, height);\\n}\\n#endif\\nvoid main()\\n{\\n#if STAGE == 1\\nivec2 thread = threadLocation();\\nint stride = outputSize().x;\\nint keypointIndex = thread.y * stride + thread.x;\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nKeypointAddress address = KeypointAddress(keypointIndex * pixelsPerKeypoint, 0);\\nKeypoint keypoint = decodeKeypoint(encodedKeypoints, encoderLength, address);\\nPermutationElement element;\\nelement.keypointIndex = keypointIndex;\\nelement.score = keypoint.score;\\nelement.valid = !isBadKeypoint(keypoint);\\ncolor = encodePermutationElement(element);\\n#elif STAGE == 2\\nivec2 thread = threadLocation();\\nint stride = outputSize().x;\\nint elementIndex = thread.y * stride + thread.x;\\nint blockIndex = elementIndex / blockSize;\\nint blockOffset = elementIndex % blockSize;\\nint la = blockIndex * blockSize;\\nint lb = la + blockSize / 2;\\nint ra = lb - 1;\\nint rb = (blockIndex + 1) * blockSize - 1;\\nint k = blockOffset;\\nPermutationElement element = selectKth(permutation, k, la, ra, lb, rb);\\ncolor = encodePermutationElement(element);\\n#elif STAGE == 3\\nivec2 thread = threadLocation();\\nint newEncoderLength = outputSize().x;\\nKeypointAddress myAddress = findKeypointAddress(thread, newEncoderLength, descriptorSize, extraSize);\\nint myKeypointIndex = findKeypointIndex(myAddress, descriptorSize, extraSize);\\nivec2 psize = textureSize(permutation, 0);\\nPermutationElement element = readPermutationElement(permutation, myKeypointIndex, psize.x, psize.y);\\nint oldEncoderLength = textureSize(encodedKeypoints, 0).x;\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nKeypointAddress address = KeypointAddress(element.keypointIndex * pixelsPerKeypoint, myAddress.offset);\\nvec4 keypointData = readKeypointData(encodedKeypoints, oldEncoderLength, address);\\ncolor = myKeypointIndex < maxKeypoints && element.valid ? keypointData : encodeNullKeypoint();\\n#endif\\n}\"\n\n/***/ }),\n\n/***/ 5795:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\n@include \\\"float16.glsl\\\"\\n#if !defined(METHOD)\\n#error Must define METHOD\\n#endif\\nuniform sampler2D pyramid;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\nuniform int maxIterations;\\nuniform float epsilon;\\nconst int PATCH_RADIUS = 1;\\nconst int PATCH_SIZE = 2 * PATCH_RADIUS + 1;\\nconst int PATCH_SIZE_SQUARED = PATCH_SIZE * PATCH_SIZE;\\nconst int LARGE_PATCH_RADIUS = PATCH_RADIUS + 1;\\nconst int LARGE_PATCH_SIZE = 2 * LARGE_PATCH_RADIUS + 1;\\nconst int LARGE_PATCH_SIZE_SQUARED = LARGE_PATCH_SIZE * LARGE_PATCH_SIZE;\\nconst int LARGER_PATCH_RADIUS = LARGE_PATCH_RADIUS + 1;\\nconst int LARGER_PATCH_SIZE = 2 * LARGER_PATCH_RADIUS + 1;\\nconst int LARGER_PATCH_SIZE_SQUARED = LARGER_PATCH_SIZE * LARGER_PATCH_SIZE;\\nconst float EPS = 1e-5;\\nfloat smoothPixelBuffer[LARGER_PATCH_SIZE_SQUARED];\\nvec2 derivativesBuffer[LARGE_PATCH_SIZE_SQUARED];\\nfloat responseBuffer[PATCH_SIZE_SQUARED];\\n#define patchPixelAt(u,v) smoothPixelBuffer[((v) + LARGER_PATCH_RADIUS) * LARGER_PATCH_SIZE + ((u) + LARGER_PATCH_RADIUS)]\\n#define derivativesAt(u,v) derivativesBuffer[((v) + LARGE_PATCH_RADIUS) * LARGE_PATCH_SIZE + ((u) + LARGE_PATCH_RADIUS)]\\n#define responseAt(u,v) responseBuffer[((v) + PATCH_RADIUS) * PATCH_SIZE + ((u) + PATCH_RADIUS)]\\nvoid readPixels(vec2 center, float lod)\\n{\\nivec2 pyrBaseSize = textureSize(pyramid, 0);\\nfloat pot = exp2(lod);\\nint u, v;\\nfor(int j = 0; j < LARGER_PATCH_SIZE; j++) {\\nfor(int i = 0; i < LARGER_PATCH_SIZE; i++) {\\nu = i - LARGER_PATCH_RADIUS;\\nv = j - LARGER_PATCH_RADIUS;\\npatchPixelAt(u,v) = pyrSubpixelAtExOffset(pyramid, center, lod, pot, ivec2(u,v), pyrBaseSize).g;\\n}\\n}\\n}\\nvoid computeDerivatives()\\n{\\nconst mat3 dx = mat3(\\n-1, 0, 1,\\n-2, 0, 2,\\n-1, 0, 1\\n);\\nconst mat3 dy = mat3(\\n1, 2, 1,\\n0, 0, 0,\\n-1,-2,-1\\n);\\nint u, v;\\nmat3 pix, convX, convY;\\nconst vec3 ones = vec3(1.0f);\\nfor(int j = 0; j < LARGE_PATCH_SIZE; j++) {\\nfor(int i = 0; i < LARGE_PATCH_SIZE; i++) {\\nu = i - LARGE_PATCH_RADIUS;\\nv = j - LARGE_PATCH_RADIUS;\\npix = mat3(\\npatchPixelAt(u+1,v+1), patchPixelAt(u+0,v+1), patchPixelAt(u-1,v+1),\\npatchPixelAt(u+1,v+0), patchPixelAt(u+0,v+0), patchPixelAt(u-1,v+0),\\npatchPixelAt(u+1,v-1), patchPixelAt(u+0,v-1), patchPixelAt(u-1,v-1)\\n);\\nconvX = matrixCompMult(dx, pix);\\nconvY = matrixCompMult(dy, pix);\\nderivativesAt(u,v) = vec2(\\ndot(ones, vec3(\\ndot(convX[0], ones),\\ndot(convX[1], ones),\\ndot(convX[2], ones)\\n)),\\ndot(ones, vec3(\\ndot(convY[0], ones),\\ndot(convY[1], ones),\\ndot(convY[2], ones)\\n))\\n);\\n}\\n}\\n}\\nvec2 computeResponseMap()\\n{\\nfloat patchArea = float(PATCH_SIZE * PATCH_SIZE);\\nvec3 h; vec2 d, c = vec2(0.0f);\\nconst vec3 ones = vec3(1.0f);\\nfloat response, sum = 0.0f;\\nint u, v;\\n#define H(r,s) d = derivativesAt((r),(s)); h += vec3(d.x * d.x, d.x * d.y, d.y * d.y)\\nfor(int j = 0; j < PATCH_SIZE; j++) {\\nfor(int i = 0; i < PATCH_SIZE; i++) {\\nu = i - PATCH_RADIUS;\\nv = j - PATCH_RADIUS;\\nh = vec3(0.0f);\\nH(u-1,v-1); H(u+0,v-1); H(u+1,v-1);\\nH(u-1,v+0); H(u+0,v+0); H(u+1,v+0);\\nH(u-1,v+1); H(u+0,v+1); H(u+1,v+1);\\nresponse = 0.5f * (h.x + h.z - sqrt((h.x - h.z) * (h.x - h.z) + 4.0f * h.y * h.y));\\nresponse /= patchArea;\\nresponseAt(u,v) = response;\\nc += vec2(u,v) * response;\\nsum += response;\\n}\\n}\\nreturn abs(sum) > EPS ? c / sum : vec2(0.0f);\\n}\\n#if METHOD == 0\\nvec2 quadratic1d()\\n{\\nfloat a = 0.5f * (responseAt(-1,0) - 2.0f * responseAt(0,0) + responseAt(1,0));\\nfloat b = 0.5f * (responseAt(1,0) - responseAt(-1,0));\\nfloat c = responseAt(0,0);\\nfloat d = 0.5f * (responseAt(0,-1) - 2.0f * responseAt(0,0) + responseAt(0,1));\\nfloat e = 0.5f * (responseAt(0,1) - responseAt(0,-1));\\nfloat f = responseAt(0,0);\\nbool hasMax = a < -EPS && d < -EPS;\\nreturn hasMax ? -0.5f * vec2(b / a, e / d) : vec2(0.0f);\\n}\\n#endif\\n#if METHOD == 1\\nvec2 taylor2d()\\n{\\nfloat dx = (-responseAt(-1,0) + responseAt(1,0)) * 0.5f;\\nfloat dy = (-responseAt(0,-1) + responseAt(0,1)) * 0.5f;\\nfloat dxx = responseAt(-1,0) - 2.0f * responseAt(0,0) + responseAt(1,0);\\nfloat dyy = responseAt(0,-1) - 2.0f * responseAt(0,0) + responseAt(0,1);\\nfloat dxy = (responseAt(-1,-1) + responseAt(1,1) - responseAt(1,-1) - responseAt(-1,1)) * 0.25f;\\nfloat det = dxx * dyy - dxy * dxy;\\nmat2 inv = mat2(dyy, -dxy, -dxy, dxx);\\nbool hasMax = det > EPS && dxx < 0.0f;\\nreturn hasMax ? inv * vec2(dx, dy) / (-det) : vec2(0.0f);\\n}\\n#endif\\n#if METHOD == 2\\nvoid bilinearUpsample(ivec2 patchOffset, vec4 pixelsOfPatch)\\n{\\nint u, v, i, j;\\nvec2 frc, ifrc; vec4 sub;\\nconst vec4 ones = vec4(1.0f);\\nfloat s = 1.0f / float(PATCH_SIZE - 1);\\nint xoff = 2 * patchOffset.x;\\nint yoff = 2 * patchOffset.y;\\nfor(j = 0; j < PATCH_SIZE; j++) {\\nfor(i = 0; i < PATCH_SIZE; i++) {\\nu = i - PATCH_RADIUS;\\nv = j - PATCH_RADIUS;\\nfrc = vec2(i, j) * s;\\nifrc = vec2(1.0f) - frc;\\nsub = vec4(\\nifrc.x * ifrc.y,\\nfrc.x * ifrc.y,\\nifrc.x * frc.y,\\nfrc.x * frc.y\\n);\\npatchPixelAt(u+xoff,v+yoff) = dot(sub*pixelsOfPatch, ones);\\n}\\n}\\n}\\n#endif\\n#if METHOD == 3\\nvoid bicubicUpsample(ivec2 patchOffset, vec4 pixelsOfPatch, vec4 dx, vec4 dy, vec4 dxy)\\n{\\nfloat x, y, s = 1.0f / float(PATCH_SIZE - 1);\\nint u, v, i, j;\\nfloat f00 = pixelsOfPatch.x;\\nfloat f10 = pixelsOfPatch.y;\\nfloat f01 = pixelsOfPatch.z;\\nfloat f11 = pixelsOfPatch.w;\\nfloat fx00 = dx.x;\\nfloat fx10 = dx.y;\\nfloat fx01 = dx.z;\\nfloat fx11 = dx.w;\\nfloat fy00 = dy.x;\\nfloat fy10 = dy.y;\\nfloat fy01 = dy.z;\\nfloat fy11 = dy.w;\\nfloat fxy00 = dxy.x;\\nfloat fxy10 = dxy.y;\\nfloat fxy01 = dxy.z;\\nfloat fxy11 = dxy.w;\\nmat4 bicubic = mat4(\\n1, 0, -3, 2,\\n0, 0, 3, -2,\\n0, 1, -2, 1,\\n0, 0, -1, 1\\n) * mat4(\\nf00, f10, fx00, fx10,\\nf01, f11, fx01, fx11,\\nfy00, fy10, fxy00, fxy10,\\nfy01, fy11, fxy01, fxy11\\n) * mat4(\\n1, 0, 0, 0,\\n0, 0, 1, 0,\\n-3, 3, -2, -1,\\n2, -2, 1, 1\\n);\\nint xoff = 2 * patchOffset.x;\\nint yoff = 2 * patchOffset.y;\\nfor(j = 0; j < PATCH_SIZE; j++) {\\nfor(i = 0; i < PATCH_SIZE; i++) {\\nu = i - PATCH_RADIUS;\\nv = j - PATCH_RADIUS;\\nx = float(i) * s;\\ny = float(j) * s;\\npatchPixelAt(u+xoff,v+yoff) = dot(\\nvec4(1, x, x*x, x*x*x),\\nbicubic * vec4(1, y, y*y, y*y*y)\\n);\\n}\\n}\\n}\\n#endif\\n#if METHOD == 2 || METHOD == 3\\nvoid upsamplePatch(int left, int top, int right, int bottom)\\n{\\nint x, y, k;\\nvec4 ptch[9];\\nvec2 d00, d10, d01, d11;\\nfor(k = 0; k < 9; k++) {\\nx = -1 + (k % 3);\\ny = -1 + (k / 3);\\nptch[k] = vec4(\\npatchPixelAt(left+x, top+y),\\npatchPixelAt(right+x, top+y),\\npatchPixelAt(left+x, bottom+y),\\npatchPixelAt(right+x, bottom+y)\\n);\\n}\\nfor(k = 0; k < 9; k++) {\\nx = -1 + (k % 3);\\ny = -1 + (k / 3);\\n#if METHOD == 2\\nbilinearUpsample(ivec2(x, y), ptch[k]);\\n#elif METHOD == 3\\nd00 = derivativesAt(left+x, top+y);\\nd10 = derivativesAt(right+x, top+y);\\nd01 = derivativesAt(left+x, bottom+y);\\nd11 = derivativesAt(right+x, bottom+y);\\nbicubicUpsample(ivec2(x, y), ptch[k],\\nvec4(d00.x, d10.x, d01.x, d11.x),\\nvec4(d00.y, d10.y, d01.y, d11.y),\\n0.25f * vec4(\\n(patchPixelAt(left+x + 1,top+y + 1) + patchPixelAt(left+x - 1, top+y - 1)) - (patchPixelAt(left+x + 1, top+y - 1) + patchPixelAt(left+x - 1, top+y + 1)),\\n(patchPixelAt(right+x + 1,top+y + 1) + patchPixelAt(right+x - 1, top+y - 1)) - (patchPixelAt(right+x + 1, top+y - 1) + patchPixelAt(right+x - 1, top+y + 1)),\\n(patchPixelAt(left+x + 1,bottom+y + 1) + patchPixelAt(left+x - 1, bottom+y - 1)) - (patchPixelAt(left+x + 1, bottom+y - 1) + patchPixelAt(left+x - 1, bottom+y + 1)),\\n(patchPixelAt(right+x + 1,bottom+y + 1) + patchPixelAt(right+x - 1, bottom+y - 1)) - (patchPixelAt(right+x + 1, bottom+y - 1) + patchPixelAt(right+x - 1, bottom+y + 1))\\n)\\n);\\n#endif\\n}\\n}\\nvec2 upsampleResponseMap(int left, int top, int right, int bottom)\\n{\\nupsamplePatch(left, top, right, bottom);\\ncomputeDerivatives();\\nreturn computeResponseMap();\\n}\\nvec2 iterativeUpsample(vec2 initialGuess)\\n{\\nint refine = 1;\\nfloat scale = 0.5f;\\nfloat eps2 = epsilon * epsilon;\\nvec2 guess = initialGuess, localGuess = initialGuess;\\nfor(int k = 0; k < maxIterations; k++) {\\nivec4 quad = ivec4(floor(localGuess.x), floor(localGuess.y), ceil(localGuess.x), ceil(localGuess.y));\\nvec2 response = (refine != 0) ? upsampleResponseMap(quad.x, quad.y, quad.z, quad.w) : vec2(0.0f);\\nlocalGuess = response * scale;\\nguess += localGuess;\\nscale *= 0.5f;\\nrefine *= int(dot(localGuess, localGuess) >= eps2);\\n}\\nreturn guess;\\n}\\n#endif\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nint keypointIndex = thread.x + thread.y * outputSize().x;\\nint pixelsPerKeypoint = sizeofEncodedKeypoint(descriptorSize, extraSize) / 4;\\nKeypointAddress address = KeypointAddress(keypointIndex * pixelsPerKeypoint, 0);\\nKeypoint keypoint = decodeKeypoint(encodedKeypoints, encoderLength, address);\\ncolor = encodeNullPairOfFloat16();\\nif(isNullKeypoint(keypoint))\\nreturn;\\ncolor = encodeDiscardedPairOfFloat16();\\nif(isBadKeypoint(keypoint))\\nreturn;\\nreadPixels(keypoint.position, keypoint.lod);\\ncomputeDerivatives();\\nvec2 offset = computeResponseMap();\\n#if METHOD == 0\\noffset = quadratic1d();\\n#elif METHOD == 1\\noffset = taylor2d();\\n#elif METHOD == 2 || METHOD == 3\\noffset = iterativeUpsample(offset);\\n#else\\n#error Unknown METHOD\\n#endif\\nfloat pot = exp2(keypoint.lod);\\ncolor = encodePairOfFloat16(offset * pot);\\n}\"\n\n/***/ }),\n\n/***/ 3169:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\n@include \\\"float16.glsl\\\"\\nuniform sampler2D encodedFlow;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\nvoid main()\\n{\\nvec4 pixel = threadPixel(encodedKeypoints);\\nivec2 thread = threadLocation();\\nint len = textureSize(encodedFlow, 0).x;\\nKeypointAddress myAddress = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nKeypoint keypoint = decodeKeypoint(encodedKeypoints, encoderLength, myAddress);\\nint myIndex = findKeypointIndex(myAddress, descriptorSize, extraSize);\\ncolor = pixel;\\nif(isBadKeypoint(keypoint))\\nreturn;\\nivec2 location = ivec2(myIndex % len, myIndex / len);\\nvec4 encodedFlow = myIndex < len * len ? pixelAt(encodedFlow, location) : encodeDiscardedKeypoint();\\nbool discardFlow = isDiscardedPairOfFloat16(encodedFlow);\\nvec2 flow = !discardFlow ? decodePairOfFloat16(encodedFlow) : vec2(0.0f);\\nvec4 newPosition = encodeKeypointPosition(keypoint.position + flow);\\nvec4 newPixel = myAddress.offset == 0 ? newPosition : pixel;\\ncolor = !discardFlow ? newPixel : encodeDiscardedKeypoint();\\n}\"\n\n/***/ }),\n\n/***/ 1337:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform sampler2D encodedOrientations;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\nvoid main()\\n{\\nvec4 pixel = threadPixel(encodedKeypoints);\\nivec2 thread = threadLocation();\\nKeypointAddress myAddress = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nint myIndex = findKeypointIndex(myAddress, descriptorSize, extraSize);\\nint orientationEncoderLength = textureSize(encodedOrientations, 0).x;\\nivec2 location = ivec2(myIndex % orientationEncoderLength, myIndex / orientationEncoderLength);\\nvec4 targetPixel = pixelAt(encodedOrientations, location);\\nKeypoint keypoint = decodeKeypoint(encodedKeypoints, encoderLength, myAddress);\\nbool isValid = !isBadKeypoint(keypoint);\\nfloat encodedOrientation = targetPixel.g;\\ncolor = isValid && myAddress.offset == 1 ? vec4(pixel.r, encodedOrientation, pixel.ba) : pixel;\\n}\"\n\n/***/ }),\n\n/***/ 6187:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform sampler2D encodedData;\\nuniform int strideOfEncodedData;\\nuniform sampler2D encodedKeypoints;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\nvec4 readEncodedData(sampler2D encodedData, int strideOfEncodedData, int elementId, int pixelsPerElement, int pixelOffset)\\n{\\nint rasterIndex = elementId * pixelsPerElement + pixelOffset;\\nivec2 pos = ivec2(rasterIndex % strideOfEncodedData, rasterIndex / strideOfEncodedData);\\nreturn texelFetch(encodedData, pos, 0);\\n}\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nKeypointAddress myAddress = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nint myIndex = findKeypointIndex(myAddress, descriptorSize, extraSize);\\nint headerSize = sizeofEncodedKeypointHeader();\\nint extraCell = myAddress.offset - headerSize / 4;\\nint numberOfExtraCells = extraSize / 4;\\ncolor = threadPixel(encodedKeypoints);\\nif(extraCell < 0 || extraCell >= numberOfExtraCells)\\nreturn;\\nKeypoint keypoint = decodeKeypoint(encodedKeypoints, encoderLength, myAddress);\\nif(isBadKeypoint(keypoint))\\nreturn;\\ncolor = readEncodedData(encodedData, strideOfEncodedData, myIndex, numberOfExtraCells, extraCell);\\n}\"\n\n/***/ }),\n\n/***/ 477:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"keypoints.glsl\\\"\\nuniform sampler2D encodedKeypoints;\\nuniform int startIndex;\\nuniform int endIndex;\\nuniform int descriptorSize;\\nuniform int extraSize;\\nuniform int encoderLength;\\n#ifndef BUFFER_SIZE\\n#error Undefined BUFFER_SIZE\\n#endif\\nlayout(std140) uniform KeypointBuffer\\n{\\nvec4 keypointBuffer[BUFFER_SIZE];\\n};\\nvoid main()\\n{\\nvec4 pixel = threadPixel(encodedKeypoints);\\nivec2 thread = threadLocation();\\nKeypointAddress address = findKeypointAddress(thread, encoderLength, descriptorSize, extraSize);\\nint index = findKeypointIndex(address, descriptorSize, extraSize);\\ncolor = pixel;\\nif(index < startIndex)\\nreturn;\\ncolor = encodeNullKeypoint();\\nif(index >= endIndex)\\nreturn;\\nvec4 data = keypointBuffer[index - startIndex];\\nswitch(address.offset) {\\ncase 0: {\\ncolor = encodeKeypointPosition(data.xy);\\nbreak;\\n}\\ncase 1: {\\nvec2 score = encodeKeypointScore(max(data.w, 0.0f));\\nfloat scale = encodeLod(data.z);\\nfloat rotation = encodeKeypointOrientation(0.0f);\\ncolor = vec4(scale, rotation, score);\\nbreak;\\n}\\ndefault: {\\ncolor = vec4(0.0f);\\nbreak;\\n}\\n}\\n}\"\n\n/***/ }),\n\n/***/ 4050:\n/***/ ((module) => {\n\nmodule.exports = \"uniform sampler2D image;\\nvoid main()\\n{\\n#if 1\\ncolor = texture(image, texCoord);\\n#else\\nivec2 thread = threadLocation();\\nivec2 pos = min(thread * 2, textureSize(image, 0) - ivec2(1));\\ncolor = pixelAt(image, pos);\\n#endif\\n}\"\n\n/***/ }),\n\n/***/ 5545:\n/***/ ((module) => {\n\nmodule.exports = \"uniform sampler2D image;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nvec4 pixel = pixelAt(image, thread / 2);\\ncolor = (((thread.x + thread.y) & 1) == 0) ? pixel : vec4(0.0f, 0.0f, 0.0f, pixel.a);\\n}\"\n\n/***/ }),\n\n/***/ 7113:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"subpixel.glsl\\\"\\nuniform sampler2D image0;\\nuniform sampler2D image1;\\nuniform float alpha;\\nuniform float beta;\\nuniform float gamma;\\nconst vec4 BACKGROUND = vec4(0.0f);\\nvoid main()\\n{\\nivec2 location = threadLocation();\\nivec2 size0 = textureSize(image0, 0);\\nivec2 size1 = textureSize(image1, 0);\\nvec4 pix0 = all(lessThan(location, size0)) ? pixelAt(image0, location) : BACKGROUND;\\nvec4 pix1 = all(lessThan(location, size1)) ? pixelAt(image1, location) : BACKGROUND;\\nvec4 pix = clamp(alpha * pix0 + beta * pix1 + vec4(gamma), 0.0f, 1.0f);\\ncolor = vec4(pix.rgb, 1.0f);\\n}\"\n\n/***/ }),\n\n/***/ 1202:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"subpixel.glsl\\\"\\nuniform sampler2D image;\\nvoid main()\\n{\\nvec2 imageSize = vec2(textureSize(image, 0));\\n#if !defined(INTERPOLATION_METHOD)\\n#error Must define INTERPOLATION_METHOD\\n#elif INTERPOLATION_METHOD == 0\\nvec2 pos = texCoord * imageSize;\\ncolor = textureLod(image, (round(pos) + vec2(0.5f)) / imageSize, 0.0f);\\n#elif INTERPOLATION_METHOD == 1\\ncolor = subpixelAtBI(image, texCoord * imageSize);\\n#else\\n#error Invalid INTERPOLATION_METHOD\\n#endif\\n}\"\n\n/***/ }),\n\n/***/ 7971:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"subpixel.glsl\\\"\\nuniform sampler2D image;\\nuniform mat3 inverseHomography;\\nconst vec4 emptyColor = vec4(0.0f, 0.0f, 0.0f, 1.0f);\\nvec2 perspectiveWarp(mat3 homography, vec2 p)\\n{\\nvec3 q = homography * vec3(p, 1.0f);\\nreturn q.xy / q.z;\\n}\\nvoid main()\\n{\\nivec2 location = threadLocation();\\nivec2 size = outputSize();\\nconst vec2 zero = vec2(0.0f);\\nvec2 target = perspectiveWarp(inverseHomography, vec2(location));\\nbool withinBounds = all(bvec4(greaterThanEqual(target, zero), lessThan(target, vec2(size))));\\ncolor = withinBounds ? subpixelAtBI(image, target) : emptyColor;\\n}\"\n\n/***/ }),\n\n/***/ 6122:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"colors.glsl\\\"\\nuniform sampler2D dest, src;\\nuniform int destComponents;\\nuniform int srcComponentId;\\nvoid main()\\n{\\nvec4 destPixel = threadPixel(dest);\\nvec4 srcPixel = threadPixel(src);\\nbvec4 flags = bvec4(\\n(destComponents & PIXELCOMPONENT_RED) != 0,\\n(destComponents & PIXELCOMPONENT_GREEN) != 0,\\n(destComponents & PIXELCOMPONENT_BLUE) != 0,\\n(destComponents & PIXELCOMPONENT_ALPHA) != 0\\n);\\ncolor = mix(destPixel, vec4(srcPixel[srcComponentId]), flags);\\n}\"\n\n/***/ }),\n\n/***/ 371:\n/***/ ((module) => {\n\nmodule.exports = \"#if !defined(TYPE)\\n#error Undefined TYPE\\n#elif TYPE == 1\\n@include \\\"keypoints.glsl\\\"\\n#define nullPixel() encodeNullKeypoint()\\n#elif TYPE == 2\\n@include \\\"float16.glsl\\\"\\n#define nullPixel() encodeNullPairOfFloat16()\\n#else\\n#error Invalid TYPE\\n#endif\\nuniform sampler2D image;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nivec2 imageSize = textureSize(image, 0);\\nint rasterIndex = thread.y * outputSize().x + thread.x;\\nbool isValidPixel = rasterIndex < imageSize.x * imageSize.y;\\nivec2 pos = ivec2(rasterIndex % imageSize.x, rasterIndex / imageSize.x);\\nvec4 nullpix = nullPixel();\\ncolor = isValidPixel ? texelFetch(image, pos, 0) : nullpix;\\n}\"\n\n/***/ }),\n\n/***/ 7307:\n/***/ ((module) => {\n\nmodule.exports = \"uniform sampler2D image;\\nvoid main()\\n{\\ncolor = threadPixel(image);\\n}\"\n\n/***/ }),\n\n/***/ 8614:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"colors.glsl\\\"\\nuniform sampler2D image;\\nuniform int pixelComponents;\\nuniform float value;\\nvoid main()\\n{\\nvec4 pixel = threadPixel(image);\\nbvec4 flags = bvec4(\\n(pixelComponents & PIXELCOMPONENT_RED) != 0,\\n(pixelComponents & PIXELCOMPONENT_GREEN) != 0,\\n(pixelComponents & PIXELCOMPONENT_BLUE) != 0,\\n(pixelComponents & PIXELCOMPONENT_ALPHA) != 0\\n);\\ncolor = mix(pixel, vec4(value), flags);\\n}\"\n\n/***/ }),\n\n/***/ 6271:\n/***/ ((module) => {\n\nmodule.exports = \"uniform float value;\\nvoid main()\\n{\\ncolor = vec4(value);\\n}\"\n\n/***/ }),\n\n/***/ 3016:\n/***/ ((module) => {\n\nmodule.exports = \"void vsmain()\\n{\\ngl_Position *= vec4(1,-1,1,1);\\n}\"\n\n/***/ }),\n\n/***/ 3630:\n/***/ ((module) => {\n\nmodule.exports = \"uniform sampler2D image;\\nuniform int iterationNumber;\\nvoid main()\\n{\\nivec2 thread = threadLocation();\\nivec2 last = outputSize() - ivec2(1);\\nint jump = (1 << iterationNumber);\\nint clusterLength = jump << 1;\\nint clusterMask = clusterLength - 1;\\nivec2 clusterPos = ivec2(thread >> (1 + iterationNumber)) << (1 + iterationNumber);\\nivec2 next1 = clusterPos + ((thread - clusterPos + ivec2(jump, 0)) & clusterMask);\\nivec2 next2 = clusterPos + ((thread - clusterPos + ivec2(0, jump)) & clusterMask);\\nivec2 next3 = clusterPos + ((thread - clusterPos + ivec2(jump, jump)) & clusterMask);\\nvec4 p0 = texelFetch(image, thread, 0);\\nvec4 p1 = texelFetch(image, min(next1, last), 0);\\nvec4 p2 = texelFetch(image, min(next2, last), 0);\\nvec4 p3 = texelFetch(image, min(next3, last), 0);\\nvec4 pmax = max(max(p0, p1), max(p2, p3));\\nvec4 pmin = min(min(p0, p1), min(p2, p3));\\ncolor = vec4(pmax.r, pmin.g, pmax.r - pmin.g, p0.a);\\n}\"\n\n/***/ }),\n\n/***/ 8508:\n/***/ ((module) => {\n\nmodule.exports = \"@include \\\"pyramids.glsl\\\"\\n@include \\\"float16.glsl\\\"\\nuniform sampler2D pyramid;\\nuniform float lod;\\n#define USE_VARYINGS 1\\nin vec2 v_pix0, v_pix1, v_pix2,\\nv_pix3, v_pix4, v_pix5,\\nv_pix6, v_pix7, v_pix8;\\nconst mat3 hkern = mat3(\\n1.0f, 0.0f,-1.0f,\\n2.0f, 0.0f,-2.0f,\\n1.0f, 0.0f,-1.0f\\n), vkern = mat3(\\n1.0f, 2.0f, 1.0f,\\n0.0f, 0.0f, 0.0f,\\n-1.0f,-2.0f,-1.0f\\n);\\n#define PIX(x,y) pyrPixelAtOffset(pyramid, lod, pot, ivec2((x),(y))).g\\n#define XIP(v) textureLod(pyramid, (v), lod).g\\nvoid main()\\n{\\nconst vec3 ones = vec3(1.0f);\\nfloat pot = exp2(lod);\\nmat3 win = mat3(\\n#if USE_VARYINGS\\nXIP(v_pix0), XIP(v_pix1), XIP(v_pix2),\\nXIP(v_pix3), XIP(v_pix4), XIP(v_pix5),\\nXIP(v_pix6), XIP(v_pix7), XIP(v_pix8)\\n#else\\nPIX(-1,-1), PIX(0,-1), PIX(1,-1),\\nPIX(-1,0), PIX(0,0), PIX(1,0),\\nPIX(-1,1), PIX(0,1), PIX(1,1)\\n#endif\\n);\\nmat3 dx = matrixCompMult(hkern, win);\\nmat3 dy = matrixCompMult(vkern, win);\\nvec2 df = vec2(\\ndot(dx[0] + dx[1] + dx[2], ones),\\ndot(dy[0] + dy[1] + dy[2], ones)\\n);\\ncolor = encodePairOfFloat16(df);\\n}\"\n\n/***/ }),\n\n/***/ 8073:\n/***/ ((module) => {\n\nmodule.exports = \"uniform mediump float lod;\\nout vec2 v_pix0, v_pix1, v_pix2,\\nv_pix3, v_pix4, v_pix5,\\nv_pix6, v_pix7, v_pix8;\\n#define PIX(x,y) (texCoord + ((pot) * vec2((x),(y))) / texSize)\\nvoid vsmain()\\n{\\nfloat pot = exp2(lod);\\nv_pix0 = PIX(-1,-1); v_pix1 = PIX(0,-1); v_pix2 = PIX(1,-1);\\nv_pix3 = PIX(-1,0); v_pix4 = PIX(0,0); v_pix5 = PIX(1,0);\\nv_pix6 = PIX(-1,1); v_pix7 = PIX(0,1); v_pix8 = PIX(1,1);\\n}\"\n\n/***/ }),\n\n/***/ 3575:\n/***/ ((module) => {\n\nmodule.exports = `AGFzbQEAAAABiwETYAABfmADf39/AX9gAX8AYAN/f38AYAF9AX9gAX8Bf2ACf38Bf2AFf39/f38B\nf2AFf39/f38AYAZ/f39/f38Bf2AAAX9gAn99AX9gA39/fQF/YAJ/fwF9YAF/AX1gBH9/f38AYAR/\nf39/AX9gEX98fHx8fHx8fHx8fHx8fHx8AGAHf39/f39/fQF/AjsEA2VudgZtZW1vcnkCAAIDZW52\nBWZhdGFsAAIDZW52CGJ5dGVmaWxsAAMDZW52CmNvcHlXaXRoaW4AAwNAPwQFBgIGAQECBwgGAwAJ\nAgYCBgYKBQUFCQsFBgEBDAEBBgYGAQEMAQ0OAwgPAxAIAwYBEQEBAQEBARIBEgEBDwQFAXABBQUG\nCAF/AUHwmgQLB/QDHAZtYWxsb2MABARmcmVlAAYFc3JhbmQACgxNYXQzMl9jcmVhdGUAEA1NYXQz\nMl9kZXN0cm95ABcKTWF0MzJfZGF0YQAYDk1hdDMyX2RhdGFTaXplABkPTWF0MzJfdHJhbnNwb3Nl\nAB0JTWF0MzJfYWRkAB4OTWF0MzJfc3VidHJhY3QAHwtNYXQzMl9zY2FsZQAgDk1hdDMyX2NvbXBt\ndWx0ACEOTWF0MzJfbXVsdGlwbHkAIg5NYXQzMl9pbnZlcnNlMQAjDk1hdDMyX2ludmVyc2UyACQO\nTWF0MzJfaW52ZXJzZTMAJQ1NYXQzMl9xcl9mdWxsACwQTWF0MzJfcXJfcmVkdWNlZAAvDE1hdDMy\nX3FyX29scwAwEE1hdDMyX3FyX2ludmVyc2UAMxZNYXQzMl9ob21vZ3JhcGh5X25kbHQ0ADcVTWF0\nMzJfaG9tb2dyYXBoeV9uZGx0ADgUTWF0MzJfYWZmaW5lX2RpcmVjdDMAOhNNYXQzMl9hZmZpbmVf\nZGlyZWN0ADsYTWF0MzJfcHJhbnNhY19ob21vZ3JhcGh5ADwUTWF0MzJfcHJhbnNhY19hZmZpbmUA\nPhtNYXQzMl90cmFuc2Zvcm1fcGVyc3BlY3RpdmUAPxZNYXQzMl90cmFuc2Zvcm1fYWZmaW5lAEAJ\nCgEAQQELBA8REz0Kh7oBPyMBAX8gALwiAUGAgID8B3FBgICA/AdGIAFB////A3FBAEdxC2kBAX9B\nAEEAKALAmoCAAEEBajYCwJqAgABBAEEAKAK0moCAACIBQQdxIAFqIgEgAGo2ArSagIAAAkBB8JqE\n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\noZlEje21oPfGsD5jDQAgHCAFoiIYIB8gA6KhIiIgFCAIoiAcIAaiIh6gIiOiIB4gHyAEoqEiHiAU\nIAeiIBigIhiioSIkmUSN7bWg98awPmMNACAcmiIlIBShIiYgIqIgHyAcoSIiIBiioUQAAAAAAADw\nPyAkoyIkoiEYICIgI6IgJiAeoqEgJKIhHgJAAkAgHSAgZEEBcw0AIBMgGCAEoiAeIAOiRAAAAAAA\nAPA/oKAiBKIgJaMhHSAcIR8MAQsgEyAYIAaiIB4gBaJEAAAAAAAA8D+goCIEoiAfmqMhHQsgFyAE\noiAfoyETAkACQCAhICWZZEEBcw0AIBogGCAGoiAeIAWiRAAAAAAAAPA/oKAiBKIgFJqjIQcMAQsg\nGiAYIAiiIB4gB6JEAAAAAAAA8D+goCIEoiAcoyEHICUhFAsgGCAdmiABoiATIAKioSIXIAeioiAd\nIBsgBKIgFKMiFKIgHiATIAeaIAGiIBQgAqKhIhyioqCgIBMgB6KhIBggHSAcoqKhIB4gFyAUoqKh\nmUSN7bWg98awPmMNACALIA2hIhsgECAOoSIaoiAWIA8gDaEiH6KhIiCZRI3ttaD3xrA+Yw0AIBEh\nBCARIQIgESEGIBEhDiARIQEgESEDIBEhBSARIQggGyAVIBmgIhWiIBYgCSALoSANIA+hoCIZoqFE\nAAAAAAAA8D8gIKMiFqIiDSAMIAqhIBogGaIgHyAVoqEgFqIiFiAMoqAiDCAJoqIgCyAJoSAWIAui\noCILIBIgDSAQoqAiEKIgFiAPIAmhIA0gD6KgIg8gCqKioKAgDyAMoqEgDSALIAqioqEgFiAQIAmi\noqGZRI3ttaD3xrA+Yw0BIBYgF6IgDSAcoqBEAAAAAAAA8D+gIQUgGCAWIBOiIA0gFKKgoCEDIB4g\nFiAdoiANIAeioKAhASAMIBeiIBAgHKKgIAqgIQ4gGCAKoiAMIBOiIBAgFKKgoCEGIB4gCqIgDCAd\noiAQIAeioKAhAiALIBeiIA8gHKKgIAmgIQQgGCAJoiALIBOiIA8gFKKgoCERIB4gCaIgCyAdoiAP\nIAeioKAhCAwBCyARIQQgESECIBEhBiARIQ4gESEBIBEhAyARIQUgESEICyAAKAIAIicgCLY4AgAg\nJyAAQRRqKAIAIihBAnRqIBG2OAIAICcgKEEDdGogBLY4AgAgJyAAKAIQIgBBAnRqIAK2OAIAICcg\nACAoaiIpQQJ0aiAGtjgCACAnIAAgKEEBdGpBAnRqIA62OAIAICcgAEEDdGogAbY4AgAgJyAoIABB\nAXRqQQJ0aiADtjgCACAnIClBA3RqIAW2OAIAC7oHAhZ/Cn0CQAJAIAAoAghBA0cNACAAKAIMQQNH\nDQAgASgCCEECRw0AIAEoAgwiA0EESA0AIAIoAghBAkcNACACKAIMIANGDQELQbKTgIAAEICAgIAA\nIAEoAgwhAwsgA0EBdCIEQQgQkoCAgAAhBSAEQQEQkoCAgAAhBkEIQQEQkoCAgAAhBwJAIANBAUgN\nACAFQRRqKAIAIgRBDGwgBSgCECIIQQJ0IglqIQogBEEEdCAJaiELIARBFGwgCWohDCAEQRhsIg0g\nCWohDiAEQRxsIg8gCWohECACKAIQQQJ0IREgASgCEEECdCESIAhBA3QhCCAGKAIQIglBA3QhEyAJ\nQQJ0IRQgAkEUaigCAEECdCEVIAFBFGooAgBBAnQhFiAEQQN0IRcgBEECdCEYIAYoAgAhCSAFKAIA\nIQQgAigCACECIAEoAgAhAQNAIAIgEWoqAgAhGSABIBJqKgIAIRogAioCACEbIAQgASoCACIcOAIA\nIAQgGGogGjgCACAEIBdqQYCAgPwDNgIAIAQgCmogHDgCACAEIAtqIBo4AgAgBCAMakGAgID8AzYC\nACAEIA1qIBsgHIwiHJQ4AgAgBCAOaiAZIByUOAIAIAQgD2ogGyAajCIalDgCACAEIBBqIBkgGpQ4\nAgAgCSAbOAIAIAkgFGogGTgCACACIBVqIQIgASAWaiEBIAQgCGohBCAJIBNqIQkgA0F/aiIDDQAL\nCyAHIAUgBkEDELCAgIAAGgJAAkAgBygCACIEKgIAIhkgBCAHKAIQIglBBHRqKgIAIhqUIAQgCUEC\ndGoqAgAiGyAEIAlBFGxqKgIAIhyUIAQgCUEYbGoqAgAiHZSSIAQgCUEDdGoqAgAiHiAEIAlBDGxq\nKgIAIh+UIAQgCUEcbGoqAgAiIJSSIBsgH5STIBkgHJQgIJSTIB4gGpQgHZSTIiEQg4CAgAANAEMA\nAIA/ISIgIYu7RI3ttaD3xrA+Y0EBcw0BC0EAKgKAiICAACIZIRsgGSEeIBkhHyAZIRogGSEcIBkh\nHSAZISAgGSEiCyAAKAIAIgQgGTgCACAEIABBFGooAgAiCUECdGogGzgCACAEIAlBA3RqIB44AgAg\nBCAAKAIQIgJBAnRqIB84AgAgBCACIAlqIgFBAnRqIBo4AgAgBCACIAlBAXRqQQJ0aiAcOAIAIAQg\nAkEDdGogHTgCACAEIAkgAkEBdGpBAnRqICA4AgAgBCABQQN0aiAiOAIAIAcQl4CAgAAaIAYQl4CA\ngAAaIAUQl4CAgAAaIAALnwgKAX8BfQF/An0Bfwp9AX8BfQN/AX0CQAJAIAAoAghBA0cNACAAKAIM\nQQNHDQAgASgCCEECRw0AIAEoAgxBBEcNACACKAIIQQJHDQAgAigCDEEERg0BC0HZk4CAABCAgICA\nAAsgACABKAIAIgMqAgAiBCAEIAMgAUEUaigCACIFQQJ0aioCACIGkiADIAVBA3RqKgIAIgeSIAMg\nBUEDbCIIQQJ0aioCACIJkkMAAIA+lCIKkyIEQwAAAEEgAyAIIAEoAhAiAWpBAnRqKgIAIgsgCyAD\nIAFBAnRqKgIAIgwgAyAFIAFqQQJ0aioCACINkiADIAVBAXQgAWpBAnRqKgIAIg6SkkMAAIA+lCIP\nkyILIAuUIAkgCpMiCSAJlCAOIA+TIg4gDpQgByAKkyIHIAeUIA0gD5MiDSANlCAGIAqTIgYgBpQg\nBCAElCAMIA+TIgwgDJSSkpKSkpKSlZEiBJS7IAwgBJS7IAYgBJS7IA0gBJS7IAcgBJS7IA4gBJS7\nIAkgBJS7IAsgBJS7IAIoAgAiAyoCACILIAsgAyACQRRqKAIAIgVBAnRqKgIAIhCSIAMgBUEDdGoq\nAgAiDJIgAyAFQQNsIghBAnRqKgIAIg2SQwAAgD6UIgmTIgtDAAAAQSADIAggAigCECIBakECdGoq\nAgAiDiAOIAMgAUECdGoqAgAiESADIAUgAWpBAnRqKgIAIhKSIAMgBUEBdCABakECdGoqAgAiBpKS\nQwAAgD6UIg6TIgcgB5QgDSAJkyINIA2UIAYgDpMiBiAGlCAMIAmTIgwgDJQgEiAOkyISIBKUIBAg\nCZMiECAQlCALIAuUIBEgDpMiESARlJKSkpKSkpKVkSILlLsgESALlLsgECALlLsgEiALlLsgDCAL\nlLsgBiALlLsgDSALlLsgByALlLsQtYCAgAAgACgCACIDIABBFGooAgAiBUEBdCICIAAoAhAiAUEB\ndCIIakECdGoqAgAhECADIAggBWpBAnRqIggqAgAhByADIAIgAWpBAnRqIgIqAgAhESADIAVBA3Rq\nIhMqAgAhFCADIAUgAWoiFUECdGoiFioCACEGIAMgBUECdGoiBSoCACEMIAMgAUECdGoiFyoCACES\nIAMgBCAJIAMgAUEDdGoiASoCACINlCADKgIAIhhDAACAPyALlSILlJKUOAIAIBcgBCAOIA2UIBIg\nC5SSlDgCACABIAQgDZQ4AgAgBSAEIAkgB5QgDCALlJKUOAIAIBYgBCAOIAeUIAYgC5SSlDgCACAI\nIAQgB5Q4AgAgEyAUIAQgCiAYlCAPIAyUkpSTIAuUIAkgECAEIAogDZQgDyAHlJKUkyIHlJI4AgAg\nAiARIAQgCiASlCAPIAaUkpSTIAuUIA4gB5SSOAIAIAMgFUEDdGogBzgCACAAC5sCAQZ/AkACQCAA\nKAIIQQNHDQAgACgCDEEDRw0AIAEoAghBAkcNACABKAIMIgNBBEgNACACKAIIQQJHDQAgAigCDCAD\nRg0BC0GAlICAABCAgICAACABKAIMIQMLQQIgAxCSgICAACEEQQIgAxCSgICAACEFQQNBAxCSgICA\nACEGQQNBAxCSgICAACEHQQNBAxCSgICAACEIIAQgASAGQQNBAxCSgICAACIDEMGAgIAAIAUgAiAD\nIAcQwYCAgAAgAyAIIAQgBRC2gICAACIBIAYQp4CAgAAaIAAgByADEKeAgIAAGiADEJeAgIAAGiAB\nEJeAgIAAGiAHEJeAgIAAGiAGEJeAgIAAGiAFEJeAgIAAGiAEEJeAgIAAGiAAC/kFAhZ/Bn0CQAJA\nIAAoAghBAkcNACAAKAIMQQNHDQAgASgCCEECRw0AIAEoAgwiA0EDSA0AIAIoAghBAkcNACACKAIM\nIANGDQELQaeUgIAAEICAgIAAIAEoAgwhAwsgA0EBdCIEQQYQkoCAgAAhBSAEQQEQkoCAgAAhBkEG\nQQEQkoCAgAAhBwJAIANBAUgNACAFQRRqKAIAIgRBDGwgBSgCECIIQQJ0IglqIQogBEEEdCAJaiEL\nIARBFGwgCWohDCACKAIQQQJ0IQ0gASgCEEECdCEOIAhBA3QhDyAGKAIQIglBA3QhECAJQQJ0IREg\nAkEUaigCAEECdCESIAFBFGooAgBBAnQhEyAEQQN0IRQgBEECdCEVIAYoAgAhCSAFKAIAIQQgAigC\nACECIAEoAgAhAQNAIAIgDWooAgAhFiABIA5qKAIAIQggAigCACEXIAQgASgCACIYNgIAIAQgFWog\nCDYCACAEIBRqQYCAgPwDNgIAIAQgCmogGDYCACAEIAtqIAg2AgAgBCAMakGAgID8AzYCACAJIBc2\nAgAgCSARaiAWNgIAIAIgEmohAiABIBNqIQEgBCAPaiEEIAkgEGohCSADQX9qIgMNAAsLIAcgBSAG\nQQMQsICAgAAaAkACQCAHKAIAIgQqAgAiGSAEIAcoAhAiCUECdGoqAgAiGpIgBCAJQQN0aioCACIb\nkiAEIAlBDGxqKgIAIhySIAQgCUEEdGoqAgAiHZIgBCAJQRRsaioCACIekhCDgICAAA0AIBkgHZQg\nGiAclJOLu0SN7bWg98awPmNBAXMNAQtBACoCgIiAgAAiGSEaIBkhGyAZIRwgGSEdIBkhHgsgACgC\nACIEIBk4AgAgBCAAQRRqKAIAIglBAnRqIBo4AgAgBCAJQQN0aiAbOAIAIAQgACgCECICQQJ0aiAc\nOAIAIAQgAiAJakECdGogHTgCACAEIAIgCUEBdGpBAnRqIB44AgAgBxCXgICAABogBhCXgICAABog\nBRCXgICAABogAAvNBQMBfAJ/FXwCQAJAIAAoAghBAkcNACAAKAIMQQNHDQAgASgCCEECRw0AIAEo\nAgxBA0cNACACKAIIQQJHDQAgAigCDEEDRg0BC0HKlICAABCAgICAAAtBACoCgIiAgAC7IQMCQAJA\nIAEoAgAiBCABKAIQIgVBAnRqKgIAuyIGIAQgAUEUaigCACIBIAVqQQJ0aioCALsiB6EiCCAEIAFB\nA3RqKgIAuyIJoiAHIAQgAUEBdCAFakECdGoqAgC7IgqhIgsgBCoCALsiDKIgCiAGoSINIAQgAUEC\ndGoqAgC7Ig6ioKAiD5lEje21oPfGsD5jDQAgAigCACIEIAIoAhAiBUECdGoqAgC7IhAgBCACQRRq\nKAIAIgEgBWpBAnRqKgIAuyIRoSAEIAFBA3RqKgIAuyISoiARIAQgAUEBdCAFakECdGoqAgC7IhOh\nIAQqAgC7IhSiIBMgEKEgBCABQQJ0aioCALsiFaKgoJlEje21oPfGsD5jDQBEAAAAAAAA8D8gD6Mi\nFiALIBSiIA0gFaKgIAggEqKgoiIPIBYgCSAOoSIXIBCiIAwgCaEiGCARoqAgDiAMoSIZIBOioKIi\nGqIgFiAXIBSiIBggFaKgIBkgEqKgoiIXIBYgCyAQoiANIBGioCAIIBOioKIiCKKhmUSN7bWg98aw\nPmNBAXNFDQAgFiAOIAqiIAcgCaKhIgMgEKIgBiAJoiAMIAqioSIKIBGioCAMIAeiIAYgDqKhIgcg\nE6KgoiEGIBYgAyAUoiAKIBWioCAHIBKioKIhAwwBCyADIQ8gAyEXIAMhCCADIRogAyEGCyAAKAIA\nIgQgD7Y4AgAgBCAAQRRqKAIAIgFBAnRqIBe2OAIAIAQgAUEDdGogA7Y4AgAgBCAAKAIQIgVBAnRq\nIAi2OAIAIAQgBSABakECdGogGrY4AgAgBCAFIAFBAXRqQQJ0aiAGtjgCACAAC4EDAQl/AkACQCAA\nKAIIQQJHDQAgACgCDEEDRw0AIAEoAghBAkcNACABKAIMIgNBA0gNACACKAIIQQJHDQAgAigCDCAD\nRg0BC0HtlICAABCAgICAACABKAIMIQMLQQIgAxCSgICAACEEQQIgAxCSgICAACEFQQNBAxCSgICA\nACEGQQNBAxCSgICAACEHQQNBAxCUgICAACEIEJaAgIAAIAhBAEEBQQBBAhCagICAACEJQQNBAxCS\ngICAACEDQQNBAxCSgICAACEKEJaAgIAAIApBAEEBQQBBAhCagICAACELIAQgASAGIAMQwYCAgAAg\nBSACIAMgBxDBgICAACAJIAQgBRC5gICAACEBIAMgCCAGEKeAgIAAGiAKIAcgAxCngICAABogACAL\nEJWAgIAAGiALEJeAgIAAGiAKEJeAgIAAGiADEJeAgIAAGiABEJeAgIAAGiAIEJeAgIAAGiAHEJeA\ngIAAGiAGEJeAgIAAGiAFEJeAgIAAGiAEEJeAgIAAGiAAC5kUAhx/DX0jgICAgABBEGsiBySAgICA\nAAJAAkAgACgCCEEDRw0AIAAoAgxBA0cNACACKAIIQQJHDQAgAigCDCIIQQRIDQAgAygCCEECRw0A\nIAMoAgwgCEcNAAJAIAFFDQAgASgCCEEBRw0BIAEoAgwgCEcNAQsgBEEBSA0AIAVBAUgNACAGQwAA\nAABgDQELQZCVgIAAEICAgIAAIAIoAgwhCAsCQCABRQ0AIAFDAAAAABCbgICAABoLIAhBAnQiCUGy\nlYCAABCFgICAACEKIAlB0ZWAgAAQhYCAgAAgCBCNgICAACILIAhBBBCOgICAACAIIARBAnQiDCAI\nb2sgDGoiDUECdEHwlYCAABCFgICAACEOAkAgDUEBSA0AQQAhDyAIQQFIIRAgDiERA0ACQCAQDQBB\n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\nNgIACwv2EgMAQYAIC7ISAAD4f091dCBvZiBtZW1vcnkhAERvdWJsZSBmcmVlAEFzc2VydGlvbiBm\nYWlsZWQgYXQgbWF0MzIuYzo2MQBPdXQgb2YgbWVtb3J5IGF0IG1hdDMyLmM6NjMAQXNzZXJ0aW9u\nIGZhaWxlZCBhdCBtYXQzMi5jOjg0AE91dCBvZiBtZW1vcnkgYXQgbWF0MzIuYzo4NgBPdXQgb2Yg\nbWVtb3J5IGF0IG1hdDMyLmM6ODkAT3V0IG9mIG1lbW9yeSBhdCBtYXQzMi5jOjEzNgAAAGANAAAB\nAAAAAAAAAAAAAAABAAAAAQAAAAIAAABEb3VibGUgZnJlZSBhdCBtYXQzMi5jOjE0OQBBc3NlcnRp\nb24gZmFpbGVkIGF0IG1hdDMyLmM6MTg0AEFzc2VydGlvbiBmYWlsZWQgYXQgbWF0MzIuYzoxODgA\nQXNzZXJ0aW9uIGZhaWxlZCBhdCBtYXQzMi5jOjI3NQBEb3VibGUgZnJlZSBhdCBtYXQzMi5jOjI5\nAEFzc2VydGlvbiBmYWlsZWQgYXQgYXJpdGhtZXRpYzMyLmM6MzYAQXNzZXJ0aW9uIGZhaWxlZCBh\ndCBhcml0aG1ldGljMzIuYzo1OABBc3NlcnRpb24gZmFpbGVkIGF0IGFyaXRobWV0aWMzMi5jOjgw\nAEFzc2VydGlvbiBmYWlsZWQgYXQgYXJpdGhtZXRpYzMyLmM6OTkAQXNzZXJ0aW9uIGZhaWxlZCBh\ndCBhcml0aG1ldGljMzIuYzoxMjEAQXNzZXJ0aW9uIGZhaWxlZCBhdCBhcml0aG1ldGljMzIuYzox\nNDMAQXNzZXJ0aW9uIGZhaWxlZCBhdCBhcml0aG1ldGljMzIuYzoxNjgAQXNzZXJ0aW9uIGZhaWxl\nZCBhdCBhcml0aG1ldGljMzIuYzoxODkAQXNzZXJ0aW9uIGZhaWxlZCBhdCBhcml0aG1ldGljMzIu\nYzoyMTgAQXNzZXJ0aW9uIGZhaWxlZCBhdCBhcml0aG1ldGljMzIuYzoyNzEAQXNzZXJ0aW9uIGZh\naWxlZCBhdCBhcml0aG1ldGljMzIuYzozMjIAQXNzZXJ0aW9uIGZhaWxlZCBhdCBhcml0aG1ldGlj\nMzIuYzozNTYAQXNzZXJ0aW9uIGZhaWxlZCBhdCBhcml0aG1ldGljMzIuYzozNzgAQXNzZXJ0aW9u\nIGZhaWxlZCBhdCBhcml0aG1ldGljMzIuYzo0MjAAQXNzZXJ0aW9uIGZhaWxlZCBhdCBhcml0aG1l\ndGljMzIuYzo0MzYAQXNzZXJ0aW9uIGZhaWxlZCBhdCBxcjMyLmM6MjYxAEFzc2VydGlvbiBmYWls\nZWQgYXQgcXIzMi5jOjI2NQBBc3NlcnRpb24gZmFpbGVkIGF0IHFyMzIuYzoyODYAQXNzZXJ0aW9u\nIGZhaWxlZCBhdCBxcjMyLmM6MjkwAEFzc2VydGlvbiBmYWlsZWQgYXQgcXIzMi5jOjMyMQBBc3Nl\ncnRpb24gZmFpbGVkIGF0IHFyMzIuYzozMjUAQXNzZXJ0aW9uIGZhaWxlZCBhdCBxcjMyLmM6Mzc5\nAE91dCBvZiBtZW1vcnkgYXQgcXIzMi5jOjM2AEFzc2VydGlvbiBmYWlsZWQgYXQgcXIzMi5jOjY5\nAEFzc2VydGlvbiBmYWlsZWQgYXQgcXIzMi5jOjczAEFzc2VydGlvbiBmYWlsZWQgYXQgcXIzMi5j\nOjE4NABEb3VibGUgZnJlZSBhdCBxcjMyLmM6NTUAQXNzZXJ0aW9uIGZhaWxlZCBhdCBxcjMyLmM6\nMTQ4AEFzc2VydGlvbiBmYWlsZWQgYXQgcXIzMi5jOjIyNABBc3NlcnRpb24gZmFpbGVkIGF0IHFy\nMzIuYzoyMjgAQXNzZXJ0aW9uIGZhaWxlZCBhdCBob21vZ3JhcGh5MzIuYzoyNDQAQXNzZXJ0aW9u\nIGZhaWxlZCBhdCBob21vZ3JhcGh5MzIuYzoyODAAQXNzZXJ0aW9uIGZhaWxlZCBhdCBob21vZ3Jh\ncGh5MzIuYzozNTkAQXNzZXJ0aW9uIGZhaWxlZCBhdCBob21vZ3JhcGh5MzIuYzo0NDQAQXNzZXJ0\naW9uIGZhaWxlZCBhdCBhZmZpbmUzMi5jOjExOQBBc3NlcnRpb24gZmFpbGVkIGF0IGFmZmluZTMy\nLmM6MTk2AEFzc2VydGlvbiBmYWlsZWQgYXQgYWZmaW5lMzIuYzoyMjkAQXNzZXJ0aW9uIGZhaWxl\nZCBhdCByYW5zYWMzMi5jOjcxAE91dCBvZiBtZW1vcnkgYXQgcmFuc2FjMzIuYzo4NABPdXQgb2Yg\nbWVtb3J5IGF0IHJhbnNhYzMyLmM6ODgAT3V0IG9mIG1lbW9yeSBhdCByYW5zYWMzMi5jOjkzAE91\ndCBvZiBtZW1vcnkgYXQgcmFuc2FjMzIuYzoxMDcARG91YmxlIGZyZWUgYXQgcmFuc2FjMzIuYzoy\nMzYARG91YmxlIGZyZWUgYXQgcmFuc2FjMzIuYzoyNDMARG91YmxlIGZyZWUgYXQgcmFuc2FjMzIu\nYzoyNDYARG91YmxlIGZyZWUgYXQgcmFuc2FjMzIuYzoyNDkAQXNzZXJ0aW9uIGZhaWxlZCBhdCBy\nYW5zYWMzMi5jOjI3NQBPdXQgb2YgbWVtb3J5IGF0IHJhbnNhYzMyLmM6Mjg4AE91dCBvZiBtZW1v\ncnkgYXQgcmFuc2FjMzIuYzoyOTIAT3V0IG9mIG1lbW9yeSBhdCByYW5zYWMzMi5jOjI5NwBPdXQg\nb2YgbWVtb3J5IGF0IHJhbnNhYzMyLmM6MzExAERvdWJsZSBmcmVlIGF0IHJhbnNhYzMyLmM6NDM2\nAERvdWJsZSBmcmVlIGF0IHJhbnNhYzMyLmM6NDQzAERvdWJsZSBmcmVlIGF0IHJhbnNhYzMyLmM6\nNDQ2AERvdWJsZSBmcmVlIGF0IHJhbnNhYzMyLmM6NDQ5AEFzc2VydGlvbiBmYWlsZWQgYXQgdHJh\nbnNmb3JtMzIuYzozOQBBc3NlcnRpb24gZmFpbGVkIGF0IHRyYW5zZm9ybTMyLmM6NzcAQXNzZXJ0\naW9uIGZhaWxlZCBhdCB0cmFuc2Zvcm0zMi5jOjExNAAAQbQaCwwIAAAAUA0AAAEAAAAAQcAaCyQA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\n`\n\n/***/ })\n\n/******/ \t});\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tvar cachedModule = __webpack_module_cache__[moduleId];\n/******/ \t\tif (cachedModule !== undefined) {\n/******/ \t\t\treturn cachedModule.exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\t// no module.id needed\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/define property getters */\n/******/ \t(() => {\n/******/ \t\t// define getter functions for harmony exports\n/******/ \t\t__webpack_require__.d = (exports, definition) => {\n/******/ \t\t\tfor(var key in definition) {\n/******/ \t\t\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n/******/ \t\t\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n/******/ \t\t\t\t}\n/******/ \t\t\t}\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/hasOwnProperty shorthand */\n/******/ \t(() => {\n/******/ \t\t__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/make namespace object */\n/******/ \t(() => {\n/******/ \t\t// define __esModule on exports\n/******/ \t\t__webpack_require__.r = (exports) => {\n/******/ \t\t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t\t}\n/******/ \t\t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/************************************************************************/\nvar __webpack_exports__ = {};\n// This entry need to be wrapped in an IIFE because it need to be in strict mode.\n(() => {\n\"use strict\";\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  \"default\": () => (/* binding */ Speedy)\n});\n\n// EXTERNAL MODULE: ./src/gpu/speedy-gl.js\nvar speedy_gl = __webpack_require__(1001);\n// EXTERNAL MODULE: ./src/utils/utils.js\nvar utils = __webpack_require__(9037);\n// EXTERNAL MODULE: ./src/core/settings.js\nvar settings = __webpack_require__(2199);\n// EXTERNAL MODULE: ./src/core/speedy-promise.js\nvar speedy_promise = __webpack_require__(9192);\n;// CONCATENATED MODULE: ./src/utils/asap.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * asap.js\n * Schedule a function to run \"as soon as possible\"\n */\n\n/** callbacks */\nconst callbacks = /** @type {Function[]} */[];\n\n/** arguments to be passed to the callbacks */\nconst args = /** @type {any[][]} */[];\n\n/** asap key */\nconst ASAP_KEY = 'asap' + Math.random().toString(36).substr(1);\n\n// Register an event listener\nwindow.addEventListener('message', event => {\n  if (event.source !== window || event.data !== ASAP_KEY) return;\n  event.stopPropagation();\n  if (callbacks.length == 0) return;\n  const fn = callbacks.pop();\n  const argArray = args.pop();\n  fn.apply(undefined, argArray);\n}, true);\n\n/**\n * Schedule a function to run \"as soon as possible\"\n * @param {Function} fn callback\n * @param {any[]} params optional parameters\n */\nfunction asap(fn, ...params) {\n  callbacks.unshift(fn);\n  args.unshift(params);\n  window.postMessage(ASAP_KEY, '*');\n}\n// EXTERNAL MODULE: ./src/utils/errors.js\nvar utils_errors = __webpack_require__(8581);\n;// CONCATENATED MODULE: ./src/gpu/speedy-texture-reader.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-texture-reader.js\n * Reads data from textures\n */\n\n\n\n\n\n\n\n\n\n/** @type {number} number of PBOs; used to get a performance boost in gl.readPixels() */\nconst DEFAULT_NUMBER_OF_BUFFERS = 2;\n\n/** @type {(fn: Function, ...args: any[]) => number} Run function fn on the \"next frame\" */\nconst runOnNextFrame = navigator.userAgent.includes('Firefox') ? (fn, ...args) => setTimeout(fn, 10, ...args) :\n// RAF produces a warning on Firefox\n(fn, ...args) => requestAnimationFrame(() => fn.apply(undefined, args)); // reduce battery usage\n\n/**\n * Reads data from textures\n */\nclass SpeedyTextureReader {\n  /**\n   * Constructor\n   * @param {number} [numberOfBuffers]\n   */\n  constructor(numberOfBuffers = DEFAULT_NUMBER_OF_BUFFERS) {\n    utils/* Utils */.A.assert(numberOfBuffers > 0);\n\n    /** @type {boolean} is this object initialized? */\n    this._initialized = false;\n\n    /** @type {Uint8Array[]} pixel buffers for data transfers (each stores RGBA data) */\n    this._pixelBuffer = new Array(numberOfBuffers).fill(null).map(() => new Uint8Array(0));\n\n    /** @type {WebGLBuffer[]} Pixel Buffer Objects (PBOs) */\n    this._pbo = new Array(numberOfBuffers).fill(null);\n\n    /** @type {number} the index of the buffer that will be consumed in this frame */\n    this._consumerIndex = 0;\n\n    /** @type {number} the index of the buffer that will be produced next */\n    this._producerIndex = numberOfBuffers - 1;\n\n    /** @type {SpeedyPromise<void>[]} producer-consumer promises */\n    this._promise = Array.from({\n      length: numberOfBuffers\n    }, () => speedy_promise/* SpeedyPromise */.i.resolve());\n\n    /** @type {boolean[]} are the contents of the ith buffer being produced? */\n    this._busy = new Array(numberOfBuffers).fill(false);\n\n    /** @type {boolean[]} can the ith buffer be consumed? */\n    this._ready = new Array(numberOfBuffers).fill(true);\n  }\n\n  /**\n   * Initialize this object\n   * @param {SpeedyGPU} gpu\n   */\n  init(gpu) {\n    this._allocatePBOs(gpu);\n    gpu.subscribe(this._allocatePBOs, this, gpu);\n    this._initialized = true;\n  }\n\n  /**\n   * Release resources\n   * @param {SpeedyGPU} gpu\n   * @returns {null}\n   */\n  release(gpu) {\n    gpu.unsubscribe(this._allocatePBOs, this);\n    this._deallocatePBOs(gpu);\n    this._initialized = false;\n    return null;\n  }\n\n  /**\n   * Read pixels from a texture, synchronously.\n   * You may optionally specify a (x,y,width,height) sub-rectangle.\n   * @param {SpeedyDrawableTexture} texture a texture with a FBO\n   * @param {number} [x]\n   * @param {number} [y] \n   * @param {number} [width]\n   * @param {number} [height]\n   * @returns {Uint8Array} pixels in the RGBA format\n   */\n  readPixelsSync(texture, x = 0, y = 0, width = texture.width, height = texture.height) {\n    utils/* Utils */.A.assert(this._initialized);\n    const gl = texture.gl;\n    const fbo = texture.glFbo;\n\n    // clamp values\n    width = Math.max(0, Math.min(width, texture.width));\n    height = Math.max(0, Math.min(height, texture.height));\n    x = Math.max(0, Math.min(x, texture.width - width));\n    y = Math.max(0, Math.min(y, texture.height - height));\n\n    // buffer allocation\n    const sizeofBuffer = width * height * 4; // 4 bytes per pixel (RGBA)\n    this._reallocate(sizeofBuffer);\n\n    // lost context?\n    if (gl.isContextLost()) return this._pixelBuffer[0].subarray(0, sizeofBuffer);\n\n    // read pixels\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n    gl.readPixels(x, y, width, height, gl.RGBA, gl.UNSIGNED_BYTE, this._pixelBuffer[0]);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n    // done!\n    return this._pixelBuffer[0].subarray(0, sizeofBuffer);\n  }\n\n  /**\n   * Read pixels from a texture, asynchronously, with PBOs.\n   * You may optionally specify a (x,y,width,height) sub-rectangle.\n   * @param {SpeedyDrawableTexture} texture a texture with a FBO\n   * @param {number} [x]\n   * @param {number} [y] \n   * @param {number} [width]\n   * @param {number} [height]\n   * @param {boolean} [useBufferedDownloads] accelerate downloads by returning pixels from the texture of the previous call (useful for streaming)\n   * @returns {SpeedyPromise<Uint8Array>} resolves to an array of pixels in the RGBA format\n   */\n  readPixelsAsync(texture, x = 0, y = 0, width = texture.width, height = texture.height, useBufferedDownloads = false) {\n    utils/* Utils */.A.assert(this._initialized);\n    const gl = texture.gl;\n    const fbo = texture.glFbo;\n\n    // clamp values\n    width = Math.max(0, Math.min(width, texture.width));\n    height = Math.max(0, Math.min(height, texture.height));\n    x = Math.max(0, Math.min(x, texture.width - width));\n    y = Math.max(0, Math.min(y, texture.height - height));\n\n    // buffer allocation\n    const sizeofBuffer = width * height * 4; // 4 bytes per pixel (RGBA)\n    this._reallocate(sizeofBuffer);\n\n    // lost context?\n    if (gl.isContextLost()) return speedy_promise/* SpeedyPromise */.i.resolve(this._pixelBuffer[0].subarray(0, sizeofBuffer));\n\n    // do not optimize?\n    if (!useBufferedDownloads) {\n      const pixelBuffer = this._pixelBuffer[0].subarray(0, sizeofBuffer);\n      return SpeedyTextureReader._readPixelsViaPBO(gl, this._pbo[0], pixelBuffer, fbo, x, y, width, height).then(() => pixelBuffer);\n    }\n\n    // Hide latency with a Producer-Consumer mechanism\n    const numberOfBuffers = this._pixelBuffer.length;\n\n    // GPU needs to produce data\n    const producerIndex = this._producerIndex;\n    if (!this._busy[producerIndex]) {\n      const pbo = this._pbo[producerIndex];\n      const pixelBuffer = this._pixelBuffer[producerIndex].subarray(0, sizeofBuffer);\n      this._producerIndex = (producerIndex + 1) % numberOfBuffers;\n      this._ready[producerIndex] = false;\n      this._busy[producerIndex] = true;\n      //console.time(\"produce \"+producerIndex);\n      this._promise[producerIndex] = SpeedyTextureReader._readPixelsViaPBO(gl, pbo, pixelBuffer, fbo, x, y, width, height).then(() => {\n        //console.timeEnd(\"produce \"+producerIndex);\n        this._busy[producerIndex] = false;\n        this._ready[producerIndex] = true;\n      });\n    }\n    //else console.log(\"skip\",producerIndex);\n    else /* skip frame */;\n\n    // CPU needs to consume data\n    const consumerIndex = this._consumerIndex;\n    this._consumerIndex = (consumerIndex + 1) % numberOfBuffers;\n    if (!this._ready[consumerIndex]) {\n      //console.time(\"consume \"+consumerIndex);\n      return this._promise[consumerIndex].then(() => {\n        //console.timeEnd(\"consume \"+consumerIndex);\n        this._ready[consumerIndex] = false;\n        return this._pixelBuffer[consumerIndex];\n      });\n    }\n\n    //console.log(\"NO WAIT \"+consumerIndex);\n    this._ready[consumerIndex] = false;\n    return speedy_promise/* SpeedyPromise */.i.resolve(this._pixelBuffer[consumerIndex]);\n  }\n\n  /**\n   * Reallocate the pixel buffers, so that they can hold the required number of bytes\n   * If the pixel buffers already have the required capacity, then nothing is done\n   * @param {number} size in bytes\n   */\n  _reallocate(size) {\n    // no need to reallocate\n    if (size <= this._pixelBuffer[0].byteLength) return;\n\n    // reallocate\n    for (let i = 0; i < this._pixelBuffer.length; i++) {\n      const newBuffer = new Uint8Array(size);\n      //newBuffer.set(this._pixelBuffer[i]); // make this optional?\n      this._pixelBuffer[i] = newBuffer;\n    }\n  }\n\n  /**\n   * Allocate PBOs\n   * @param {SpeedyGPU} gpu\n   */\n  _allocatePBOs(gpu) {\n    const gl = gpu.gl;\n    for (let i = 0; i < this._pbo.length; i++) this._pbo[i] = gl.createBuffer();\n  }\n\n  /**\n   * Deallocate PBOs\n   * @param {SpeedyGPU} gpu\n   */\n  _deallocatePBOs(gpu) {\n    const gl = gpu.gl;\n    for (let i = this._pbo.length - 1; i >= 0; i--) {\n      gl.deleteBuffer(this._pbo[i]);\n      this._pbo[i] = null;\n    }\n  }\n\n  /**\n   * Read pixels to a Uint8Array, asynchronously, using a Pixel Buffer Object (PBO)\n   * It's assumed that the target texture is in the RGBA8 format\n   * @param {WebGL2RenderingContext} gl\n   * @param {WebGLBuffer} pbo\n   * @param {Uint8Array} outputBuffer with size >= width * height * 4\n   * @param {WebGLFramebuffer} fbo\n   * @param {GLint} x\n   * @param {GLint} y\n   * @param {GLsizei} width\n   * @param {GLsizei} height\n   * @returns {SpeedyPromise<void>}\n   */\n  static _readPixelsViaPBO(gl, pbo, outputBuffer, fbo, x, y, width, height) {\n    /*\n     When testing Speedy on Chrome (mobile) using about:tracing with the\n    --enable-gpu-service-tracing flag, I found that A LOT of time is spent\n    in TraceGLAPI::glMapBufferRange, which takes place just after\n    GLES2DecoderImpl::HandleReadPixels and GLES2DecoderImpl::glReadPixels.\n     Using multiple PBOs doesn't seem to impact Chrome too much. Performance\n    is much better on Firefox. This suggests there is room for improvement.\n    I do not yet understand clearly the cause for this lag on Chrome. It\n    may be a CPU-GPU synchronization issue.\n     EDIT: I have found that using gl.flush() aggressively greatly improves\n          things. WebGL commands will be pushed frequently!\n     See also:\n    https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7.3 (Buffer objects)\n    https://github.com/chromium/chromium/blob/master/docs/gpu/debugging_gpu_related_code.md\n     */\n    const size = width * height * 4;\n\n    // validate outputBuffer\n    utils/* Utils */.A.assert(outputBuffer.byteLength >= size, `Invalid buffer size`);\n\n    // read pixels into the PBO\n    gl.bindBuffer(gl.PIXEL_PACK_BUFFER, pbo);\n    gl.bufferData(gl.PIXEL_PACK_BUFFER, size, gl.DYNAMIC_READ);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n    gl.readPixels(x, y, width, height, gl.RGBA, gl.UNSIGNED_BYTE, 0);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.bindBuffer(gl.PIXEL_PACK_BUFFER, null);\n\n    // create a fence\n    const sync = gl.fenceSync(gl.SYNC_GPU_COMMANDS_COMPLETE, 0);\n    gl.flush(); // make sure the sync command is read\n\n    // wait for the commands to be processed by the GPU\n    return new speedy_promise/* SpeedyPromise */.i((resolve, reject) => {\n      // according to the WebGL2 spec sec 3.7.14 Sync objects,\n      // \"sync objects may only transition to the signaled state\n      // when the user agent's event loop is not executing a task\"\n      // in other words, it won't be signaled in the same frame\n      if (settings/* Settings */.w.gpuPollingMode != 'asap') runOnNextFrame(SpeedyTextureReader._clientWaitAsync, gl, sync, 0, resolve, reject);else asap(SpeedyTextureReader._clientWaitAsync, gl, sync, 0, resolve, reject);\n    }).then(() => {\n      gl.bindBuffer(gl.PIXEL_PACK_BUFFER, pbo);\n      gl.getBufferSubData(gl.PIXEL_PACK_BUFFER, 0, outputBuffer);\n      gl.bindBuffer(gl.PIXEL_PACK_BUFFER, null);\n    }).catch(err => {\n      throw new utils_errors/* IllegalOperationError */.Er(`Can't getBufferSubDataAsync(): error in clientWaitAsync()`, err);\n    }).finally(() => {\n      gl.deleteSync(sync);\n    });\n  }\n\n  /**\n   * Waits for a sync object to become signaled\n   * @param {WebGL2RenderingContext} gl\n   * @param {WebGLSync} sync\n   * @param {GLbitfield} flags may be gl.SYNC_FLUSH_COMMANDS_BIT or 0\n   * @param {Function} resolve\n   * @param {Function} reject\n   * @param {number} [pollInterval] in milliseconds\n   * @param {number} [remainingAttempts] for timeout\n   */\n  static _clientWaitAsync(gl, sync, flags, resolve, reject, pollInterval = 10, remainingAttempts = 1000) {\n    (function poll() {\n      const status = gl.clientWaitSync(sync, flags, 0);\n      if (remainingAttempts-- <= 0) {\n        reject(new utils_errors/* TimeoutError */.MU(`GPU polling timeout`, utils_errors/* GLError */.wB.from(gl)));\n      } else if (status === gl.CONDITION_SATISFIED || status === gl.ALREADY_SIGNALED) {\n        resolve();\n      } else {\n        //setTimeout(poll, pollInterval);\n        if (settings/* Settings */.w.gpuPollingMode != 'asap') requestAnimationFrame(poll); // RAF is a rather unusual way to do polling at ~60 fps. Does it reduce CPU usage?\n        else asap(poll);\n      }\n    })();\n  }\n}\n// EXTERNAL MODULE: ./src/utils/globals.js\nvar globals = __webpack_require__(3816);\n;// CONCATENATED MODULE: ./src/gpu/speedy-texture.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-texture.js\n * A wrapper around WebGLTexture\n */\n\n\n\n\n\n\n\n/**\n * Get a buffer filled with zeros\n * @param {number} size number of bytes\n * @returns {Uint8Array}\n */\n/*\nconst zeros = (function() {\n    let buffer = new Uint8Array(4);\n\n    return function(size) {\n        if(size > buffer.length)\n            buffer = new Uint8Array(size);\n\n        return buffer.subarray(0, size);\n    }\n})();\n*/\n\n/**\n * A wrapper around WebGLTexture\n */\nclass SpeedyTexture {\n  /**\n   * Constructor\n   * @param {WebGL2RenderingContext} gl\n   * @param {number} width texture width in pixels\n   * @param {number} height texture height in pixels\n   * @param {number} [format]\n   * @param {number} [internalFormat]\n   * @param {number} [dataType]\n   * @param {number} [filter]\n   * @param {number} [wrap]\n   */\n  constructor(gl, width, height, format = gl.RGBA, internalFormat = gl.RGBA8, dataType = gl.UNSIGNED_BYTE, filter = gl.NEAREST, wrap = gl.MIRRORED_REPEAT) {\n    /** @type {WebGL2RenderingContext} rendering context */\n    this._gl = gl;\n\n    /** @type {number} width of the texture */\n    this._width = Math.max(1, width | 0);\n\n    /** @type {number} height of the texture */\n    this._height = Math.max(1, height | 0);\n\n    /** @type {boolean} have we generated mipmaps for this texture? */\n    this._hasMipmaps = false;\n\n    /** @type {number} texture format */\n    this._format = format;\n\n    /** @type {number} internal format (usually a sized format) */\n    this._internalFormat = internalFormat;\n\n    /** @type {number} data type */\n    this._dataType = dataType;\n\n    /** @type {number} texture filtering (min & mag) */\n    this._filter = filter;\n\n    /** @type {number} texture wrapping */\n    this._wrap = wrap;\n\n    /** @type {WebGLTexture} internal texture object */\n    this._glTexture = SpeedyTexture._createTexture(this._gl, this._width, this._height, this._format, this._internalFormat, this._dataType, this._filter, this._wrap);\n  }\n\n  /**\n   * Releases the texture\n   * @returns {null}\n   */\n  release() {\n    const gl = this._gl;\n\n    // already released?\n    if (this._glTexture == null) throw new utils_errors/* IllegalOperationError */.Er(`The SpeedyTexture has already been released`);\n\n    // release resources\n    this.discardMipmaps();\n    gl.deleteTexture(this._glTexture);\n    this._glTexture = null;\n    this._width = this._height = 0;\n\n    // done!\n    return null;\n  }\n\n  /**\n   * Upload pixel data to the texture. The texture will be resized if needed.\n   * @param {TexImageSource} data\n   * @param {number} [width] in pixels\n   * @param {number} [height] in pixels\n   * @return {SpeedyTexture} this\n   */\n  upload(data, width = this._width, height = this._height) {\n    const gl = this._gl;\n\n    // bugfix: if the media is a video, we can't really\n    // upload it to the GPU unless it's ready\n    if (data instanceof HTMLVideoElement) {\n      if (data.readyState < 2) {\n        // this may happen when the video loops (Firefox)\n        // keep the previously uploaded texture\n        //Utils.warning(`Trying to process a video that isn't ready yet`);\n        return this;\n      }\n    }\n    utils/* Utils */.A.assert(width > 0 && height > 0);\n    this.discardMipmaps();\n    this._width = width;\n    this._height = height;\n    this._internalFormat = gl.RGBA8;\n    this._format = gl.RGBA;\n    this._dataType = gl.UNSIGNED_BYTE;\n    SpeedyTexture._upload(gl, this._glTexture, this._width, this._height, data, 0, this._format, this._internalFormat, this._dataType);\n    return this;\n  }\n\n  /**\n   * Clear the texture\n   * @returns {this}\n   */\n  clear() {\n    const gl = this._gl;\n\n    // context loss?\n    if (gl.isContextLost()) return this;\n\n    // clear texture data\n    gl.bindTexture(gl.TEXTURE_2D, this._glTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, this._internalFormat, this._width, this._height, 0, this._format, this._dataType, null);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n\n    // no mipmaps\n    this.discardMipmaps();\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Resize this texture. Its content will be lost!\n   * @param {number} width new width, in pixels\n   * @param {number} height new height, in pixels\n   * @returns {this}\n   */\n  resize(width, height) {\n    const gl = this._gl;\n\n    // no need to resize?\n    if (this._width === width && this._height === height) return this;\n\n    // validate size\n    width |= 0;\n    height |= 0;\n    if (width > globals.MAX_TEXTURE_LENGTH || height > globals.MAX_TEXTURE_LENGTH) throw new utils_errors/* NotSupportedError */.EM(`Maximum texture size exceeded. Using ${width} x ${height}, expected up to ${globals.MAX_TEXTURE_LENGTH} x ${globals.MAX_TEXTURE_LENGTH}.`);else if (width < 1 || height < 1) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid texture size: ${width} x ${height}`);\n\n    // context loss?\n    if (gl.isContextLost()) return this;\n\n    // update dimensions\n    this._width = width;\n    this._height = height;\n\n    // resize\n    // Note: this is fast on Chrome, but seems slow on Firefox\n    gl.bindTexture(gl.TEXTURE_2D, this._glTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, this._internalFormat, this._width, this._height, 0, this._format, this._dataType, null);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n\n    // no mipmaps\n    this.discardMipmaps();\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Generate mipmap\n   * @param {SpeedyDrawableTexture[]} [mipmap] custom texture for each mip level\n   * @returns {SpeedyTexture} this\n   */\n  generateMipmaps(mipmap = []) {\n    const gl = this._gl;\n\n    // nothing to do\n    if (this._hasMipmaps) return this;\n\n    // let the hardware compute the all levels of the pyramid, up to 1x1\n    // we also specify the TEXTURE_MIN_FILTER to be used from now on\n    gl.bindTexture(gl.TEXTURE_2D, this._glTexture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST_MIPMAP_LINEAR);\n    gl.generateMipmap(gl.TEXTURE_2D);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n\n    // accept custom textures\n    if (mipmap.length > 0) {\n      // expected number of mipmap levels according to the OpenGL ES 3.0 spec (sec 3.8.10.4)\n      const width = this.width,\n        height = this.height;\n      const numMipmaps = 1 + Math.floor(Math.log2(Math.max(width, height)));\n      utils/* Utils */.A.assert(mipmap.length <= numMipmaps);\n\n      // verify the dimensions of each level\n      for (let level = 1; level < mipmap.length; level++) {\n        // use max(1, floor(size / 2^lod)), in accordance to\n        // the OpenGL ES 3.0 spec sec 3.8.10.4 (Mipmapping)\n        const w = Math.max(1, width >>> level);\n        const h = Math.max(1, height >>> level);\n\n        // verify the dimensions of this level\n        utils/* Utils */.A.assert(mipmap[level].width === w && mipmap[level].height === h);\n\n        // copy to mipmap\n        mipmap[level].copyTo(this, level);\n      }\n    }\n\n    // done!\n    this._hasMipmaps = true;\n    return this;\n  }\n\n  /**\n   * Invalidates previously generated mipmap, if any\n   */\n  discardMipmaps() {\n    const gl = this._gl;\n\n    // nothing to do\n    if (!this._hasMipmaps) return;\n\n    // reset the min filter\n    gl.bindTexture(gl.TEXTURE_2D, this._glTexture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, this._filter);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n\n    // done!\n    this._hasMipmaps = false;\n  }\n\n  /**\n   * Does this texture have a mipmap?\n   * @returns {boolean}\n   */\n  hasMipmaps() {\n    return this._hasMipmaps;\n  }\n\n  /**\n   * Has this texture been released?\n   * @returns {boolean}\n   */\n  isReleased() {\n    return this._glTexture == null;\n  }\n\n  /**\n   * The internal WebGLTexture\n   * @returns {WebGLTexture}\n   */\n  get glTexture() {\n    return this._glTexture;\n  }\n\n  /**\n   * The width of the texture, in pixels\n   * @returns {number}\n   */\n  get width() {\n    return this._width;\n  }\n\n  /**\n   * The height of the texture, in pixels\n   * @returns {number}\n   */\n  get height() {\n    return this._height;\n  }\n\n  /**\n   * The WebGL Context\n   * @returns {WebGL2RenderingContext}\n   */\n  get gl() {\n    return this._gl;\n  }\n\n  /**\n   * Create a WebGL texture\n   * @param {WebGL2RenderingContext} gl\n   * @param {number} width in pixels\n   * @param {number} height in pixels\n   * @param {number} format usually gl.RGBA\n   * @param {number} internalFormat usually gl.RGBA8\n   * @param {number} dataType usually gl.UNSIGNED_BYTE\n   * @param {number} filter usually gl.NEAREST or gl.LINEAR\n   * @param {number} wrap gl.REPEAT, gl.MIRRORED_REPEAT or gl.CLAMP_TO_EDGE\n   * @returns {WebGLTexture}\n   */\n  static _createTexture(gl, width, height, format, internalFormat, dataType, filter, wrap) {\n    utils/* Utils */.A.assert(width > 0 && height > 0);\n\n    // create & bind texture\n    const texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    // setup\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrap);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrap);\n    //gl.texStorage2D(gl.TEXTURE_2D, 1, internalFormat, width, height);\n    gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, width, height, 0, format, dataType, null);\n\n    // unbind & return\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return texture;\n  }\n\n  /**\n   * Upload pixel data to a WebGL texture\n   * @param {WebGL2RenderingContext} gl\n   * @param {WebGLTexture} texture\n   * @param {GLsizei} width texture width\n   * @param {GLsizei} height texture height\n   * @param {TexImageSource} pixels\n   * @param {GLint} lod mipmap level-of-detail\n   * @param {number} format\n   * @param {number} internalFormat\n   * @param {number} dataType\n   * @returns {WebGLTexture} texture\n   */\n  static _upload(gl, texture, width, height, pixels, lod, format, internalFormat, dataType) {\n    // Prefer calling _upload() before gl.useProgram() to avoid the\n    // needless switching of GL programs internally. See also:\n    // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n\n    /*\n    // slower than texImage2D, unlike the spec?\n    gl.texSubImage2D(gl.TEXTURE_2D,     // target\n                     lod,               // mip level\n                     0,                 // x-offset\n                     0,                 // y-offset\n                     width,             // texture width\n                     height,            // texture height\n                     gl.RGBA,           // source format\n                     gl.UNSIGNED_BYTE,  // source type\n                     pixels);           // source data\n    */\n\n    gl.texImage2D(gl.TEXTURE_2D,\n    // target\n    lod,\n    // mip level\n    internalFormat,\n    // internal format\n    width,\n    // texture width\n    height,\n    // texture height\n    0,\n    // border\n    format,\n    // source format\n    dataType,\n    // source type\n    pixels); // source data\n\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return texture;\n  }\n}\n\n/**\n * A SpeedyTexture with a framebuffer\n */\nclass SpeedyDrawableTexture extends SpeedyTexture {\n  /**\n   * Constructor\n   * @param {WebGL2RenderingContext} gl\n   * @param {number} width texture width in pixels\n   * @param {number} height texture height in pixels\n   * @param {number} [format]\n   * @param {number} [internalFormat]\n   * @param {number} [dataType]\n   * @param {number} [filter]\n   * @param {number} [wrap]\n   */\n  constructor(gl, width, height, format = undefined, internalFormat = undefined, dataType = undefined, filter = undefined, wrap = undefined) {\n    super(gl, width, height, format, internalFormat, dataType, filter, wrap);\n\n    /** @type {WebGLFramebuffer} framebuffer */\n    this._glFbo = SpeedyDrawableTexture._createFramebuffer(gl, this._glTexture);\n  }\n\n  /**\n   * Releases the texture\n   * @returns {null}\n   */\n  release() {\n    const gl = this._gl;\n\n    // already released?\n    if (this._glFbo == null) throw new utils_errors/* IllegalOperationError */.Er(`The SpeedyDrawableTexture has already been released`);\n\n    // release the framebuffer\n    gl.deleteFramebuffer(this._glFbo);\n    this._glFbo = null;\n\n    // release the SpeedyTexture\n    return super.release();\n  }\n\n  /**\n   * The internal WebGLFramebuffer\n   * @returns {WebGLFramebuffer}\n   */\n  get glFbo() {\n    return this._glFbo;\n  }\n\n  /**\n   * Copy this texture into another\n   * (you may have to discard the mipmaps after calling this function)\n   * @param {SpeedyTexture} texture target texture\n   * @param {number} [lod] level-of-detail of the target texture\n   */\n  copyTo(texture, lod = 0) {\n    const gl = this._gl;\n\n    // context loss?\n    if (gl.isContextLost()) return;\n\n    // compute texture size as max(1, floor(size / 2^lod)),\n    // in accordance to the OpenGL ES 3.0 spec sec 3.8.10.4\n    // (Mipmapping)\n    const pot = 1 << (lod |= 0);\n    const expectedWidth = Math.max(1, Math.floor(texture.width / pot));\n    const expectedHeight = Math.max(1, Math.floor(texture.height / pot));\n\n    // validate\n    utils/* Utils */.A.assert(this._width === expectedWidth && this._height === expectedHeight);\n\n    // copy to texture\n    SpeedyDrawableTexture._copyToTexture(gl, this._glFbo, texture.glTexture, 0, 0, this._width, this._height, lod);\n  }\n\n  /*\n   * Resize this texture\n   * @param {number} width new width, in pixels\n   * @param {number} height new height, in pixels\n   * @param {boolean} [preserveContent] should we preserve the content of the texture? EXPENSIVE!\n   * @returns {this}\n   */\n  /*resize(width, height, preserveContent = false)\n  {\n      const gl = this._gl;\n       // no need to preserve the content?\n      if(!preserveContent)\n          return super.resize(width, height);\n       // no need to resize?\n      if(this._width === width && this._height === height)\n          return this;\n       // validate size\n      width |= 0; height |= 0;\n      Utils.assert(width > 0 && height > 0);\n       // context loss?\n      if(gl.isContextLost())\n          return this;\n       // allocate new texture\n      const newTexture = SpeedyTexture._createTexture(gl, width, height);\n       // initialize the new texture with zeros to avoid a\n      // warning when calling copyTexSubImage2D() on Firefox\n      // this may not be very efficient?\n      SpeedyTexture._upload(gl, newTexture, width, height, zeros(width * height * 4)); // RGBA: 4 bytes per pixel\n       // copy the old texture to the new one\n      const oldWidth = this._width, oldHeight = this._height;\n      SpeedyDrawableTexture._copyToTexture(gl, this._glFbo, newTexture, 0, 0, Math.min(width, oldWidth), Math.min(height, oldHeight), 0);\n       // bind FBO\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this._glFbo);\n       // invalidate old data (is this needed?)\n      gl.invalidateFramebuffer(gl.FRAMEBUFFER, [gl.COLOR_ATTACHMENT0]);\n       // attach the new texture to the existing framebuffer\n      gl.framebufferTexture2D(gl.FRAMEBUFFER,         // target\n                              gl.COLOR_ATTACHMENT0,   // color buffer\n                              gl.TEXTURE_2D,          // tex target\n                              newTexture,             // texture\n                              0);                     // mipmap level\n       // unbind FBO\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n       // release the old texture and replace it\n      gl.deleteTexture(this._glTexture);\n      this._glTexture = newTexture;\n       // update dimensions & discard mipmaps\n      this.discardMipmaps();\n      this._width = width;\n      this._height = height;\n       // done!\n      return this;\n  }\n  */\n\n  /**\n   * Clear the texture\n   * @returns {this}\n   */\n  clear() {\n    //\n    // When we pass null to texImage2D(), it seems that Firefox\n    // doesn't clear the texture. Instead, it displays this warning:\n    //\n    // \"WebGL warning: drawArraysInstanced:\n    //  Tex image TEXTURE_2D level 0 is incurring lazy initialization.\"\n    //\n    // Here is a workaround:\n    //\n    return this.clearToColor(0, 0, 0, 0);\n  }\n\n  /**\n   * Clear the texture to a color\n   * @param {number} r red component, a value in [0,1]\n   * @param {number} g green component, a value in [0,1]\n   * @param {number} b blue component, a value in [0,1]\n   * @param {number} a alpha component, a value in [0,1]\n   * @returns {this}\n   */\n  clearToColor(r, g, b, a) {\n    const gl = this._gl;\n\n    // context loss?\n    if (gl.isContextLost()) return this;\n\n    // clamp parameters\n    r = Math.max(0.0, Math.min(+r, 1.0));\n    g = Math.max(0.0, Math.min(+g, 1.0));\n    b = Math.max(0.0, Math.min(+b, 1.0));\n    a = Math.max(0.0, Math.min(+a, 1.0));\n\n    // discard mipmaps, if any\n    this.discardMipmaps();\n\n    // clear the texture\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._glFbo);\n    gl.viewport(0, 0, this._width, this._height);\n    gl.clearColor(r, g, b, a);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Inspect the pixels of the texture for debugging purposes\n   * @param {SpeedyGPU} gpu\n   * @param {SpeedyTextureReader} [textureReader] optional texture reader\n   * @returns {Uint8Array}\n   */\n  inspect(gpu, textureReader) {\n    if (textureReader === undefined) {\n      textureReader = new SpeedyTextureReader();\n      textureReader.init(gpu);\n      const pixels = textureReader.readPixelsSync(this);\n      textureReader.release(gpu);\n      return new Uint8Array(pixels); // copy the array\n    } else {\n      const pixels = textureReader.readPixelsSync(this);\n      return new Uint8Array(pixels);\n    }\n  }\n\n  /**\n   * Inspect the pixels of the texture as unsigned 32-bit integers\n   * @param {SpeedyGPU} gpu\n   * @param {SpeedyTextureReader} [textureReader] optional texture reader\n   * @returns {Uint32Array}\n   */\n  inspect32(gpu, textureReader) {\n    utils/* Utils */.A.assert(globals.LITTLE_ENDIAN); // make sure we use little-endian\n    return new Uint32Array(this.inspect(gpu, textureReader).buffer);\n  }\n\n  /**\n   * Create a FBO associated with an existing texture\n   * @param {WebGL2RenderingContext} gl\n   * @param {WebGLTexture} texture\n   * @returns {WebGLFramebuffer}\n   */\n  static _createFramebuffer(gl, texture) {\n    const fbo = gl.createFramebuffer();\n\n    // setup framebuffer\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER,\n    // target\n    gl.COLOR_ATTACHMENT0,\n    // color buffer\n    gl.TEXTURE_2D,\n    // tex target\n    texture,\n    // texture\n    0); // mipmap level\n\n    // check for errors\n    const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n    if (status != gl.FRAMEBUFFER_COMPLETE) {\n      const error = (() => ['FRAMEBUFFER_UNSUPPORTED', 'FRAMEBUFFER_INCOMPLETE_ATTACHMENT', 'FRAMEBUFFER_INCOMPLETE_DIMENSIONS', 'FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT', 'FRAMEBUFFER_INCOMPLETE_MULTISAMPLE'].filter(err => gl[err] === status)[0] || 'unknown error')();\n      throw new utils_errors/* GLError */.wB(`Can't create framebuffer: ${error} (${status})`);\n    }\n\n    // unbind & return\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    return fbo;\n  }\n\n  /**\n   * Copy data from a framebuffer to a texture\n   * @param {WebGL2RenderingContext} gl\n   * @param {WebGLFramebuffer} fbo we'll read the data from this\n   * @param {WebGLTexture} texture destination texture\n   * @param {GLint} x xpos (where to start copying)\n   * @param {GLint} y ypos (where to start copying)\n   * @param {GLsizei} width width of the texture\n   * @param {GLsizei} height height of the texture\n   * @param {GLint} [lod] mipmap level-of-detail\n   * @returns {WebGLTexture} texture\n   */\n  static _copyToTexture(gl, fbo, texture, x, y, width, height, lod = 0) {\n    //gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n    gl.copyTexSubImage2D(gl.TEXTURE_2D,\n    // target\n    lod,\n    // mipmap level\n    0,\n    // xoffset\n    0,\n    // yoffset\n    x,\n    // xpos (where to start copying)\n    y,\n    // ypos (where to start copying)\n    width,\n    // width of the texture\n    height // height of the texture\n    );\n\n    /*\n    gl.copyTexImage2D(\n        gl.TEXTURE_2D, // target\n        lod, // mipmap level\n        gl.RGBA, // internal format\n        x, // xpos (where to start copying)\n        y, // ypos (where to start copying)\n        width, // width of the texture\n        height, // height of the texture\n        0 // border\n    );\n    */\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return texture;\n  }\n}\n// EXTERNAL MODULE: ./src/gpu/shader-declaration.js + 1 modules\nvar shader_declaration = __webpack_require__(9420);\n;// CONCATENATED MODULE: ./src/gpu/speedy-program.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-program.js\n * SpeedyProgram class\n */\n\n\n\n\n\n\n\n/** @const {Object<string,string>} Map uniform type to a gl function */\nconst UNIFORM_SETTERS = Object.freeze({\n  'sampler2D': 'uniform1i',\n  'isampler2D': 'uniform1i',\n  'usampler2D': 'uniform1i',\n  'float': 'uniform1f',\n  'int': 'uniform1i',\n  'uint': 'uniform1ui',\n  'bool': 'uniform1i',\n  'vec2': 'uniform2f',\n  'vec3': 'uniform3f',\n  'vec4': 'uniform4f',\n  'ivec2': 'uniform2i',\n  'ivec3': 'uniform3i',\n  'ivec4': 'uniform4i',\n  'uvec2': 'uniform2ui',\n  'uvec3': 'uniform3ui',\n  'uvec4': 'uniform4ui',\n  'bvec2': 'uniform2i',\n  'bvec3': 'uniform3i',\n  'bvec4': 'uniform4i',\n  'mat2': 'uniformMatrix2fv',\n  'mat3': 'uniformMatrix3fv',\n  'mat4': 'uniformMatrix4fv'\n});\n\n/**\n * @typedef {object} SpeedyProgramOptions\n * @property {boolean} [renderToTexture] render results to a texture?\n * @property {boolean} [pingpong] alternate output texture between calls\n */\n\n/** @typedef {number|number[]|boolean|boolean[]|SpeedyTexture} SpeedyProgramUniformValue */\n\n/**\n * A SpeedyProgram is a Function that runs GLSL code\n */\nclass SpeedyProgram extends Function {\n  /**\n   * Creates a new SpeedyProgram\n   * @param {WebGL2RenderingContext} gl WebGL context\n   * @param {ShaderDeclaration} shaderdecl Shader declaration\n   * @param {SpeedyProgramOptions} [options] user options\n   */\n  constructor(gl, shaderdecl, options = {}) {\n    super('...args', 'return this._self._call(...args)');\n\n    /** @type {SpeedyProgram} this function bound to this function! */\n    this._self = this.bind(this);\n    this._self._init(gl, shaderdecl, options);\n    return this._self;\n  }\n\n  /**\n   * Initialize the SpeedyProgram\n   * @param {WebGL2RenderingContext} gl WebGL context\n   * @param {ShaderDeclaration} shaderdecl Shader declaration\n   * @param {SpeedyProgramOptions} options user options\n   */\n  _init(gl, shaderdecl, options) {\n    // not a valid context?\n    if (gl.isContextLost()) throw new utils_errors/* IllegalOperationError */.Er(`Can't initialize SpeedyProgram: lost context`);\n\n    // options object\n    options = Object.assign({\n      // default options\n      renderToTexture: true,\n      pingpong: false\n    }, options);\n\n    /** @type {WebGL2RenderingContext} */\n    this._gl = gl;\n\n    /** @type {WebGLProgram} vertex shader + fragment shader */\n    this._program = SpeedyProgram._compile(gl, shaderdecl.vertexSource, shaderdecl.fragmentSource);\n\n    /** @type {ProgramGeometry} this is a quad */\n    this._geometry = new ProgramGeometry(gl, {\n      position: shaderdecl.locationOfAttributes.position,\n      texCoord: shaderdecl.locationOfAttributes.texCoord\n    });\n\n    /** @type {string[]} names of the arguments of the SpeedyProgram */\n    this._argnames = shaderdecl.arguments;\n\n    /** @type {boolean[]} tells whether the i-th argument of the SpeedyProgram is an array or not */\n    this._argIsArray = new Array(this._argnames.length).fill(false);\n\n    /** @type {UBOHelper} UBO helper (lazy instantiation) */\n    this._ubo = null;\n\n    /** @type {boolean} should we render to a texture? If false, we render to the canvas */\n    this._renderToTexture = Boolean(options.renderToTexture);\n\n    /** @type {number} width of the output */\n    this._width = 1;\n\n    /** @type {number} height of the output */\n    this._height = 1;\n\n    /** @type {[number,number]} cached object that stores the size of the output */\n    this._size = [1, 1];\n\n    /** @type {SpeedyDrawableTexture[]} output texture(s) */\n    this._texture = new Array(options.pingpong ? 2 : 1).fill(null);\n\n    /** @type {number} used for pingpong rendering */\n    this._textureIndex = 0;\n\n    /** @type {Map<string,UniformVariable>} uniform variables */\n    this._uniform = new Map();\n\n    /** @type {ShaderDeclaration} shader declaration */\n    this._shaderdecl = shaderdecl;\n\n    // autodetect uniforms\n    gl.useProgram(this._program);\n    for (const name of shaderdecl.uniforms) {\n      const type = shaderdecl.uniformType(name);\n      const location = gl.getUniformLocation(this._program, name);\n      this._uniform.set(name, new UniformVariable(type, location));\n    }\n\n    // match arguments & uniforms\n    for (let j = 0; j < this._argnames.length; j++) {\n      const argname = this._argnames[j];\n      if (!this._uniform.has(argname)) {\n        this._argIsArray[j] = this._uniform.has(indexedVariable(argname, 0));\n        if (!this._argIsArray[j]) throw new utils_errors/* IllegalOperationError */.Er(`Expected uniform \"${argname}\", as declared in the argument list`);\n      }\n    }\n  }\n\n  /**\n   * Run the SpeedyProgram\n   * @param  {...SpeedyProgramUniformValue} args\n   * @returns {SpeedyDrawableTexture}\n   */\n  _call(...args) {\n    const gl = this._gl;\n    const argnames = this._argnames;\n    const texture = this._texture[this._textureIndex];\n\n    // matching arguments?\n    if (args.length != argnames.length) throw new utils_errors/* IllegalArgumentError */.qw(`Can't run shader: incorrect number of arguments (expected ${argnames.length}, got ${args.length})`);\n\n    // can't use the output texture as an input\n    /*\n    // slower method\n    const flatArgs = Utils.flatten(args);\n    for(let j = flatArgs.length - 1; j >= 0; j--) {\n        if(flatArgs[j] === this._texture[this._textureIndex])\n            throw new NotSupportedError(`Can't run shader: don't use its output texture as an input to itself. Consider using pingpong rendering!`);\n    }\n    */\n    for (let j = args.length - 1; j >= 0; j--) {\n      if (args[j] === texture) throw new utils_errors/* NotSupportedError */.EM(`Can't run shader: don't use its output texture as an input to itself. Consider using pingpong rendering!`);\n      // else if(Array.isArray(args[j])) ...\n      // we don't support passing arrays of textures at the time of this writing\n    }\n\n    // context loss?\n    if (gl.isContextLost()) return texture;\n\n    // use program\n    gl.useProgram(this._program);\n\n    // bind the VAO\n    gl.bindVertexArray(this._geometry.vao);\n\n    // select the render target\n    const fbo = this._renderToTexture ? texture.glFbo : null;\n\n    // update texSize uniform (available in all fragment shaders)\n    const texSize = this._uniform.get('texSize');\n    this._size[0] = this._width;\n    this._size[1] = this._height;\n    texSize.setValue(gl, this._size);\n\n    // set uniforms[i] to args[i]\n    for (let i = 0, texNo = 0; i < args.length; i++) {\n      const argname = argnames[i];\n      if (!this._argIsArray[i]) {\n        // uniform variable matches argument name\n        const uniform = this._uniform.get(argname);\n        texNo = uniform.setValue(gl, args[i], texNo);\n      } else {\n        // uniform array matches argument name\n        const array = args[i];\n        if (Array.isArray(array)) {\n          if (this._uniform.has(indexedVariable(argname, array.length))) throw new utils_errors/* IllegalArgumentError */.qw(`Can't run shader: too few elements in the \"${argname}\" array`);\n          for (let j = 0, uniform = undefined; (uniform = this._uniform.get(indexedVariable(argname, j))) !== undefined; j++) texNo = uniform.setValue(gl, array[j], texNo);\n        } else throw new utils_errors/* IllegalArgumentError */.qw(`Can't run shader: expected an array for \"${argname}\"`);\n      }\n    }\n\n    // set Uniform Buffer Objects (if any)\n    if (this._ubo !== null) this._ubo.update();\n\n    // bind the FBO\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n\n    // draw call\n    gl.viewport(0, 0, this._width, this._height);\n    gl.drawArrays(gl.TRIANGLES, 0, 6); // mode, offset, count\n\n    // unbind the FBO\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n    // unbind the VAO\n    gl.bindVertexArray(null);\n\n    // we've just changed the texture! discard the pyramid, if any\n    if (texture != null) texture.discardMipmaps();\n\n    // ping-pong rendering\n    this._pingpong();\n\n    // done!\n    return texture;\n  }\n\n  /**\n   * Set the output texture(s) and its (their) shape(s)\n   * @param {number} width new width, in pixels\n   * @param {number} height new height, in pixels\n   * @param  {...SpeedyDrawableTexture|null} texture output texture(s)\n   * @returns {SpeedyProgram} this\n   */\n  outputs(width, height, ...texture) {\n    this._setOutputTexture(...texture);\n    this._setOutputSize(width, height);\n    return this;\n  }\n\n  /**\n   * Set the size of the output\n   * @param {number} width new width, in pixels\n   * @param {number} height new height, in pixels\n   * @returns {SpeedyProgram} this\n   */\n  _setOutputSize(width, height) {\n    utils/* Utils */.A.assert(width > 0 && height > 0);\n\n    // update output size\n    this._width = width | 0;\n    this._height = height | 0;\n\n    // resize the output texture(s)\n    for (let i = 0; i < this._texture.length; i++) {\n      if (this._texture[i] != null) this._texture[i].resize(this._width, this._height);\n    }\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Use the provided texture(s) as output\n   * @param {...SpeedyDrawableTexture} texture set to null to use the internal texture(s)\n   * @returns {SpeedyProgram} this\n   */\n  _setOutputTexture(...texture) {\n    utils/* Utils */.A.assert(texture.length === this._texture.length, `Incorrect number of textures (expected ${this._texture.length})`);\n\n    // update output texture(s)\n    for (let i = 0; i < this._texture.length; i++) this._texture[i] = texture[i];\n    this._textureIndex = 0;\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Clear the internal textures\n   * @returns {SpeedyDrawableTexture}\n   */\n  clear() {\n    const texture = this._texture[this._textureIndex];\n\n    // clear internal textures\n    for (let i = 0; i < this._texture.length; i++) this._texture[i].clear();\n\n    // ping-pong rendering\n    this._pingpong();\n\n    // done!\n    return texture;\n  }\n\n  /**\n   * Set data using a Uniform Buffer Object\n   * @param {string} blockName uniform block name\n   * @param {ArrayBufferView} data\n   * @returns {SpeedyProgram} this\n   */\n  setUBO(blockName, data) {\n    if (this._ubo === null) this._ubo = new UBOHelper(this._gl, this._program);\n    this._ubo.set(blockName, data);\n    return this;\n  }\n\n  /**\n   * Release the resources associated with this SpeedyProgram\n   * @returns {null}\n   */\n  release() {\n    const gl = this._gl;\n\n    // Release UBOs (if any)\n    if (this._ubo != null) this._ubo = this._ubo.release();\n\n    // Unlink textures\n    this._texture.fill(null);\n\n    // Release geometry\n    this._geometry = this._geometry.release();\n\n    // Release program\n    gl.deleteProgram(this._program);\n    this._program = null;\n\n    // Need to delete the shaders as well? In sec 5.14.9 Programs and shaders\n    // of the WebGL 1.0 spec, it is mentioned that the underlying GL object\n    // will automatically be marked for deletion when the JS object is\n    // destroyed (i.e., garbage collected)\n\n    // done!\n    return null;\n  }\n\n  /**\n   * A constant #defined in the shader declaration\n   * @param {string} name\n   * @returns {number}\n   */\n  definedConstant(name) {\n    return this._shaderdecl.definedConstant(name);\n  }\n\n  /**\n   * Helper method for pingpong rendering: alternates\n   * the texture index from 0 to 1 and vice-versa\n   */\n  _pingpong() {\n    if (this._texture.length > 1) this._textureIndex = 1 - this._textureIndex;\n  }\n\n  /**\n   * Compile and link GLSL shaders\n   * @param {WebGL2RenderingContext} gl\n   * @param {string} vertexShaderSource GLSL code of the vertex shader\n   * @param {string} fragmentShaderSource GLSL code of the fragment shader\n   * @returns {WebGLProgram}\n   */\n  static _compile(gl, vertexShaderSource, fragmentShaderSource) {\n    const program = gl.createProgram();\n    const vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n\n    // compile vertex shader\n    gl.shaderSource(vertexShader, vertexShaderSource);\n    gl.compileShader(vertexShader);\n    gl.attachShader(program, vertexShader);\n\n    // compile fragment shader\n    gl.shaderSource(fragmentShader, fragmentShaderSource);\n    gl.compileShader(fragmentShader);\n    gl.attachShader(program, fragmentShader);\n\n    // link program\n    gl.linkProgram(program);\n    gl.validateProgram(program);\n\n    // return on success\n    if (gl.getProgramParameter(program, gl.LINK_STATUS)) return program;\n\n    // display an error\n    const errors = [gl.getShaderInfoLog(fragmentShader), gl.getShaderInfoLog(vertexShader), gl.getProgramInfoLog(program)];\n    gl.deleteProgram(program);\n    gl.deleteShader(fragmentShader);\n    gl.deleteShader(vertexShader);\n\n    // display error\n    const spaces = i => Math.max(0, 2 - Math.floor(Math.log10(i)));\n    const col = k => new Array(spaces(k)).fill(' ').join('') + k + '. ';\n    const source = errors[0] ? fragmentShaderSource : vertexShaderSource;\n    const formattedSource = source.split('\\n').map((line, no) => col(1 + no) + line).join('\\n');\n    throw new utils_errors/* GLError */.wB(`\\n\\n---------- ERROR ----------\\n\\n` + errors.filter(err => err).join('\\n') + `\\n\\n---------- SOURCE CODE ----------\\n\\n` + formattedSource + '\\n');\n  }\n}\n\n// ============================================================================\n//                                  HELPERS\n// ============================================================================\n\n/**\n * Configure and store the VAO and the VBOs\n * @param {WebGL2RenderingContext} gl\n * @param {LocationOfAttributes} location\n * @returns {ProgramGeometry}\n *\n * @typedef {Object} LocationOfAttributes\n * @property {number} position\n * @property {number} texCoord\n *\n * @typedef {Object} BufferOfAttributes\n * @property {WebGLBuffer} position\n * @property {WebGLBuffer} texCoord\n */\nfunction ProgramGeometry(gl, location) {\n  /** @type {WebGLVertexArrayObject} Vertex Array Object */\n  this.vao = gl.createVertexArray();\n\n  /** @type {BufferOfAttributes} Vertex Buffer Objects */\n  this.vbo = Object.freeze({\n    position: gl.createBuffer(),\n    texCoord: gl.createBuffer()\n  });\n\n  /** @type {WebGL2RenderingContext} */\n  this._gl = gl;\n\n  // bind the VAO\n  gl.bindVertexArray(this.vao);\n\n  // set the position attribute\n  gl.bindBuffer(gl.ARRAY_BUFFER, this.vbo.position);\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\n  // clip coordinates (CCW)\n  -1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1]), gl.STATIC_DRAW);\n  gl.enableVertexAttribArray(location.position);\n  gl.vertexAttribPointer(location.position,\n  // attribute location\n  2,\n  // 2 components per vertex (x,y)\n  gl.FLOAT,\n  // type\n  false,\n  // don't normalize\n  0,\n  // default stride (tightly packed)\n  0); // offset\n\n  // set the texCoord attribute\n  gl.bindBuffer(gl.ARRAY_BUFFER, this.vbo.texCoord);\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\n  // texture coordinates (CCW)\n  0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\n  gl.enableVertexAttribArray(location.texCoord);\n  gl.vertexAttribPointer(location.texCoord,\n  // attribute location\n  2,\n  // 2 components per vertex (x,y)\n  gl.FLOAT,\n  // type\n  false,\n  // don't normalize\n  0,\n  // default stride (tightly packed)\n  0); // offset\n\n  // unbind\n  gl.bindBuffer(gl.ARRAY_BUFFER, null);\n  gl.bindVertexArray(null);\n\n  // done!\n  return Object.freeze(this);\n}\n\n/**\n * Releases the internal resources\n * @returns {null}\n */\nProgramGeometry.prototype.release = function () {\n  const gl = this._gl;\n  gl.deleteVertexArray(this.vao);\n  gl.deleteBuffer(this.vbo.position);\n  gl.deleteBuffer(this.vbo.texCoord);\n  return null;\n};\n\n/**\n * Helper class for storing data in GLSL uniform variables\n * @param {string} type\n * @param {WebGLUniformLocation} location\n */\nfunction UniformVariable(type, location) {\n  /** @type {string} GLSL data type */\n  this.type = String(type);\n  if (!Object.prototype.hasOwnProperty.call(UNIFORM_SETTERS, this.type)) throw new utils_errors/* NotSupportedError */.EM(`Unsupported uniform type: ${this.type}`);\n\n  /** @type {WebGLUniformLocation} uniform location in a WebGL program */\n  this.location = location;\n\n  /** @type {string} setter function */\n  this.setter = UNIFORM_SETTERS[this.type];\n  const n = Number(this.setter.match(/^uniform(Matrix)?(\\d)/)[2]) | 0;\n\n  /** @type {number} is the uniform a scalar (0), a vector (1) or a matrix (2)? */\n  this.dim = this.type.startsWith('mat') ? 2 : this.type.indexOf('vec') >= 0 ? 1 : 0;\n\n  /** @type {number} required number of scalars */\n  this.length = this.dim == 2 ? n * n : n;\n\n  /** @type {SpeedyProgramUniformValue|null} cached value */\n  this._value = null;\n}\n\n/**\n * Set the value of a uniform variable\n * @param {WebGL2RenderingContext} gl\n * @param {SpeedyProgramUniformValue} value use column-major format for matrices\n * @param {number} [texNo] current texture index\n * @returns {number} new texture index\n */\nUniformVariable.prototype.setValue = function (gl, value, texNo = -1) {\n  const setValue = /** @type {Function} */gl[this.setter];\n\n  // check uniform type\n  if (typeof value === 'object' && this.type.endsWith('sampler2D')) {\n    // set texture\n    if (texNo >= gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS) throw new utils_errors/* NotSupportedError */.EM(`Can't activate texture unit ${texNo}: max is ${gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS}`);else if (Array.isArray(value)) throw new utils_errors/* NotSupportedError */.EM(`Can't pass arrays of textures to shaders`);else if (value == null) throw new utils_errors/* IllegalArgumentError */.qw(`Can't run shader: cannot use ${value} as an input texture`);else if (texNo < 0) throw new utils_errors/* IllegalArgumentError */.qw(`Missing texNo`);\n    const tex = value;\n    gl.activeTexture(gl.TEXTURE0 + texNo);\n    gl.bindTexture(gl.TEXTURE_2D, tex.glTexture);\n    gl.uniform1i(this.location, texNo);\n    texNo++;\n  } else if (value === this._value && typeof value !== 'object') {\n    // do not update the uniform if it hasn't changed\n    // note that value may be an array whose entries may have been updated\n    void 0;\n  } else if (typeof value === 'number' || typeof value === 'boolean') {\n    // set scalar value\n    setValue.call(gl, this.location, value);\n  } else if (Array.isArray(value)) {\n    // set vector or matrix\n    if (value.length === this.length) {\n      if (this.dim == 2) setValue.call(gl, this.location, false, value); // matrix\n      else setValue.call(gl, this.location, ...value); // vector\n    } else throw new utils_errors/* IllegalArgumentError */.qw(`Can't run shader: incorrect number of values for ${this.type}: \"${value}\"`);\n  } else throw new utils_errors/* IllegalArgumentError */.qw(`Can't run shader: unrecognized argument \"${value}\"`);\n\n  // cache the value\n  this._value = value;\n\n  // done\n  return texNo;\n};\n\n/**\n * @typedef {object} UBOStuff\n * @property {WebGLBuffer} buffer\n * @property {number} blockBindingIndex \"global\" binding index\n * @property {number} blockIndex UBO \"location\" in the program\n * @property {ArrayBufferView|null} data user-data\n */\n\n/**\n * A helper class for handling Uniform Buffer Objects (UBOs)\n * @param {WebGL2RenderingContext} gl\n * @param {WebGLProgram} program\n */\nfunction UBOHelper(gl, program) {\n  /** @type {WebGL2RenderingContext} */\n  this._gl = gl;\n\n  /** @type {WebGLProgram} */\n  this._program = program;\n\n  /** @type {number} auto-increment counter */\n  this._nextIndex = 0;\n\n  /** @type {Object<string,UBOStuff>} UBO dictionary indexed by uniform block names */\n  this._ubo = Object.create(null);\n}\n\n/**\n * Set Uniform Buffer Object data\n * (the buffer will be uploaded when the program is executed)\n * @param {string} name uniform block name\n * @param {ArrayBufferView} data\n */\nUBOHelper.prototype.set = function (name, data) {\n  const gl = this._gl;\n\n  // create UBO entry\n  if (this._ubo[name] === undefined) {\n    this._ubo[name] = {\n      buffer: gl.createBuffer(),\n      blockBindingIndex: this._nextIndex++,\n      blockIndex: -1,\n      data: null\n    };\n  }\n\n  // get UBO entry for the given block name\n  const ubo = this._ubo[name];\n\n  // read block index & assign binding point\n  if (ubo.blockIndex < 0) {\n    const blockIndex = gl.getUniformBlockIndex(this._program, name); // GLuint\n    gl.uniformBlockBinding(this._program, blockIndex, ubo.blockBindingIndex);\n    ubo.blockIndex = blockIndex;\n  }\n\n  // store the data - we'll upload it later\n  ubo.data = data;\n};\n\n/**\n * Update UBO data\n * Called when we're using the appropriate WebGLProgram\n */\nUBOHelper.prototype.update = function () {\n  const gl = this._gl;\n  for (const name in this._ubo) {\n    const ubo = this._ubo[name];\n    gl.bindBuffer(gl.UNIFORM_BUFFER, ubo.buffer);\n    gl.bufferData(gl.UNIFORM_BUFFER, ubo.data, gl.DYNAMIC_DRAW);\n    gl.bindBufferBase(gl.UNIFORM_BUFFER, ubo.blockBindingIndex, ubo.buffer);\n    gl.bindBuffer(gl.UNIFORM_BUFFER, null);\n  }\n};\n\n/**\n * Release allocated buffers\n * @returns {null}\n */\nUBOHelper.prototype.release = function () {\n  const gl = this._gl;\n  for (const name in this._ubo) {\n    const ubo = this._ubo[name];\n    gl.deleteBuffer(ubo.buffer);\n    ubo.data = null;\n  }\n  return null;\n};\n\n/**\n * Generates an indexed variable name, as in variable[index]\n * @param {string} variable\n * @param {number} index\n * @returns {string} variable[index]\n */\nfunction indexedVariable(variable, index) {\n  //return `${variable}[${index}]`; // no caching\n\n  // is this cache lookup really faster than string concatenation?\n  // what about memory consumption?\n  const cache = indexedVariable.cache;\n  let nameList = cache.get(variable);\n  if (nameList === undefined) cache.set(variable, nameList = []);\n  if (nameList[index] === undefined) nameList[index] = `${variable}[${index}]`;\n  return nameList[index];\n}\n\n/** @type {Map<string,string[]>} cached argument names */\nindexedVariable.cache = new Map(); // Object.create(null)\n;// CONCATENATED MODULE: ./src/gpu/speedy-program-group.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-program-group.js\n * An abstract group of programs that run on the GPU\n */\n\n\n\n\n\n/** @typedef {import('./speedy-program').SpeedyProgramOptions} SpeedyProgramOptions */\n\n/**\n * @typedef {object} SpeedyProgramHelpers\n * @property {function(): SpeedyProgramOptions} usesPingpongRendering\n * @property {function(): SpeedyProgramOptions} rendersToCanvas\n*/\n\n/** @const {SpeedyProgramHelpers} Program settings generator */\nconst PROGRAM_HELPERS = Object.freeze({\n  /**\n   * Pingpong Rendering: the output texture of a\n   * program cannot be used as an input to itself.\n   * This is a convenient helper in these situations\n   * @returns {SpeedyProgramOptions}\n   */\n  usesPingpongRendering() {\n    return {\n      pingpong: true\n    };\n  },\n  /**\n   * Render to canvas\n   * Use it when we're supposed to see the texture\n   * @returns {SpeedyProgramOptions}\n   */\n  rendersToCanvas() {\n    return {\n      renderToTexture: false\n    };\n  }\n});\n\n/**\n * SpeedyProgramGroup\n * A semantically correlated group\n * of programs that run on the GPU\n * @abstract\n */\nclass SpeedyProgramGroup {\n  /**\n   * Class constructor\n   * @protected\n   * @param {SpeedyGPU} gpu\n   */\n  constructor(gpu) {\n    /** @type {SpeedyGPU} GPU-accelerated routines */\n    this._gpu = gpu;\n\n    /** @type {SpeedyProgram[]} the list of all programs that belong to this group */\n    this._programs = [];\n  }\n\n  /**\n   * Declare a program\n   * @protected\n   * @param {string} name Program name\n   * @param {ShaderDeclarationBuilder} builder Builder of a ShaderDeclaration\n   * @param {SpeedyProgramOptions} [options] Program settings\n   * @returns {this}\n   */\n  declare(name, builder, options = {}) {\n    // lazy instantiation of kernels\n    Object.defineProperty(this, name, {\n      get: (() => {\n        // Why cast a symbol to symbol?\n        // Suppress error TS9005: Declaration emit for this file requires using private name 'key'.\n        const key = /** @type {symbol} */Symbol(name);\n        return () => this[key] || (this[key] = this._createProgram(builder.build(), options));\n      })()\n    });\n    return this;\n  }\n\n  /**\n   * Neat helpers to be used when declaring programs\n   * @returns {SpeedyProgramHelpers}\n   */\n  get program() {\n    return PROGRAM_HELPERS;\n  }\n\n  /**\n   * Releases all programs from this group\n   * @returns {null}\n   */\n  release() {\n    for (let i = 0; i < this._programs.length; i++) this._programs[i].release();\n    return null;\n  }\n\n  /**\n   * Spawn a SpeedyProgram\n   * @param {ShaderDeclaration} shaderdecl Shader declaration\n   * @param {SpeedyProgramOptions} [options] Program settings\n   * @returns {SpeedyProgram}\n   */\n  _createProgram(shaderdecl, options = {}) {\n    const program = new SpeedyProgram(this._gpu.gl, shaderdecl, options);\n    this._programs.push(program);\n    return program;\n  }\n}\n;// CONCATENATED MODULE: ./src/gpu/programs/utils.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * utils.js\n * GPU utilities\n */\n\n\n\n\n\n\n\n//\n// Shaders\n//\n\n// Copy image\nconst copy = (0,shader_declaration/* importShader */.bf)('utils/copy.glsl').withArguments('image');\n\n// Copy keypoints\nconst copyKeypoints = (0,shader_declaration/* importShader */.bf)('utils/copy-raster.glsl').withDefines({\n  'TYPE': 1\n}).withArguments('image');\n\n// Copy 2D vectors\nconst copy2DVectors = (0,shader_declaration/* importShader */.bf)('utils/copy-raster.glsl').withDefines({\n  'TYPE': 2\n}).withArguments('image');\n\n// Flip y-axis for output\nconst flipY = (0,shader_declaration/* importShader */.bf)('utils/copy.glsl', 'utils/flip-y.vs.glsl').withArguments('image');\n\n// Fill image with a constant\nconst fill = (0,shader_declaration/* importShader */.bf)('utils/fill.glsl').withArguments('value');\n\n// Fill zero or more color components of the input image with a constant value\nconst fillComponents = (0,shader_declaration/* importShader */.bf)('utils/fill-components.glsl').withArguments('image', 'pixelComponents', 'value');\n\n// Copy the src component of src to zero or more color components of a copy of dest\nconst copyComponents = (0,shader_declaration/* importShader */.bf)('utils/copy-components.glsl').withArguments('dest', 'src', 'destComponents', 'srcComponentId');\n\n// Scan the entire image and find the minimum & maximum pixel intensity\nconst scanMinMax2D = (0,shader_declaration/* importShader */.bf)('utils/scan-minmax2d.glsl').withArguments('image', 'iterationNumber');\n\n// Compute the partial derivatives of an image\nconst sobelDerivatives = (0,shader_declaration/* importShader */.bf)('utils/sobel-derivatives.glsl', 'utils/sobel-derivatives.vs.glsl').withArguments('pyramid', 'lod');\n\n/**\n * SpeedyProgramGroupUtils\n * Utility operations\n */\nclass SpeedyProgramGroupUtils extends SpeedyProgramGroup {\n  /**\n   * Class constructor\n   * @param {SpeedyGPU} gpu\n   */\n  constructor(gpu) {\n    super(gpu);\n    this\n    // render to the canvas\n    .declare('renderToCanvas', flipY, Object.assign({}, this.program.rendersToCanvas()))\n\n    // copy image\n    .declare('copy', copy)\n\n    // copy keypoints\n    .declare('copyKeypoints', copyKeypoints)\n\n    // copy 2D vectors\n    .declare('copy2DVectors', copy2DVectors)\n\n    // Fill image with a constant\n    .declare('fill', fill)\n\n    // Fill zero or more color components of the input image with a constant value\n    .declare('fillComponents', fillComponents)\n\n    // Copy the src component of src to zero or more color components of a copy of dest\n    .declare('copyComponents', copyComponents)\n\n    // find minimum & maximum pixel intensity\n    .declare('scanMinMax2D', scanMinMax2D, Object.assign({}, this.program.usesPingpongRendering()))\n\n    // Compute the partial derivatives of an image\n    .declare('sobelDerivatives', sobelDerivatives);\n  }\n}\n// EXTERNAL MODULE: ./src/gpu/shaders/filters/convolution.js\nvar convolution = __webpack_require__(1672);\n;// CONCATENATED MODULE: ./src/gpu/programs/filters.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * filters.js\n * Image filtering on the GPU\n */\n\n\n\n\n\n\n\n//\n// Shaders\n//\n\n// Convert to greyscale\nconst rgb2grey = (0,shader_declaration/* importShader */.bf)('filters/rgb2grey.glsl').withArguments('image');\n\n// Convolution\nconst filters_convolution = [3, 5, 7].reduce((obj, ksize) => (obj[ksize] = (0,shader_declaration/* importShader */.bf)('filters/convolution2d.glsl').withDefines({\n  'KERNEL_SIZE_SQUARED': ksize * ksize\n}).withArguments('image', 'kernel'), obj), {});\n\n// Separable convolution\nconst convolutionX = [3, 5, 7, 9, 11, 13, 15].reduce((obj, ksize) => (obj[ksize] = (0,shader_declaration/* importShader */.bf)('filters/convolution1d.glsl').withDefines({\n  'KERNEL_SIZE': ksize,\n  'AXIS': 0\n}).withArguments('image', 'kernel'), obj), {});\nconst convolutionY = [3, 5, 7, 9, 11, 13, 15].reduce((obj, ksize) => (obj[ksize] = (0,shader_declaration/* importShader */.bf)('filters/convolution1d.glsl').withDefines({\n  'KERNEL_SIZE': ksize,\n  'AXIS': 1\n}).withArguments('image', 'kernel'), obj), {});\n// Median filter\nconst median = [3, 5, 7].reduce((obj, ksize) => (obj[ksize] = (0,shader_declaration/* importShader */.bf)('filters/fast-median.glsl').withDefines({\n  'KERNEL_SIZE': ksize\n}).withArguments('image'), obj), {});\n\n// Normalize image\nconst normalizeGreyscale = (0,shader_declaration/* importShader */.bf)('filters/normalize-image.glsl').withDefines({\n  'GREYSCALE': 1\n}).withArguments('minmax2d', 'minValue', 'maxValue');\nconst normalizeColored = (0,shader_declaration/* importShader */.bf)('filters/normalize-image.glsl').withDefines({\n  'GREYSCALE': 0\n}).withArguments('minmax2dRGB', 'minValue', 'maxValue');\n\n// Nightvision\nconst nightvision = (0,shader_declaration/* importShader */.bf)('filters/nightvision.glsl').withDefines({\n  'GREYSCALE': 0\n}).withArguments('image', 'illuminationMap', 'gain', 'offset', 'decay');\nconst nightvisionGreyscale = (0,shader_declaration/* importShader */.bf)('filters/nightvision.glsl').withDefines({\n  'GREYSCALE': 1\n}).withArguments('image', 'illuminationMap', 'gain', 'offset', 'decay');\n\n//\n// Utilities\n//\n\n// Handy conversion for Gaussian filters\n// (symmetric kernel, approx. zero after 3*sigma)\nconst ksize2sigma = ksize => Math.max(1.0, ksize / 6.0);\n\n// Generate a 1D Gaussian kernel\nconst gaussian = ksize => utils/* Utils */.A.gaussianKernel(ksize2sigma(ksize), ksize);\n\n// Generate a 1D Box filter\nconst box = ksize => new Array(ksize).fill(1.0 / ksize);\n\n/**\n * SpeedyProgramGroupFilters\n * Image filtering\n */\nclass SpeedyProgramGroupFilters extends SpeedyProgramGroup {\n  /**\n   * Class constructor\n   * @param {SpeedyGPU} gpu\n   */\n  constructor(gpu) {\n    super(gpu);\n    this\n    // convert to greyscale\n    .declare('rgb2grey', rgb2grey)\n\n    // median filters\n    .declare('median3', median[3]) // 3x3 window\n    .declare('median5', median[5]) // 5x5 window\n    .declare('median7', median[7]) // 7x7 window\n\n    // 2D convolution\n    .declare('convolution3', filters_convolution[3]) // 3x3 kernel\n    .declare('convolution5', filters_convolution[5]) // 5x5 kernel\n    .declare('convolution7', filters_convolution[7]) // 7x7 kernel\n\n    // 1D separable convolution\n    .declare('convolution3x', convolutionX[3]) // 1x3 kernel\n    .declare('convolution3y', convolutionY[3]) // 3x1 kernel\n    .declare('convolution5x', convolutionX[5]) // 1x5 kernel\n    .declare('convolution5y', convolutionY[5]) // 5x1 kernel\n    .declare('convolution7x', convolutionX[7]).declare('convolution7y', convolutionY[7]).declare('convolution9x', convolutionX[9]).declare('convolution9y', convolutionY[9]).declare('convolution11x', convolutionX[11]).declare('convolution11y', convolutionY[11]).declare('convolution13x', convolutionX[13]).declare('convolution13y', convolutionY[13]).declare('convolution15x', convolutionX[15]).declare('convolution15y', convolutionY[15])\n\n    // normalize image\n    .declare('normalizeGreyscale', normalizeGreyscale).declare('normalizeColored', normalizeColored)\n\n    // nightvision\n    .declare('nightvision', nightvision).declare('nightvisionGreyscale', nightvisionGreyscale).declare('illuminationMapLoX', (0,convolution.convX)(utils/* Utils */.A.gaussianKernel(80, 31))).declare('illuminationMapLoY', (0,convolution.convY)(utils/* Utils */.A.gaussianKernel(80, 31))).declare('illuminationMapX', (0,convolution.convX)(utils/* Utils */.A.gaussianKernel(80, 63))).declare('illuminationMapY', (0,convolution.convY)(utils/* Utils */.A.gaussianKernel(80, 63))).declare('illuminationMapHiX', (0,convolution.convX)(utils/* Utils */.A.gaussianKernel(80, 255))).declare('illuminationMapHiY', (0,convolution.convY)(utils/* Utils */.A.gaussianKernel(80, 255)))\n\n    // gaussian: separable kernels\n    // see also: http://dev.theomader.com/gaussian-kernel-calculator/\n    .declare('gaussian3x', (0,convolution.convX)([0.25, 0.5, 0.25])) // sigma ~ 1.0\n    .declare('gaussian3y', (0,convolution.convY)([0.25, 0.5, 0.25])).declare('gaussian5x', (0,convolution.convX)([0.05, 0.25, 0.4, 0.25, 0.05])) // sigma ~ 1.0\n    .declare('gaussian5y', (0,convolution.convY)([0.05, 0.25, 0.4, 0.25, 0.05])).declare('gaussian7x', (0,convolution.convX)(gaussian(7))).declare('gaussian7y', (0,convolution.convY)(gaussian(7))).declare('gaussian9x', (0,convolution.convX)(gaussian(9))).declare('gaussian9y', (0,convolution.convY)(gaussian(9))).declare('gaussian11x', (0,convolution.convX)(gaussian(11))).declare('gaussian11y', (0,convolution.convY)(gaussian(11)))\n\n    // box filter: separable kernels\n    .declare('box3x', (0,convolution.convX)(box(3))).declare('box3y', (0,convolution.convY)(box(3))).declare('box5x', (0,convolution.convX)(box(5))).declare('box5y', (0,convolution.convY)(box(5))).declare('box7x', (0,convolution.convX)(box(7))).declare('box7y', (0,convolution.convY)(box(7))).declare('box9x', (0,convolution.convX)(box(9))).declare('box9y', (0,convolution.convY)(box(9))).declare('box11x', (0,convolution.convX)(box(11))).declare('box11y', (0,convolution.convY)(box(11)));\n  }\n}\n// EXTERNAL MODULE: ./src/core/speedy-namespace.js\nvar speedy_namespace = __webpack_require__(6634);\n;// CONCATENATED MODULE: ./src/gpu/speedy-descriptordb.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-descriptordb.js\n * A database of binary descriptors in video memory\n */\n\n\n\n\n\n\n//\n// A database of binary descriptors is a texture that stores\n// a set of (descriptor: uint8_t[]) entries.\n//\n\n/** @type {number} we use RGBA8 textures to store the descriptors */\nconst DESCRIPTORDB_BYTESPERPIXEL = 4;\n\n/** @type {number} texture size goes up to 16 MB */\nconst DESCRIPTORDB_MAXLOG2STRIDE = 11; // 2048x2048 RGBA8 textures are guaranteed to be available in WebGL2 (where is the source of this?)\n\n/**\n * Utility for generating a database of binary descriptors in video memory\n */\nclass SpeedyDescriptorDB extends speedy_namespace/* SpeedyNamespace */.Q {\n  /**\n   * Create a database of binary descriptors\n   * @param {SpeedyTexture} texture output texture\n   * @param {Uint8Array[]} descriptors binary descriptors\n   * @param {number} descriptorSize in bytes, a multiple of 4\n   * @returns {SpeedyTexture} texture\n   */\n  static create(texture, descriptors, descriptorSize) {\n    utils/* Utils */.A.assert(descriptorSize % DESCRIPTORDB_BYTESPERPIXEL == 0, `Invalid descriptorSize: ${descriptorSize}`);\n    const numberOfDescriptors = descriptors.length;\n    const pixelsPerDescriptor = descriptorSize / DESCRIPTORDB_BYTESPERPIXEL;\n\n    // find an appropriate texture size\n    const n = Math.log2(pixelsPerDescriptor * Math.max(numberOfDescriptors, 1)) / 2;\n    const log2stride = Math.min(DESCRIPTORDB_MAXLOG2STRIDE, Math.ceil(n));\n\n    // setup texture parameters\n    const stride = 1 << log2stride;\n    const width = stride,\n      height = stride; // we use powers-of-two\n\n    // are we within storage capacity?\n    const capacity = width * height / pixelsPerDescriptor;\n    if (numberOfDescriptors > capacity) throw new utils_errors/* NotSupportedError */.EM(`The capacity of the descriptorDB (${capacity} for ${descriptorSize * 8}-bit descriptors) has been exceeded`);\n\n    // create texture data\n    const data = new Uint8Array(width * height * DESCRIPTORDB_BYTESPERPIXEL);\n    for (let i = 0; i < numberOfDescriptors; i++) {\n      const byteOffset = i * descriptorSize;\n      const descriptor = descriptors[i];\n\n      // validate input\n      utils/* Utils */.A.assert(descriptor.byteLength === descriptorSize);\n      utils/* Utils */.A.assert(byteOffset + descriptorSize <= data.byteLength);\n\n      // write data\n      data.set(descriptor, byteOffset);\n    }\n\n    // log data for further study\n    const MEGABYTE = 1048576;\n    const totalSize = numberOfDescriptors * descriptorSize;\n    utils/* Utils */.A.log(`Creating a ${width}x${height} database of ${numberOfDescriptors} ` + `${descriptorSize * 8}-bit descriptors ` + `(total size: ${(totalSize / MEGABYTE).toFixed(2)} MB)`);\n\n    // upload to the texture\n    texture.resize(width, height);\n    texture.upload(data);\n    return texture;\n  }\n}\n;// CONCATENATED MODULE: ./src/gpu/speedy-lsh.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-lsh.js\n * GPU-based LSH tables for fast matching of binary descriptors\n */\n\n\n\n\n\n\n/*\n *              ALE'S GPU-BASED LSH FOR APPROXIMATE KNN MATCHING\n *              ------------------------------------------------\n *\n * Here is my variant of Locality Sensitive Hashing for GPU-based KNN matching!\n * Indices of keypoint descriptors are stored in several tables, each with many\n * buckets of fixed capacity. In a nutshell, I create a data structure of fixed\n * size to match the keypoints.\n *\n * Buckets in video memory may get full. Wouldn't it be cool if we could use a\n * probabilistic approach to let us work within their storage capacity?\n *\n * Let there be n buckets in a table, each with storage capacity c (holding\n * up to c elements). Buckets are numbered from 0 to n-1.\n *\n * We pick uniformly a random bucket to store a new element in the table. Let\n * X be the chosen bucket. The probability that we'll store the new element in\n * any particular bucket k is:\n *\n * P(X = k) = 1/n   (k = 0, 1, 2, ... n-1)\n *\n * On average, each new element stored in the table inserts 1/n of an element\n * in each bucket. If we add m new elements to the table, each bucket receives\n * m/n elements, on average(*).\n *\n * (*) for all k, define the Ik random variable as 1 if X = k and 0 otherwise.\n *     It follows that the expected value of Ik, E(Ik), is 1/n for all k. In\n *     addition, the expected value of (m Ik) is m * E(ik) = m/n.\n *\n * Now let Yi be the number of elements inserted in bucket i in m additions to\n * the table. We model Yi as Poisson(m/n), since on average, m additions to\n * the table result in m/n new elements being inserted in bucket i. Buckets\n * are picked independently. Hence, for all i, the probability that we insert\n * q elements in bucket i in m additions to the table is:\n *\n * P(Yi = q) = (m/n)^q * exp(-m/n) / q!   (q = 0, 1, 2...)\n *\n * Given that each bucket has storage capacity c, we require Yi <= c with a\n * high probability p (say, p = 0.99). This means that, in m additions, we\n * don't want to exceed the capacity c with high probability. So, let us find\n * a (large) value of m such that:\n *\n * P(Yi <= c) >= p\n *\n * Sounds good! We can find the largest matching m using binary search.\n *\n * I don't think we need to enforce a high probability that ALL buckets stay\n * within their capacity - n is large, we need to use the available space, and\n * we have multiple tables anyway.\n *\n * In practice, the assumption that buckets are picked uniformly doesn't hold:\n * keypoints that are nearby tend to have similar descriptors and buckets are\n * picked according to those descriptors. Still, this model works well enough\n * in practice and it is simple! That's what I like about it!\n *\n * ... now, how I actually do the matching is the theme of the next episode!\n */\n\n/** @type {number} Default number of tables in a LSH data structure */\nconst LSH_DEFAULT_NUMBER_OF_TABLES = 8;\n\n/** @type {number} Default number of bits of a hash */\nconst LSH_DEFAULT_HASH_SIZE = 15;\n\n/** @type {number[]} Acceptable number of tables for a LSH data structure */\nconst LSH_ACCEPTABLE_NUMBER_OF_TABLES = [4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32];\n\n/** @type {number[]} Acceptable values for hashSize, in bits */\nconst LSH_ACCEPTABLE_HASH_SIZES = [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20];\n\n/** @type {number[]} Acceptable sizes for keypoint descriptors, in bytes */\nconst LSH_ACCEPTABLE_DESCRIPTOR_SIZES = [32, 64];\n\n/**\n * @typedef {Object} LSHProfile LSH profile\n * @property {string} name name of the profile\n * @property {number} capacity maximum number of keypoints that can be stored in such a table\n * @property {number} hashSize number of bits in a keypoint descriptor hash (at most 16)\n * @property {number} tableCount number of tables, preferably a power of 2 (at most 16)\n * @property {number} bucketCapacity maximum number of entries of a bucket of a table\n */\n\n/** @type {function(number,number,number):LSHProfile[]|null} generate LSH profiles sorted by increasing capacity */\nconst generateLSHProfiles = (t, h, p) => !LSH_ACCEPTABLE_HASH_SIZES.includes(h) || !LSH_ACCEPTABLE_NUMBER_OF_TABLES.includes(t) ? null : [{\n  name: 'x-small',\n  bucketCapacity: 1,\n  tableCount: t,\n  hashSize: h,\n  capacity: findTableCapacity(h, 1, p)\n}, {\n  name: 'small',\n  bucketCapacity: 2,\n  tableCount: t,\n  hashSize: h,\n  capacity: findTableCapacity(h, 2, p)\n}, {\n  name: 'small-plus',\n  bucketCapacity: 3,\n  tableCount: t,\n  hashSize: h,\n  capacity: findTableCapacity(h, 3, p)\n}, {\n  name: 'medium',\n  bucketCapacity: 4,\n  tableCount: t,\n  hashSize: h,\n  capacity: findTableCapacity(h, 4, p)\n}, {\n  name: 'medium-plus',\n  bucketCapacity: 5,\n  tableCount: t,\n  hashSize: h,\n  capacity: findTableCapacity(h, 5, p)\n}, {\n  name: 'large',\n  bucketCapacity: 6,\n  tableCount: t,\n  hashSize: h,\n  capacity: findTableCapacity(h, 6, p)\n}, {\n  name: 'x-large',\n  bucketCapacity: 8,\n  tableCount: t,\n  hashSize: h,\n  capacity: findTableCapacity(h, 8, p)\n}];\n\n//\n// LSH hash sequences: random bits in increasing order\n// We generate a few sequences (one for each table) supporting up to 16 hash bits\n// We pad each sequence with invalid values at the end - we want to pick any bit with equal probability\n//\n\n/** @typedef {Uint32Array} BitSequences flattened array of LSH_SEQUENCE_COUNT sequences of LSH_SEQUENCE_MAXLEN elements each - each entry represents a bit index */\n/** @typedef {Object<number,BitSequences>} BitSequencesIndexedByDescriptorSize */\n/** @typedef {Object<number,BitSequencesIndexedByDescriptorSize>} LSHSequences */\n\n/** @type {number} maximum number of elements of a sequence */\nconst LSH_SEQUENCE_MAXLEN = Math.max(...LSH_ACCEPTABLE_HASH_SIZES);\n\n/** @type {number} number of sequences in a BitSequences object */\nconst LSH_SEQUENCE_COUNT = Math.max(...LSH_ACCEPTABLE_NUMBER_OF_TABLES);\n\n/** @type {function(BitSequences): BitSequences} Sort subsequences of random bits in ascending order */\nconst partitionedSort = seq => (utils/* Utils */.A.range(LSH_SEQUENCE_COUNT).forEach(i => seq.subarray(i * LSH_SEQUENCE_MAXLEN, (i + 1) * LSH_SEQUENCE_MAXLEN).sort()), seq);\n\n/** @type {function(number, BitSequences): BitSequences} Set the last p entries of the input subsequences to an invalid value */\nconst padSequences = (p, seq) => (utils/* Utils */.A.range(LSH_SEQUENCE_COUNT).forEach(i => seq.subarray((i + 1) * LSH_SEQUENCE_MAXLEN - p, (i + 1) * LSH_SEQUENCE_MAXLEN).fill(0xBADCAFE)), seq);\n\n/** @type {LSHSequences} the bits we pick to form the hashes, laid out in ascending order and indexed by descriptorSize and hashSize */\nconst LSH_SEQUENCES = (f => LSH_ACCEPTABLE_HASH_SIZES.reduce((p, o) => (p[o] = f(o), p), {}))(h => ({\n  // for 256-bit descriptors\n  32: partitionedSort(padSequences(LSH_SEQUENCE_MAXLEN - h, new Uint32Array([...utils/* Utils */.A.shuffle(utils/* Utils */.A.range(256)), ...utils/* Utils */.A.shuffle(utils/* Utils */.A.range(256)), ...utils/* Utils */.A.shuffle(utils/* Utils */.A.range(256))].slice(0, LSH_SEQUENCE_COUNT * LSH_SEQUENCE_MAXLEN)))),\n  // for 512-bit descriptors\n  64: partitionedSort(padSequences(LSH_SEQUENCE_MAXLEN - h, new Uint32Array([...utils/* Utils */.A.shuffle(utils/* Utils */.A.range(512)), ...utils/* Utils */.A.shuffle(utils/* Utils */.A.range(512))].slice(0, LSH_SEQUENCE_COUNT * LSH_SEQUENCE_MAXLEN))))\n}));\n\n//\n// Misc\n//\n\n/** @type {number} we use RGBA8 textures (32 bits per pixel) as storage */\nconst LSH_BYTESPERPIXEL = 4;\n\n/** @type {function(number): number} next power of 2 */\nconst nextPot = x => x > 1 ? 1 << Math.ceil(Math.log2(x)) : 1;\n\n/**\n * GPU-based LSH tables for fast matching of binary descriptors\n */\nclass SpeedyLSH {\n  /**\n   * Constructor\n   * @param {SpeedyTexture} lshTables texture to be used as the set of LSH tables\n   * @param {SpeedyTexture} descriptorDB texture to be used as the descriptor database\n   * @param {Uint8Array[]} descriptors the binary descriptors you'll store (make sure you don't repeat them, otherwise they will just waste space)\n   * @param {number} [tableCount] number of LSH tables, preferably a power of two\n   * @param {number} [hashSize] number of bits of a hash of a descriptor\n   * @param {number} [probability] probability of no discard events happening in the theoretical model\n   */\n  constructor(lshTables, descriptorDB, descriptors, tableCount = LSH_DEFAULT_NUMBER_OF_TABLES, hashSize = LSH_DEFAULT_HASH_SIZE, probability = 0.95) {\n    const descriptorCount = descriptors.length;\n    const descriptorSize = descriptorCount > 0 ? descriptors[0].byteLength : 0;\n    const lshProfiles = generateLSHProfiles(tableCount, hashSize, probability);\n\n    // validate input\n    utils/* Utils */.A.assert(descriptorCount > 0, `Can't build LSH tables without descriptors!`);\n    utils/* Utils */.A.assert(LSH_ACCEPTABLE_DESCRIPTOR_SIZES.includes(descriptorSize), `Can't build LSH tables: unacceptable descriptor size of ${descriptorSize} bytes`);\n    utils/* Utils */.A.assert(descriptors.findIndex(d => d.byteLength !== descriptorSize) < 0, `Can't build LSH tables: incorrectly sized descriptors. Expected ${descriptorSize} bytes for each`);\n    utils/* Utils */.A.assert(descriptorCount < globals.MATCH_MAX_INDEX, `Can't build LSH tables: too many descriptors (${descriptors.length})`);\n    utils/* Utils */.A.assert(lshProfiles != null, `Can't build LSH tables: unacceptable number of tables (${tableCount}) x hash size (${hashSize})`);\n\n    /** @type {LSHProfile} LSH profile */\n    this._profile = lshProfiles.find(profile => descriptorCount <= profile.capacity) || lshProfiles[lshProfiles.length - 1];\n\n    /** @type {number} descriptor size, in bytes */\n    this._descriptorSize = descriptorSize;\n\n    /** @type {number} number of descriptors */\n    this._descriptorCount = descriptorCount;\n\n    /** @type {BitSequences} bit sequences */\n    this._sequences = this._pickSequences(this._descriptorSize);\n\n    /** @type {SpeedyTexture} LSH tables storing indices of descriptors */\n    this._tables = this._createStaticTables(lshTables, this._sequences, descriptors, descriptorSize);\n\n    /** @type {SpeedyTexture} a storage of descriptors */\n    this._descriptorDB = SpeedyDescriptorDB.create(descriptorDB, descriptors, descriptorSize);\n  }\n\n  /**\n   * Descriptor size, in bytes\n   * @returns {number}\n   */\n  get descriptorSize() {\n    return this._descriptorSize;\n  }\n\n  /**\n   * Number of descriptors stored in this LSH data structure\n   * @returns {number}\n   */\n  get descriptorCount() {\n    return this._descriptorCount;\n  }\n\n  /**\n   * LSH bit sequences\n   * @returns {BitSequences}\n   */\n  get sequences() {\n    return this._sequences;\n  }\n\n  /**\n   * Number of bits that make a hash\n   * @returns {number}\n   */\n  get hashSize() {\n    return this._profile.hashSize;\n  }\n\n  /**\n   * Maximum number of descriptors that can be stored in a bucket of a table\n   * @returns {number}\n   */\n  get bucketCapacity() {\n    return this._profile.bucketCapacity;\n  }\n\n  /**\n   * How many buckets per table do we have?\n   * @returns {number}\n   */\n  get bucketsPerTable() {\n    return 1 << this._profile.hashSize;\n  }\n\n  /**\n   * Number of LSH tables\n   * @returns {number}\n   */\n  get tableCount() {\n    return this._profile.tableCount;\n  }\n\n  /**\n   * Size of one LSH table, in bytes\n   * @returns {number}\n   */\n  get tableSize() {\n    return this.bucketsPerTable * this.bucketCapacity * LSH_BYTESPERPIXEL;\n  }\n\n  /**\n   * Size of all LSH tables combined, in bytes\n   * @returns {number}\n   */\n  get totalSize() {\n    // actually, the total memory in VRAM may be a bit larger than\n    // this value, depending on the actual size of the texture\n    return this.tableCount * this.tableSize;\n  }\n\n  /**\n   * LSH tables texture\n   * @returns {SpeedyDrawableTexture}\n   */\n  get tables() {\n    return this._tables;\n  }\n\n  /**\n   * A collection of descriptors\n   * @returns {SpeedyDrawableTexture}\n   */\n  get descriptorDB() {\n    return this._descriptorDB;\n  }\n\n  /**\n   * Pick the appropriate LSH sequences for a particular descriptor size\n   * @param {number} descriptorSize in bytes\n   * @returns {BitSequences}\n   */\n  _pickSequences(descriptorSize) {\n    utils/* Utils */.A.assert(Object.prototype.hasOwnProperty.call(LSH_SEQUENCES, this.hashSize));\n    utils/* Utils */.A.assert(Object.prototype.hasOwnProperty.call(LSH_SEQUENCES[this.hashSize], descriptorSize));\n    return LSH_SEQUENCES[this.hashSize][descriptorSize];\n  }\n\n  /**\n   * Create LSH tables\n   * @param {SpeedyTexture} texture output texture\n   * @param {BitSequences} sequences bit sequences\n   * @param {Uint8Array[]} descriptors non-empty array of binary descriptors, ALL HAVING THE SAME SIZE\n   * @param {number} descriptorSize in bytes\n   * @returns {SpeedyTexture} texture\n   */\n  _createStaticTables(texture, sequences, descriptors, descriptorSize) {\n    const END_OF_LIST = 0xFFFFFFFF;\n    const profileName = this._profile.name;\n    const tableCapacity = this._profile.capacity;\n    const tableCount = this.tableCount;\n    const bucketsPerTable = this.bucketsPerTable;\n    const bucketSize = this.bucketCapacity * LSH_BYTESPERPIXEL;\n    const hashSize = this.hashSize;\n    const numberOfPixels = this.tableCount * this.bucketsPerTable * this.bucketCapacity; // watch for overflow?\n    const textureWidth = Math.min(nextPot(Math.sqrt(numberOfPixels)), 4096); // 4096 is compatible with most devices according to MDN\n    const textureHeight = Math.ceil(numberOfPixels / textureWidth);\n    const numberOfDescriptors = descriptors.length;\n\n    // validate input\n    utils/* Utils */.A.assert(hashSize <= LSH_SEQUENCE_MAXLEN);\n    utils/* Utils */.A.assert(tableCount <= LSH_SEQUENCE_COUNT);\n    utils/* Utils */.A.assert(numberOfPixels <= textureWidth * textureHeight);\n\n    // log\n    const MEGABYTE = 1048576;\n    utils/* Utils */.A.log(`Building ${tableCount} ${profileName} LSH tables with ${numberOfDescriptors} ` + `${descriptorSize * 8}-bit descriptors each and hashSize = ${hashSize} bits ` + `(${textureWidth}x${textureHeight}, with ${(this.tableSize / MEGABYTE).toFixed(2)} ` + `MB per table and total size = ${(this.totalSize / MEGABYTE).toFixed(2)} MB), `);\n\n    // warn the user if there are too many descriptors\n    if (numberOfDescriptors > tableCapacity) {\n      const exceedingPercentage = 100 * numberOfDescriptors / tableCapacity;\n      utils/* Utils */.A.warning(`There are too many descriptors (${numberOfDescriptors}) for a ${profileName} LSH table. That's ${exceedingPercentage.toFixed(2)}% of its theoretical capacity. Consider increasing the hashSize (currently set to ${hashSize}) or reducing the number of descriptors to avoid degradation.`);\n    }\n\n    // create empty LSH tables\n    const buffer = new ArrayBuffer(textureWidth * textureHeight * LSH_BYTESPERPIXEL);\n    const bytes = new Uint8Array(buffer).fill(0xFF);\n    const data = new DataView(buffer);\n\n    // shuffle the descriptors...\n    // it seems like a good idea to handle collisions of similar descriptors,\n    // which may be located next to each other in the array\n    const permutation = utils/* Utils */.A.shuffle(utils/* Utils */.A.range(numberOfDescriptors));\n\n    // for each descriptor\n    // do everything in little-endian format!\n    const numberOfDiscardedDescriptorsPerTable = new Array(tableCount).fill(0);\n    for (let i = 0; i < numberOfDescriptors; i++) {\n      const descriptorIndex = permutation[i]; //i;\n      const hashes = this._hashCodes(descriptors[descriptorIndex], sequences);\n\n      // for each table\n      for (let table = 0; table < tableCount; table++) {\n        // compute hash & memory addresses\n        const hash = hashes[table];\n        const tableByteOffset = table * bucketsPerTable * bucketSize;\n        const bucketByteOffset = tableByteOffset + hash * bucketSize;\n\n        // find the end of the list\n        let index = END_OF_LIST;\n        for (let entryByteOffset = 0; entryByteOffset < bucketSize; entryByteOffset += LSH_BYTESPERPIXEL) {\n          const byteOffset = bucketByteOffset + entryByteOffset;\n          index = data.getUint32(byteOffset, true);\n\n          // add the keypoint\n          if (index == END_OF_LIST) {\n            data.setUint32(byteOffset, descriptorIndex, true);\n            break;\n          }\n        }\n\n        // note: if the bucket is full, we just discard the entry :\\\n        // we give this event a probabilistic treatment (see above),\n        // so it happens with low probability\n        if (index != END_OF_LIST) numberOfDiscardedDescriptorsPerTable[table]++;\n      }\n    }\n\n    // log data for further study\n    const numberOfDiscardedDescriptors = numberOfDiscardedDescriptorsPerTable.reduce((sum, val) => sum + val, 0);\n    const profile = numberOfDiscardedDescriptorsPerTable.map(d => 100 * d / numberOfDescriptors);\n    utils/* Utils */.A.log(`When building ${tableCount} ${profileName} LSH tables with ${numberOfDescriptors} ` + `${descriptorSize * 8}-bit descriptors each and hashSize = ${hashSize} bits, ` + `I got the following discard profile: ` + profile.map(x => x.toFixed(2) + '%').join(', ') + `. ` + `Average: ${(100 * numberOfDiscardedDescriptors / (tableCount * numberOfDescriptors)).toFixed(2)}%. ` + `Minimum: ${Math.min(...profile).toFixed(2)}%. ` + `Table capacity: ${tableCapacity}.`);\n\n    // upload the LSH tables to the GPU\n    texture.resize(textureWidth, textureHeight);\n    texture.upload(bytes);\n    return texture;\n  }\n\n  /**\n   * Pick bits from a binary descriptor\n   * @param {Uint8Array} descriptor a single descriptor\n   * @param {BitSequences} sequences flattened array of tableCount sequences of LSH_SEQUENCE_MAXLEN elements each\n   * @returns {number[]} hash code for each table\n   */\n  _hashCodes(descriptor, sequences) {\n    const tableCount = this.tableCount;\n    const hashSize = this.hashSize;\n    const bucketsPerTable = this.bucketsPerTable;\n    const hashes = new Array(tableCount);\n    //const descriptorSize = descriptor.length;\n\n    // just to be sure...\n    utils/* Utils */.A.assert(hashSize <= LSH_SEQUENCE_MAXLEN && sequences.length >= LSH_SEQUENCE_MAXLEN * tableCount);\n\n    // for each table\n    for (let table = 0; table < tableCount; table++) {\n      const offset = LSH_SEQUENCE_MAXLEN * table;\n\n      // pick bits [ sequences[offset] .. sequences[offset + hashSize-1] ]\n      let hash = 0;\n      for (let i = 0; i < hashSize; i++) {\n        let bit = sequences[offset + i];\n        let b = bit >>> 3;\n        let m = 1 << (bit & 7);\n\n        //Utils.assert(b < descriptorSize);\n        hash = hash << 1 | (descriptor[b] & m) != 0;\n      }\n\n      // validate & store\n      utils/* Utils */.A.assert(hash >= 0 && hash < bucketsPerTable);\n      hashes[table] = hash;\n    }\n\n    // done!\n    return hashes;\n  }\n}\n\n/**\n * Compute P(X <= k), where X ~ Poisson(lambda)\n * @param {number} lambda positive number\n * @param {number} k non-negative integer\n * @returns {number}\n */\nfunction cumulativePoisson(lambda, k) {\n  const exp = Math.exp(-lambda);\n  let sum = 1,\n    fat = 1,\n    pow = 1;\n\n  // k should be small!!!\n  for (let i = 1; i <= k; i++) sum += (pow *= lambda) / (fat *= i);\n  return sum * exp;\n}\n\n/**\n * Find the maximum number of keypoint descriptors that a table can hold\n * @param {number} hashSize positive integer\n * @param {number} bucketCapacity positive integer\n * @param {number} [probability] probability of no discard events happening in the theoretical model\n * @return {number} optimal table capacity\n */\nfunction findTableCapacity(hashSize, bucketCapacity, probability = 0.99) {\n  const n = 1 << hashSize; // number of buckets\n  const c = bucketCapacity;\n  const p = probability;\n  let l = 1,\n    r = n * c; // watch for overflow!\n  let m = 0,\n    pm = 0;\n\n  // binary search\n  while (l < r) {\n    m = Math.floor((l + r) / 2);\n    pm = cumulativePoisson(m / n, c);\n    if (pm > p)\n      //if(1-pm < 1-p)\n      l = m + 1;else r = m;\n  }\n  return m;\n}\n;// CONCATENATED MODULE: ./src/gpu/programs/keypoints.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * keypoints.js\n * Facade for various keypoint detection algorithms\n */\n\n\n\n\n\n\n\n// FAST corner detector\nconst fast9_16 = (0,shader_declaration/* importShader */.bf)('keypoints/fast.glsl', 'keypoints/fast.vs.glsl').withDefines({\n  'FAST_TYPE': 916\n}).withArguments('corners', 'pyramid', 'lod', 'threshold');\n\n// Harris corner detector\nconst harris = [1, 3, 5, 7].reduce((obj, win) => (obj[win] = (0,shader_declaration/* importShader */.bf)('keypoints/harris.glsl').withDefines({\n  'WINDOW_SIZE': win\n}).withArguments('corners', 'pyramid', 'derivatives', 'lod', 'lodStep', 'gaussian'), obj), {});\nconst harrisScoreFindMax = (0,shader_declaration/* importShader */.bf)('keypoints/score-findmax.glsl').withArguments('corners', 'iterationNumber');\nconst harrisScoreCutoff = (0,shader_declaration/* importShader */.bf)('keypoints/harris-cutoff.glsl').withArguments('corners', 'maxScore', 'quality');\n\n// Subpixel refinement\nconst subpixelQuadratic1d = (0,shader_declaration/* importShader */.bf)('keypoints/subpixel-refinement.glsl').withDefines({\n  'METHOD': 0\n}).withArguments('pyramid', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength', 'maxIterations', 'epsilon');\nconst subpixelTaylor2d = (0,shader_declaration/* importShader */.bf)('keypoints/subpixel-refinement.glsl').withDefines({\n  'METHOD': 1\n}).withArguments('pyramid', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength', 'maxIterations', 'epsilon');\nconst subpixelBilinear = (0,shader_declaration/* importShader */.bf)('keypoints/subpixel-refinement.glsl').withDefines({\n  'METHOD': 2\n}).withArguments('pyramid', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength', 'maxIterations', 'epsilon');\nconst subpixelBicubic = (0,shader_declaration/* importShader */.bf)('keypoints/subpixel-refinement.glsl').withDefines({\n  'METHOD': 3\n}).withArguments('pyramid', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength', 'maxIterations', 'epsilon');\n\n// Scale refinement\nconst refineScaleLoG = (0,shader_declaration/* importShader */.bf)('keypoints/refine-scale.glsl').withDefines({\n  'METHOD': 0\n}).withArguments('pyramid', 'lodStep', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength');\nconst refineScaleFAST916 = (0,shader_declaration/* importShader */.bf)('keypoints/refine-scale.glsl').withDefines({\n  'METHOD': 1\n}).withArguments('pyramid', 'lodStep', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength', 'threshold');\n\n// Pixel allocation\nconst allocateDescriptors = (0,shader_declaration/* importShader */.bf)('keypoints/allocate-descriptors.glsl').withArguments('inputEncodedKeypoints', 'inputDescriptorSize', 'inputExtraSize', 'inputEncoderLength', 'outputDescriptorSize', 'outputExtraSize', 'outputEncoderLength');\nconst allocateExtra = (0,shader_declaration/* importShader */.bf)('keypoints/allocate-extra.glsl').withArguments('inputEncodedKeypoints', 'inputDescriptorSize', 'inputExtraSize', 'inputEncoderLength', 'outputDescriptorSize', 'outputExtraSize', 'outputEncoderLength');\nconst transferToExtra = (0,shader_declaration/* importShader */.bf)('keypoints/transfer-to-extra.glsl').withArguments('encodedData', 'strideOfEncodedData', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength');\n\n// ORB descriptors\nconst orbDescriptor = (0,shader_declaration/* importShader */.bf)('keypoints/orb-descriptor.glsl').withArguments('image', 'encodedCorners', 'extraSize', 'encoderLength');\nconst orbOrientation = (0,shader_declaration/* importShader */.bf)('keypoints/orb-orientation.glsl').withArguments('image', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength');\n\n// Non-maximum suppression\nconst nonMaxSuppression = (0,shader_declaration/* importShader */.bf)('keypoints/nonmax-suppression.glsl').withDefines({\n  'MULTISCALE': 0\n}).withArguments('image', 'lodStep');\nconst multiscaleNonMaxSuppression = (0,shader_declaration/* importShader */.bf)('keypoints/nonmax-suppression.glsl').withDefines({\n  'MULTISCALE': 1\n}).withArguments('image', 'lodStep');\nconst nonmaxSpace = (0,shader_declaration/* importShader */.bf)('keypoints/nonmax-space.glsl').withArguments('corners');\nconst nonmaxScale = (0,shader_declaration/* importShader */.bf)('keypoints/nonmax-scale.glsl').withDefines({\n  'USE_LAPLACIAN': 1\n}).withArguments('corners', 'pyramid', 'pyrLaplacian', 'lodStep');\nconst nonmaxScaleSimple = (0,shader_declaration/* importShader */.bf)('keypoints/nonmax-scale.glsl').withDefines({\n  'USE_LAPLACIAN': 0\n}).withArguments('corners', 'pyramid', 'lodStep');\nconst laplacian = (0,shader_declaration/* importShader */.bf)('keypoints/laplacian.glsl').withArguments('corners', 'pyramid', 'lodStep', 'lodOffset');\n\n// Keypoint tracking & optical-flow\nconst lk = [3, 5, 7, 9, 11, 13, 15, 17, 19, 21].reduce((obj, win) => (obj[win] = (0,shader_declaration/* importShader */.bf)('keypoints/lk.glsl').withDefines({\n  'WINDOW_SIZE': win\n}).withArguments('encodedFlow', 'prevKeypoints', 'nextPyramid', 'prevPyramid', 'level', 'depth', 'numberOfIterations', 'discardThreshold', 'epsilon', 'descriptorSize', 'extraSize', 'encoderLength'), obj), {});\nconst transferFlow = (0,shader_declaration/* importShader */.bf)('keypoints/transfer-flow.glsl').withArguments('encodedFlow', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength');\n\n// Brute-force matching\nconst bfMatcherInitCandidates = (0,shader_declaration/* importShader */.bf)('keypoints/knn-init.glsl').withDefines({\n  'ENCODE_FILTERS': 0\n});\nconst bfMatcherInitFilters = (0,shader_declaration/* importShader */.bf)('keypoints/knn-init.glsl').withDefines({\n  'ENCODE_FILTERS': 1\n});\nconst bfMatcherTransfer = (0,shader_declaration/* importShader */.bf)('keypoints/knn-transfer.glsl').withArguments('encodedMatches', 'encodedKthMatches', 'numberOfMatchesPerKeypoint', 'kthMatch');\nconst bfMatcher32 = (0,shader_declaration/* importShader */.bf)('keypoints/bf-knn.glsl').withDefines({\n  'DESCRIPTOR_SIZE': 32,\n  'NUMBER_OF_KEYPOINTS_PER_PASS': 16\n}).withArguments('encodedMatches', 'encodedFilters', 'matcherLength', 'dbEncodedKeypoints', 'dbDescriptorSize', 'dbExtraSize', 'dbEncoderLength', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength', 'passId');\nconst bfMatcher64 = (0,shader_declaration/* importShader */.bf)('keypoints/bf-knn.glsl').withDefines({\n  'DESCRIPTOR_SIZE': 64,\n  'NUMBER_OF_KEYPOINTS_PER_PASS': 8\n}).withArguments('encodedMatches', 'encodedFilters', 'matcherLength', 'dbEncodedKeypoints', 'dbDescriptorSize', 'dbExtraSize', 'dbEncoderLength', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength', 'passId');\n\n// LSH-based KNN matching\nconst lshKnnInitCandidates = (0,shader_declaration/* importShader */.bf)('keypoints/knn-init.glsl').withDefines({\n  'ENCODE_FILTERS': 0\n});\nconst lshKnnInitFilters = (0,shader_declaration/* importShader */.bf)('keypoints/knn-init.glsl').withDefines({\n  'ENCODE_FILTERS': 1\n});\nconst lshKnn = LSH_ACCEPTABLE_DESCRIPTOR_SIZES.reduce((obj, descriptorSize) => (obj[descriptorSize] = LSH_ACCEPTABLE_HASH_SIZES.reduce((obj, hashSize) => (obj[hashSize] = [0, 1, 2].reduce((obj, level) => (obj[level] = (0,shader_declaration/* importShader */.bf)('keypoints/lsh-knn.glsl').withDefines({\n  'DESCRIPTOR_SIZE': descriptorSize,\n  'HASH_SIZE': hashSize,\n  'LEVEL': level,\n  'SEQUENCE_MAXLEN': LSH_SEQUENCE_MAXLEN,\n  'SEQUENCE_COUNT': LSH_SEQUENCE_COUNT\n}).withArguments('candidates', 'filters', 'matcherLength', 'tables', 'descriptorDB', 'tableIndex', 'bucketCapacity', 'bucketsPerTable', 'tablesStride', 'descriptorDBStride', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength'), obj), {}), obj), {}), obj), {});\nconst lshKnnTransfer = (0,shader_declaration/* importShader */.bf)('keypoints/knn-transfer.glsl').withArguments('encodedMatches', 'encodedKthMatches', 'numberOfMatchesPerKeypoint', 'kthMatch');\n\n// Keypoint sorting\nconst sortCreatePermutation = (0,shader_declaration/* importShader */.bf)('keypoints/sort-keypoints.glsl').withDefines({\n  'STAGE': 1\n}).withArguments('encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength');\nconst sortMergePermutation = (0,shader_declaration/* importShader */.bf)('keypoints/sort-keypoints.glsl').withDefines({\n  'STAGE': 2\n}).withArguments('permutation', 'blockSize', 'dblLog2BlockSize');\nconst sortApplyPermutation = (0,shader_declaration/* importShader */.bf)('keypoints/sort-keypoints.glsl').withDefines({\n  'STAGE': 3\n}).withArguments('permutation', 'maxKeypoints', 'encodedKeypoints', 'descriptorSize', 'extraSize');\n\n// Keypoint mixing\nconst mixKeypointsPreInit = (0,shader_declaration/* importShader */.bf)('keypoints/mix-keypoints.glsl').withDefines({\n  'STAGE': 1\n}).withArguments('encodedKeypointsA', 'encodedKeypointsB', 'encoderLengthA', 'encoderLengthB', 'encoderCapacityA', 'encoderCapacityB', 'descriptorSize', 'extraSize', 'encoderLength');\nconst mixKeypointsInit = (0,shader_declaration/* importShader */.bf)('keypoints/mix-keypoints.glsl').withDefines({\n  'STAGE': 2\n}).withArguments('encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength', 'maxKeypoints');\nconst mixKeypointsSort = (0,shader_declaration/* importShader */.bf)('keypoints/mix-keypoints.glsl').withDefines({\n  'STAGE': 3\n}).withArguments('array', 'blockSize');\nconst mixKeypointsView = (0,shader_declaration/* importShader */.bf)('keypoints/mix-keypoints.glsl').withDefines({\n  'STAGE': 5\n}).withArguments('array');\nconst mixKeypointsApply = (0,shader_declaration/* importShader */.bf)('keypoints/mix-keypoints.glsl').withDefines({\n  'STAGE': 4\n}).withArguments('array', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength');\n\n// Keypoint encoding\nconst initLookupTable = (0,shader_declaration/* importShader */.bf)('keypoints/lookup-of-locations.glsl').withDefines({\n  'FS_OUTPUT_TYPE': 2,\n  'STAGE': 1\n}).withArguments('corners');\nconst sortLookupTable = (0,shader_declaration/* importShader */.bf)('keypoints/lookup-of-locations.glsl', 'keypoints/lookup-of-locations.vs.glsl').withDefines({\n  'FS_OUTPUT_TYPE': 2,\n  'FS_USE_CUSTOM_PRECISION': 1,\n  'STAGE': 2\n}).withArguments('lookupTable', 'blockSize', 'width', 'height');\nconst viewLookupTable = (0,shader_declaration/* importShader */.bf)('keypoints/lookup-of-locations.glsl').withDefines({\n  'STAGE': -1\n}).withArguments('lookupTable');\nconst encodeKeypoints = (0,shader_declaration/* importShader */.bf)('keypoints/encode-keypoints.glsl').withArguments('corners', 'lookupTable', 'stride', 'descriptorSize', 'extraSize', 'encoderLength', 'encoderCapacity');\nconst encodeKeypointSkipOffsets = (0,shader_declaration/* importShader */.bf)('keypoints/encode-keypoint-offsets.glsl').withArguments('corners', 'imageSize');\nconst encodeKeypointLongSkipOffsets = (0,shader_declaration/* importShader */.bf)('keypoints/encode-keypoint-long-offsets.glsl').withDefines({\n  'MAX_ITERATIONS': 6\n}) // dependent texture reads :(\n.withArguments('offsetsImage', 'imageSize');\nconst encodeKeypointPositions = (0,shader_declaration/* importShader */.bf)('keypoints/encode-keypoint-positions.glsl').withArguments('offsetsImage', 'imageSize', 'passId', 'numPasses', 'keypointLimit', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength');\nconst encodeKeypointProperties = (0,shader_declaration/* importShader */.bf)('keypoints/encode-keypoint-properties.glsl').withArguments('corners', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength');\nconst encodeNullKeypoints = (0,shader_declaration/* importShader */.bf)('keypoints/encode-null-keypoints.glsl').withArguments();\nconst transferOrientation = (0,shader_declaration/* importShader */.bf)('keypoints/transfer-orientation.glsl').withArguments('encodedOrientations', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength');\nconst uploadKeypoints = (0,shader_declaration/* importShader */.bf)('keypoints/upload-keypoints.glsl').withDefines({\n  // UBOs can hold at least 16KB of data;\n  // gl.MAX_UNIFORM_BLOCK_SIZE >= 16384\n  // according to the GL ES 3 reference.\n  // Each keypoint uses 16 bytes (vec4)\n  'BUFFER_SIZE': 1024 //16384 / 16\n}).withArguments('encodedKeypoints', 'startIndex', 'endIndex', 'descriptorSize', 'extraSize', 'encoderLength');\n\n// Geometric transformations\nconst applyHomography = (0,shader_declaration/* importShader */.bf)('keypoints/apply-homography.glsl').withArguments('homography', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength');\n\n// Keypoint filters\nconst clipBorder = (0,shader_declaration/* importShader */.bf)('keypoints/clip-border.glsl').withArguments('imageWidth', 'imageHeight', 'borderTop', 'borderRight', 'borderBottom', 'borderLeft', 'encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength');\nconst distanceFilter = (0,shader_declaration/* importShader */.bf)('keypoints/distance-filter.glsl').withArguments('encodedKeypointsA', 'encoderLengthA', 'encodedKeypointsB', 'encoderLengthB', 'descriptorSize', 'extraSize', 'encoderLength', 'threshold');\nconst hammingDistanceFilter32 = (0,shader_declaration/* importShader */.bf)('keypoints/hamming-distance-filter.glsl').withDefines({\n  'DESCRIPTOR_SIZE': 32\n}).withArguments('encodedKeypointsA', 'encoderLengthA', 'encodedKeypointsB', 'encoderLengthB', 'descriptorSize', 'extraSize', 'encoderLength', 'threshold');\nconst hammingDistanceFilter64 = (0,shader_declaration/* importShader */.bf)('keypoints/hamming-distance-filter.glsl').withDefines({\n  'DESCRIPTOR_SIZE': 64\n}).withArguments('encodedKeypointsA', 'encoderLengthA', 'encodedKeypointsB', 'encoderLengthB', 'descriptorSize', 'extraSize', 'encoderLength', 'threshold');\n\n// Other utilities\nconst shuffle = (0,shader_declaration/* importShader */.bf)('keypoints/shuffle.glsl').withDefines({\n  'PERMUTATION_MAXLEN': 2048\n}).withArguments('encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength');\nconst clip = (0,shader_declaration/* importShader */.bf)('keypoints/clip.glsl').withArguments('encodedKeypoints', 'descriptorSize', 'extraSize', 'encoderLength', 'maxKeypoints');\n\n/**\n * SpeedyProgramGroupKeypoints\n * Keypoint detection\n */\nclass SpeedyProgramGroupKeypoints extends SpeedyProgramGroup {\n  /**\n   * Class constructor\n   * @param {SpeedyGPU} gpu\n   */\n  constructor(gpu) {\n    super(gpu);\n    this\n    //\n    // FAST corner detector\n    //\n    .declare('fast9_16', fast9_16, Object.assign({}, this.program.usesPingpongRendering()))\n\n    //\n    // Harris corner detector\n    //\n    .declare('harris1', harris[1], Object.assign({}, this.program.usesPingpongRendering())).declare('harris3', harris[3], Object.assign({}, this.program.usesPingpongRendering())).declare('harris5', harris[5], Object.assign({}, this.program.usesPingpongRendering())).declare('harris7', harris[7], Object.assign({}, this.program.usesPingpongRendering())).declare('harrisScoreFindMax', harrisScoreFindMax, Object.assign({}, this.program.usesPingpongRendering())).declare('harrisScoreCutoff', harrisScoreCutoff)\n\n    //\n    // Subpixel refinement\n    //\n    .declare('subpixelQuadratic1d', subpixelQuadratic1d).declare('subpixelTaylor2d', subpixelTaylor2d).declare('subpixelBicubic', subpixelBicubic).declare('subpixelBilinear', subpixelBilinear)\n\n    //\n    // Scale refinement\n    //\n    .declare('refineScaleLoG', refineScaleLoG).declare('refineScaleFAST916', refineScaleFAST916)\n\n    //\n    // Pixel allocation\n    //\n    .declare('allocateDescriptors', allocateDescriptors).declare('allocateExtra', allocateExtra).declare('transferToExtra', transferToExtra)\n\n    //\n    // ORB descriptors\n    //\n    .declare('orbDescriptor', orbDescriptor).declare('orbOrientation', orbOrientation)\n\n    //\n    // Non-maximum suppression\n    //\n    .declare('nonmax', nonMaxSuppression).declare('pyrnonmax', multiscaleNonMaxSuppression).declare('nonmaxSpace', nonmaxSpace).declare('nonmaxScale', nonmaxScale).declare('nonmaxScaleSimple', nonmaxScaleSimple).declare('laplacian', laplacian)\n\n    //\n    // LK optical-flow\n    //\n    .declare('lk21', lk[21], Object.assign({}, this.program.usesPingpongRendering())).declare('lk19', lk[19], Object.assign({}, this.program.usesPingpongRendering())).declare('lk17', lk[17], Object.assign({}, this.program.usesPingpongRendering())).declare('lk15', lk[15], Object.assign({}, this.program.usesPingpongRendering())).declare('lk13', lk[13], Object.assign({}, this.program.usesPingpongRendering())).declare('lk11', lk[11], Object.assign({}, this.program.usesPingpongRendering())).declare('lk9', lk[9], Object.assign({}, this.program.usesPingpongRendering())).declare('lk7', lk[7], Object.assign({}, this.program.usesPingpongRendering())).declare('lk5', lk[5], Object.assign({}, this.program.usesPingpongRendering())).declare('lk3', lk[3], Object.assign({}, this.program.usesPingpongRendering())).declare('transferFlow', transferFlow)\n\n    //\n    // Brute-force KNN matching\n    //\n    .declare('bfMatcherInitCandidates', bfMatcherInitCandidates).declare('bfMatcherInitFilters', bfMatcherInitFilters).declare('bfMatcherTransfer', bfMatcherTransfer, Object.assign({}, this.program.usesPingpongRendering())).declare('bfMatcher32', bfMatcher32, Object.assign({}, this.program.usesPingpongRendering())).declare('bfMatcher64', bfMatcher64, Object.assign({}, this.program.usesPingpongRendering()))\n\n    //\n    // LSH-based KNN matching\n    //\n    .declare('lshKnnInitCandidates', lshKnnInitCandidates).declare('lshKnnInitFilters', lshKnnInitFilters).declare('lshKnnTransfer', lshKnnTransfer, Object.assign({}, this.program.usesPingpongRendering()))\n\n    //\n    // Keypoint sorting\n    //\n    .declare('sortCreatePermutation', sortCreatePermutation).declare('sortMergePermutation', sortMergePermutation, Object.assign({}, this.program.usesPingpongRendering())).declare('sortApplyPermutation', sortApplyPermutation)\n\n    //\n    // Keypoint mixing\n    //\n    .declare('mixKeypointsPreInit', mixKeypointsPreInit).declare('mixKeypointsInit', mixKeypointsInit).declare('mixKeypointsSort', mixKeypointsSort, Object.assign({}, this.program.usesPingpongRendering())).declare('mixKeypointsView', mixKeypointsView).declare('mixKeypointsApply', mixKeypointsApply)\n\n    //\n    // Keypoint encoders\n    //\n    .declare('encodeNullKeypoints', encodeNullKeypoints).declare('encodeKeypoints', encodeKeypoints).declare('initLookupTable', initLookupTable).declare('sortLookupTable', sortLookupTable, Object.assign({}, this.program.usesPingpongRendering())).declare('viewLookupTable', viewLookupTable).declare('encodeKeypointSkipOffsets', encodeKeypointSkipOffsets).declare('encodeKeypointLongSkipOffsets', encodeKeypointLongSkipOffsets, Object.assign({}, this.program.usesPingpongRendering())).declare('encodeKeypointPositions', encodeKeypointPositions, Object.assign({}, this.program.usesPingpongRendering())).declare('encodeKeypointProperties', encodeKeypointProperties).declare('transferOrientation', transferOrientation).declare('uploadKeypoints', uploadKeypoints, Object.assign({}, this.program.usesPingpongRendering()))\n\n    //\n    // Geometric transformations\n    //\n    .declare('applyHomography', applyHomography)\n\n    //\n    // Keypoint filters\n    //\n    .declare('clipBorder', clipBorder).declare('distanceFilter', distanceFilter).declare('hammingDistanceFilter32', hammingDistanceFilter32).declare('hammingDistanceFilter64', hammingDistanceFilter64)\n\n    //\n    // Other utilities\n    //\n    .declare('shuffle', shuffle).declare('clip', clip);\n\n    //\n    // LSH-based KNN matching\n    //\n    for (const descriptorSize of Object.keys(lshKnn)) {\n      for (const hashSize of Object.keys(lshKnn[descriptorSize])) {\n        for (const level of Object.keys(lshKnn[descriptorSize][hashSize])) {\n          const name = `lshKnn${descriptorSize}h${hashSize}lv${level}`;\n          this.declare(name, lshKnn[descriptorSize][hashSize][level], Object.assign({}, this.program.usesPingpongRendering()));\n        }\n      }\n    }\n  }\n}\n;// CONCATENATED MODULE: ./src/gpu/programs/pyramids.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * pyramids.js\n * Image pyramids\n */\n\n\n\n\n\n\n\n//\n// Shaders\n//\n\nconst upsample2 = (0,shader_declaration/* importShader */.bf)('pyramids/upsample2.glsl').withArguments('image');\nconst downsample2 = (0,shader_declaration/* importShader */.bf)('pyramids/downsample2.glsl').withArguments('image');\n\n/**\n * SpeedyProgramGroupPyramids\n * Image pyramids\n */\nclass SpeedyProgramGroupPyramids extends SpeedyProgramGroup {\n  /**\n   * Class constructor\n   * @param {SpeedyGPU} gpu\n   */\n  constructor(gpu) {\n    super(gpu);\n    this\n    // upsampling & downsampling\n    .declare('upsample2', upsample2).declare('downsample2', downsample2)\n\n    // separable kernels for gaussian smoothing\n    // use [c, b, a, b, c] where a+2c = 2b and a+2b+2c = 1\n    // pick a = 0.4 for gaussian approximation (sigma = 1)\n    .declare('smoothX', (0,convolution.convX)([0.05, 0.25, 0.4, 0.25, 0.05])).declare('smoothY', (0,convolution.convY)([0.05, 0.25, 0.4, 0.25, 0.05]))\n    /*\n    .declare('reduce', conv2D([\n        0.00250, 0.01250, 0.02000, 0.01250, 0.00250,\n        0.01250, 0.06250, 0.10000, 0.06250, 0.01250,\n        0.02000, 0.10000, 0.16000, 0.10000, 0.02000,\n        0.01250, 0.06250, 0.10000, 0.06250, 0.01250,\n        0.00250, 0.01250, 0.02000, 0.01250, 0.00250\n    ]))\n    */\n\n    // smoothing for 2x image\n    // same rules as above with sum(k) = 2\n    .declare('smoothX2', (0,convolution.convX)([0.1, 0.5, 0.8, 0.5, 0.1\n    // NOTE: this would saturate the image, but we apply it\n    // on a 2x upsampled version with lots of zero pixels\n    ])).declare('smoothY2', (0,convolution.convY)([0.1, 0.5, 0.8, 0.5, 0.1], 1.0 / 2.0));\n  }\n}\n;// CONCATENATED MODULE: ./src/gpu/programs/transforms.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * transforms.js\n * Geometric transformations\n */\n\n\n\n\n\n\n//\n// Shaders\n//\n\n// Perspective warp\nconst warpPerspective = (0,shader_declaration/* importShader */.bf)('transforms/warp-perspective.glsl').withArguments('image', 'inverseHomography');\n\n// Resize image\nconst resizeNearest = (0,shader_declaration/* importShader */.bf)('transforms/resize.glsl').withDefines({\n  'INTERPOLATION_METHOD': 0 // Nearest neighbors\n}).withArguments('image');\nconst resizeBilinear = (0,shader_declaration/* importShader */.bf)('transforms/resize.glsl').withDefines({\n  'INTERPOLATION_METHOD': 1 // Bilinear interpolation\n}).withArguments('image');\n\n// Additive mix (TODO create a new program group?)\nconst additiveMix = (0,shader_declaration/* importShader */.bf)('transforms/additive-mix.glsl').withArguments('image0', 'image1', 'alpha', 'beta', 'gamma');\n\n/**\n * SpeedyProgramGroupTransforms\n * Geometric transformations\n */\nclass SpeedyProgramGroupTransforms extends SpeedyProgramGroup {\n  /**\n   * Class constructor\n   * @param {SpeedyGPU} gpu\n   */\n  constructor(gpu) {\n    super(gpu);\n    this.declare('warpPerspective', warpPerspective).declare('resizeNearest', resizeNearest).declare('resizeBilinear', resizeBilinear).declare('additiveMix', additiveMix);\n  }\n}\n;// CONCATENATED MODULE: ./src/gpu/speedy-program-center.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-program-center.js\n * An access point to all programs that run on the GPU\n */\n\n\n\n\n\n\n\n\n\n/**\n * An access point to all programs that run on the CPU\n * All program groups can be accessed via this class\n */\nclass SpeedyProgramCenter {\n  /**\n   * Class constructor\n   * @param {SpeedyGPU} gpu reference to SpeedyGPU\n   */\n  constructor(gpu) {\n    // Note: we instantiate the program groups lazily\n\n    /** @type {SpeedyGPU} reference to SpeedyGPU */\n    this._gpu = gpu;\n\n    /** @type {SpeedyProgramGroupFilters} image filters */\n    this._filters = null;\n\n    /** @type {SpeedyProgramGroupTransforms} geometric transformations */\n    this._transforms = null;\n\n    /** @type {SpeedyProgramGroupPyramids} pyramids & scale-space */\n    this._pyramids = null;\n\n    /** @type {SpeedyProgramGroupKeypoints} keypoint routines */\n    this._keypoints = null;\n\n    /** @type {SpeedyProgramGroupUtils} utility programs */\n    this._utils = null;\n  }\n\n  /**\n   * Image filters & convolutions\n   * @returns {SpeedyProgramGroupFilters}\n   */\n  get filters() {\n    return this._filters || (this._filters = new SpeedyProgramGroupFilters(this._gpu));\n  }\n\n  /**\n   * Geometric transformations\n   * @returns {SpeedyProgramGroupTransforms}\n   */\n  get transforms() {\n    return this._transforms || (this._transforms = new SpeedyProgramGroupTransforms(this._gpu));\n  }\n\n  /**\n   * Image pyramids & scale-space\n   * @returns {SpeedyProgramGroupPyramids}\n   */\n  get pyramids() {\n    return this._pyramids || (this._pyramids = new SpeedyProgramGroupPyramids(this._gpu));\n  }\n\n  /**\n   * Keypoint detection & description\n   * @returns {SpeedyProgramGroupKeypoints}\n   */\n  get keypoints() {\n    return this._keypoints || (this._keypoints = new SpeedyProgramGroupKeypoints(this._gpu));\n  }\n\n  /**\n   * Utility programs\n   * @returns {SpeedyProgramGroupUtils}\n   */\n  get utils() {\n    return this._utils || (this._utils = new SpeedyProgramGroupUtils(this._gpu));\n  }\n\n  /**\n   * Release all programs from all groups. You'll\n   * no longer be able to use any of them.\n   * @returns {null}\n   */\n  release() {\n    for (const key in this) {\n      if (Object.prototype.hasOwnProperty.call(this, key) && this[key] != null) {\n        const group = this[key];\n        if (group instanceof SpeedyProgramGroup) group.release();\n      }\n    }\n    return null;\n  }\n}\n;// CONCATENATED MODULE: ./src/gpu/speedy-texture-pool.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-texture-pool.js\n * Texture pool\n */\n\n\n\n\n\n\n// Constants\nconst DEFAULT_CAPACITY = 1024;\nconst BUCKET = Symbol('Bucket');\n\n/*\n\n=== Heuristics to figure out the capacity of a texture pool ===\n\n1. Decide the maximum amount of VRAM you'd like to use in a pool (say, 64 MB).\n\n2. Figure out the average texture size in your application (say, 640x360 pixels).\n\n3. Figure out the average texture size in bytes (say, 921600 bytes). Each pixel\n   uses 4 bytes (RGBA format).\n\n4. Divide the maximum amount of VRAM by the average texture size in bytes\n   (say, 72). That's the capacity of the pool.\n\nNote that textures are allocated lazily, so VRAM usage is kept to a minimum.\n\nAdapted from: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices\n\n*/\n\n/**\n * @typedef {number} TextureBucketIndex index of a bucket in a pool\n */\n\n/**\n * A bucket\n */\nclass TextureBucket {\n  /**\n   * Constructor\n   * @param {SpeedyDrawableTexture} texture managed texture\n   * @param {TextureBucketIndex} index index of this bucket\n   * @param {TextureBucketIndex} next index of the next bucket\n   */\n  constructor(texture, index, next) {\n    /** @type {SpeedyDrawableTexture} managed texture */\n    this.texture = texture;\n\n    /** @type {TextureBucketIndex} index of this bucket */\n    this.index = index;\n\n    /** @type {TextureBucketIndex} index of the next bucket */\n    this.next = next;\n\n    /** @type {boolean} whether the texture is available or not */\n    this.free = true;\n  }\n}\n\n/**\n * Texture pool\n */\nclass SpeedyTexturePool {\n  /**\n   * Constructor\n   * @param {SpeedyGPU} gpu\n   * @param {number} [capacity] number of textures in the pool\n   */\n  constructor(gpu, capacity = DEFAULT_CAPACITY) {\n    utils/* Utils */.A.assert(capacity > 0);\n\n    /** @type {TextureBucket[]} buckets */\n    this._bucket = Array.from({\n      length: capacity\n    }, (_, i) => new TextureBucket(null, i, i - 1));\n\n    /** @type {TextureBucketIndex} index of an available bucket */\n    this._head = capacity - 1;\n\n    /** @type {SpeedyGPU} GPU instance */\n    this._gpu = gpu;\n  }\n\n  /**\n   * Get a texture from the pool\n   * @returns {SpeedyDrawableTexture}\n   */\n  allocate() {\n    if (this._head < 0) throw new utils_errors/* OutOfMemoryError */.l(`Exhausted pool (capacity: ${this._bucket.length})`);\n    const bucket = this._bucket[this._head];\n    bucket.free = false;\n    this._head = bucket.next;\n    if (bucket.texture == null)\n      // lazy instantiation\n      bucket.texture = SpeedyTexturePool._createManagedTexture(this._gpu.gl, bucket);\n    return bucket.texture;\n  }\n\n  /**\n   * Put a texture back in the pool\n   * @param {SpeedyDrawableTexture} texture\n   * @returns {null}\n   */\n  free(texture) {\n    const bucket = texture[BUCKET];\n    utils/* Utils */.A.assert(bucket !== undefined && !bucket.free, `Unmanaged texture or double free`);\n    bucket.next = this._head;\n    bucket.free = true;\n    this._head = bucket.index;\n    return null;\n  }\n\n  /**\n   * Release the texture pool\n   * @returns {null}\n   */\n  release() {\n    for (let i = 0; i < this._bucket.length; i++) {\n      if (this._bucket[i].texture != null) this._bucket[i].texture = this._bucket[i].texture.release();\n    }\n    return null;\n  }\n\n  /**\n   * Create a texture with a reference to a bucket\n   * @param {WebGL2RenderingContext} gl\n   * @param {TextureBucket} bucket\n   * @returns {SpeedyDrawableTexture}\n   */\n  static _createManagedTexture(gl, bucket) {\n    const texture = new SpeedyDrawableTexture(gl, 1, 1);\n    return Object.defineProperty(texture, BUCKET, {\n      configurable: false,\n      enumerable: false,\n      writable: false,\n      value: bucket\n    });\n  }\n}\n// EXTERNAL MODULE: ./src/utils/types.js\nvar types = __webpack_require__(6049);\n;// CONCATENATED MODULE: ./src/core/speedy-media-source.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-media-source.js\n * Wrappers around <img>, <video>, <canvas>, etc.\n */\n\n\n\n\n\n\n/** @typedef {HTMLImageElement|HTMLVideoElement|HTMLCanvasElement|OffscreenCanvas|ImageBitmap|ImageData} SpeedyMediaSourceNativeElement */\n\n/** Internal token for protected constructors */\nconst PRIVATE_TOKEN = Symbol();\n\n/**\n * An abstract media source: a wrapper around native\n * elements such as: HTMLImageElement, HTMLVideoElement,\n * and so on\n * @abstract\n */\nclass SpeedyMediaSource {\n  /**\n   * @protected Constructor\n   * @param {symbol} token\n   */\n  constructor(token) {\n    // the constructor is not public\n    if (token !== PRIVATE_TOKEN) throw new utils_errors/* IllegalOperationError */.Er();\n\n    /** @type {SpeedyMediaSourceNativeElement} underlying media object */\n    this._data = null;\n  }\n\n  /**\n   * Load a media source\n   * @param {SpeedyMediaSourceNativeElement} wrappedObject\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  static load(wrappedObject) {\n    if (wrappedObject instanceof HTMLImageElement) return SpeedyImageMediaSource.load(wrappedObject);else if (wrappedObject instanceof HTMLVideoElement) return SpeedyVideoMediaSource.load(wrappedObject);else if (wrappedObject instanceof HTMLCanvasElement) return SpeedyCanvasMediaSource.load(wrappedObject);else if (typeof OffscreenCanvas !== 'undefined' && wrappedObject instanceof OffscreenCanvas) return SpeedyOffscreenCanvasMediaSource.load(wrappedObject);else if (wrappedObject instanceof ImageBitmap) return SpeedyBitmapMediaSource.load(wrappedObject);else if (wrappedObject instanceof ImageData) return SpeedyDataMediaSource.load(wrappedObject);else throw new utils_errors/* IllegalArgumentError */.qw(`Unsupported media type: ${wrappedObject}`);\n  }\n\n  /**\n   * The underlying wrapped object\n   * @returns {SpeedyMediaSourceNativeElement}\n   */\n  get data() {\n    return this._data;\n  }\n\n  /**\n   * Is the underlying media loaded?\n   * @returns {boolean}\n   */\n  isLoaded() {\n    return this._data !== null;\n  }\n\n  /**\n   * The type of the underlying media source\n   * @abstract\n   * @returns {MediaType}\n   */\n  get type() {\n    throw new utils_errors/* AbstractMethodError */.aQ();\n  }\n\n  /**\n   * Media width, in pixels\n   * @abstract\n   * @returns {number}\n   */\n  get width() {\n    throw new utils_errors/* AbstractMethodError */.aQ();\n  }\n\n  /**\n   * Media height, in pixels\n   * @abstract\n   * @returns {number}\n   */\n  get height() {\n    throw new utils_errors/* AbstractMethodError */.aQ();\n  }\n\n  /**\n   * Clone this media source\n   * @abstract\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  clone() {\n    throw new utils_errors/* AbstractMethodError */.aQ();\n  }\n\n  /**\n   * Release resources associated with this object\n   * @returns {null}\n   */\n  release() {\n    return this._data = null;\n  }\n\n  /**\n   * Load the underlying media\n   * @abstract\n   * @param {SpeedyMediaSourceNativeElement} element\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  _load(element) {\n    throw new utils_errors/* AbstractMethodError */.aQ();\n  }\n\n  /**\n   * Wait for an event to be triggered in an element\n   * @param {Element} element\n   * @param {string} eventName\n   * @param {number} [timeout] in ms\n   * @returns {SpeedyPromise<Element>}\n   */\n  static _waitUntil(element, eventName, timeout = 30000) {\n    return new speedy_promise/* SpeedyPromise */.i((resolve, reject) => {\n      utils/* Utils */.A.log(`Waiting for ${eventName} to be triggered in ${element}...`);\n      const timer = setTimeout(() => {\n        clear();\n        reject(new utils_errors/* TimeoutError */.MU(`${eventName} has not been triggered in ${element}: timeout (${timeout}ms)`));\n      }, timeout);\n      function clear() {\n        clearTimeout(timer);\n        element.removeEventListener('error', handleError, false);\n        element.removeEventListener(eventName, handleSuccess, false);\n      }\n      function handleError() {\n        const hasError = element.error !== null && typeof element.error === 'object';\n        const error = hasError ? element.error : {\n          code: -1,\n          message: ''\n        };\n        const info = `${error.message} (error code ${error.code})`;\n        clear();\n        reject(new utils_errors/* ResourceNotLoadedError */.FJ(`Can't load ${element}. ${info}`));\n      }\n      function handleSuccess() {\n        clear();\n        resolve(element);\n      }\n      element.addEventListener('error', handleError, false);\n      element.addEventListener(eventName, handleSuccess, false);\n    });\n  }\n}\n\n/**\n * Image media source:\n * a wrapper around HTMLImageElement\n */\nclass SpeedyImageMediaSource extends SpeedyMediaSource {\n  /**\n   * @private Constructor\n   * @param {symbol} token\n   */\n  constructor(token) {\n    super(token);\n\n    /** @type {HTMLImageElement} image element */\n    this._data = null;\n  }\n\n  /**\n   * The underlying wrapped object\n   * @returns {HTMLImageElement}\n   */\n  get data() {\n    return this._data;\n  }\n\n  /**\n   * The type of the underlying media source\n   * @returns {MediaType}\n   */\n  get type() {\n    return types/* MediaType */.zu.Image;\n  }\n\n  /**\n   * Media width, in pixels\n   * @returns {number}\n   */\n  get width() {\n    return this._data ? this._data.naturalWidth : 0;\n  }\n\n  /**\n   * Media height, in pixels\n   * @returns {number}\n   */\n  get height() {\n    return this._data ? this._data.naturalHeight : 0;\n  }\n\n  /**\n   * Clone this media source\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  clone() {\n    if (this._data == null) throw new utils_errors/* IllegalOperationError */.Er(`Media not loaded`);\n    const newNode = /** @type {HTMLImageElement} */this._data.cloneNode(true);\n    return SpeedyImageMediaSource.load(newNode);\n  }\n\n  /**\n   * Load the underlying media\n   * @param {HTMLImageElement} image\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  _load(image) {\n    if (this.isLoaded()) this.release();\n    if (image.complete && image.naturalWidth !== 0) {\n      // already loaded?\n      return new speedy_promise/* SpeedyPromise */.i(resolve => {\n        this._data = image;\n        resolve(this);\n      });\n    } else {\n      return SpeedyMediaSource._waitUntil(image, 'load').then(() => {\n        this._data = image;\n        return this;\n      });\n    }\n  }\n\n  /**\n   * Load the underlying media\n   * @param {HTMLImageElement} image\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  static load(image) {\n    return new SpeedyImageMediaSource(PRIVATE_TOKEN)._load(image);\n  }\n}\n\n/**\n * Video media source:\n * a wrapper around HTMLVideoElement\n */\nclass SpeedyVideoMediaSource extends SpeedyMediaSource {\n  /**\n   * @private Constructor\n   * @param {symbol} token\n   */\n  constructor(token) {\n    super(token);\n\n    /** @type {HTMLVideoElement} video element */\n    this._data = null;\n  }\n\n  /**\n   * The underlying wrapped object\n   * @returns {HTMLVideoElement}\n   */\n  get data() {\n    return this._data;\n  }\n\n  /**\n   * The type of the underlying media source\n   * @returns {MediaType}\n   */\n  get type() {\n    return types/* MediaType */.zu.Video;\n  }\n\n  /**\n   * Media width, in pixels\n   * @returns {number}\n   */\n  get width() {\n    // Warning: videoWidth & videoHeight may change at any time !!!\n    // so you can't cache these dimensions\n    return this._data ? this._data.videoWidth : 0;\n  }\n\n  /**\n   * Media height, in pixels\n   * @returns {number}\n   */\n  get height() {\n    return this._data ? this._data.videoHeight : 0;\n  }\n\n  /**\n   * Clone this media source\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  clone() {\n    if (this._data == null) throw new utils_errors/* IllegalOperationError */.Er(`Media not loaded`);\n    const newNode = /** @type {HTMLVideoElement} */this._data.cloneNode(true);\n    return SpeedyVideoMediaSource.load(newNode);\n  }\n\n  /**\n   * Load the underlying media\n   * @param {HTMLVideoElement} video\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  _load(video) {\n    if (this.isLoaded()) this.release();\n    utils/* Utils */.A.log('Loading a video...');\n    video.load();\n    return SpeedyVideoMediaSource._waitUntilPlayable(video).then(() => {\n      return SpeedyVideoMediaSource._handleAutoplay(video).then(() => {\n        this._data = video;\n        return this;\n      });\n    });\n  }\n\n  /**\n   * Load the underlying media\n   * @param {HTMLVideoElement} video\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  static load(video) {\n    return new SpeedyVideoMediaSource(PRIVATE_TOKEN)._load(video);\n  }\n\n  /**\n   * Handle browser quirks concerning autoplay\n   * @param {HTMLVideoElement} video\n   * @returns {SpeedyPromise<void>} gets rejected if we can't autoplay\n   */\n  static _handleAutoplay(video) {\n    // Autoplay guide: https://developer.mozilla.org/en-US/docs/Web/Media/Autoplay_guide\n    // Chrome policy: https://developer.chrome.com/blog/autoplay/\n    // WebKit policy: https://webkit.org/blog/7734/auto-play-policy-changes-for-macos/\n\n    // videos marked as autoplay may not play if not visible on-screen\n    // videos marked as autoplay should be muted\n    if (video.autoplay /*&& video.muted*/) {\n      return new speedy_promise/* SpeedyPromise */.i((resolve, reject) => {\n        const promise = video.play();\n\n        // handle older browsers\n        if (promise === undefined) {\n          resolve();\n          return;\n        }\n\n        // wrap promise\n        promise.then(resolve, reject);\n      });\n    }\n\n    // nothing to do\n    return speedy_promise/* SpeedyPromise */.i.resolve();\n  }\n\n  /**\n   * Wait for the input video to be playable\n   * @param {HTMLVideoElement} video\n   * @returns {SpeedyPromise<HTMLVideoElement>} resolves to the input video when it can be played\n   */\n  static _waitUntilPlayable(video) {\n    const TIMEOUT = 30000,\n      INTERVAL = 500;\n    if (video.readyState >= 3) return speedy_promise/* SpeedyPromise */.i.resolve(video);\n    return new speedy_promise/* SpeedyPromise */.i((resolve, reject) => {\n      let ms = 0,\n        t = setInterval(() => {\n          //if(video.readyState >= 4) { // canplaythrough (may timeout on slow connections)\n          if (video.readyState >= 3) {\n            clearInterval(t);\n            resolve(video);\n          } else if ((ms += INTERVAL) >= TIMEOUT) {\n            clearInterval(t);\n            reject(new utils_errors/* TimeoutError */.MU('The video took too long to load'));\n          }\n        }, INTERVAL);\n    });\n  }\n}\n\n/**\n * Canvas media source:\n * a wrapper around HTMLCanvasElement\n */\nclass SpeedyCanvasMediaSource extends SpeedyMediaSource {\n  /**\n   * @private Constructor\n   * @param {symbol} token\n   */\n  constructor(token) {\n    super(token);\n\n    /** @type {HTMLCanvasElement} canvas element */\n    this._data = null;\n  }\n\n  /**\n   * The underlying wrapped object\n   * @returns {HTMLCanvasElement}\n   */\n  get data() {\n    return this._data;\n  }\n\n  /**\n   * The type of the underlying media source\n   * @returns {MediaType}\n   */\n  get type() {\n    return types/* MediaType */.zu.Canvas;\n  }\n\n  /**\n   * Media width, in pixels\n   * @returns {number}\n   */\n  get width() {\n    return this._data ? this._data.width : 0;\n  }\n\n  /**\n   * Media height, in pixels\n   * @returns {number}\n   */\n  get height() {\n    return this._data ? this._data.height : 0;\n  }\n\n  /**\n   * Clone this media source\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  clone() {\n    if (this._data == null) throw new utils_errors/* IllegalOperationError */.Er(`Media not loaded`);\n    const newCanvas = utils/* Utils */.A.createCanvas(this.width, this.height);\n    const newContext = newCanvas.getContext('2d');\n    newContext.drawImage(this._data, 0, 0);\n    return SpeedyCanvasMediaSource.load(newCanvas);\n  }\n\n  /**\n   * Load the underlying media\n   * @param {HTMLCanvasElement} canvas\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  _load(canvas) {\n    if (this.isLoaded()) this.release();\n    return new speedy_promise/* SpeedyPromise */.i(resolve => {\n      this._data = canvas;\n      resolve(this);\n    });\n  }\n\n  /**\n   * Load the underlying media\n   * @param {HTMLCanvasElement} canvas\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  static load(canvas) {\n    return new SpeedyCanvasMediaSource(PRIVATE_TOKEN)._load(canvas);\n  }\n}\n\n/**\n * OffscreenCanvas media source:\n * a wrapper around OffscreenCanvas\n */\nclass SpeedyOffscreenCanvasMediaSource extends SpeedyMediaSource {\n  /**\n   * @private Constructor\n   * @param {symbol} token\n   */\n  constructor(token) {\n    super(token);\n\n    /** @type {OffscreenCanvas} offscreen canvas element */\n    this._data = null;\n  }\n\n  /**\n   * The underlying wrapped object\n   * @returns {OffscreenCanvas}\n   */\n  get data() {\n    return this._data;\n  }\n\n  /**\n   * The type of the underlying media source\n   * @returns {MediaType}\n   */\n  get type() {\n    return types/* MediaType */.zu.OffscreenCanvas;\n  }\n\n  /**\n   * Media width, in pixels\n   * @returns {number}\n   */\n  get width() {\n    return this._data ? this._data.width : 0;\n  }\n\n  /**\n   * Media height, in pixels\n   * @returns {number}\n   */\n  get height() {\n    return this._data ? this._data.height : 0;\n  }\n\n  /**\n   * Clone this media source\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  clone() {\n    if (this._data == null) throw new utils_errors/* IllegalOperationError */.Er(`Media not loaded`);\n    const newCanvas = new OffscreenCanvas(this.width, this.height);\n    const newContext = newCanvas.getContext('2d');\n    newContext.drawImage(this._data, 0, 0);\n    return SpeedyOffscreenCanvasMediaSource.load(newCanvas);\n  }\n\n  /**\n   * Load the underlying media\n   * @param {OffscreenCanvas} offscreenCanvas\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  _load(offscreenCanvas) {\n    if (this.isLoaded()) this.release();\n    return new speedy_promise/* SpeedyPromise */.i(resolve => {\n      this._data = offscreenCanvas;\n      resolve(this);\n    });\n  }\n\n  /**\n   * Load the underlying media\n   * @param {OffscreenCanvas} offscreenCanvas\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  static load(offscreenCanvas) {\n    return new SpeedyOffscreenCanvasMediaSource(PRIVATE_TOKEN)._load(offscreenCanvas);\n  }\n}\n\n/**\n * Bitmap media source:\n * a wrapper around ImageBitmap\n */\nclass SpeedyBitmapMediaSource extends SpeedyMediaSource {\n  /**\n   * @private Constructor\n   * @param {symbol} token\n   */\n  constructor(token) {\n    super(token);\n\n    /** @type {ImageBitmap} image bitmap */\n    this._data = null;\n  }\n\n  /**\n   * The underlying wrapped object\n   * @returns {ImageBitmap}\n   */\n  get data() {\n    return this._data;\n  }\n\n  /**\n   * The type of the underlying media source\n   * @returns {MediaType}\n   */\n  get type() {\n    return types/* MediaType */.zu.Bitmap;\n  }\n\n  /**\n   * Media width, in pixels\n   * @returns {number}\n   */\n  get width() {\n    return this._data ? this._data.width : 0;\n  }\n\n  /**\n   * Media height, in pixels\n   * @returns {number}\n   */\n  get height() {\n    return this._data ? this._data.height : 0;\n  }\n\n  /**\n   * Clone this media source\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  clone() {\n    if (this._data == null) throw new utils_errors/* IllegalOperationError */.Er(`Media not loaded`);\n    return new speedy_promise/* SpeedyPromise */.i((resolve, reject) => {\n      createImageBitmap(this._data).then(newBitmap => {\n        const newSource = new SpeedyBitmapMediaSource(PRIVATE_TOKEN);\n        newSource._load(newBitmap).then(resolve, reject);\n      }, reject);\n    });\n  }\n\n  /**\n   * Release resources associated with this object\n   * @returns {null}\n   */\n  release() {\n    if (this._data != null) this._data.close();\n    return super.release();\n  }\n\n  /**\n   * Load the underlying media\n   * @param {ImageBitmap} bitmap\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  _load(bitmap) {\n    if (this.isLoaded()) this.release();\n    return new speedy_promise/* SpeedyPromise */.i(resolve => {\n      this._data = bitmap;\n      resolve(this);\n    });\n  }\n\n  /**\n   * Load the underlying media\n   * @param {ImageBitmap} bitmap\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  static load(bitmap) {\n    return new SpeedyBitmapMediaSource(PRIVATE_TOKEN)._load(bitmap);\n  }\n}\n\n/**\n * Data media source:\n * a wrapper around ImageData\n */\nclass SpeedyDataMediaSource extends SpeedyMediaSource {\n  /**\n   * @private Constructor\n   * @param {symbol} token\n   */\n  constructor(token) {\n    super(token);\n\n    /** @type {ImageData} image data */\n    this._data = null;\n  }\n\n  /**\n   * The underlying wrapped object\n   * @returns {ImageData}\n   */\n  get data() {\n    return this._data;\n  }\n\n  /**\n   * The type of the underlying media source\n   * @returns {MediaType}\n   */\n  get type() {\n    return types/* MediaType */.zu.Data;\n  }\n\n  /**\n   * Media width, in pixels\n   * @returns {number}\n   */\n  get width() {\n    return this._data ? this._data.width : 0;\n  }\n\n  /**\n   * Media height, in pixels\n   * @returns {number}\n   */\n  get height() {\n    return this._data ? this._data.height : 0;\n  }\n\n  /**\n   * Clone this media source\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  clone() {\n    if (this._data == null) throw new utils_errors/* IllegalOperationError */.Er(`Media not loaded`);\n    const imageDataCopy = new ImageData(new Uint8ClampedArray(this._data.data), this._data.width, this._data.height);\n    return SpeedyDataMediaSource.load(imageDataCopy);\n  }\n\n  /**\n   * Load the underlying media\n   * @param {ImageData} imageData\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  _load(imageData) {\n    if (this.isLoaded()) this.release();\n    return new speedy_promise/* SpeedyPromise */.i(resolve => {\n      this._data = imageData;\n      resolve(this);\n    });\n  }\n\n  /**\n   * Load the underlying media\n   * @param {ImageData} imageData\n   * @returns {SpeedyPromise<SpeedyMediaSource>}\n   */\n  static load(imageData) {\n    return new SpeedyDataMediaSource(PRIVATE_TOKEN)._load(imageData);\n  }\n}\n// EXTERNAL MODULE: ./src/utils/observable.js\nvar observable = __webpack_require__(3211);\n;// CONCATENATED MODULE: ./src/gpu/speedy-gpu.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-gpu.js\n * GPU-accelerated routines for Computer Vision\n */\n\n\n\n\n\n\n\n\n\n\n/**\n * GPU-accelerated routines for Computer Vision\n */\nclass SpeedyGPU extends observable/* Observable */.c {\n  /**\n   * Constructor\n   */\n  constructor() {\n    super();\n\n    /** @type {SpeedyGL} cached reference */\n    this._speedyGL = speedy_gl/* SpeedyGL */.c.instance;\n\n    /** @type {SpeedyProgramCenter} GPU-based programs */\n    this._programs = new SpeedyProgramCenter(this);\n\n    /** @type {SpeedyTexturePool} texture pool */\n    this._texturePool = new SpeedyTexturePool(this);\n\n    // recreate the state if necessary\n    this._speedyGL.subscribe(this._reset, this);\n  }\n\n  /**\n   * Access point to all GPU programs\n   * @returns {SpeedyProgramCenter}\n   */\n  get programs() {\n    return this._programs;\n  }\n\n  /**\n   * The WebGL Rendering Context\n   * Be careful not to cache this, as the WebGL Rendering Context may be lost!\n   * @returns {WebGL2RenderingContext}\n   */\n  get gl() {\n    return this._speedyGL.gl;\n  }\n\n  /**\n   * Internal canvas\n   * @returns {HTMLCanvasElement}\n   */\n  get canvas() {\n    return this._speedyGL.canvas;\n  }\n\n  /**\n   * Texture pool\n   * @returns {SpeedyTexturePool}\n   */\n  get texturePool() {\n    return this._texturePool;\n  }\n\n  /**\n   * Renders a texture to the canvas\n   * @param {SpeedyTexture} texture\n   * @returns {HTMLCanvasElement} returned for convenience\n   */\n  renderToCanvas(texture) {\n    const width = texture.width;\n    const height = texture.height;\n    const canvas = this.canvas;\n\n    // do we need to resize the canvas?\n    if (width > canvas.width || height > canvas.height) {\n      utils/* Utils */.A.warning(`Resizing the canvas to ${width} x ${height}`);\n      canvas.width = width;\n      canvas.height = height;\n    }\n\n    // render\n    this.programs.utils.renderToCanvas.outputs(width, height, null);\n    this.programs.utils.renderToCanvas(texture);\n\n    // done!\n    return canvas;\n  }\n\n  /**\n   * Upload an image to the GPU\n   * @param {SpeedyMediaSource} source\n   * @param {SpeedyTexture} outputTexture\n   * @returns {SpeedyTexture} outputTexture\n   */\n  upload(source, outputTexture) {\n    return outputTexture.upload(source.data, source.width, source.height);\n  }\n\n  /**\n   * Releases resources\n   * @returns {null}\n   */\n  release() {\n    utils/* Utils */.A.assert(!this.isReleased());\n\n    // release internal components\n    this._programs = this._programs.release();\n    this._texturePool = this._texturePool.release();\n\n    // unsubscribe\n    this._speedyGL.unsubscribe(this._reset);\n    return null;\n  }\n\n  /**\n   * Has this SpeedyGPU been released?\n   * @returns {boolean}\n   */\n  isReleased() {\n    return this._programs == null;\n  }\n\n  /**\n   * Lose & restore the WebGL context (useful for testing purposes)\n   * @return {SpeedyPromise<void>} resolves as soon as the context is restored\n   */\n  loseAndRestoreWebGLContext() {\n    return this._speedyGL.loseAndRestoreContext().then(() => void 0);\n  }\n\n  /**\n   * Reset the internal state\n   * (called on context reset)\n   */\n  _reset() {\n    if (this.isReleased()) return;\n    this._programs = new SpeedyProgramCenter(this);\n    this._texturePool = new SpeedyTexturePool(this);\n    this._notify();\n  }\n}\n;// CONCATENATED MODULE: ./src/core/speedy-size.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-size.js\n * Size of a rectangle\n */\n\n/**\n * Size of a rectangle\n */\nclass SpeedySize {\n  /**\n   * Constructor\n   * @param {number} width non-negative number\n   * @param {number} height non-negative number\n   */\n  constructor(width, height) {\n    /** @type {number} width */\n    this._width = Math.max(0, +width);\n\n    /** @type {number} height */\n    this._height = Math.max(0, +height);\n  }\n\n  //\n  // ===== METHODS =====\n  //\n\n  /**\n   * Width\n   * @returns {number}\n   */\n  get width() {\n    return this._width;\n  }\n\n  /**\n   * Width\n   * @param {number} value\n   */\n  set width(value) {\n    this._width = Math.max(0, +value);\n  }\n\n  /**\n   * Height\n   * @returns {number}\n   */\n  get height() {\n    return this._height;\n  }\n\n  /**\n   * Height\n   * @param {number} value\n   */\n  set height(value) {\n    this._height = Math.max(0, +value);\n  }\n\n  /**\n   * Convert to string\n   * @returns {string}\n   */\n  toString() {\n    return `SpeedySize(${this.width}, ${this.height})`;\n  }\n\n  /**\n   * Is this size equal to anotherSize?\n   * @param {SpeedySize} anotherSize\n   * @returns {boolean}\n   */\n  equals(anotherSize) {\n    return this.width === anotherSize.width && this.height === anotherSize.height;\n  }\n\n  /**\n   * The area of the rectangle\n   * @returns {number}\n   */\n  area() {\n    return this.width * this.height;\n  }\n}\n;// CONCATENATED MODULE: ./src/core/speedy-media.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-media.js\n * SpeedyMedia implementation\n */\n\n\n\n\n\n\n\n\n\n\n/** @typedef {import('./speedy-media-source').SpeedyMediaSourceNativeElement} SpeedyMediaSourceNativeElement */\n\n/**\n * @typedef {object} SpeedyMediaOptions\n * @property {ImageFormat} [format] default is RGBA\n */\n\n/** A helper used to keep the constructor of SpeedyMedia private */\nconst speedy_media_PRIVATE_TOKEN = Symbol();\n\n/**\n * SpeedyMedia encapsulates a media element\n * (e.g., image, video, canvas)\n */\nclass SpeedyMedia {\n  /**\n   * @private Constructor. It receives a VALID media source that is ALREADY LOADED.\n   * @param {symbol} token\n   * @param {SpeedyMediaSource} source\n   * @param {SpeedyMediaOptions} [options] options object\n   */\n  constructor(token, source, options = {}) {\n    // private constructor\n    if (token !== speedy_media_PRIVATE_TOKEN) throw new utils_errors/* IllegalOperationError */.Er();\n\n    /** @type {SpeedyMediaSource} media source */\n    this._source = source;\n\n    /** @type {ImageFormat} format */\n    this._format = options.format !== undefined ? options.format : types/* ImageFormat */.f5.RGBA;\n\n    /** @type {SpeedyMediaOptions} options */\n    this._options = Object.freeze(Object.assign(Object.assign({}, options), {}, {\n      format: this._format\n    }));\n\n    // validate\n    if (!source.isLoaded()) throw new utils_errors/* IllegalOperationError */.Er(`Source not loaded: ${source}`);else if (this._format !== types/* ImageFormat */.f5.RGBA && this._format !== types/* ImageFormat */.f5.GREY) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid format: ${this._format}`);\n  }\n\n  /**\n   * Load a media source\n   * Will wait until the HTML media source is loaded\n   * @param {SpeedyMediaSourceNativeElement} mediaSource An image, video or canvas\n   * @param {SpeedyMediaOptions} [options] options object\n   * @param {boolean} [log] show log message?\n   * @returns {SpeedyPromise<SpeedyMedia>}\n   */\n  static load(mediaSource, options = {}, log = true) {\n    return SpeedyMediaSource.load(mediaSource).then(source => {\n      utils/* Utils */.A.assert(source.width !== 0 && source.height !== 0);\n\n      // FIXME user could pass an invalid format in options if ImageFormat is made public\n      const media = new SpeedyMedia(speedy_media_PRIVATE_TOKEN, source, options);\n\n      // show log message\n      if (log) utils/* Utils */.A.log(`Loaded SpeedyMedia with a ${mediaSource}.`);\n\n      // done!\n      return media;\n    });\n  }\n\n  /**\n   * The media element (image, video, canvas) encapsulated by this SpeedyMedia object\n   * @returns {SpeedyMediaSourceNativeElement} the media element\n   */\n  get source() {\n    return this._source ? this._source.data : null;\n  }\n\n  /**\n   * The type of the media attached to this SpeedyMedia object\n   * @returns {\"image\" | \"video\" | \"canvas\" | \"offscreen-canvas\" | \"bitmap\" | \"data\" | \"unknown\"}\n   */\n  get type() {\n    if (this.isReleased()) return 'unknown';\n    switch (this._source.type) {\n      case types/* MediaType */.zu.Image:\n        return 'image';\n      case types/* MediaType */.zu.Video:\n        return 'video';\n      case types/* MediaType */.zu.Canvas:\n        return 'canvas';\n      case types/* MediaType */.zu.OffscreenCanvas:\n        return 'offscreen-canvas';\n      case types/* MediaType */.zu.Bitmap:\n        return 'bitmap';\n      case types/* MediaType */.zu.Data:\n        return 'data';\n      default:\n        // this shouldn't happen\n        return 'unknown';\n    }\n  }\n\n  /**\n   * Gets the width of the media\n   * @returns {number} media width\n   */\n  get width() {\n    return this._source ? this._source.width : 0;\n  }\n\n  /**\n   * Gets the height of the media\n   * @returns {number} media height\n   */\n  get height() {\n    return this._source ? this._source.height : 0;\n  }\n\n  /**\n   * The size of this media, in pixels\n   * @returns {SpeedySize}\n   */\n  get size() {\n    return this._source ? new SpeedySize(this._source.width, this._source.height) : new SpeedySize(0, 0);\n  }\n\n  /**\n   * Returns a read-only object featuring advanced options\n   * related to this SpeedyMedia object\n   * @returns {SpeedyMediaOptions}\n   */\n  get options() {\n    return this._options;\n  }\n\n  /**\n   * Releases resources associated with this media\n   * @returns {null}\n   */\n  release() {\n    if (!this.isReleased()) {\n      utils/* Utils */.A.log('Releasing SpeedyMedia object...');\n      this._source = this._source.release();\n    }\n    return null;\n  }\n\n  /**\n   * Has this media been released?\n   * @returns {boolean}\n   */\n  isReleased() {\n    return this._source == null;\n  }\n\n  /**\n   * Clones the SpeedyMedia object\n   * @returns {SpeedyPromise<SpeedyMedia>} a clone object\n   */\n  clone() {\n    // has the media been released?\n    if (this.isReleased()) throw new utils_errors/* IllegalOperationError */.Er(`Can't clone a SpeedyMedia that has been released`);\n\n    // clone the object\n    const clone = new SpeedyMedia(speedy_media_PRIVATE_TOKEN, this._source, this._options);\n\n    // done!\n    return speedy_promise/* SpeedyPromise */.i.resolve(clone);\n  }\n\n  /**\n   * Converts the media to an ImageBitmap\n   * @returns {SpeedyPromise<ImageBitmap>}\n   */\n  toBitmap() {\n    if (this.isReleased()) throw new utils_errors/* IllegalOperationError */.Er('Can\\'t convert SpeedyMedia to ImageBitmap: the media has been released');else if (!this._source.isLoaded()) throw new utils_errors/* IllegalOperationError */.Er('Can\\'t convert SpeedyMedia to bitmap: the media hasn\\'t been loaded');else if (this._source.type == types/* MediaType */.zu.Bitmap) return speedy_promise/* SpeedyPromise */.i.resolve(this._source.data);else return new speedy_promise/* SpeedyPromise */.i((resolve, reject) => createImageBitmap(this._source.data).then(resolve, reject));\n  }\n}\n;// CONCATENATED MODULE: ./src/core/speedy-platform.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-platform.js\n * Utilities to query information about the graphics driver\n */\n\n\n\n\n/**\n * Utilities to query information about the graphics driver. This information\n * may or may not be available, depending on the privacy settings of the web\n * browser. In addition, it may be more or less accurate in different browsers.\n */\nclass SpeedyPlatform extends speedy_namespace/* SpeedyNamespace */.Q {\n  /**\n   * Renderer string of the graphics driver\n   * @returns {string}\n   */\n  static get renderer() {\n    return speedy_gl/* SpeedyGL */.c.instance.renderer;\n  }\n\n  /**\n   * Vendor string of the graphics driver\n   * @returns {string}\n   */\n  static get vendor() {\n    return speedy_gl/* SpeedyGL */.c.instance.vendor;\n  }\n}\n;// CONCATENATED MODULE: ./src/core/speedy-vector.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-vector.js\n * Vectors\n */\n\n/**\n * 2D vector of floating-point numbers\n */\nclass SpeedyVector2 {\n  /**\n   * Create a 2D vector\n   * @param {number} x\n   * @param {number} y\n   */\n  constructor(x, y) {\n    /** @type {number} x coordinate */\n    this._x = +x;\n\n    /** @type {number} y coordinate */\n    this._y = +y;\n  }\n\n  //\n  // ===== METHODS =====\n  //\n\n  /**\n   * x-coordinate\n   * @returns {number}\n   */\n  get x() {\n    return this._x;\n  }\n\n  /**\n   * x-coordinate\n   * @param {number} value\n   */\n  set x(value) {\n    this._x = +value;\n  }\n\n  /**\n   * y-coordinate\n   * @returns {number}\n   */\n  get y() {\n    return this._y;\n  }\n\n  /**\n   * y-coordinate\n   * @param {number} value\n   */\n  set y(value) {\n    this._y = +value;\n  }\n\n  /**\n   * Convert to string\n   * @returns {string}\n   */\n  toString() {\n    return `SpeedyVector2(${this.x.toFixed(5)}, ${this.y.toFixed(5)})`;\n  }\n\n  /**\n   * Is this vector equal to v?\n   * @param {SpeedyVector2} v\n   * @returns {boolean}\n   */\n  equals(v) {\n    return this.x === v.x && this.y === v.y;\n  }\n\n  /**\n   * Dot product between this vector and another vector\n   * @param {SpeedyVector2} v another vector\n   * @returns {number}\n   */\n  dot(v) {\n    return this.x * v.x + this.y * v.y;\n  }\n\n  /**\n   * The distance between this vector and another vector\n   * @param {SpeedyVector2} v another vector\n   * @returns {number}\n   */\n  distanceTo(v) {\n    const dx = this.x - v.x;\n    const dy = this.y - v.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  /**\n   * Euclidean norm\n   * @returns {number}\n   */\n  length() {\n    return Math.sqrt(this.x * this.x + this.y * this.y);\n  }\n\n  /**\n   * Returns a normalized version of this vector\n   * @returns {SpeedyVector2}\n   */\n  normalized() {\n    const len = this.length();\n    if (len > 0.0) return new SpeedyVector2(this.x / len, this.y / len);else return new SpeedyVector2(0.0, 0.0);\n  }\n\n  /**\n   * Returns a copy of this vector translated by offset\n   * @param {SpeedyVector2} offset\n   * @returns {SpeedyVector2}\n   */\n  plus(offset) {\n    return new SpeedyVector2(this.x + offset.x, this.y + offset.y);\n  }\n\n  /**\n   * Returns a copy of this vector translated by -offset\n   * @param {SpeedyVector2} offset\n   * @returns {SpeedyVector2}\n   */\n  minus(offset) {\n    return new SpeedyVector2(this.x - offset.x, this.y - offset.y);\n  }\n\n  /**\n   * Returns a copy of this vector scaled by a scalar\n   * @param {number} scalar\n   * @returns {SpeedyVector2}\n   */\n  times(scalar) {\n    return new SpeedyVector2(this.x * scalar, this.y * scalar);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/speedy-point.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-point.js\n * Points in space\n */\n\n\n\n/**\n * 2D point\n */\nclass SpeedyPoint2 {\n  /**\n   * Create a 2D point\n   * @param {number} x\n   * @param {number} y\n   */\n  constructor(x, y) {\n    /** @type {number} x coordinate */\n    this._x = +x;\n\n    /** @type {number} y coordinate */\n    this._y = +y;\n  }\n\n  //\n  // ===== METHODS =====\n  //\n\n  /**\n   * x-coordinate\n   * @returns {number}\n   */\n  get x() {\n    return this._x;\n  }\n\n  /**\n   * x-coordinate\n   * @param {number} value\n   */\n  set x(value) {\n    this._x = +value;\n  }\n\n  /**\n   * y-coordinate\n   * @returns {number}\n   */\n  get y() {\n    return this._y;\n  }\n\n  /**\n   * y-coordinate\n   * @param {number} value\n   */\n  set y(value) {\n    this._y = +value;\n  }\n\n  /**\n   * Convert to string\n   * @returns {string}\n   */\n  toString() {\n    return `SpeedyPoint2(${this.x.toFixed(5)}, ${this.y.toFixed(5)})`;\n  }\n\n  /**\n   * Add a vector to this point\n   * @param {SpeedyVector2} v \n   * @returns {SpeedyPoint2}\n   */\n  plus(v) {\n    return new SpeedyPoint2(this.x + v.x, this.y + v.y);\n  }\n\n  /**\n   * Subtracts a point p from this point\n   * @param {SpeedyPoint2} p \n   * @returns {SpeedyVector2}\n   */\n  minus(p) {\n    return new SpeedyVector2(this.x - p.x, this.y - p.y);\n  }\n\n  /**\n   * Is this point equal to p?\n   * @param {SpeedyPoint2} p\n   * @returns {boolean}\n   */\n  equals(p) {\n    return this.x === p.x && this.y === p.y;\n  }\n}\n// EXTERNAL MODULE: ./src/core/speedy-matrix-expr.js\nvar speedy_matrix_expr = __webpack_require__(6306);\n// EXTERNAL MODULE: ./src/core/speedy-matrix-wasm.js\nvar speedy_matrix_wasm = __webpack_require__(6465);\n// EXTERNAL MODULE: ./src/core/speedy-matrix.js\nvar speedy_matrix = __webpack_require__(4188);\n;// CONCATENATED MODULE: ./src/core/speedy-matrix-factory.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-matrix-factory.js\n * A factory of matrices\n */\n\n\n\n\n\n\n\n\n/**\n * Matrix routines\n */\nclass SpeedyMatrixFactory extends Function {\n  /**\n   * Constructor\n   */\n  constructor() {\n    // This factory can be invoked as a function\n    super('...args', 'return args.length > 1 ? this._create(...args) : this._from(args[0])');\n    return this.bind(this);\n  }\n\n  /**\n   * @private\n   *\n   * Create a new matrix filled with the specified size and entries\n   * @param {number} rows\n   * @param {number} [columns]\n   * @param {number[]} [entries] in column-major format\n   * @returns {SpeedyMatrix}\n   */\n  _create(rows, columns = rows, entries = []) {\n    return speedy_matrix.SpeedyMatrix.Create(rows, columns, entries);\n  }\n\n  /**\n   * @private\n   *\n   * Evaluate an expression synchronously and store the result in a new matrix\n   * @param {SpeedyMatrixExpr} expr matrix expression\n   * @returns {SpeedyMatrix}\n   */\n  _from(expr) {\n    return speedy_matrix.SpeedyMatrix.From(expr);\n  }\n\n  /**\n   * Create a new matrix filled with zeros with the specified size\n   * @param {number} rows\n   * @param {number} [columns]\n   * @returns {SpeedyMatrix}\n   */\n  Zeros(rows, columns = rows) {\n    return speedy_matrix.SpeedyMatrix.Zeros(rows, columns);\n  }\n\n  /**\n   * Create a new matrix filled with ones with the specified size\n   * @param {number} rows\n   * @param {number} [columns]\n   * @returns {SpeedyMatrix}\n   */\n  Ones(rows, columns = rows) {\n    return speedy_matrix.SpeedyMatrix.Ones(rows, columns);\n  }\n\n  /**\n   * Create an identity matrix with the specified size\n   * @param {number} rows\n   * @param {number} [columns]\n   * @returns {SpeedyMatrix}\n   */\n  Eye(rows, columns = rows) {\n    return speedy_matrix.SpeedyMatrix.Eye(rows, columns);\n  }\n\n  /**\n   * Returns a promise that resolves immediately if the WebAssembly routines\n   * are ready to be used, or as soon as they do become ready\n   * @returns {SpeedyPromise<void>}\n   */\n  ready() {\n    return speedy_matrix.SpeedyMatrix.ready();\n  }\n\n  /**\n   * QR decomposition\n   * @param {SpeedyMatrix} Q is m x n (reduced) or m x m (full), output\n   * @param {SpeedyMatrix} R is n x n (reduced) or m x n (full), output\n   * @param {SpeedyMatrix} mat is m x n, input\n   * @param {object} [options]\n   * @param {'reduced'|'full'} [options.mode]\n   * @returns {SpeedyPromise<[SpeedyMatrix,SpeedyMatrix]>} resolves to [Q,R]\n   */\n  qr(Q, R, mat, {\n    mode = 'reduced'\n  } = {}) {\n    const A = mat,\n      m = mat.rows,\n      n = mat.columns;\n\n    // validate shapes & mode\n    if (mode == 'reduced') {\n      if (Q.rows != m || Q.columns != n || R.rows != n || R.columns != n) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid shape for reduced QR`);\n    } else if (mode == 'full') {\n      if (Q.rows != m || Q.columns != m || R.rows != m || R.columns != n) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid shape for full QR`);\n    } else throw new utils_errors/* IllegalArgumentError */.qw(`Invalid mode for QR: \"${mode}\"`);\n    return speedy_matrix_wasm/* SpeedyMatrixWASM */.U.ready().then(({\n      wasm,\n      memory\n    }) => {\n      // allocate matrices\n      const Qptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, Q);\n      const Rptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, R);\n      const Aptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, A);\n\n      // copy input matrices to WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, Aptr, A);\n\n      // run the WASM routine\n      if (mode == 'reduced') wasm.exports.Mat32_qr_reduced(Qptr, Rptr, Aptr);else wasm.exports.Mat32_qr_full(Qptr, Rptr, Aptr);\n\n      // copy output matrices from WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyFromMat32(wasm, memory, Qptr, Q);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyFromMat32(wasm, memory, Rptr, R);\n\n      // deallocate matrices\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, Aptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, Rptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, Qptr);\n\n      // done!\n      return [Q, R];\n    });\n  }\n\n  /**\n   * Solve a possibly overdetermined system of linear\n   * equations Ax = b for x using ordinary least squares\n   * @param {SpeedyMatrix} solution n x 1, output\n   * @param {SpeedyMatrix} A m x n, m >= n, input\n   * @param {SpeedyMatrix} b m x 1, output\n   * @param {object} [options]\n   * @param {'qr'} [options.method] method of resolution\n   * @returns {SpeedyPromise<SpeedyMatrix>} resolves to solution\n   */\n  ols(solution, A, b, {\n    method = 'qr'\n  } = {}) {\n    const m = A.rows,\n      n = A.columns;\n    const x = solution;\n\n    // validate shapes\n    if (m < n || n == 0) throw new utils_errors/* IllegalArgumentError */.qw(`Can't solve an underdetermined system of equations`);else if (b.rows != m || b.columns != 1 || x.rows != n || x.columns != 1) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid shapes`);\n    return speedy_matrix_wasm/* SpeedyMatrixWASM */.U.ready().then(({\n      wasm,\n      memory\n    }) => {\n      // allocate matrices\n      const Aptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, A);\n      const bptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, b);\n      const xptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, x);\n\n      // copy input matrices to WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, Aptr, A);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, bptr, b);\n\n      // run the WASM routine\n      switch (method) {\n        case 'qr':\n          wasm.exports.Mat32_qr_ols(xptr, Aptr, bptr, 2);\n          break;\n        default:\n          throw new utils_errors/* IllegalArgumentError */.qw(`Invalid method: \"${method}\"`);\n      }\n\n      // copy output matrix from WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyFromMat32(wasm, memory, xptr, x);\n\n      // deallocate matrices\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, xptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, bptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, Aptr);\n\n      // done!\n      return solution;\n    });\n  }\n\n  /**\n   * Solve a system of linear equations Ax = b for x\n   * @param {SpeedyMatrix} solution m x 1, output\n   * @param {SpeedyMatrix} A m x m, input\n   * @param {SpeedyMatrix} b m x 1, output\n   * @param {object} [options]\n   * @param {'qr'} [options.method] method of resolution\n   * @returns {SpeedyPromise<SpeedyMatrix>} resolves to solution\n   */\n  solve(solution, A, b, {\n    method = 'qr'\n  } = {}) {\n    const m = A.rows,\n      n = A.columns;\n    const x = solution;\n\n    // validate shapes\n    if (m != n) throw new utils_errors/* IllegalArgumentError */.qw(`Can't solve an over or underdetermined system of equations`);else if (b.rows != m || b.columns != 1 || x.rows != m || x.columns != 1) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid shapes`);\n    return speedy_matrix_wasm/* SpeedyMatrixWASM */.U.ready().then(({\n      wasm,\n      memory\n    }) => {\n      // select method\n      switch (method) {\n        case 'qr':\n          return this.ols(x, A, b, {\n            method\n          });\n\n        /*case 'lu':\n            break;*/\n\n        default:\n          throw new utils_errors/* IllegalArgumentError */.qw(`Invalid method: \"${method}\"`);\n      }\n    });\n  }\n\n  /**\n   * Compute a perspective transformation using 4 correspondences of points\n   * @param {SpeedyMatrix} homography 3x3 output - homography matrix\n   * @param {SpeedyMatrix} src 2x4 input points - source coordinates\n   * @param {SpeedyMatrix} dest 2x4 input points - destination coordinates\n   * @returns {SpeedyPromise<SpeedyMatrix>} resolves to homography\n   */\n  perspective(homography, src, dest) {\n    // validate shapes\n    if (src.rows != 2 || src.columns != 4 || dest.rows != 2 || dest.columns != 4) throw new utils_errors/* IllegalArgumentError */.qw(`You need two 2x4 input matrices to compute a perspective transformation`);else if (homography.rows != 3 || homography.columns != 3) throw new utils_errors/* IllegalArgumentError */.qw(`The output of perspective() is a 3x3 homography`);\n    return speedy_matrix_wasm/* SpeedyMatrixWASM */.U.ready().then(({\n      wasm,\n      memory\n    }) => {\n      // allocate matrices\n      const homptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, homography);\n      const srcptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, src);\n      const destptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, dest);\n\n      // copy input matrices to WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, srcptr, src);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, destptr, dest);\n\n      // run the WASM routine\n      wasm.exports.Mat32_homography_ndlt4(homptr, srcptr, destptr);\n\n      // copy output matrix from WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyFromMat32(wasm, memory, homptr, homography);\n\n      // deallocate matrices\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, destptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, srcptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, homptr);\n\n      // done!\n      return homography;\n    });\n  }\n\n  /**\n   * Compute a perspective transformation using n >= 4 correspondences of points\n   * @param {SpeedyMatrix} homography 3x3 output - homography matrix\n   * @param {SpeedyMatrix} src 2 x n input points - source coordinates\n   * @param {SpeedyMatrix} dest 2 x n input points - destination coordinates\n   * @param {object} [options]\n   * @param {'default'|'pransac'} [options.method] method of computation\n   * @param {SpeedyMatrix|null} [options.mask] (pransac) 1 x n output: i-th entry will be 1 if the i-th input point is an inlier, or 0 otherwise\n   * @param {number} [options.reprojectionError] (pransac) given in pixels, used to separate inliers from outliers of a particular model (e.g., 1 pixel)\n   * @param {number} [options.numberOfHypotheses] (pransac) number of hypotheses to be generated up-front (e.g., 512)\n   * @param {number} [options.bundleSize] (pransac) how many points should we check before reducing the number of viable hypotheses (e.g., 128)\n   * @returns {SpeedyPromise<SpeedyMatrix>} resolves to homography\n   */\n  findHomography(homography, src, dest, {\n    method = 'default',\n    mask = null,\n    reprojectionError = 3,\n    numberOfHypotheses = 512,\n    bundleSize = 128\n  } = {}) {\n    // validate shapes\n    if (src.rows != 2 || src.columns < 4 || dest.rows != 2 || dest.columns != src.columns) throw new utils_errors/* IllegalArgumentError */.qw(`You need two 2 x n (n >= 4) input matrices to compute a homography`);else if (homography.rows != 3 || homography.columns != 3) throw new utils_errors/* IllegalArgumentError */.qw(`The output of findHomography() is a 3x3 homography`);else if (mask != null && (mask.rows != 1 || mask.columns != src.columns)) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid shape of the inliers mask`);\n    return speedy_matrix_wasm/* SpeedyMatrixWASM */.U.ready().then(({\n      wasm,\n      memory\n    }) => {\n      // allocate matrices\n      const homptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, homography);\n      const srcptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, src);\n      const destptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, dest);\n      const maskptr = mask != null ? speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, mask) : 0;\n\n      // copy input matrices to WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, srcptr, src);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, destptr, dest);\n\n      // run the WASM routine\n      switch (method) {\n        case 'pransac':\n          utils/* Utils */.A.assert(reprojectionError >= 0 && numberOfHypotheses > 0 && bundleSize > 0);\n          wasm.exports.Mat32_pransac_homography(homptr, maskptr, srcptr, destptr, numberOfHypotheses, bundleSize, reprojectionError);\n          break;\n        case 'default':\n        case 'dlt':\n          // obsolete\n          wasm.exports.Mat32_homography_ndlt(homptr, srcptr, destptr);\n          break;\n        default:\n          throw new utils_errors/* IllegalArgumentError */.qw(`Illegal method for findHomography(): \"${method}\"`);\n      }\n\n      // copy output matrices from WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyFromMat32(wasm, memory, homptr, homography);\n      if (mask != null) speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyFromMat32(wasm, memory, maskptr, mask);\n\n      // deallocate matrices\n      if (mask != null) speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, maskptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, destptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, srcptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, homptr);\n\n      // done!\n      return homography;\n    });\n  }\n\n  /**\n   * Apply a perspective transformation to a set of 2D points\n   * @param {SpeedyMatrix} dest 2 x n output matrix\n   * @param {SpeedyMatrix} src 2 x n input matrix (a set of points)\n   * @param {SpeedyMatrix} transform 3x3 homography matrix\n   * @returns {SpeedyPromise<SpeedyMatrix>} resolves to dest\n   */\n  applyPerspectiveTransform(dest, src, transform) {\n    // validate shapes\n    if (src.rows != 2 || dest.rows != 2 || src.columns != dest.columns) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid shapes`);else if (transform.rows != 3 || transform.columns != 3) throw new utils_errors/* IllegalArgumentError */.qw(`The perspective transformation must be a 3x3 matrix`);\n    return speedy_matrix_wasm/* SpeedyMatrixWASM */.U.ready().then(({\n      wasm,\n      memory\n    }) => {\n      // allocate matrices\n      const matptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, transform);\n      const srcptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, src);\n      const destptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, dest);\n\n      // copy input matrices to WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, srcptr, src);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, matptr, transform);\n\n      // run the WASM routine\n      wasm.exports.Mat32_transform_perspective(destptr, srcptr, matptr);\n\n      // copy output matrix from WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyFromMat32(wasm, memory, destptr, dest);\n\n      // deallocate matrices\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, destptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, srcptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, matptr);\n\n      // done!\n      return dest;\n    });\n  }\n\n  /**\n   * Compute an affine transform using 3 correspondences of points\n   * @param {SpeedyMatrix} transform 2x3 output - affine transform\n   * @param {SpeedyMatrix} src 2x3 input points - source coordinates\n   * @param {SpeedyMatrix} dest 2x3 input points - destination coordinates\n   * @returns {SpeedyPromise<SpeedyMatrix>} resolves to homography\n   */\n  affine(transform, src, dest) {\n    // validate shapes\n    if (src.rows != 2 || src.columns != 3 || dest.rows != 2 || dest.columns != 3) throw new utils_errors/* IllegalArgumentError */.qw(`You need two 2x3 input matrices to compute an affine transform`);else if (transform.rows != 2 || transform.columns != 3) throw new utils_errors/* IllegalArgumentError */.qw(`The output of affine() is a 2x3 matrix`);\n    return speedy_matrix_wasm/* SpeedyMatrixWASM */.U.ready().then(({\n      wasm,\n      memory\n    }) => {\n      // allocate matrices\n      const matptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, transform);\n      const srcptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, src);\n      const destptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, dest);\n\n      // copy input matrices to WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, srcptr, src);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, destptr, dest);\n\n      // run the WASM routine\n      wasm.exports.Mat32_affine_direct3(matptr, srcptr, destptr);\n\n      // copy output matrix from WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyFromMat32(wasm, memory, matptr, transform);\n\n      // deallocate matrices\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, destptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, srcptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, matptr);\n\n      // done!\n      return transform;\n    });\n  }\n\n  /**\n   * Compute an affine transformation using n >= 3 correspondences of points\n   * @param {SpeedyMatrix} transform 2x3 output - affine transform\n   * @param {SpeedyMatrix} src 2 x n input points - source coordinates\n   * @param {SpeedyMatrix} dest 2 x n input points - destination coordinates\n   * @param {object} [options]\n   * @param {'default'|'pransac'} [options.method] method of computation\n   * @param {SpeedyMatrix|null} [options.mask] (pransac) 1 x n output: i-th entry will be 1 if the i-th input point is an inlier, or 0 otherwise\n   * @param {number} [options.reprojectionError] (pransac) given in pixels, used to separate inliers from outliers of a particular model (e.g., 1 pixel)\n   * @param {number} [options.numberOfHypotheses] (pransac) number of hypotheses to be generated up-front (e.g., 512)\n   * @param {number} [options.bundleSize] (pransac) how many points should we check before reducing the number of viable hypotheses (e.g., 128)\n   * @returns {SpeedyPromise<SpeedyMatrix>} resolves to an affine transform\n   */\n  findAffineTransform(transform, src, dest, {\n    method = 'default',\n    mask = null,\n    reprojectionError = 3,\n    numberOfHypotheses = 512,\n    bundleSize = 128\n  } = {}) {\n    // validate shapes\n    if (src.rows != 2 || src.columns < 3 || dest.rows != 2 || dest.columns != src.columns) throw new utils_errors/* IllegalArgumentError */.qw(`You need two 2 x n (n >= 3) input matrices to compute an affine transform`);else if (transform.rows != 2 || transform.columns != 3) throw new utils_errors/* IllegalArgumentError */.qw(`The output of findAffineTransform() is a 2x3 matrix`);else if (mask != null && (mask.rows != 1 || mask.columns != src.columns)) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid shape of the inliers mask`);\n    return speedy_matrix_wasm/* SpeedyMatrixWASM */.U.ready().then(({\n      wasm,\n      memory\n    }) => {\n      // allocate matrices\n      const matptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, transform);\n      const srcptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, src);\n      const destptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, dest);\n      const maskptr = mask != null ? speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, mask) : 0;\n\n      // copy input matrices to WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, srcptr, src);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, destptr, dest);\n\n      // run the WASM routine\n      switch (method) {\n        case 'pransac':\n          utils/* Utils */.A.assert(reprojectionError >= 0 && numberOfHypotheses > 0 && bundleSize > 0);\n          wasm.exports.Mat32_pransac_affine(matptr, maskptr, srcptr, destptr, numberOfHypotheses, bundleSize, reprojectionError);\n          break;\n        case 'default':\n          wasm.exports.Mat32_affine_direct(matptr, srcptr, destptr);\n          break;\n        default:\n          throw new utils_errors/* IllegalArgumentError */.qw(`Illegal method for findAffineTransform(): \"${method}\"`);\n      }\n\n      // copy output matrices from WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyFromMat32(wasm, memory, matptr, transform);\n      if (mask != null) speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyFromMat32(wasm, memory, maskptr, mask);\n\n      // deallocate matrices\n      if (mask != null) speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, maskptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, destptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, srcptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, matptr);\n\n      // done!\n      return transform;\n    });\n  }\n\n  /**\n   * Apply an affine transformation to a set of 2D points\n   * @param {SpeedyMatrix} dest 2 x n output matrix\n   * @param {SpeedyMatrix} src 2 x n input matrix (a set of points)\n   * @param {SpeedyMatrix} transform 2x3 affine transform\n   * @returns {SpeedyPromise<SpeedyMatrix>} resolves to dest\n   */\n  applyAffineTransform(dest, src, transform) {\n    // validate shapes\n    if (src.rows != 2 || dest.rows != 2 || src.columns != dest.columns) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid shapes`);else if (transform.rows != 2 || transform.columns != 3) throw new utils_errors/* IllegalArgumentError */.qw(`The affine transformation must be a 2x3 matrix`);\n    return speedy_matrix_wasm/* SpeedyMatrixWASM */.U.ready().then(({\n      wasm,\n      memory\n    }) => {\n      // allocate matrices\n      const matptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, transform);\n      const srcptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, src);\n      const destptr = speedy_matrix_wasm/* SpeedyMatrixWASM */.U.allocateMat32(wasm, memory, dest);\n\n      // copy input matrices to WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, srcptr, src);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyToMat32(wasm, memory, matptr, transform);\n\n      // run the WASM routine\n      wasm.exports.Mat32_transform_affine(destptr, srcptr, matptr);\n\n      // copy output matrix from WASM memory\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.copyFromMat32(wasm, memory, destptr, dest);\n\n      // deallocate matrices\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, destptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, srcptr);\n      speedy_matrix_wasm/* SpeedyMatrixWASM */.U.deallocateMat32(wasm, memory, matptr);\n\n      // done!\n      return dest;\n    });\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/pipeline-message.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * pipeline-message.js\n * A message that is shared between nodes of a pipeline\n */\n\n\n\n\n\n\n\n\n/**\n * Types of messages\n * @enum {Symbol}\n */\nconst SpeedyPipelineMessageType = Object.freeze({\n  Nothing: Symbol('Nothing'),\n  Image: Symbol('Image'),\n  Keypoints: Symbol('Keypoints'),\n  Vector2: Symbol('Vector2'),\n  LSHTables: Symbol('LSHTables'),\n  KeypointMatches: Symbol('KeypointMatches')\n});\n\n/**\n * Diagnostic data\n * @typedef {Object.<string, string|number>} SpeedyPipelineMessageDiagnosticData\n */\n\n/**\n * A message that is shared between nodes of a pipeline\n * @abstract\n */\nclass SpeedyPipelineMessage {\n  /**\n   * Constructor\n   * @param {SpeedyPipelineMessageType} type message type\n   */\n  constructor(type) {\n    /** @type {SpeedyPipelineMessageType} message type */\n    this._type = type;\n  }\n\n  /**\n   * Message type\n   * @returns {SpeedyPipelineMessageType}\n   */\n  get type() {\n    return this._type;\n  }\n\n  /**\n   * Checks if the type of this message is equal to parameter type\n   * @param {SpeedyPipelineMessageType} type\n   * @returns {boolean}\n   */\n  hasType(type) {\n    return this._type === type;\n  }\n\n  /**\n   * Is this an empty message?\n   * @returns {boolean}\n   */\n  isEmpty() {\n    return this.hasType(SpeedyPipelineMessageType.Nothing);\n  }\n\n  /**\n   * Convert to string\n   * @returns {string}\n   */\n  toString() {\n    const type = Object.keys(SpeedyPipelineMessageType).find(type => SpeedyPipelineMessageType[type] === this.type);\n    return `message of type ${type}`;\n  }\n\n  /**\n   * Inspect this message for debugging purposes\n   * @param {SpeedyGPU} gpu\n   * @returns {SpeedyPipelineMessageDiagnosticData}\n   */\n  inspect(gpu) {\n    throw new utils_errors/* AbstractMethodError */.aQ();\n  }\n\n  /**\n   * Set parameters\n   * @abstract\n   * @param  {...any} args\n   * @returns {SpeedyPipelineMessage} this message\n   */\n  set(...args) {\n    throw new utils_errors/* AbstractMethodError */.aQ();\n  }\n\n  /**\n   * Create a message of the specified type\n   * @param {SpeedyPipelineMessageType} type\n   * @returns {SpeedyPipelineMessage}\n   */\n  static create(type) {\n    return createMessage(type);\n  }\n}\n\n/**\n * An empty message carrying nothing\n */\nclass SpeedyPipelineMessageWithNothing extends SpeedyPipelineMessage {\n  /**\n   * Constructor\n   */\n  constructor() {\n    super(SpeedyPipelineMessageType.Nothing);\n  }\n\n  /**\n   * Set parameters\n   * @returns {SpeedyPipelineMessage} this message\n   */\n  set() {\n    return this;\n  }\n\n  /**\n   * Inspect this message for debugging purposes\n   * @param {SpeedyGPU} gpu\n   * @returns {SpeedyPipelineMessageDiagnosticData}\n   */\n  inspect(gpu) {\n    return {\n      type: this.constructor.name\n    };\n  }\n}\n\n/**\n * A message transporting an image\n */\nclass SpeedyPipelineMessageWithImage extends SpeedyPipelineMessage {\n  /**\n   * Constructor\n   */\n  constructor() {\n    super(SpeedyPipelineMessageType.Image);\n\n    /** @type {SpeedyDrawableTexture} the image we carry */\n    this._image = null;\n\n    /** @type {ImageFormat} image format */\n    this._format = types/* ImageFormat */.f5.RGBA;\n  }\n\n  /**\n   * Set parameters\n   * @param {SpeedyDrawableTexture} image the image we carry\n   * @param {ImageFormat} [format] image format\n   * @returns {SpeedyPipelineMessage} this message\n   */\n  set(image, format = types/* ImageFormat */.f5.RGBA) {\n    // set parameters\n    this._image = image;\n    this._format = format;\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Inspect this message for debugging purposes\n   * @param {SpeedyGPU} gpu\n   * @returns {SpeedyPipelineMessageDiagnosticData}\n   */\n  inspect(gpu) {\n    const formatName = Object.keys(types/* ImageFormat */.f5).find(format => types/* ImageFormat */.f5[format] === this.format);\n    return {\n      type: this.constructor.name,\n      format: String(formatName),\n      imageSize: this.image ? `${this.image.width}x${this.image.height}` : '0x0',\n      image: this.image ? '<image data>' /* possibly MBs of data */ : '',\n      hasMipmaps: this.image && this.image.hasMipmaps() ? 'yes' : 'no'\n    };\n  }\n\n  /**\n   * The image we carry\n   * @returns {SpeedyDrawableTexture}\n   */\n  get image() {\n    return this._image;\n  }\n\n  /**\n   * Image format\n   * @returns {ImageFormat}\n   */\n  get format() {\n    return this._format;\n  }\n}\n\n/**\n * A message transporting keypoints\n */\nclass SpeedyPipelineMessageWithKeypoints extends SpeedyPipelineMessage {\n  /**\n   * Constructor\n   */\n  constructor() {\n    super(SpeedyPipelineMessageType.Keypoints);\n\n    /** @type {SpeedyDrawableTexture} encoded keypoints */\n    this._encodedKeypoints = null;\n\n    /** @type {number} descriptor size in bytes */\n    this._descriptorSize = 0;\n\n    /** @type {number} extra size in bytes */\n    this._extraSize = 0;\n\n    /** @type {number} encoder length */\n    this._encoderLength = 1;\n  }\n\n  /**\n   * Set parameters\n   * @param {SpeedyDrawableTexture} encodedKeypoints encoded keypoints\n   * @param {number} descriptorSize in bytes\n   * @param {number} extraSize in bytes\n   * @param {number} encoderLength positive integer\n   * @returns {SpeedyPipelineMessage} this message\n   */\n  set(encodedKeypoints, descriptorSize, extraSize, encoderLength) {\n    // set parameters\n    this._encodedKeypoints = encodedKeypoints;\n    this._descriptorSize = descriptorSize | 0;\n    this._extraSize = extraSize | 0;\n    this._encoderLength = encoderLength | 0;\n\n    // validate\n    utils/* Utils */.A.assert(this._descriptorSize >= 0 && this._extraSize >= 0);\n    utils/* Utils */.A.assert(this._encoderLength === this._encodedKeypoints.width, 'Invalid encoderLength');\n    utils/* Utils */.A.assert(this._encodedKeypoints.width === this._encodedKeypoints.height, 'Invalid encodedKeypoints texture');\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Inspect this message for debugging purposes\n   * @param {SpeedyGPU} gpu\n   * @returns {SpeedyPipelineMessageDiagnosticData}\n   */\n  inspect(gpu) {\n    return {\n      type: this.constructor.name,\n      descriptorSize: this.descriptorSize,\n      extraSize: this.extraSize,\n      encoderLength: this.encoderLength,\n      encodedKeypointsSize: this.encodedKeypoints ? `${this.encodedKeypoints.width}x${this.encodedKeypoints.height}` : '0x0',\n      encodedKeypoints: this.encodedKeypoints ? utils/* Utils */.A.formatBinaryData(this.encodedKeypoints.inspect(gpu).buffer) : ''\n    };\n  }\n\n  /**\n   * Encoded keypoints\n   * @returns {SpeedyDrawableTexture}\n   */\n  get encodedKeypoints() {\n    return this._encodedKeypoints;\n  }\n\n  /**\n   * Descriptor size, in bytes\n   * @returns {number}\n   */\n  get descriptorSize() {\n    return this._descriptorSize;\n  }\n\n  /**\n   * Extra size, in bytes\n   * @returns {number}\n   */\n  get extraSize() {\n    return this._extraSize;\n  }\n\n  /**\n   * Encoder length\n   * @returns {number}\n   */\n  get encoderLength() {\n    return this._encoderLength;\n  }\n}\n\n/*\n * A message transporting a set of 2D vectors\n */\nclass SpeedyPipelineMessageWith2DVectors extends SpeedyPipelineMessage {\n  /**\n   * Constructor\n   */\n  constructor() {\n    super(SpeedyPipelineMessageType.Vector2);\n\n    /** @type {SpeedyDrawableTexture} the set of vectors */\n    this._vectors = null;\n  }\n\n  /**\n   * Set parameters\n   * @param {SpeedyDrawableTexture} vectors the set of vectors\n   * @returns {SpeedyPipelineMessage} this message\n   */\n  set(vectors) {\n    // set parameters\n    this._vectors = vectors;\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Inspect this message for debugging purposes\n   * @param {SpeedyGPU} gpu\n   * @returns {SpeedyPipelineMessageDiagnosticData}\n   */\n  inspect(gpu) {\n    return {\n      type: this.constructor.name,\n      vectorsSize: this.vectors ? `${this.vectors.width}x${this.vectors.height}` : '0x0',\n      vectors: this.vectors ? utils/* Utils */.A.formatBinaryData(this.vectors.inspect(gpu).buffer) : ''\n    };\n  }\n\n  /**\n   * The set of vectors\n   * @returns {SpeedyDrawableTexture}\n   */\n  get vectors() {\n    return this._vectors;\n  }\n}\n\n/**\n * A message transporting LSH tables\n */\nclass SpeedyPipelineMessageWithLSHTables extends SpeedyPipelineMessage {\n  /**\n   * Constructor\n   */\n  constructor() {\n    super(SpeedyPipelineMessageType.LSHTables);\n\n    /** @type {SpeedyLSH} LSH data structure */\n    this._lsh = null;\n  }\n\n  /**\n   * Set parameters\n   * @param {SpeedyLSH} lsh\n   * @returns {SpeedyPipelineMessage} this message\n   */\n  set(lsh) {\n    // set parameters\n    this._lsh = lsh;\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Inspect this message for debugging purposes\n   * @param {SpeedyGPU} gpu\n   * @returns {SpeedyPipelineMessageDiagnosticData}\n   */\n  inspect(gpu) {\n    return {\n      type: this.constructor.name,\n      lsh: '<LSH tables>'\n    };\n  }\n\n  /**\n   * LSH data structure\n   * @returns {SpeedyLSH}\n   */\n  get lsh() {\n    return this._lsh;\n  }\n}\n\n/*\n * A message transporting a set of keypoint matches\n */\nclass SpeedyPipelineMessageWithKeypointMatches extends SpeedyPipelineMessage {\n  /**\n   * Constructor\n   */\n  constructor() {\n    super(SpeedyPipelineMessageType.KeypointMatches);\n\n    /** @type {SpeedyDrawableTexture} keypoint matches (note: 1 pixel encodes 1 match) */\n    this._encodedMatches = null;\n\n    /** @type {number} number of matches per keypoint */\n    this._matchesPerKeypoint = 1;\n  }\n\n  /**\n   * Set parameters\n   * @param {SpeedyDrawableTexture} encodedMatches\n   * @param {number} matchesPerKeypoint\n   * @returns {SpeedyPipelineMessage} this message\n   */\n  set(encodedMatches, matchesPerKeypoint) {\n    // set parameters\n    this._encodedMatches = encodedMatches;\n    this._matchesPerKeypoint = matchesPerKeypoint | 0;\n\n    // validate\n    utils/* Utils */.A.assert(this._matchesPerKeypoint > 0);\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Inspect this message for debugging purposes\n   * @param {SpeedyGPU} gpu\n   * @returns {SpeedyPipelineMessageDiagnosticData}\n   */\n  inspect(gpu) {\n    return {\n      type: this.constructor.name,\n      matchesPerKeypoint: this.matchesPerKeypoint,\n      encodedMatchesSize: this.encodedMatches ? `${this.encodedMatches.width}x${this.encodedMatches.height}` : '0x0',\n      encodedMatches: this.encodedMatches ? utils/* Utils */.A.formatBinaryData(this.encodedMatches.inspect(gpu).buffer) : ''\n    };\n  }\n\n  /**\n   * The matches\n   * @returns {SpeedyDrawableTexture}\n   */\n  get encodedMatches() {\n    return this._encodedMatches;\n  }\n\n  /**\n   * Number of matches per keypoint\n   * @returns {number}\n   */\n  get matchesPerKeypoint() {\n    return this._matchesPerKeypoint;\n  }\n}\n\n//\n// Utilities\n//\n\n/** Map message type to message class */\nconst MESSAGE_CLASS = Object.freeze({\n  [SpeedyPipelineMessageType.Nothing]: SpeedyPipelineMessageWithNothing,\n  [SpeedyPipelineMessageType.Image]: SpeedyPipelineMessageWithImage,\n  [SpeedyPipelineMessageType.Keypoints]: SpeedyPipelineMessageWithKeypoints,\n  [SpeedyPipelineMessageType.Vector2]: SpeedyPipelineMessageWith2DVectors,\n  [SpeedyPipelineMessageType.LSHTables]: SpeedyPipelineMessageWithLSHTables,\n  [SpeedyPipelineMessageType.KeypointMatches]: SpeedyPipelineMessageWithKeypointMatches\n});\n\n/**\n * Create a message of the specified type\n * @param {SpeedyPipelineMessageType} type\n * @returns {SpeedyPipelineMessage}\n */\nfunction createMessage(type) {\n  //return Reflect.construct(MESSAGE_CLASS[type], []);\n  return new MESSAGE_CLASS[\n  // error TS2538: Type 'Symbol' cannot be used as an index type.\n  // heck, what the hack...\n  /** @type {any} */\n  type]();\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/pipeline-portspec.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * pipeline-portspec.js\n * Specification (requirements) of a port of a node of a pipeline\n */\n\n\n\n\n/**\n * A message constraint is a message validation predicate\n * @typedef {function(SpeedyPipelineMessage): boolean} SpeedyPipelineMessageConstraint\n */\n\n/**\n * A validation predicate that validates all messages\n * @type {SpeedyPipelineMessageConstraint}\n */\nconst always = message => true;\n\n/**\n * Specification (requirements) of a port of a node of a pipeline\n */\nclass SpeedyPipelinePortSpec {\n  /**\n   * Constructor\n   * @param {SpeedyPipelineMessageType} expectedMessageType expected message type\n   * @param {SpeedyPipelineMessageConstraint} [messageConstraint] message validation function\n   */\n  constructor(expectedMessageType, messageConstraint = always) {\n    /** @type {SpeedyPipelineMessageType} expected message type */\n    this._expectedMessageType = expectedMessageType;\n\n    /** @type {SpeedyPipelineMessageConstraint} message validation function */\n    this._isValidMessage = typeof messageConstraint === 'function' ? messageConstraint : always;\n\n    // expect a valid type\n    utils/* Utils */.A.assert(this._expectedMessageType != SpeedyPipelineMessageType.Nothing);\n  }\n\n  /**\n   * Checks if two specs have the same expected type\n   * @param {SpeedyPipelinePortSpec} spec\n   * @returns {boolean}\n   */\n  isCompatibleWith(spec) {\n    return this._expectedMessageType == spec._expectedMessageType;\n  }\n\n  /**\n   * Is the given message accepted by a port that abides by this specification?\n   * @param {SpeedyPipelineMessage} message\n   * @returns {boolean}\n   */\n  accepts(message) {\n    return message.hasType(this._expectedMessageType) && this._isValidMessage(message);\n  }\n\n  /**\n   * Convert to string\n   * @returns {string}\n   */\n  toString() {\n    const type = Object.keys(SpeedyPipelineMessageType).find(type => SpeedyPipelineMessageType[type] === this._expectedMessageType);\n    return `Port expects ${type} satisfying ${this._isValidMessage}`;\n  }\n\n  /**\n   * Expected message type\n   * @returns {SpeedyPipelineMessageType}\n   */\n  get expectedMessageType() {\n    return this._expectedMessageType;\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/pipeline-port.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * pipeline-port.js\n * Port of a node of a pipeline\n */\n\n\n\n\n\n\n\n\n// Constants\nconst DEFAULT_INPUT_PORT_NAME = 'in';\nconst DEFAULT_OUTPUT_PORT_NAME = 'out';\nconst ACCEPTABLE_PORT_NAME = /^[a-z][a-zA-Z0-9]*$/;\nconst EMPTY_MESSAGE = new SpeedyPipelineMessageWithNothing();\n\n/**\n * Diagnostic data\n * @typedef {import('./pipeline-message.js').SpeedyPipelineMessageDiagnosticData} SpeedyPipelinePortDiagnosticData\n */\n\n/**\n * Port of a node of a pipeline\n * @abstract\n */\nclass SpeedyPipelinePort {\n  /**\n   * Constructor\n   * @param {string} name the name of this port \n   * @param {SpeedyPipelinePortSpec} spec port specification\n   * @param {SpeedyPipelineNode} node the node to which this port belongs\n   */\n  constructor(name, spec, node) {\n    /** @type {string} the name of this port */\n    this._name = String(name);\n\n    /** @type {SpeedyPipelinePortSpec} the specification of this port */\n    this._spec = spec;\n\n    /** @type {SpeedyPipelineNode} the node to which this port belongs */\n    this._node = node;\n\n    /** @type {SpeedyPipelineMessage} the message located in this port */\n    this._message = EMPTY_MESSAGE;\n\n    // check if we've got an acceptable port name\n    utils/* Utils */.A.assert(ACCEPTABLE_PORT_NAME.test(this._name), `Port name \"${this._name}\" is not acceptable`);\n  }\n\n  /**\n   * The name of this port\n   * @returns {string}\n   */\n  get name() {\n    return this._name;\n  }\n\n  /**\n   * The node to which this port belongs\n   * @returns {SpeedyPipelineNode}\n   */\n  get node() {\n    return this._node;\n  }\n\n  /**\n   * Connect this port to another\n   * @abstract\n   * @param {SpeedyPipelinePort} port\n   */\n  connectTo(port) {\n    throw new utils_errors/* AbstractMethodError */.aQ();\n  }\n\n  /**\n   * Is this an input port?\n   * @abstract\n   * @returns {boolean}\n   */\n  isInputPort() {\n    throw new utils_errors/* AbstractMethodError */.aQ();\n  }\n\n  /**\n   * Is this an output port?\n   * @returns {boolean}\n   */\n  isOutputPort() {\n    return !this.isInputPort();\n  }\n\n  /**\n   * Clear the message stored in this port\n   */\n  clearMessage() {\n    this._message = EMPTY_MESSAGE;\n  }\n\n  /**\n   * Is there a valid message located in this port?\n   * @returns {boolean}\n   */\n  hasMessage() {\n    return !this._message.isEmpty();\n  }\n\n  /**\n   * Read the message that is in this port\n   * @returns {SpeedyPipelineMessage}\n   */\n  read() {\n    if (this._message.isEmpty()) throw new utils_errors/* IllegalOperationError */.Er(`Can't read from port ${this.name}: nothing to read`);\n    return this._message;\n  }\n\n  /**\n   * Write a message to this port\n   * @param {SpeedyPipelineMessage} message\n   */\n  write(message) {\n    throw new utils_errors/* NotSupportedError */.EM(`Can't write ${message} to port ${this.name}: unsupported operation`);\n  }\n\n  /**\n   * Inspect this port for debugging purposes\n   * @param {SpeedyGPU} gpu\n   * @returns {SpeedyPipelinePortDiagnosticData} diagnostic data\n   */\n  inspect(gpu) {\n    return this._message.inspect(gpu);\n  }\n\n  /**\n   * Default port name\n   * @abstract\n   * @returns {string}\n   */\n  static get DEFAULT_NAME() {\n    throw new utils_errors/* AbstractMethodError */.aQ();\n  }\n}\n\n/**\n * Output port\n */\nclass SpeedyPipelineOutputPort extends SpeedyPipelinePort {\n  /**\n   * Constructor\n   * @param {string} name the name of this port \n   * @param {SpeedyPipelinePortSpec} spec port specification\n   * @param {SpeedyPipelineNode} node the node to which this port belongs\n   */\n  constructor(name, spec, node) {\n    super(name, spec, node);\n\n    /** @type {SpeedyPipelineMessage} cached message */\n    this._cachedMessage = null;\n  }\n\n  /**\n   * Connect this port to another\n   * @param {SpeedyPipelineInputPort} port\n   */\n  connectTo(port) {\n    if (!port.isInputPort()) throw new utils_errors/* IllegalArgumentError */.qw(`Can't connect output port ${this.name} to port ${port.name}: expected an input port`);\n    port.connectTo(this);\n  }\n\n  /**\n   * Is this an input port?\n   * @returns {boolean}\n   */\n  isInputPort() {\n    return false;\n  }\n\n  /**\n   * Write a message to this port\n   * @param {SpeedyPipelineMessage} message\n   */\n  write(message) {\n    if (!this._spec.accepts(message)) throw new utils_errors/* IllegalArgumentError */.qw(`Can't write ${message} to port ${this.name}. ${this._spec}`);\n    this._message = message;\n  }\n\n  /**\n   * Write a message to this port using a cached message object\n   * @param  {...any} args to be passed to SpeedyPipelineMessage.set()\n   */\n  swrite(...args) {\n    if (this._cachedMessage == null) this._cachedMessage = SpeedyPipelineMessage.create(this._spec.expectedMessageType);\n    this.write(this._cachedMessage.set(...args));\n  }\n\n  /**\n   * Default port name\n   * @returns {string}\n   */\n  static get DEFAULT_NAME() {\n    return DEFAULT_OUTPUT_PORT_NAME;\n  }\n}\n\n/**\n * Input port\n */\nclass SpeedyPipelineInputPort extends SpeedyPipelinePort {\n  /**\n   * Constructor\n   * @param {string} name the name of this port \n   * @param {SpeedyPipelinePortSpec} spec port specification\n   * @param {SpeedyPipelineNode} node the node to which this port belongs\n   */\n  constructor(name, spec, node) {\n    super(name, spec, node);\n\n    /** @type {SpeedyPipelineOutputPort|null} incoming link */\n    this._incomingLink = null;\n  }\n\n  /**\n   * Incoming link\n   * @returns {SpeedyPipelineOutputPort|null}\n   */\n  get incomingLink() {\n    return this._incomingLink;\n  }\n\n  /**\n   * Connect this port to another\n   * @param {SpeedyPipelineOutputPort} port\n   */\n  connectTo(port) {\n    if (!port.isOutputPort()) throw new utils_errors/* IllegalArgumentError */.qw(`Can't connect input port ${this.name} of \"${this.node.fullName}\" to input port ${port.name} of \"${port.node.fullName}\": expected an output port`);else if (!this._spec.isCompatibleWith(port._spec)) throw new utils_errors/* IllegalArgumentError */.qw(`Can't connect port ${this.name} of \"${this.node.fullName}\" to port ${port.name} of \"${port.node.fullName}\": incompatible types`);\n    this._incomingLink = port;\n  }\n\n  /**\n   * Unlink this port\n   */\n  disconnect() {\n    this._incomingLink = null;\n  }\n\n  /**\n   * Is this an input port?\n   * @returns {boolean}\n   */\n  isInputPort() {\n    return true;\n  }\n\n  /**\n   * Receive a message using the incoming link\n   * @param {string} [nodeName]\n   * @returns {SpeedyPipelineMessage}\n   */\n  pullMessage(nodeName = '') {\n    const name = nodeName.length > 0 ? `${this.name} of ${nodeName}` : this.name;\n    if (this._incomingLink == null) throw new utils_errors/* IllegalOperationError */.Er(`No incoming link for input port ${name}`);\n    const message = this._incomingLink.read();\n    if (!this._spec.accepts(message)) throw new utils_errors/* IllegalArgumentError */.qw(`Can't receive ${message} at port ${name}: ${this._spec}`);\n    return this._message = message;\n  }\n\n  /**\n   * Default port name\n   * @returns {string}\n   */\n  static get DEFAULT_NAME() {\n    return DEFAULT_INPUT_PORT_NAME;\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/pipeline-portbuilder.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * pipeline-portbuilder.js\n * Builder of a port of a node of a pipeline\n */\n\n\n\n\n\n\n\n/**\n * @typedef {import('./pipeline-portspec').SpeedyPipelineMessageConstraint} SpeedyPipelineMessageConstraint\n */\n\n/**\n * Builder of a port of a node of a pipeline\n */\nclass SpeedyPipelinePortBuilder {\n  /**\n   * Constructor\n   * @param {typeof SpeedyPipelinePort} portClass input or output?\n   * @param {string} portName\n   */\n  constructor(portClass, portName) {\n    /** @type {typeof SpeedyPipelinePort} input or output? */\n    this._class = portClass;\n\n    /** @type {string} port name */\n    this._name = String(portName);\n\n    /** @type {SpeedyPipelineMessageType} accepted message type */\n    this._type = SpeedyPipelineMessageType.Nothing;\n\n    /** @type {SpeedyPipelineMessageConstraint} message validation function */\n    this._messageConstraint = undefined;\n  }\n\n  /**\n   * Declare that the new port expects a certain type of message\n   * @param {SpeedyPipelineMessageType} type expected type\n   * @returns {SpeedyPipelinePortBuilder} this builder\n   */\n  expects(type) {\n    utils/* Utils */.A.assert(this._type == SpeedyPipelineMessageType.Nothing);\n    utils/* Utils */.A.assert(type != SpeedyPipelineMessageType.Nothing);\n    this._type = type;\n    return this;\n  }\n\n  /**\n   * Declare that the new port expects messages satisfying a constraint\n   * @param {SpeedyPipelineMessageConstraint} constraint\n   * @returns {SpeedyPipelinePortBuilder} this builder\n   */\n  satisfying(constraint) {\n    utils/* Utils */.A.assert(this._type != SpeedyPipelineMessageType.Nothing, 'You must first declare what type of message this port expects');\n    utils/* Utils */.A.assert(this._messageConstraint === undefined);\n    utils/* Utils */.A.assert(typeof constraint === 'function');\n    this._messageConstraint = constraint;\n    return this;\n  }\n\n  /**\n   * Build a port\n   * @param {SpeedyPipelineNode} node the node to which the new port will belong\n   * @returns {SpeedyPipelinePort}\n   */\n  build(node) {\n    const spec = new SpeedyPipelinePortSpec(this._type, this._messageConstraint);\n    return Reflect.construct(this._class, [this._name, spec, node]);\n  }\n}\n\n/**\n * Creates a builder for an input port\n * @param {string} [portName]\n * @returns {SpeedyPipelinePortBuilder}\n */\nfunction InputPort(portName = SpeedyPipelineInputPort.DEFAULT_NAME) {\n  return new SpeedyPipelinePortBuilder(SpeedyPipelineInputPort, portName);\n}\n\n/**\n * Creates a builder for an output port\n * @param {string} [portName]\n * @returns {SpeedyPipelinePortBuilder}\n */\nfunction OutputPort(portName = SpeedyPipelineOutputPort.DEFAULT_NAME) {\n  return new SpeedyPipelinePortBuilder(SpeedyPipelineOutputPort, portName);\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/pipeline-node.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * pipeline-node.js\n * Node of a pipeline\n */\n\n\n\n\n\n\n\n\n\n\n\n\n/** @typedef {Object<string,SpeedyPipelineInputPort>} InputPortDictionary */\n/** @typedef {Object<string,SpeedyPipelineOutputPort>} OutputPortDictionary */\n\n/** Generate a random name for a node */\nconst generateRandomName = () => Math.random().toString(16).substr(2);\n\n/** Create an empty input port dictionary */\nconst createInputPortDictionary = () => ( /** @type {InputPortDictionary} */Object.create(null));\n\n/** Create an empty output port dictionary */\nconst createOutputPortDictionary = () => ( /** @type {OutputPortDictionary} */Object.create(null));\n\n/**\n * Map an array of input ports to an InputPortDictionary whose keys are their names\n * @param {SpeedyPipelineInputPort[]} ports\n * @returns {InputPortDictionary}\n */\nfunction InputPortDictionary(ports) {\n  return ports.reduce((dict, port) => (dict[port.name] = port, dict), createInputPortDictionary());\n}\n\n/**\n * Map an array of output ports to an OutputPortDictionary whose keys are their names\n * @param {SpeedyPipelineOutputPort[]} ports\n * @returns {OutputPortDictionary}\n */\nfunction OutputPortDictionary(ports) {\n  return ports.reduce((dict, port) => (dict[port.name] = port, dict), createOutputPortDictionary());\n}\n\n/** A flag used for debugging purposes */\nlet _texView = false;\n\n/**\n * Node of a pipeline\n * @abstract\n */\nclass SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] the name of this node\n   * @param {number} [texCount] number of work textures\n   * @param {SpeedyPipelinePortBuilder[]} [portBuilders] port builders\n   */\n  constructor(name = generateRandomName(), texCount = 0, portBuilders = []) {\n    /** @type {string} the name of this node */\n    this._name = String(name);\n\n    /** @type {SpeedyDrawableTexture[]} work texture(s) */\n    this._tex = new Array(texCount).fill(null);\n\n    // build the ports\n    const ports = portBuilders.map(builder => builder.build(this));\n    const inputPorts = /** @type {SpeedyPipelineInputPort[]} */ports.filter(port => port.isInputPort());\n    const outputPorts = /** @type {SpeedyPipelineOutputPort[]} */ports.filter(port => port.isOutputPort());\n\n    /** @type {InputPortDictionary} input ports */\n    this._inputPorts = InputPortDictionary(inputPorts);\n\n    /** @type {OutputPortDictionary} output ports */\n    this._outputPorts = OutputPortDictionary(outputPorts);\n\n    // validate\n    if (this._name.length == 0) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid name \"${this._name}\" for node ${this.fullName}`);else if (portBuilders.length == 0) throw new utils_errors/* IllegalArgumentError */.qw(`No ports have been found in node ${this.fullName}`);\n  }\n\n  /**\n   * The name of this node\n   * @returns {string}\n   */\n  get name() {\n    return this._name;\n  }\n\n  /**\n   * Name and type of this node\n   * @returns {string}\n   */\n  get fullName() {\n    return `${this.constructor.name}[${this.name}]`;\n  }\n\n  /**\n   * Find input port by name\n   * @param {string} [portName]\n   * @returns {SpeedyPipelineInputPort}\n   */\n  input(portName = SpeedyPipelineInputPort.DEFAULT_NAME) {\n    if (portName in this._inputPorts) return this._inputPorts[portName];\n    throw new utils_errors/* IllegalArgumentError */.qw(`Can't find input port ${portName} in node ${this.fullName}`);\n  }\n\n  /**\n   * Find output port by name\n   * @param {string} [portName]\n   * @returns {SpeedyPipelineOutputPort}\n   */\n  output(portName = SpeedyPipelineOutputPort.DEFAULT_NAME) {\n    if (portName in this._outputPorts) return this._outputPorts[portName];\n    throw new utils_errors/* IllegalArgumentError */.qw(`Can't find output port ${portName} in node ${this.fullName}`);\n  }\n\n  /**\n   * Get data from the input ports and execute\n   * the task that this node is supposed to!\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  execute(gpu) {\n    let portName;\n\n    // clear output ports\n    for (portName in this._outputPorts) this._outputPorts[portName].clearMessage();\n\n    // let the input ports receive what is due\n    for (portName in this._inputPorts) this._inputPorts[portName].pullMessage(this.fullName);\n\n    // run the task\n    const runTask = this._run(gpu);\n    if (typeof runTask === 'undefined') return void this._finishExecution(gpu);else return runTask.then(() => this._finishExecution(gpu));\n  }\n\n  /**\n   * Finish the execution of this node;\n   * to be called after execute()\n   * @param {SpeedyGPU} gpu\n   */\n  _finishExecution(gpu) {\n    // ensure that no output ports are empty\n    for (const portName in this._outputPorts) {\n      utils/* Utils */.A.assert(this._outputPorts[portName].hasMessage(), `Did you forget to write data to the output port ${portName} of ${this.fullName}?`);\n    }\n\n    // diagnosticize the node / pipeline\n    if (settings/* Settings */.w.logging === 'diagnostic') {\n      utils/* Utils */.A.log(`%c ${this.fullName} `, 'font-size:12pt;font-weight:bold;color:white;background:blue');\n\n      // Inspecting the data has performance implications.\n      // It is for diagnostic purposes only, not meant to be done in production!\n\n      for (const portName in this._inputPorts) utils/* Utils */.A.log(`%c-> ${portName}:`, 'font-size:10pt;font-weight:bold', this._inputPorts[portName].inspect(gpu));\n      for (const portName in this._outputPorts) utils/* Utils */.A.log(`%c<- ${portName}:`, 'font-size:10pt;font-weight:bold', this._outputPorts[portName].inspect(gpu));\n    }\n  }\n\n  /**\n   * Run the specific task of this node\n   * @abstract\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    throw new utils_errors/* AbstractMethodError */.aQ();\n  }\n\n  /**\n   * Initializes this node\n   * @param {SpeedyGPU} gpu\n   */\n  init(gpu) {\n    gpu.subscribe(this._allocateWorkTextures, this, gpu);\n    this._allocateWorkTextures(gpu);\n  }\n\n  /**\n   * Releases this node\n   * @param {SpeedyGPU} gpu\n   */\n  release(gpu) {\n    this._deallocateWorkTextures(gpu);\n    gpu.unsubscribe(this._allocateWorkTextures, this);\n  }\n\n  /**\n   * Clear all ports\n   */\n  clearPorts() {\n    let portName;\n    for (portName in this._inputPorts) this._inputPorts[portName].clearMessage();\n    for (portName in this._outputPorts) this._outputPorts[portName].clearMessage();\n  }\n\n  /**\n   * Find all nodes that feed input to this node\n   * @returns {SpeedyPipelineNode[]}\n   */\n  inputNodes() {\n    const nodes = [];\n    for (const portName in this._inputPorts) {\n      const port = this._inputPorts[portName];\n      if (port.incomingLink != null) nodes.push(port.incomingLink.node);\n    }\n    return nodes;\n  }\n\n  /**\n   * Is this a source of the pipeline?\n   * @returns {boolean}\n   */\n  isSource() {\n    return false;\n  }\n\n  /**\n   * Is this a sink of the pipeline?\n   * @returns {boolean}\n   */\n  isSink() {\n    return false;\n\n    // note: a portal sink has no output ports, but it isn't a sink of the pipeline!\n    //return Object.keys(this._outputPorts).length == 0;\n  }\n\n  /**\n   * Allocate work texture(s)\n   * @param {SpeedyGPU} gpu\n   */\n  _allocateWorkTextures(gpu) {\n    for (let j = 0; j < this._tex.length; j++) this._tex[j] = gpu.texturePool.allocate();\n  }\n\n  /**\n   * Deallocate work texture(s)\n   * @param {SpeedyGPU} gpu\n   */\n  _deallocateWorkTextures(gpu) {\n    for (let j = this._tex.length - 1; j >= 0; j--) this._tex[j] = gpu.texturePool.free(this._tex[j]);\n  }\n\n  /**\n   * Visually inspect a texture for debugging purposes\n   * @param {SpeedyGPU} gpu\n   * @param {SpeedyDrawableTexture} texture\n   */\n  _visualize(gpu, texture) {\n    const canvas = gpu.renderToCanvas(texture);\n    if (!_texView) {\n      document.body.appendChild(canvas);\n      _texView = true;\n    }\n  }\n}\n\n/**\n * Source node (a node with no input ports)\n * @abstract\n */\nclass SpeedyPipelineSourceNode extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] the name of this node\n   * @param {number} [texCount] number of work textures\n   * @param {SpeedyPipelinePortBuilder[]} [portBuilders] port builders\n   */\n  constructor(name = undefined, texCount = undefined, portBuilders = undefined) {\n    super(name, texCount, portBuilders);\n    utils/* Utils */.A.assert(Object.keys(this._inputPorts).length == 0);\n  }\n\n  /**\n   * Is this a source of the pipeline?\n   * @returns {boolean}\n   */\n  isSource() {\n    return true;\n  }\n}\n\n/**\n * Sink node (a node with no output ports)\n * @abstract\n */\nclass SpeedyPipelineSinkNode extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] the name of this node\n   * @param {number} [texCount] number of work textures\n   * @param {SpeedyPipelinePortBuilder[]} [portBuilders] port builders\n   */\n  constructor(name = undefined, texCount = undefined, portBuilders = undefined) {\n    super(name, texCount, portBuilders);\n    utils/* Utils */.A.assert(Object.keys(this._outputPorts).length == 0);\n  }\n\n  /**\n   * Export data from this node to the user\n   * @abstract\n   * @returns {SpeedyPromise<any>}\n   */\n  export() {\n    throw new utils_errors/* AbstractMethodError */.aQ();\n  }\n\n  /**\n   * Is this a sink of the pipeline?\n   * @returns {boolean}\n   */\n  isSink() {\n    return true;\n  }\n}\n;// CONCATENATED MODULE: ./src/core/speedy-keypoint-match.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-match.js\n * A match between two keypoint descriptors\n */\n\n\n\n// Constants\nconst MATCH_NOT_FOUND = -1;\n\n/**\n * A match between two keypoint descriptors\n */\nclass SpeedyKeypointMatch {\n  /**\n   * Constructor\n   * @param {number} index index of the stored keypoint, a non-negative integer\n   * @param {number} distance a measure of the quality of the match, a non-negative number\n   */\n  constructor(index, distance) {\n    const isValid = distance < globals.MATCH_MAX_DISTANCE;\n\n    /** @type {number} index of the stored keypoint */\n    this._index = isValid ? index | 0 : MATCH_NOT_FOUND;\n\n    /** @type {number} a measure of the quality of the match */\n    this._distance = isValid ? +distance : Number.POSITIVE_INFINITY;\n\n    // done!\n    return Object.freeze(this);\n  }\n\n  /**\n   * The index of the stored keypoint\n   * @returns {number}\n   */\n  get index() {\n    return this._index;\n  }\n\n  /**\n   * A measure of the quality of the match (lower values indicate better matches)\n   * @returns {number}\n   */\n  get distance() {\n    return this._distance;\n  }\n\n  /**\n   * A string representation of the keypoint match\n   * @returns {string}\n   */\n  toString() {\n    return `SpeedyKeypointMatch(${this.index},${this.distance})`;\n  }\n}\n;// CONCATENATED MODULE: ./src/core/speedy-keypoint.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-keypoint.js\n * Keypoint class\n */\n\n\n\n\n\n\n/**\n * Represents a keypoint\n */\nclass SpeedyKeypoint {\n  /**\n   * Constructor\n   * @param {number} x X position\n   * @param {number} y Y position\n   * @param {number} [lod] Level-of-detail\n   * @param {number} [rotation] Rotation in radians\n   * @param {number} [score] Cornerness measure\n   * @param {SpeedyKeypointDescriptor|null} [descriptor] Keypoint descriptor, if any\n   */\n  constructor(x, y, lod = 0.0, rotation = 0.0, score = 0.0, descriptor = null) {\n    /** @type {SpeedyPoint2} keypoint position */\n    this._position = new SpeedyPoint2(+x, +y);\n\n    /** @type {number} level of detail */\n    this._lod = +lod;\n\n    /** @type {number} rotation in radians */\n    this._rotation = +rotation;\n\n    /** @type {number} a cornerness measure */\n    this._score = +score;\n\n    /** @type {SpeedyKeypointDescriptor|null} keypoint descriptor, if any */\n    this._descriptor = descriptor;\n  }\n\n  /**\n   * Converts this keypoint to a descriptive string\n   * @returns {string}\n   */\n  toString() {\n    return `SpeedyKeypoint(${this.x},${this.y})`;\n  }\n\n  /**\n   * The position of this keypoint\n   * @returns {SpeedyPoint2}\n   */\n  get position() {\n    return this._position;\n  }\n\n  /**\n   * The x-position of this keypoint\n   * @returns {number}\n   */\n  get x() {\n    return this._position.x;\n  }\n\n  /**\n   * The x-position of this keypoint\n   * @param {number} value\n   */\n  set x(value) {\n    this._position.x = +value;\n  }\n\n  /**\n   * The y-position of this keypoint\n   * @returns {number}\n   */\n  get y() {\n    return this._position.y;\n  }\n\n  /**\n   * The y-position of this keypoint\n   * @param {number} value\n   */\n  set y(value) {\n    this._position.y = +value;\n  }\n\n  /**\n   * The pyramid level-of-detail from which this keypoint was extracted\n   * @returns {number}\n   */\n  get lod() {\n    return this._lod;\n  }\n\n  /**\n   * Scale: 2^lod\n   * @returns {number}\n   */\n  get scale() {\n    return Math.pow(2, this._lod);\n  }\n\n  /**\n   * The orientation of the keypoint, in radians\n   * @returns {number} Angle in radians\n   */\n  get rotation() {\n    return this._rotation;\n  }\n\n  /**\n   * Score: a cornerness measure\n   * @returns {number} Score\n   */\n  get score() {\n    return this._score;\n  }\n\n  /**\n   * Keypoint descriptor\n   * @return {SpeedyKeypointDescriptor|null}\n   */\n  get descriptor() {\n    return this._descriptor;\n  }\n}\n\n/**\n * Represents a tracked keypoint\n */\nclass SpeedyTrackedKeypoint extends SpeedyKeypoint {\n  /**\n   * Constructor\n   * @param {number} x X position\n   * @param {number} y Y position\n   * @param {number} [lod] Level-of-detail\n   * @param {number} [rotation] Rotation in radians\n   * @param {number} [score] Cornerness measure\n   * @param {SpeedyKeypointDescriptor|null} [descriptor] Keypoint descriptor, if any\n   * @param {SpeedyVector2} [flow] flow vector\n   */\n  constructor(x, y, lod = 0.0, rotation = 0.0, score = 0.0, descriptor = null, flow = new SpeedyVector2(0, 0)) {\n    super(x, y, lod, rotation, score, descriptor);\n\n    /** @type {SpeedyVector2} flow vector */\n    this._flow = flow;\n  }\n\n  /**\n   * Flow vector\n   * @returns {SpeedyVector2}\n   */\n  get flow() {\n    return this._flow;\n  }\n}\n\n/**\n * Represents a matched keypoint\n */\nclass SpeedyMatchedKeypoint extends SpeedyKeypoint {\n  /**\n   * Constructor\n   * @param {number} x X position\n   * @param {number} y Y position\n   * @param {number} [lod] Level-of-detail\n   * @param {number} [rotation] Rotation in radians\n   * @param {number} [score] Cornerness measure\n   * @param {SpeedyKeypointDescriptor|null} [descriptor] Keypoint descriptor, if any\n   * @param {SpeedyKeypointMatch[]} [matches] Keypoint matches, if any\n   */\n  constructor(x, y, lod = 0.0, rotation = 0.0, score = 0.0, descriptor = null, matches = []) {\n    super(x, y, lod, rotation, score, descriptor);\n\n    /** @type {SpeedyKeypointMatch[]} keypoint matches */\n    this._matches = matches;\n  }\n\n  /**\n   * Keypoint matches\n   * @returns {SpeedyKeypointMatch[]}\n   */\n  get matches() {\n    return this._matches;\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/pipeline.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * pipeline.js\n * A pipeline is a network of nodes in which data flows to a sink\n */\n\n\n\n\n\n\n\n\n\n\n\n/**\n * A dictionary indexed by the names of the sink nodes\n * @typedef {Object<string,any>} SpeedyPipelineOutput\n */\n\n/** @type {SpeedyGPU} shared GPU programs & textures */\nlet gpu = null;\n\n/** @type {number} gpu reference count */\nlet referenceCount = 0;\n\n/**\n * A pipeline is a network of nodes in which data flows to a sink\n */\nclass SpeedyPipeline {\n  /**\n   * Constructor\n   */\n  constructor() {\n    /** @type {SpeedyPipelineNode[]} the collection of all nodes that belong to this pipeline */\n    this._nodes = [];\n\n    /** @type {SpeedyPipelineNode[]} a sequence of nodes: from the source(s) to the sink */\n    this._sequence = [];\n\n    /** @type {boolean} are we running the pipeline at this moment? */\n    this._busy = false;\n  }\n\n  /**\n   * Find a node by its name\n   * @template T extends SpeedyPipelineNode\n   * @param {string} name\n   * @returns {T|null}\n   */\n  node(name) {\n    for (let i = 0, n = this._nodes.length; i < n; i++) {\n      if (this._nodes[i].name === name) return this._nodes[i];\n    }\n    return null;\n  }\n\n  /**\n   * Initialize the pipeline\n   * @param  {...SpeedyPipelineNode} nodes\n   * @returns {SpeedyPipeline} this pipeline\n   */\n  init(...nodes) {\n    // validate\n    if (this._nodes.length > 0) throw new utils_errors/* IllegalOperationError */.Er(`The pipeline has already been initialized`);else if (nodes.length == 0) throw new utils_errors/* IllegalArgumentError */.qw(`Can't initialize the pipeline. Please specify its nodes`);\n\n    // create a GPU instance and increase the reference count\n    if (0 == referenceCount++) {\n      utils/* Utils */.A.assert(!gpu, 'Duplicate SpeedyGPU instance');\n      gpu = new SpeedyGPU();\n    }\n\n    // add nodes to the network\n    for (let i = 0; i < nodes.length; i++) {\n      const node = nodes[i];\n      if (!this._nodes.includes(node)) this._nodes.push(node);\n    }\n\n    // generate the sequence of nodes\n    this._sequence = SpeedyPipeline._tsort(this._nodes);\n    SpeedyPipeline._validateSequence(this._sequence);\n\n    // initialize nodes\n    for (let i = 0; i < this._sequence.length; i++) this._sequence[i].init(gpu);\n\n    // done!\n    return this;\n  }\n\n  /**\n   * Release the resources associated with this pipeline\n   * @returns {null}\n   */\n  release() {\n    if (this._nodes.length == 0) throw new utils_errors/* IllegalOperationError */.Er(`The pipeline has already been released or has never been initialized`);\n\n    // release nodes\n    for (let i = this._sequence.length - 1; i >= 0; i--) this._sequence[i].release(gpu);\n    this._sequence.length = 0;\n    this._nodes.length = 0;\n\n    // decrease reference count and release GPU if necessary\n    if (0 == --referenceCount) gpu = gpu.release();\n\n    // done!\n    return null;\n  }\n\n  /**\n   * Run the pipeline\n   * @returns {SpeedyPromise<SpeedyPipelineOutput>} results are indexed by the names of the sink nodes\n   */\n  run() {\n    utils/* Utils */.A.assert(this._sequence.length > 0, `The pipeline has not been initialized or has been released`);\n\n    // is the pipeline busy?\n    if (this._busy) {\n      // if so, we need to wait 'til it finishes\n      return new speedy_promise/* SpeedyPromise */.i((resolve, reject) => {\n        setTimeout(() => this.run().then(resolve, reject), 0);\n      });\n    } else {\n      // the pipeline is now busy and won't accept concurrent tasks\n      // (we allocate textures using a single pool)\n      this._busy = true;\n    }\n\n    // find the sinks\n    const sinks = /** @type {SpeedyPipelineSinkNode[]} */this._sequence.filter(node => node.isSink());\n\n    // create output template\n    const template = SpeedyPipeline._createOutputTemplate(sinks);\n\n    // diagnostic log\n    if (settings/* Settings */.w.logging === 'diagnostic') utils/* Utils */.A.log('%c RUNNING PIPELINE ', 'background:red;color:white;font-size:28pt;font-weight:bold');\n\n    // run the pipeline\n    return SpeedyPipeline._runSequence(this._sequence).then(() =>\n    // export results\n    speedy_promise/* SpeedyPromise */.i.all(sinks.map(sink => sink.export().turbocharge())).then(results =>\n    // aggregate results by the names of the sinks\n    results.reduce((obj, val, idx) => (obj[sinks[idx].name] = val, obj), template))).finally(() => {\n      // clear all ports\n      for (let i = this._sequence.length - 1; i >= 0; i--) this._sequence[i].clearPorts();\n\n      // the pipeline is no longer busy\n      this._busy = false;\n\n      // diagnostic log\n      if (settings/* Settings */.w.logging === 'diagnostic') {\n        utils/* Utils */.A.log('%c PIPELINE OUTPUT \\n', 'background:green;color:white;font-size:16pt;font-weight:bold');\n        Object.keys(template).forEach(entry => {\n          utils/* Utils */.A.log('%c' + entry + ':', 'font-size:10pt;font-weight:bold', template[entry]);\n        });\n      }\n    }).turbocharge();\n  }\n\n  /**\n   * @internal\n   *\n   * GPU instance\n   * @returns {SpeedyGPU}\n   */\n  get _gpu() {\n    return gpu;\n  }\n\n  /**\n   * Execute the tasks of a sequence of nodes\n   * @param {SpeedyPipelineNode[]} sequence sequence of nodes\n   * @param {number} [i] in [0,n)\n   * @param {number} [n] number of nodes\n   * @returns {SpeedyPromise<void>}\n   */\n  static _runSequence(sequence, i = 0, n = sequence.length) {\n    for (; i < n; i++) {\n      const runTask = sequence[i].execute(gpu);\n\n      // this call greatly improves performance when downloading pixel data using PBOs\n      gpu.gl.flush();\n      if (typeof runTask !== 'undefined') return runTask.then(() => SpeedyPipeline._runSequence(sequence, i + 1, n));\n    }\n    return speedy_promise/* SpeedyPromise */.i.resolve();\n  }\n\n  /**\n   * Topological sorting\n   * @param {SpeedyPipelineNode[]} nodes \n   * @returns {SpeedyPipelineNode[]}\n   */\n  static _tsort(nodes) {\n    /** @typedef {[SpeedyPipelineNode, boolean]} StackNode */\n\n    const outlinks = SpeedyPipeline._outlinks(nodes);\n    const stack = nodes.map(node => ( /** @type {StackNode} */[node, false]));\n    const trash = new Set();\n    const sorted = new Array(nodes.length);\n    let j = sorted.length;\n    while (stack.length > 0) {\n      const [node, done] = stack.pop();\n      if (!done) {\n        if (!trash.has(node)) {\n          const outnodes = outlinks.get(node);\n          trash.add(node);\n          stack.push([node, true]);\n          stack.push(...outnodes.map(node => ( /** @type {StackNode} */[node, false])));\n          if (outnodes.some(node => trash.has(node) && !sorted.includes(node))) throw new utils_errors/* IllegalOperationError */.Er(`Pipeline networks cannot have cycles!`);\n        }\n      } else sorted[--j] = node;\n    }\n    return sorted;\n  }\n\n  /**\n   * Figure out the outgoing links of all nodes\n   * @param {SpeedyPipelineNode[]} nodes\n   * @returns {Map<SpeedyPipelineNode,SpeedyPipelineNode[]>}\n   */\n  static _outlinks(nodes) {\n    const outlinks = new Map();\n    for (let k = 0; k < nodes.length; k++) outlinks.set(nodes[k], []);\n    for (let i = 0; i < nodes.length; i++) {\n      const to = nodes[i];\n      const inputs = to.inputNodes();\n      for (let j = 0; j < inputs.length; j++) {\n        const from = inputs[j];\n        const links = outlinks.get(from);\n        if (!links) throw new utils_errors/* IllegalOperationError */.Er(`Can't initialize the pipeline. Missing node: ${from.fullName}. Did you forget to add it to the initialization list?`);\n        if (!links.includes(to)) links.push(to);\n      }\n    }\n    return outlinks;\n  }\n\n  /**\n   * Generate the output template by aggregating the names of the sinks\n   * @param {SpeedyPipelineNode[]} [sinks]\n   * @returns {SpeedyPipelineOutput}\n   */\n  static _createOutputTemplate(sinks = []) {\n    const template = Object.create(null);\n    for (let i = sinks.length - 1; i >= 0; i--) template[sinks[i].name] = null;\n    return template;\n  }\n\n  /**\n   * Validate a sequence of nodes\n   * @param {SpeedyPipelineNode[]} sequence\n   */\n  static _validateSequence(sequence) {\n    if (sequence.length == 0) throw new utils_errors/* IllegalOperationError */.Er(`Pipeline doesn't have nodes`);else if (!sequence[0].isSource()) throw new utils_errors/* IllegalOperationError */.Er(`Pipeline doesn't have a source`);else if (!sequence.find(node => node.isSink())) throw new utils_errors/* IllegalOperationError */.Er(`Pipeline doesn't have a sink`);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/images/source.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * image-input.js\n * Gets an image into a pipeline\n */\n\n\n\n\n\n\n\n\n\n\n\n\n// Constants\nconst UPLOAD_BUFFER_SIZE = 2; // how many textures we allocate for uploading data\n\n/**\n * Gets an image into a pipeline\n */\nclass SpeedyPipelineNodeImageSource extends SpeedyPipelineSourceNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, UPLOAD_BUFFER_SIZE, [OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {SpeedyMedia|null} source media */\n    this._media = null;\n\n    /** @type {number} texture index */\n    this._textureIndex = 0;\n  }\n\n  /**\n   * Source media\n   * @returns {SpeedyMedia|null}\n   */\n  get media() {\n    return this._media;\n  }\n\n  /**\n   * Source media\n   * @param {SpeedyMedia|null} media\n   */\n  set media(media) {\n    if (media !== null && !(media instanceof SpeedyMedia)) throw new utils_errors/* IllegalArgumentError */.qw(`Not a SpeedyMedia: ${media}`);\n    this._media = media;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    if (this._media == null) throw new utils_errors/* IllegalOperationError */.Er(`Did you forget to set the media of ${this.fullName}?`);\n\n    // use round-robin to mitigate WebGL's implicit synchronization\n    // and maybe minimize texture upload times\n    this._textureIndex = (this._textureIndex + 1) % this._tex.length;\n\n    // upload texture\n    const outputTexture = this._tex[this._textureIndex];\n    gpu.upload(this._media._source, outputTexture);\n    this.output().swrite(outputTexture, this._media._format);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/images/sink.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * image-output.js\n * Gets an image out of a pipeline\n */\n\n\n\n\n\n\n\n\n\n\n\n\n\n/** @typedef {\"bitmap\" | \"data\"} SpeedyPipelineNodeImageSinkExportedMediaType exported media type */\n\n/** @type {SpeedyPipelineNodeImageSinkExportedMediaType} default exported media type */\nconst DEFAULT_MEDIA_TYPE = \"bitmap\";\n\n/**\n * Gets an image out of a pipeline\n */\nclass SpeedyPipelineNodeImageSink extends SpeedyPipelineSinkNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = 'image') {\n    super(name, 0, [InputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {SpeedyPipelineNodeImageSinkExportedMediaType} the media type that is exported from this node */\n    this._mediaType = DEFAULT_MEDIA_TYPE;\n\n    /** @type {ImageBitmap} output bitmap */\n    this._bitmap = null;\n\n    /** @type {ImageData} output pixel data */\n    this._data = null;\n\n    /** @type {ImageFormat} output format */\n    this._format = types/* ImageFormat */.f5.RGBA;\n\n    /** @type {SpeedyTextureReader} texture reader */\n    this._textureReader = new SpeedyTextureReader(1);\n  }\n\n  /**\n   * The media type that is exported from this node\n   * @returns {SpeedyPipelineNodeImageSinkExportedMediaType}\n   */\n  get mediaType() {\n    return this._mediaType;\n  }\n\n  /**\n   * The media type that is exported from this node\n   * @param {SpeedyPipelineNodeImageSinkExportedMediaType} value\n   */\n  set mediaType(value) {\n    if (value != 'bitmap' && value != 'data') throw new utils_errors/* IllegalArgumentError */.qw(`Invalid mediaType for ${this.fullName}: \"${value}\"`);\n    this._mediaType = value;\n  }\n\n  /**\n   * Initializes this node\n   * @param {SpeedyGPU} gpu\n   */\n  init(gpu) {\n    super.init(gpu);\n    this._textureReader.init(gpu);\n  }\n\n  /**\n   * Releases this node\n   * @param {SpeedyGPU} gpu\n   */\n  release(gpu) {\n    this._textureReader.release(gpu);\n    super.release(gpu);\n  }\n\n  /**\n   * Export data from this node to the user\n   * @returns {SpeedyPromise<SpeedyMedia>}\n   */\n  export() {\n    const bitmapOrData = this._mediaType != 'data' ? this._bitmap : this._data;\n    utils/* Utils */.A.assert(bitmapOrData != null);\n    return SpeedyMedia.load(bitmapOrData, {\n      format: this._format\n    }, false);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    if (this._mediaType != 'data') {\n      /* Create an ImageBitmap (default) */\n      return new speedy_promise/* SpeedyPromise */.i(resolve => {\n        const canvas = gpu.renderToCanvas(image);\n        createImageBitmap(canvas, 0, canvas.height - image.height, image.width, image.height).then(bitmap => {\n          this._bitmap = bitmap;\n          this._format = format;\n          this._data = null;\n          resolve();\n        });\n      });\n    } else {\n      /* Create an ImageData */\n      return this._textureReader.readPixelsAsync(image, 0, 0, image.width, image.height, false).then(pixels => {\n        const dataArray = new Uint8ClampedArray(pixels.buffer);\n        this._data = new ImageData(dataArray, image.width, image.height);\n        this._format = format;\n        this._bitmap = null;\n      });\n    }\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/images/multiplexer.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * multiplexer.js\n * Image multiplexer\n */\n\n\n\n\n\n\n\n\n\n\n\n/** @type {string[]} the names of the input ports indexed by their number */\nconst INPUT_PORT = ['in0', 'in1'];\n\n/**\n * Image multiplexer\n */\nclass SpeedyPipelineNodeImageMultiplexer extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 0, [...INPUT_PORT.map(portName => InputPort(portName).expects(SpeedyPipelineMessageType.Image)), OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {number} which port should be linked to the output? */\n    this._port = 0;\n  }\n\n  /**\n   * The number of the port that should be linked to the output\n   * @returns {number}\n   */\n  get port() {\n    return this._port;\n  }\n\n  /**\n   * The number of the port that should be linked to the output\n   * @param {number} port\n   */\n  set port(port) {\n    if (port < 0 || port >= INPUT_PORT.length) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid port: ${port}`);\n    this._port = port | 0;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const message = this.input(INPUT_PORT[this._port]).read();\n    this.output().write(message);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/images/buffer.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * buffer.js\n * Image Buffer\n */\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Image Buffer: a node with memory.\n * At time t, it outputs the image received at time t-1\n */\nclass SpeedyPipelineNodeImageBuffer extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 2, [InputPort().expects(SpeedyPipelineMessageType.Image), OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {number} current page: 0 or 1 */\n    this._pageIndex = 0;\n\n    /** @type {boolean} first run? */\n    this._initialized = false;\n\n    /** @type {ImageFormat} previous image format */\n    this._previousFormat = types/* ImageFormat */.f5.RGBA;\n\n    /** @type {boolean} frozen buffer? */\n    this._frozen = false;\n  }\n\n  /**\n   * A frozen buffer discards the input, effectively increasing the buffering time\n   * @returns {boolean}\n   */\n  get frozen() {\n    return this._frozen;\n  }\n\n  /**\n   * A frozen buffer discards the input, effectively increasing the buffering time\n   * @param {boolean} value\n   */\n  set frozen(value) {\n    this._frozen = Boolean(value);\n  }\n\n  /**\n   * Releases this node\n   * @param {SpeedyGPU} gpu\n   */\n  release(gpu) {\n    this._initialized = false;\n    super.release(gpu);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const previousFormat = this._previousFormat;\n    const page = this._tex;\n    const previousInputTexture = page[1 - this._pageIndex];\n    const outputTexture = page[this._pageIndex];\n\n    // can't store pyramids\n    if (image.hasMipmaps()) throw new utils_errors/* NotSupportedError */.EM(`${this.fullName} can't bufferize a pyramid`);\n\n    // bufferize\n    if (!this._frozen || !this._initialized) {\n      // store input\n      this._previousFormat = format;\n      previousInputTexture.resize(image.width, image.height);\n      image.copyTo(previousInputTexture);\n\n      // page flipping\n      this._pageIndex = 1 - this._pageIndex;\n    }\n\n    // first run?\n    if (!this._initialized) {\n      this._initialized = true;\n      this.output().swrite(previousInputTexture, format);\n      return;\n    }\n\n    // done!\n    this.output().swrite(outputTexture, previousFormat);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/images/pyramid.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * pyramid.js\n * Generate pyramid\n */\n\n\n\n\n\n\n\n\n\n\n\n// Constants\nconst MAX_LEVELS = globals.PYRAMID_MAX_LEVELS; //14; // supposing image size <= 8K = 2^13 (downto 1)\nconst MAX_TEXTURES = 2 * MAX_LEVELS; //MAX_LEVELS;\n\n/**\n * Generate pyramid\n */\nclass SpeedyPipelineNodeImagePyramid extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, MAX_TEXTURES + 1, [InputPort().expects(SpeedyPipelineMessageType.Image), OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const outputTexture = this._tex[0];\n    const pyramids = gpu.programs.pyramids;\n    let width = image.width,\n      height = image.height;\n\n    // number of mipmap levels according to the OpenGL ES 3.0 spec (sec 3.8.10.4)\n    const mipLevels = 1 + Math.floor(Math.log2(Math.max(width, height)));\n\n    // get work textures\n    const mip = new Array(MAX_TEXTURES + 1);\n    for (let i = MAX_TEXTURES; i >= 1; i--) mip[i - 1] = this._tex[i];\n\n    // get a copy of the input image\n    mip[0].resize(width, height);\n    image.copyTo(mip[0]);\n\n    // generate gaussian pyramid\n    const numLevels = Math.min(mipLevels, MAX_LEVELS);\n    for (let level = 1; level < numLevels; level++) {\n      // use max(1, floor(size / 2^lod)), in accordance to\n      // the OpenGL ES 3.0 spec sec 3.8.10.4 (Mipmapping)\n      const halfWidth = Math.max(1, width >>> 1);\n      const halfHeight = Math.max(1, height >>> 1);\n\n      // reduce operation\n      const tmp = level - 1 + MAX_LEVELS;\n      pyramids.smoothX.outputs(width, height, mip[tmp])(mip[level - 1]);\n      pyramids.smoothY.outputs(width, height, mip[level - 1])(mip[tmp]);\n      pyramids.downsample2.outputs(halfWidth, halfHeight, mip[level])(mip[level - 1]);\n      /*\n      (pyramids.reduce.outputs(width, height, mip[tmp]))(mip[level-1]);\n      (pyramids.downsample2.outputs(halfWidth, halfHeight, mip[level]))(mip[tmp]);\n      */\n\n      // flush\n      gpu.gl.flush();\n\n      // next level\n      width = halfWidth;\n      height = halfHeight;\n\n      /*\n      // debug: view pyramid\n      const view = mip[level-1];\n      const canvas = gpu.renderToCanvas(view);\n      if(!window._ww) document.body.appendChild(canvas);\n      window._ww = 1;\n      */\n    }\n\n    // copy to output & set mipmap\n    outputTexture.resize(image.width, image.height);\n    outputTexture.clear();\n    image.copyTo(outputTexture);\n    outputTexture.generateMipmaps(mip.slice(0, numLevels));\n\n    // done!\n    this.output().swrite(outputTexture, format);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/images/mixer.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * mixer.js\n * Image Mixer\n */\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Image Mixer\n */\nclass SpeedyPipelineNodeImageMixer extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 1, [InputPort('in0').expects(SpeedyPipelineMessageType.Image), InputPort('in1').expects(SpeedyPipelineMessageType.Image), OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {number} alpha coefficient (applied to image0) */\n    this._alpha = 0.5;\n\n    /** @type {number} beta coefficient (applied to image1) */\n    this._beta = 0.5;\n\n    /** @type {number} gamma coefficient (brightness control) */\n    this._gamma = 0.0;\n  }\n\n  /**\n   * Alpha coefficient (applied to image0)\n   * @returns {number}\n   */\n  get alpha() {\n    return this._alpha;\n  }\n\n  /**\n   * Alpha coefficient (applied to image0)\n   * @param {number} value\n   */\n  set alpha(value) {\n    this._alpha = +value;\n  }\n\n  /**\n   * Beta coefficient (applied to image1)\n   * @returns {number}\n   */\n  get beta() {\n    return this._beta;\n  }\n\n  /**\n   * Beta coefficient (applied to image1)\n   * @param {number} value\n   */\n  set beta(value) {\n    this._beta = +value;\n  }\n\n  /**\n   * Gamma coefficient (brightness control)\n   * @returns {number}\n   */\n  get gamma() {\n    return this._gamma;\n  }\n\n  /**\n   * Gamma coefficient (brightness control)\n   * @param {number} value\n   */\n  set gamma(value) {\n    this._gamma = +value;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const in0 = /** @type {SpeedyPipelineMessageWithImage} */this.input('in0').read();\n    const in1 = /** @type {SpeedyPipelineMessageWithImage} */this.input('in1').read();\n    const image0 = in0.image,\n      image1 = in1.image;\n    const format0 = in0.format,\n      format1 = in1.format;\n    const width = Math.max(image0.width, image1.width);\n    const height = Math.max(image0.height, image1.height);\n    const alpha = this._alpha,\n      beta = this._beta,\n      gamma = this._gamma;\n    const outputTexture = this._tex[0];\n    if (format0 != format1) throw new utils_errors/* NotSupportedError */.EM(`Can't mix images of different formats`);\n    gpu.programs.transforms.additiveMix.outputs(width, height, outputTexture);\n    gpu.programs.transforms.additiveMix(image0, image1, alpha, beta, gamma);\n    this.output().swrite(outputTexture, format0);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/images/portal.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * portal.js\n * Image Portals\n */\n\n\n\n\n\n\n\n\n\n\n\n/**\n * A sink of an Image Portal\n * This is not a pipeline sink - it doesn't export any data!\n */\nclass SpeedyPipelineNodeImagePortalSink extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 1, [InputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {ImageFormat} stored image format */\n    this._format = types/* ImageFormat */.f5.RGBA;\n\n    /** @type {boolean} is this node initialized? */\n    this._initialized = false;\n  }\n\n  /**\n   * Stored image\n   * @returns {SpeedyTexture}\n   */\n  get image() {\n    if (!this._initialized) throw new utils_errors/* IllegalOperationError */.Er(`Portal error: ${this.fullName} holds no data`);\n    return this._tex[0];\n  }\n\n  /**\n   * Stored image format\n   * @returns {ImageFormat}\n   */\n  get format() {\n    if (!this._initialized) throw new utils_errors/* IllegalOperationError */.Er(`Portal error: ${this.fullName} holds no data`);\n    return this._format;\n  }\n\n  /**\n   * Initializes this node\n   * @param {SpeedyGPU} gpu\n   */\n  init(gpu) {\n    super.init(gpu);\n    this._tex[0].resize(1, 1).clear(); // initial texture\n    this._format = types/* ImageFormat */.f5.RGBA;\n    this._initialized = true;\n  }\n\n  /**\n   * Releases this node\n   * @param {SpeedyGPU} gpu\n   */\n  release(gpu) {\n    this._initialized = false;\n    super.release(gpu);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const tex = this._tex[0];\n\n    // can't store pyramids\n    if (image.hasMipmaps()) throw new utils_errors/* NotSupportedError */.EM(`${this.fullName} can't store a pyramid`);\n\n    // copy input\n    this._format = format;\n    tex.resize(image.width, image.height);\n    image.copyTo(tex);\n  }\n}\n\n/**\n * A source of an Image Portal\n */\nclass SpeedyPipelineNodeImagePortalSource extends SpeedyPipelineSourceNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 0, [OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {SpeedyPipelineNodeImagePortalSink|null} portal sink */\n    this._source = null;\n  }\n\n  /**\n   * Data source\n   * @returns {SpeedyPipelineNodeImagePortalSink|null}\n   */\n  get source() {\n    return this._source;\n  }\n\n  /**\n   * Data source\n   * @param {SpeedyPipelineNodeImagePortalSink|null} node\n   */\n  set source(node) {\n    if (node !== null && !(node instanceof SpeedyPipelineNodeImagePortalSink)) throw new utils_errors/* IllegalArgumentError */.qw(`Incompatible source for ${this.fullName}`);\n    this._source = node;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    if (this._source == null) throw new utils_errors/* IllegalOperationError */.Er(`${this.fullName} has no source`);\n    this.output().swrite(this._source.image, this._source.format);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/factories/image-factory.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * image-factory.js\n * Image-related nodes\n */\n\n\n\n\n\n\n\n\n\n\n/**\n * Portal nodes\n */\nclass SpeedyPipelineImagePortalFactory extends speedy_namespace/* SpeedyNamespace */.Q {\n  /**\n   * Create an image portal source\n   * @param {string} [name] name of the node\n   * @returns {SpeedyPipelineNodeImagePortalSource}\n   */\n  static Source(name = undefined) {\n    return new SpeedyPipelineNodeImagePortalSource(name);\n  }\n\n  /**\n   * Create an image portal sink\n   * @param {string} [name] name of the node\n   * @returns {SpeedyPipelineNodeImagePortalSink}\n   */\n  static Sink(name = undefined) {\n    return new SpeedyPipelineNodeImagePortalSink(name);\n  }\n}\n\n/**\n * Image nodes\n */\nclass SpeedyPipelineImageFactory extends speedy_namespace/* SpeedyNamespace */.Q {\n  /**\n   * Create an image source\n   * @param {string} [name] name of the node\n   * @returns {SpeedyPipelineNodeImageSource}\n   */\n  static Source(name = undefined) {\n    return new SpeedyPipelineNodeImageSource(name);\n  }\n\n  /**\n   * Create an image sink\n   * @param {string} [name] name of the node\n   * @returns {SpeedyPipelineNodeImageSink}\n   */\n  static Sink(name = undefined) {\n    return new SpeedyPipelineNodeImageSink(name);\n  }\n\n  /**\n   * Create an image multiplexer\n   * @param {string} [name] name of the node\n   * @returns {SpeedyPipelineNodeImageMultiplexer}\n   */\n  static Multiplexer(name = undefined) {\n    return new SpeedyPipelineNodeImageMultiplexer(name);\n  }\n\n  /**\n   * Create an image buffer\n   * @param {string} [name] name of the node\n   * @returns {SpeedyPipelineNodeImageBuffer}\n   */\n  static Buffer(name = undefined) {\n    return new SpeedyPipelineNodeImageBuffer(name);\n  }\n\n  /**\n   * Image Pyramid\n   * @param {string} [name] name of the node\n   * @returns {SpeedyPipelineNodeImagePyramid}\n   */\n  static Pyramid(name = undefined) {\n    return new SpeedyPipelineNodeImagePyramid(name);\n  }\n\n  /**\n   * Image Mixer (blending)\n   * @param {string} [name] name of the node\n   * @returns {SpeedyPipelineNodeImageMixer}\n   */\n  static Mixer(name = undefined) {\n    return new SpeedyPipelineNodeImageMixer(name);\n  }\n\n  /**\n   * Image Portals\n   * @returns {typeof SpeedyPipelineImagePortalFactory}\n   */\n  static get Portal() {\n    return SpeedyPipelineImagePortalFactory;\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/filters/greyscale.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * greyscale.js\n * Convert an image to greyscale\n */\n\n\n\n\n\n\n\n\n\n\n/**\n * Convert an image to greyscale\n */\nclass SpeedyPipelineNodeGreyscale extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 1, [InputPort().expects(SpeedyPipelineMessageType.Image), OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const width = image.width,\n      height = image.height;\n    const outputTexture = this._tex[0];\n    const filters = gpu.programs.filters;\n    filters.rgb2grey.outputs(width, height, outputTexture);\n    filters.rgb2grey(image);\n    this.output().swrite(outputTexture, types/* ImageFormat */.f5.GREY);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/filters/gaussian-blur.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * gaussian-blur.js\n * Gaussian Blur\n */\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Default kernels for different sizes: 3x3, 5x5, 7x7... (use sigma_x = sigma_y)\n * Heuristics: in order to pick a sigma, we set radius = 2 * sigma. Since\n * ksize = 1 + 2 * radius, it follows that sigma = (ksize - 1) / 4. When\n * ksize is 3, we set sigma = 1. Therefore, sigma = max(1, (ksize - 1) / 4).\n */\nconst DEFAULT_KERNEL = Object.freeze({\n  3: [0.27901008925473514, 0.44197982149052983, 0.27901008925473514],\n  // 1D convolution (sigma = 1)\n  5: [0.06135959781344021, 0.2447701955296099, 0.3877404133138998, 0.2447701955296099, 0.06135959781344021],\n  // 1D convolution (separable kernel)\n  7: [0.03873542500847274, 0.11308485700794121, 0.2150068609928349, 0.26634571398150225, 0.2150068609928349, 0.11308485700794121, 0.03873542500847274],\n  9: [0.028532262603370988, 0.067234535494912, 0.12400932997922749, 0.17904386461741617, 0.20236001461014655, 0.17904386461741617, 0.12400932997922749, 0.067234535494912, 0.028532262603370988],\n  11: [0.022656882730580346, 0.04610857898527292, 0.08012661469398517, 0.11890414969751599, 0.15067709325491124, 0.16305336127546846, 0.15067709325491124, 0.11890414969751599, 0.08012661469398517, 0.04610857898527292, 0.022656882730580346],\n  13: [0.018815730430644363, 0.03447396964662016, 0.05657737457255748, 0.08317258170844948, 0.10952340502389682, 0.12918787500405662, 0.13649812722755, 0.12918787500405662, 0.10952340502389682, 0.08317258170844948, 0.05657737457255748, 0.03447396964662016, 0.018815730430644363],\n  15: [0.016100340991695383, 0.027272329212157102, 0.042598338587449644, 0.06135478775568558, 0.08148767614129326, 0.09979838342934616, 0.11270444144735056, 0.11736740487004466, 0.11270444144735056, 0.09979838342934616, 0.08148767614129326, 0.06135478775568558, 0.042598338587449644, 0.027272329212157102, 0.016100340991695383]\n  //3: [ 0.25, 0.5, 0.25 ],\n  //5: [ 0.05, 0.25, 0.4, 0.25, 0.05 ],\n});\n\n/** Zero vector. When we set sigma_x = sigma_y = 0, we use the default rule to compute the actual sigma */\nconst DEFAULT_SIGMA = new SpeedyVector2(0, 0);\n\n/** convolution programs (x-axis) */\nconst CONVOLUTION_X = Object.freeze({\n  3: 'convolution3x',\n  5: 'convolution5x',\n  7: 'convolution7x',\n  9: 'convolution9x',\n  11: 'convolution11x',\n  13: 'convolution13x',\n  15: 'convolution15x'\n});\n\n/** convolution programs (y-axis) */\nconst CONVOLUTION_Y = Object.freeze({\n  3: 'convolution3y',\n  5: 'convolution5y',\n  7: 'convolution7y',\n  9: 'convolution9y',\n  11: 'convolution11y',\n  13: 'convolution13y',\n  15: 'convolution15y'\n});\n\n/**\n * @typedef {object} SeparableConvolutionKernel\n * @property {number[]} x\n * @property {number[]} y\n */\n\n/**\n * Gaussian Blur\n */\nclass SpeedyPipelineNodeGaussianBlur extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 2, [InputPort().expects(SpeedyPipelineMessageType.Image), OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {SpeedySize} size of the kernel */\n    this._kernelSize = new SpeedySize(5, 5);\n\n    /** @type {SpeedyVector2} sigma of the Gaussian kernel (0 means: use default settings) */\n    this._sigma = DEFAULT_SIGMA;\n\n    /** @type {SeparableConvolutionKernel} convolution kernel */\n    this._kernel = {\n      x: DEFAULT_KERNEL[this._kernelSize.width],\n      y: DEFAULT_KERNEL[this._kernelSize.height]\n    };\n  }\n\n  /**\n   * Size of the kernel\n   * @returns {SpeedySize}\n   */\n  get kernelSize() {\n    return this._kernelSize;\n  }\n\n  /**\n   * Size of the kernel\n   * @param {SpeedySize} kernelSize\n   */\n  set kernelSize(kernelSize) {\n    utils/* Utils */.A.assert(kernelSize instanceof SpeedySize);\n    const kw = kernelSize.width,\n      kh = kernelSize.height;\n    if (kw < 3 || kh < 3 || kw > 15 || kh > 15 || kw % 2 == 0 || kh % 2 == 0) throw new utils_errors/* NotSupportedError */.EM(`Unsupported kernel size: ${kw}x${kh}`);\n    this._kernelSize = kernelSize;\n    this._updateKernel();\n  }\n\n  /**\n   * Sigma of the Gaussian kernel\n   * @returns {SpeedyVector2}\n   */\n  get sigma() {\n    return this._sigma;\n  }\n\n  /**\n   * Sigma of the Gaussian kernel\n   * @param {SpeedyVector2} sigma\n   */\n  set sigma(sigma) {\n    utils/* Utils */.A.assert(sigma instanceof SpeedyVector2, `Sigma must be a SpeedyVector2`);\n    utils/* Utils */.A.assert(sigma.x >= 0 && sigma.y >= 0);\n    this._sigma = sigma;\n    this._updateKernel();\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const width = image.width,\n      height = image.height;\n    const kernX = this._kernel.x;\n    const kernY = this._kernel.y;\n    const convX = CONVOLUTION_X[this._kernelSize.width];\n    const convY = CONVOLUTION_Y[this._kernelSize.height];\n    const tex = this._tex[0];\n    const outputTexture = this._tex[1];\n    gpu.programs.filters[convX].outputs(width, height, tex)(image, kernX);\n    gpu.programs.filters[convY].outputs(width, height, outputTexture)(tex, kernY);\n    this.output().swrite(outputTexture, format);\n  }\n\n  /**\n   * Update the internal kernel to match\n   * sigma and kernelSize\n   */\n  _updateKernel() {\n    if (this._sigma.x == DEFAULT_SIGMA.x) this._kernel.x = DEFAULT_KERNEL[this._kernelSize.width];else this._kernel.x = utils/* Utils */.A.gaussianKernel(this._sigma.x, this._kernelSize.width, true);\n    if (this._sigma.y == DEFAULT_SIGMA.y) this._kernel.y = DEFAULT_KERNEL[this._kernelSize.height];else this._kernel.y = utils/* Utils */.A.gaussianKernel(this._sigma.y, this._kernelSize.height, true);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/filters/simple-blur.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * simple-blur.js\n * Simple Blur (Box Filter)\n */\n\n\n\n\n\n\n\n\n\n\n\n\n/** 1D convolution filters */\nconst BOX_FILTER = Object.freeze({\n  3: new Array(3).fill(1 / 3),\n  5: new Array(5).fill(1 / 5),\n  7: new Array(7).fill(1 / 7),\n  9: new Array(9).fill(1 / 9),\n  11: new Array(11).fill(1 / 11),\n  13: new Array(13).fill(1 / 13),\n  15: new Array(15).fill(1 / 15)\n});\n\n/** convolution programs (x-axis) */\nconst simple_blur_CONVOLUTION_X = Object.freeze({\n  3: 'convolution3x',\n  5: 'convolution5x',\n  7: 'convolution7x',\n  9: 'convolution9x',\n  11: 'convolution11x',\n  13: 'convolution13x',\n  15: 'convolution15x'\n});\n\n/** convolution programs (y-axis) */\nconst simple_blur_CONVOLUTION_Y = Object.freeze({\n  3: 'convolution3y',\n  5: 'convolution5y',\n  7: 'convolution7y',\n  9: 'convolution9y',\n  11: 'convolution11y',\n  13: 'convolution13y',\n  15: 'convolution15y'\n});\n\n/**\n * @typedef {object} SeparableConvolutionKernel\n * @property {number[]} x\n * @property {number[]} y\n */\n\n/**\n * Simple Blur (Box Filter)\n */\nclass SpeedyPipelineNodeSimpleBlur extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 2, [InputPort().expects(SpeedyPipelineMessageType.Image), OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {SpeedySize} size of the kernel */\n    this._kernelSize = new SpeedySize(5, 5);\n\n    /** @type {SeparableConvolutionKernel} convolution kernel */\n    this._kernel = {\n      x: BOX_FILTER[this._kernelSize.width],\n      y: BOX_FILTER[this._kernelSize.height]\n    };\n  }\n\n  /**\n   * Size of the kernel\n   * @returns {SpeedySize}\n   */\n  get kernelSize() {\n    return this._kernelSize;\n  }\n\n  /**\n   * Size of the kernel\n   * @param {SpeedySize} kernelSize\n   */\n  set kernelSize(kernelSize) {\n    utils/* Utils */.A.assert(kernelSize instanceof SpeedySize);\n    const kw = kernelSize.width,\n      kh = kernelSize.height;\n    if (kw < 3 || kh < 3 || kw > 15 || kh > 15 || kw % 2 == 0 || kh % 2 == 0) throw new utils_errors/* NotSupportedError */.EM(`Unsupported kernel size: ${kw}x${kh}`);\n    this._kernelSize = kernelSize;\n    this._kernel.x = BOX_FILTER[this._kernelSize.width];\n    this._kernel.y = BOX_FILTER[this._kernelSize.height];\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const width = image.width,\n      height = image.height;\n    const kernX = this._kernel.x;\n    const kernY = this._kernel.y;\n    const convX = simple_blur_CONVOLUTION_X[this._kernelSize.width];\n    const convY = simple_blur_CONVOLUTION_Y[this._kernelSize.height];\n    const tex = this._tex[0];\n    const outputTexture = this._tex[1];\n    gpu.programs.filters[convX].outputs(width, height, tex)(image, kernX);\n    gpu.programs.filters[convY].outputs(width, height, outputTexture)(tex, kernY);\n    this.output().swrite(outputTexture, format);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/filters/median-blur.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * median-blur.js\n * Median Blur\n */\n\n\n\n\n\n\n\n\n\n\n\n\n// Median programs\nconst MEDIAN = {\n  3: 'median3',\n  5: 'median5',\n  7: 'median7'\n};\n\n/**\n * Median Blur\n */\nclass SpeedyPipelineNodeMedianBlur extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 1, [InputPort().expects(SpeedyPipelineMessageType.Image).satisfying(( /** @type {SpeedyPipelineMessageWithImage} */msg) => msg.format === types/* ImageFormat */.f5.GREY), OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {SpeedySize} size of the kernel (assumed to be square) */\n    this._kernelSize = new SpeedySize(5, 5);\n  }\n\n  /**\n   * Size of the kernel\n   * @returns {SpeedySize}\n   */\n  get kernelSize() {\n    return this._kernelSize;\n  }\n\n  /**\n   * Size of the kernel\n   * @param {SpeedySize} kernelSize\n   */\n  set kernelSize(kernelSize) {\n    utils/* Utils */.A.assert(kernelSize instanceof SpeedySize);\n    const ksize = kernelSize.width;\n    if (!(ksize == 3 || ksize == 5 || ksize == 7)) throw new utils_errors/* NotSupportedError */.EM(`Supported kernel sizes: 3x3, 5x5, 7x7`);else if (kernelSize.width != kernelSize.height) throw new utils_errors/* NotSupportedError */.EM(`Use a square kernel`);\n    this._kernelSize = kernelSize;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const width = image.width,\n      height = image.height;\n    const ksize = this._kernelSize.width;\n    const med = MEDIAN[ksize];\n    const outputTexture = this._tex[0];\n    gpu.programs.filters[med].outputs(width, height, outputTexture)(image);\n    this.output().swrite(outputTexture, format);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/filters/convolution.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * convolution.js\n * Image convolution\n */\n\n\n\n\n\n\n\n\n\n\n\n\n\n// 2D convolution programs\nconst CONVOLUTION = {\n  3: 'convolution3',\n  5: 'convolution5',\n  7: 'convolution7'\n};\n\n/**\n * Image convolution\n */\nclass SpeedyPipelineNodeConvolution extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 1, [InputPort().expects(SpeedyPipelineMessageType.Image), OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {SpeedyMatrix} convolution kernel (square matrix) */\n    this._kernel = speedy_matrix.SpeedyMatrix.Create(3, 3, [0, 0, 0, 0, 1, 0, 0, 0, 0]); // identity transform\n  }\n\n  /**\n   * Convolution kernel\n   * @returns {SpeedyMatrix}\n   */\n  get kernel() {\n    return this._kernel;\n  }\n\n  /**\n   * Convolution kernel\n   * @param {SpeedyMatrix} kernel\n   */\n  set kernel(kernel) {\n    if (kernel.rows != kernel.columns) throw new utils_errors/* NotSupportedError */.EM(`Use a square kernel`);else if (!(kernel.rows == 3 || kernel.rows == 5 || kernel.rows == 7)) throw new utils_errors/* NotSupportedError */.EM(`Invalid kernel size. Supported sizes: 3x3, 5x5, 7x7`);\n    this._kernel = kernel;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const width = image.width,\n      height = image.height;\n    const outputTexture = this._tex[0];\n    const ksize = this._kernel.rows;\n    const conv = CONVOLUTION[ksize];\n    const kernel = this._kernel.read();\n    gpu.programs.filters[conv].outputs(width, height, outputTexture)(image, kernel);\n    this.output().swrite(outputTexture, format);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/filters/nightvision.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * nightvision.js\n * Nightvision filter\n */\n\n\n\n\n\n\n\n\n\n\n\n/**\n * @typedef {\"high\"|\"medium\"|\"low\"} NightvisionQualityLevel\n */\n\n/**\n * Nightvision filter: \"see in the dark\"\n */\nclass SpeedyPipelineNodeNightvision extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 3, [InputPort().expects(SpeedyPipelineMessageType.Image).satisfying(( /** @type {SpeedyPipelineMessageWithImage} */msg) => msg.format === types/* ImageFormat */.f5.RGBA || msg.format === types/* ImageFormat */.f5.GREY), OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {number} a value typically in [0,1]: larger number => higher contrast */\n    this._gain = 0.5;\n\n    /** @type {number} a value typically in [0,1]: controls brightness */\n    this._offset = 0.5;\n\n    /** @type {number} gain decay, a value in [0,1] */\n    this._decay = 0.0;\n\n    /** @type {NightvisionQualityLevel} quality level */\n    this._quality = 'medium';\n  }\n\n  /**\n   * Gain, a value typically in [0,1]: larger number => higher contrast\n   * @returns {number}\n   */\n  get gain() {\n    return this._gain;\n  }\n\n  /**\n   * Gain, a value typically in [0,1]: larger number => higher contrast\n   * @param {number} gain\n   */\n  set gain(gain) {\n    this._gain = +gain;\n  }\n\n  /**\n   * Offset, a value typically in [0,1] that controls the brightness\n   * @returns {number}\n   */\n  get offset() {\n    return this._offset;\n  }\n\n  /**\n   * Offset, a value typically in [0,1] that controls the brightness\n   * @param {number} offset\n   */\n  set offset(offset) {\n    this._offset = +offset;\n  }\n\n  /**\n   * Gain decay, a value in [0,1] that controls how the gain decays from the center of the image\n   * @returns {number}\n   */\n  get decay() {\n    return this._decay;\n  }\n\n  /**\n   * Gain decay, a value in [0,1] that controls how the gain decays from the center of the image\n   * @param {number} decay\n   */\n  set decay(decay) {\n    this._decay = Math.max(0.0, Math.min(+decay, 1.0));\n  }\n\n  /**\n   * Quality level of the filter\n   * @returns {NightvisionQualityLevel}\n   */\n  get quality() {\n    return this._quality;\n  }\n\n  /**\n   * Quality level of the filter\n   * @param {NightvisionQualityLevel} quality\n   */\n  set quality(quality) {\n    if (quality === 'high' || quality === 'medium' || quality === 'low') this._quality = quality;else throw new utils_errors/* IllegalArgumentError */.qw(`Invalid quality level for the Nightvision filter: \"${quality}\"`);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const width = image.width,\n      height = image.height;\n    const gain = this._gain;\n    const offset = this._offset;\n    const decay = this._decay;\n    const quality = this._quality;\n    const filters = gpu.programs.filters;\n    const tmp = this._tex[0];\n    const illuminationMap = this._tex[1];\n    const outputTexture = this._tex[2];\n\n    // compute illumination map\n    if (quality == 'medium') {\n      filters.illuminationMapX.outputs(width, height, tmp);\n      filters.illuminationMapY.outputs(width, height, illuminationMap);\n      filters.illuminationMapX(image);\n      filters.illuminationMapY(tmp);\n    } else if (quality == 'high') {\n      filters.illuminationMapHiX.outputs(width, height, tmp);\n      filters.illuminationMapHiY.outputs(width, height, illuminationMap);\n      filters.illuminationMapHiX(image);\n      filters.illuminationMapHiY(tmp);\n    } else if (quality == 'low') {\n      filters.illuminationMapLoX.outputs(width, height, tmp);\n      filters.illuminationMapLoY.outputs(width, height, illuminationMap);\n      filters.illuminationMapLoX(image);\n      filters.illuminationMapLoY(tmp);\n    }\n\n    // run nightvision\n    if (format === types/* ImageFormat */.f5.GREY) {\n      filters.nightvisionGreyscale.outputs(width, height, outputTexture);\n      filters.nightvisionGreyscale(image, illuminationMap, gain, offset, decay);\n    } else if (format === types/* ImageFormat */.f5.RGBA) {\n      filters.nightvision.outputs(width, height, outputTexture);\n      filters.nightvision(image, illuminationMap, gain, offset, decay);\n    }\n\n    // done!\n    this.output().swrite(outputTexture, format);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/filters/normalize.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * normalize.js\n * Normalize image to a range\n */\n\n\n\n\n\n\n\n\n\n\n/**\n * Normalize image to a range\n */\nclass SpeedyPipelineNodeNormalize extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 4, [InputPort().expects(SpeedyPipelineMessageType.Image).satisfying(( /** @type {SpeedyPipelineMessageWithImage} */msg) => msg.format === types/* ImageFormat */.f5.GREY), OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {number} a value in [0,255] */\n    this._minValue = 0;\n\n    /** @type {number} a value in [0,255] */\n    this._maxValue = 255;\n  }\n\n  /**\n   * Minimum intensity in the output image, a value in [0,255]\n   * @returns {number}\n   */\n  get minValue() {\n    return this._minValue;\n  }\n\n  /**\n   * Minimum intensity in the output image, a value in [0,255]\n   * @param {number} minValue\n   */\n  set minValue(minValue) {\n    this._minValue = Math.max(0, Math.min(+minValue, 255));\n  }\n\n  /**\n   * Maximum intensity in the output image, a value in [0,255]\n   * @returns {number}\n   */\n  get maxValue() {\n    return this._maxValue;\n  }\n\n  /**\n   * Maximum intensity in the output image, a value in [0,255]\n   * @param {number} maxValue\n   */\n  set maxValue(maxValue) {\n    this._maxValue = Math.max(0, Math.min(+maxValue, 255));\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const width = image.width,\n      height = image.height;\n    const outputTexture = this._tex[3];\n    let minValue = this._minValue;\n    let maxValue = this._maxValue;\n    if (minValue > maxValue) minValue = maxValue = (minValue + maxValue) / 2;\n    const minmax = this._scanMinMax(gpu, image, types/* PixelComponent */.kQ.GREEN);\n    gpu.programs.filters.normalizeGreyscale.outputs(width, height, outputTexture);\n    gpu.programs.filters.normalizeGreyscale(minmax, minValue, maxValue);\n    this.output().swrite(outputTexture, format);\n  }\n\n  /**\n   * Scan a single component in all pixels of the image and find the min & max intensities\n   * @param {SpeedyGPU} gpu\n   * @param {SpeedyTexture} image input image\n   * @param {PixelComponent} pixelComponent a single PixelComponent flag\n   * @returns {SpeedyDrawableTexture} RGBA = (max, min, max - min, original_pixel)\n   */\n  _scanMinMax(gpu, image, pixelComponent) {\n    const tex = this._tex;\n    const program = gpu.programs.utils;\n    const width = image.width,\n      height = image.height;\n    const numIterations = Math.ceil(Math.log2(Math.max(width, height))) | 0;\n    utils/* Utils */.A.assert(types/* ColorComponentId */.kg[pixelComponent] !== undefined);\n    program.copyComponents.outputs(width, height, tex[2]);\n    program.scanMinMax2D.outputs(width, height, tex[0], tex[1]);\n    let texture = program.copyComponents(image, image, types/* PixelComponent */.kQ.ALL, types/* ColorComponentId */.kg[pixelComponent]);\n    for (let i = 0; i < numIterations; i++) texture = program.scanMinMax2D(texture, i);\n    return texture;\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/factories/filter-factory.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * filter-factory.js\n * Image filters\n */\n\n\n\n\n\n\n\n\n\n\n/**\n * Image filters\n */\nclass SpeedyPipelineFilterFactory extends speedy_namespace/* SpeedyNamespace */.Q {\n  /**\n   * Convert image to greyscale\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeGreyscale}\n   */\n  static Greyscale(name = undefined) {\n    return new SpeedyPipelineNodeGreyscale(name);\n  }\n\n  /**\n   * Gaussian Blur\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeGaussianBlur}\n   */\n  static GaussianBlur(name = undefined) {\n    return new SpeedyPipelineNodeGaussianBlur(name);\n  }\n\n  /**\n   * Simple Blur (Box Filter)\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeSimpleBlur}\n   */\n  static SimpleBlur(name = undefined) {\n    return new SpeedyPipelineNodeSimpleBlur(name);\n  }\n\n  /**\n   * Median Blur\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeMedianBlur}\n   */\n  static MedianBlur(name = undefined) {\n    return new SpeedyPipelineNodeMedianBlur(name);\n  }\n\n  /**\n   * Image Convolution\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeConvolution}\n   */\n  static Convolution(name = undefined) {\n    return new SpeedyPipelineNodeConvolution(name);\n  }\n\n  /**\n   * Nightvision\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeNightvision}\n   */\n  static Nightvision(name = undefined) {\n    return new SpeedyPipelineNodeNightvision(name);\n  }\n\n  /**\n   * Normalize image\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeNormalize}\n   */\n  static Normalize(name = undefined) {\n    return new SpeedyPipelineNodeNormalize(name);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/transforms/perspective-warp.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * perspective-warp.js\n * Warp an image using a perspective transformation\n */\n\n\n\n\n\n\n\n\n\n\n\n\n// Used when an invalid matrix is provided\nconst SINGULAR_MATRIX = [0, 0, 0, 0, 0, 0, 0, 0, 1];\n\n/**\n * Warp an image using a perspective transformation\n */\nclass SpeedyPipelineNodePerspectiveWarp extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 1, [InputPort().expects(SpeedyPipelineMessageType.Image), OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {SpeedyMatrix} perspective transformation */\n    this._transform = speedy_matrix.SpeedyMatrix.Create(3, 3, [1, 0, 0, 0, 1, 0, 0, 0, 1]); // identity matrix\n  }\n\n  /**\n   * Perspective transform, a 3x3 homography matrix\n   * @returns {SpeedyMatrix}\n   */\n  get transform() {\n    return this._transform;\n  }\n\n  /**\n   * Perspective transform, a 3x3 homography matrix\n   * @param {SpeedyMatrix} transform\n   */\n  set transform(transform) {\n    if (!(transform.rows == 3 && transform.columns == 3)) throw new utils_errors/* IllegalArgumentError */.qw(`Not a 3x3 transformation matrix: ${transform}`);\n    this._transform = transform;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const width = image.width,\n      height = image.height;\n    const outputTexture = this._tex[0];\n    const homography = this._transform.read();\n    const inverseHomography = this._inverse3(homography);\n    const isValidHomography = !Number.isNaN(inverseHomography[0]);\n    gpu.programs.transforms.warpPerspective.outputs(width, height, outputTexture);\n    gpu.programs.transforms.warpPerspective(image, isValidHomography ? inverseHomography : SINGULAR_MATRIX);\n    this.output().swrite(outputTexture, format);\n  }\n\n  /**\n   * Compute the inverse of a 3x3 matrix IN-PLACE (do it fast!)\n   * @param {number[]} mat 3x3 matrix in column-major format\n   * @param {number} [eps] epsilon\n   * @returns {number[]} 3x3 inverse matrix in column-major format\n   */\n  _inverse3(mat, eps = 1e-6) {\n    // read the entries of the matrix\n    const a11 = mat[0];\n    const a21 = mat[1];\n    const a31 = mat[2];\n    const a12 = mat[3];\n    const a22 = mat[4];\n    const a32 = mat[5];\n    const a13 = mat[6];\n    const a23 = mat[7];\n    const a33 = mat[8];\n\n    // compute cofactors\n    const b1 = a33 * a22 - a32 * a23; // b11\n    const b2 = a33 * a12 - a32 * a13; // b21\n    const b3 = a23 * a12 - a22 * a13; // b31\n\n    // compute the determinant\n    const det = a11 * b1 - a21 * b2 + a31 * b3;\n\n    // set up the inverse\n    if (!(Math.abs(det) < eps)) {\n      const d = 1.0 / det;\n      mat[0] = b1 * d;\n      mat[1] = -(a33 * a21 - a31 * a23) * d;\n      mat[2] = (a32 * a21 - a31 * a22) * d;\n      mat[3] = -b2 * d;\n      mat[4] = (a33 * a11 - a31 * a13) * d;\n      mat[5] = -(a32 * a11 - a31 * a12) * d;\n      mat[6] = b3 * d;\n      mat[7] = -(a23 * a11 - a21 * a13) * d;\n      mat[8] = (a22 * a11 - a21 * a12) * d;\n    } else mat.fill(Number.NaN, 0, 9);\n\n    // done!\n    return mat;\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/transforms/resize.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * resize.js\n * Resize image\n */\n\n\n\n\n\n\n\n\n\n\n\n\n\n/** @typedef {\"bilinear\"|\"nearest\"} SpeedyPipelineNodeResizeMethod */\n\n/**\n * Resize image\n */\nclass SpeedyPipelineNodeResize extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 1, [InputPort().expects(SpeedyPipelineMessageType.Image), OutputPort().expects(SpeedyPipelineMessageType.Image)]);\n\n    /** @type {SpeedySize} size of the output image, in pixels */\n    this._size = new SpeedySize(0, 0);\n\n    /** @type {SpeedyVector2} size of the output relative to the size of the input */\n    this._scale = new SpeedyVector2(1, 1);\n\n    /** @type {SpeedyPipelineNodeResizeMethod} interpolation method */\n    this._method = 'bilinear';\n  }\n\n  /**\n   * Size of the output image, in pixels (use 0 to use scale)\n   * @returns {SpeedySize}\n   */\n  get size() {\n    return this._size;\n  }\n\n  /**\n   * Size of the output image, in pixels (use 0 to use scale)\n   * @param {SpeedySize} size\n   */\n  set size(size) {\n    this._size = size;\n  }\n\n  /**\n   * Size of the output image relative to the size of the input image\n   * @returns {SpeedyVector2}\n   */\n  get scale() {\n    return this._scale;\n  }\n\n  /**\n   * Size of the output image relative to the size of the input image\n   * @param {SpeedyVector2} scale\n   */\n  set scale(scale) {\n    this._scale = scale;\n  }\n\n  /**\n   * Interpolation method\n   * @returns {SpeedyPipelineNodeResizeMethod}\n   */\n  get method() {\n    return this._method;\n  }\n\n  /**\n   * Interpolation method\n   * @param {SpeedyPipelineNodeResizeMethod} method\n   */\n  set method(method) {\n    if (method !== 'nearest' && method !== 'bilinear') throw new utils_errors/* IllegalArgumentError */.qw(`Invalid method method: \"${method}\"`);\n    this._method = method;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const width = image.width,\n      height = image.height;\n    const outputTexture = this._tex[0];\n    const method = this._method;\n    const newWidth = this._size.width || Math.max(1, this._scale.x * width);\n    const newHeight = this._size.height || Math.max(1, this._scale.y * height);\n    if (method == 'bilinear') {\n      gpu.programs.transforms.resizeBilinear.outputs(newWidth, newHeight, outputTexture)(image);\n    } else if (method == 'nearest') {\n      gpu.programs.transforms.resizeNearest.outputs(newWidth, newHeight, outputTexture)(image);\n    }\n    this.output().swrite(outputTexture, format);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/factories/transform-factory.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * transform-factory.js\n * Image transforms\n */\n\n\n\n\n\n/**\n * Image transforms\n */\nclass SpeedyPipelineTransformFactory extends speedy_namespace/* SpeedyNamespace */.Q {\n  /**\n   * Resize image\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeResize}\n   */\n  static Resize(name = undefined) {\n    return new SpeedyPipelineNodeResize(name);\n  }\n\n  /**\n   * Warp an image using a perspective transformation\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodePerspectiveWarp}\n   */\n  static PerspectiveWarp(name = undefined) {\n    return new SpeedyPipelineNodePerspectiveWarp(name);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/detectors/detector.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * detector.js\n * Abstract keypoint detectors\n */\n\n\n\n\n\n\n\n\n\n\n// Constants\nconst MAX_CAPACITY = globals.MAX_ENCODER_CAPACITY; // maximum capacity of the encoder (up to this many keypoints can be stored)\nconst detector_DEFAULT_CAPACITY = globals.DEFAULT_ENCODER_CAPACITY; // default capacity of the encoder\nconst DEFAULT_SCALE_FACTOR = 1.4142135623730951; // sqrt(2)\nconst NUMBER_OF_RGBA16_TEXTURES = 2;\n\n// legacy constants\nconst NUMBER_OF_INTERNAL_TEXTURES = 0; //5; // number of internal textures used to encode the keypoints\nconst ENCODER_PASSES = 4; // number of passes of the keypoint encoder: directly impacts performance\nconst LONG_SKIP_OFFSET_PASSES = 2; // number of passes of the long skip offsets shader\n\n/**\n * Abstract keypoint detector\n * @abstract\n */\nclass SpeedyPipelineNodeKeypointDetector extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   * @param {number} [texCount] number of work textures\n   * @param {SpeedyPipelinePortBuilder[]} [portBuilders] port builders\n   */\n  constructor(name = undefined, texCount = 0, portBuilders = undefined) {\n    super(name, texCount + NUMBER_OF_INTERNAL_TEXTURES, portBuilders);\n\n    /** @type {number} encoder capacity */\n    this._capacity = detector_DEFAULT_CAPACITY; // must not be greater than MAX_ENCODER_CAPACITY\n\n    /** @type {GLint} auxiliary storage */\n    this._oldWrapS = 0;\n\n    /** @type {SpeedyDrawableTexture[]} textures with 8-bytes per pixel */\n    this._tex16 = new Array(NUMBER_OF_RGBA16_TEXTURES).fill(null);\n  }\n\n  /**\n   * Initialize this node\n   * @param {SpeedyGPU} gpu\n   */\n  init(gpu) {\n    // initialize\n    super.init(gpu);\n\n    // encodeKeypointSkipOffsets() relies on this\n    this._oldWrapS = this._setupSpecialTexture(gpu.gl.TEXTURE_WRAP_S, gpu.gl.REPEAT);\n\n    // allocate RGBA16 textures\n    this._allocateTex16(gpu);\n    gpu.subscribe(this._allocateTex16, this, gpu);\n  }\n\n  /**\n   * Release this node\n   * @param {SpeedyGPU} gpu\n   */\n  release(gpu) {\n    // deallocate RGBA16 textures\n    gpu.unsubscribe(this._allocateTex16, this);\n    this._deallocateTex16(gpu);\n\n    // we need to restore the texture parameter because textures come from a pool!\n    this._setupSpecialTexture(gpu.gl.TEXTURE_WRAP_S, this._oldWrapS);\n\n    // release\n    super.release(gpu);\n  }\n\n  /**\n   * Set a parameter of the special texture\n   * @param {GLenum} pname\n   * @param {GLint} param new value\n   * @returns {GLint} old value of param\n   */\n  _setupSpecialTexture(pname, param) {\n    if (NUMBER_OF_INTERNAL_TEXTURES == 0) return;\n\n    // legacy code\n    const texture = this._tex[this._tex.length - 1];\n    const gl = texture.gl;\n    gl.bindTexture(gl.TEXTURE_2D, texture.glTexture);\n    const oldval = gl.getTexParameter(gl.TEXTURE_2D, pname);\n    gl.texParameteri(gl.TEXTURE_2D, pname, param);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return oldval;\n  }\n\n  /**\n   * We can encode up to this many keypoints. If you find a\n   * tight bound for this, download times will be faster.\n   * @returns {number}\n   */\n  get capacity() {\n    return this._capacity;\n  }\n\n  /**\n   * We can encode up to this many keypoints. If you find a\n   * tight bound for this, download times will be faster.\n   * @param {number} capacity\n   */\n  set capacity(capacity) {\n    this._capacity = Math.min(Math.max(0, capacity | 0), MAX_CAPACITY);\n  }\n\n  /**\n   * Create a tiny texture with encoded keypoints out of\n   * an encoded corners texture\n   * @param {SpeedyGPU} gpu\n   * @param {SpeedyTexture} corners input\n   * @param {SpeedyDrawableTexture} encodedKeypoints output\n   * @param {number} [descriptorSize] in bytes\n   * @param {number} [extraSize] in bytes\n   * @returns {SpeedyDrawableTexture} encodedKeypoints\n   */\n  _encodeKeypoints(gpu, corners, encodedKeypoints, descriptorSize = 0, extraSize = 0) {\n    const encoderCapacity = this._capacity;\n    const encoderLength = SpeedyPipelineNodeKeypointDetector.encoderLength(encoderCapacity, descriptorSize, extraSize);\n    const width = 1 << (Math.ceil(Math.log2(corners.width * corners.height)) >>> 1); // power of two\n    const height = Math.ceil(corners.width * corners.height / width); // probabilistic approach in Parallel Ale Sort 2D\n    //const width = corners.width, height = corners.height; // independent texture reads approach in Parallel Ale Sort 2D\n    const maxSize = Math.max(width, height);\n    const keypoints = gpu.programs.keypoints;\n\n    // prepare programs\n    keypoints.initLookupTable.outputs(width, height, this._tex16[1]);\n    keypoints.sortLookupTable.outputs(width, height, this._tex16[0], this._tex16[1]);\n    keypoints.encodeKeypoints.outputs(encoderLength, encoderLength, encodedKeypoints);\n\n    // compute lookup table\n    let lookupTable = keypoints.initLookupTable(corners);\n    for (let b = 1; b < maxSize; b *= 2) lookupTable = keypoints.sortLookupTable(lookupTable, b, width, height);\n\n    /*\n    // debug: view texture\n    const lookupView = (keypoints.viewLookupTable.outputs(\n        width, height, this._tex[0]\n    ))(lookupTable);\n    const canvas = gpu.renderToCanvas(lookupView);\n    if(!this._ww) document.body.appendChild(canvas);\n    this._ww = 1;\n    */\n\n    // encode keypoints\n    return keypoints.encodeKeypoints(corners, lookupTable, width, descriptorSize, extraSize, encoderLength, encoderCapacity);\n  }\n  _encodeKeypointsOLD(gpu, corners, encodedKeypoints, descriptorSize = 0, extraSize = 0) {\n    const capacity = this._capacity;\n    const encoderLength = SpeedyPipelineNodeKeypointDetector.encoderLength(capacity, descriptorSize, extraSize);\n    const width = corners.width,\n      height = corners.height;\n    const imageSize = [width, height];\n    const tex = this._tex.slice(this._tex.length - NUMBER_OF_INTERNAL_TEXTURES); // array of internal textures\n    const keypoints = gpu.programs.keypoints;\n    const specialTexture = tex.pop(); // gl.TEXTURE_WRAP_S is set to gl.REPEAT\n\n    // prepare programs\n    keypoints.encodeKeypointSkipOffsets.outputs(width, height, tex[0]);\n    keypoints.encodeKeypointLongSkipOffsets.outputs(width, height, tex[1], tex[0]);\n    keypoints.encodeKeypointPositions.outputs(encoderLength, encoderLength, tex[2], tex[3]);\n    keypoints.encodeKeypointProperties.outputs(encoderLength, encoderLength, encodedKeypoints);\n\n    // copy the input corners to a special texture\n    // that is needed by encodeKeypointSkipOffsets()\n    corners = gpu.programs.utils.copy.outputs(width, height, specialTexture)(corners);\n\n    // encode skip offsets\n    let offsets = keypoints.encodeKeypointSkipOffsets(corners, imageSize);\n    for (let i = 0; i < LONG_SKIP_OFFSET_PASSES; i++) {\n      // to boost performance\n      // the maximum skip offset of pass p=1,2,3... is 7 * (1+m)^p,\n      // where m = MAX_ITERATIONS of encodeKeypointLongSkipOffsets()\n      offsets = keypoints.encodeKeypointLongSkipOffsets(offsets, imageSize); // **bottleneck**\n    }\n\n    /*\n    // debug: view corners\n    let cornerview = offsets;\n    const canvas = gpu.renderToCanvas(cornerview);\n    if(!window._ww) document.body.appendChild(canvas);\n    window._ww = 1;\n    */\n\n    // encode keypoint positions\n    let encodedKps = tex[3].clear();\n    for (let j = 0; j < ENCODER_PASSES; j++) encodedKps = keypoints.encodeKeypointPositions(offsets, imageSize, j, ENCODER_PASSES, capacity, encodedKps, descriptorSize, extraSize, encoderLength);\n\n    // encode keypoint properties\n    return keypoints.encodeKeypointProperties(corners, encodedKps, descriptorSize, extraSize, encoderLength);\n  }\n\n  /**\n   * Create a tiny texture with zero encoded keypoints\n   * @param {SpeedyGPU} gpu\n   * @param {SpeedyDrawableTexture} encodedKeypoints output texture\n   * @param {number} [descriptorSize] in bytes\n   * @param {number} [extraSize] in bytes\n   * @returns {SpeedyDrawableTexture} encodedKeypoints\n   */\n  _encodeZeroKeypoints(gpu, encodedKeypoints, descriptorSize = 0, extraSize = 0) {\n    const capacity = 0;\n    const encoderLength = SpeedyPipelineNodeKeypointDetector.encoderLength(capacity, descriptorSize, extraSize);\n    const keypoints = gpu.programs.keypoints;\n    keypoints.encodeNullKeypoints.outputs(encoderLength, encoderLength, encodedKeypoints);\n    return keypoints.encodeNullKeypoints();\n  }\n\n  /**\n   * Allocate RGBA16 textures\n   * @param {SpeedyGPU} gpu\n   */\n  _allocateTex16(gpu) {\n    const gl = gpu.gl;\n\n    // RGBA16UI is color renderable according to the OpenGL ES 3 spec\n    for (let i = 0; i < this._tex16.length; i++) this._tex16[i] = new SpeedyDrawableTexture(gl, 1, 1, gl.RGBA_INTEGER, gl.RGBA16UI, gl.UNSIGNED_SHORT, gl.NEAREST, gl.CLAMP_TO_EDGE);\n  }\n\n  /**\n   * Deallocate RGBA16 textures\n   * @param {SpeedyGPU} gpu\n   */\n  _deallocateTex16(gpu) {\n    for (let i = 0; i < this._tex16.length; i++) this._tex16[i] = this._tex16[i].release();\n  }\n\n  /**\n   * Compute the length of the keypoint encoder, given its capacity\n   * @param {number} encoderCapacity how many keypoints can we fit?\n   * @param {number} descriptorSize in bytes\n   * @param {number} extraSize in bytes\n   */\n  static encoderLength(encoderCapacity, descriptorSize, extraSize) {\n    const pixelsPerKeypoint = Math.ceil((globals.MIN_KEYPOINT_SIZE + descriptorSize + extraSize) / 4);\n    const numberOfPixels = encoderCapacity * pixelsPerKeypoint;\n    return Math.max(globals.MIN_ENCODER_LENGTH, Math.ceil(Math.sqrt(numberOfPixels)));\n  }\n\n  /**\n   * The maximum number of keypoints we can store using\n   * a particular configuration of a keypoint encoder\n   * @param {number} descriptorSize in bytes\n   * @param {number} extraSize in bytes\n   * @param {number} encoderLength\n   */\n  static encoderCapacity(descriptorSize, extraSize, encoderLength) {\n    const pixelsPerKeypoint = Math.ceil((globals.MIN_KEYPOINT_SIZE + descriptorSize + extraSize) / 4);\n    const numberOfPixels = encoderLength * encoderLength;\n    return Math.floor(numberOfPixels / pixelsPerKeypoint);\n  }\n}\n\n/**\n * Abstract scale-space keypoint detector\n * @abstract\n */\nclass SpeedyPipelineNodeMultiscaleKeypointDetector extends SpeedyPipelineNodeKeypointDetector {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   * @param {number} [texCount] number of work textures\n   * @param {SpeedyPipelinePortBuilder[]} [portBuilders] port builders\n   */\n  constructor(name = undefined, texCount = undefined, portBuilders = undefined) {\n    super(name, texCount, portBuilders);\n\n    /** @type {number} number of pyramid levels */\n    this._levels = 1;\n\n    /** @type {number} scale factor between two pyramid levels */\n    this._scaleFactor = DEFAULT_SCALE_FACTOR;\n  }\n\n  /**\n   * Number of pyramid levels\n   * @returns {number}\n   */\n  get levels() {\n    return this._levels;\n  }\n\n  /**\n   * Number of pyramid levels\n   * @param {number} levels\n   */\n  set levels(levels) {\n    this._levels = Math.max(1, levels | 0);\n  }\n\n  /**\n   * Scale factor between two pyramid levels\n   * @returns {number}\n   */\n  get scaleFactor() {\n    return this._scaleFactor;\n  }\n\n  /**\n   * Scale factor between two pyramid levels\n   * @param {number} scaleFactor should be greater than 1\n   */\n  set scaleFactor(scaleFactor) {\n    this._scaleFactor = Math.max(1.0, Math.min(+scaleFactor, 2.0));\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/source.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * source.js\n * Gets keypoints into the pipeline\n */\n\n\n\n\n\n\n\n\n\n\n\n\n\n// Constants\nconst UBO_MAX_BYTES = 16384; // UBOs can hold at least 16KB of data: gl.MAX_UNIFORM_BLOCK_SIZE >= 16384 according to the GL ES 3 reference\nconst BUFFER_SIZE = 1024; // how many keypoints we can upload in one pass of the shader (as defined in the shader program)\nconst SIZEOF_VEC4 = Float32Array.BYTES_PER_ELEMENT * 4; // 16 bytes\n\n/**\n * Gets keypoints into the pipeline\n */\nclass SpeedyPipelineNodeKeypointSource extends SpeedyPipelineSourceNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 2, [OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n\n    /** @type {SpeedyKeypoint[]} keypoints to be uploaded to the GPU */\n    this._keypoints = [];\n\n    /** @type {Float32Array} upload buffer (UBO) */\n    this._buffer = SpeedyPipelineNodeKeypointSource._createUploadBuffer(BUFFER_SIZE);\n\n    /** @type {number} maximum number of keypoints */\n    this._capacity = globals.DEFAULT_ENCODER_CAPACITY;\n  }\n\n  /**\n   * Keypoints to be uploaded\n   * @returns {SpeedyKeypoint[]}\n   */\n  get keypoints() {\n    return this._keypoints;\n  }\n\n  /**\n   * Keypoints to be uploaded\n   * @param {SpeedyKeypoint[]} keypoints\n   */\n  set keypoints(keypoints) {\n    if (!Array.isArray(keypoints)) throw new utils_errors/* IllegalArgumentError */.qw(`Not an array of keypoints`);\n    this._keypoints = keypoints;\n  }\n\n  /**\n   * The maximum number of keypoints we'll accept.\n   * This should be a tight bound for better performance.\n   * @returns {number}\n   */\n  get capacity() {\n    return this._capacity;\n  }\n\n  /**\n   * The maximum number of keypoints we'll accept.\n   * This should be a tight bound for better performance.\n   * @param {number} capacity\n   */\n  set capacity(capacity) {\n    this._capacity = Math.min(Math.max(0, capacity | 0), globals.MAX_ENCODER_CAPACITY);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    // Orientation, descriptors and extra bytes will be lost\n    const descriptorSize = 0,\n      extraSize = 0;\n    const keypoints = this._keypoints;\n    const maxKeypoints = this._capacity;\n    const numKeypoints = Math.min(keypoints.length, maxKeypoints);\n    const numPasses = Math.max(1, Math.ceil(numKeypoints / BUFFER_SIZE));\n    const buffer = this._buffer;\n    const uploadKeypoints = gpu.programs.keypoints.uploadKeypoints;\n    const encoderLength = SpeedyPipelineNodeKeypointDetector.encoderLength(maxKeypoints, descriptorSize, extraSize); // we're using maxKeypoints to avoid constant texture resize (slow on Firefox)\n\n    uploadKeypoints.outputs(encoderLength, encoderLength, this._tex[0], this._tex[1]);\n    let startIndex = 0,\n      encodedKeypoints = uploadKeypoints.clear();\n    for (let i = 0; i < numPasses; i++) {\n      const n = Math.min(BUFFER_SIZE, numKeypoints - startIndex);\n      const endIndex = startIndex + n;\n      uploadKeypoints.setUBO('KeypointBuffer', SpeedyPipelineNodeKeypointSource._fillUploadBuffer(buffer, keypoints, startIndex, endIndex));\n      encodedKeypoints = uploadKeypoints(encodedKeypoints, startIndex, endIndex, descriptorSize, extraSize, encoderLength);\n      startIndex = endIndex;\n    }\n    this.output().swrite(encodedKeypoints, descriptorSize, extraSize, encoderLength);\n  }\n\n  /**\n   * Create an upload buffer\n   * @param {number} bufferSize number of keypoints\n   * @returns {Float32Array}\n   */\n  static _createUploadBuffer(bufferSize) {\n    const internalBuffer = new ArrayBuffer(SIZEOF_VEC4 * bufferSize);\n    utils/* Utils */.A.assert(internalBuffer.byteLength <= UBO_MAX_BYTES);\n    return new Float32Array(internalBuffer);\n  }\n\n  /**\n   * Fill upload buffer with keypoint data\n   * @param {Float32Array} buffer\n   * @param {SpeedyKeypoint[]} keypoints \n   * @param {number} start index, inclusive\n   * @param {number} end index, exclusive\n   * @returns {Float32Array} buffer\n   */\n  static _fillUploadBuffer(buffer, keypoints, start, end) {\n    const n = end - start;\n    for (let i = 0; i < n; i++) {\n      const keypoint = keypoints[start + i];\n      const hasPos = keypoint.position !== undefined;\n      const j = i * 4;\n\n      // Format data as follows:\n      // vec4(xpos, ypos, lod, score)\n      buffer[j] = +(hasPos ? keypoint.position.x : keypoint.x) || 0;\n      buffer[j + 1] = +(hasPos ? keypoint.position.y : keypoint.y) || 0;\n      buffer[j + 2] = +keypoint.lod || 0;\n      buffer[j + 3] = +keypoint.score || 0;\n    }\n\n    // done!\n    return buffer;\n  }\n}\n;// CONCATENATED MODULE: ./src/core/speedy-keypoint-descriptor.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * speedy-keypoint-descriptor.js\n * Keypoint descriptor\n */\n\n/**\n * Represents a keypoint descriptor\n */\nclass SpeedyKeypointDescriptor {\n  /**\n   * Constructor\n   * @param {Uint8Array} data descriptor bytes\n   */\n  constructor(data) {\n    this._data = data;\n    return Object.freeze(this);\n  }\n\n  /**\n   * Descriptor data\n   * @returns {Uint8Array}\n   */\n  get data() {\n    return this._data;\n  }\n\n  /**\n   * The size of the descriptor, in bytes\n   * @returns {number}\n   */\n  get size() {\n    return this._data.byteLength;\n  }\n\n  /**\n   * A string representation of the keypoint descriptor\n   * @returns {string}\n   */\n  toString() {\n    return `SpeedyKeypointDescriptor(${this._data.join(',')})`;\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/sink.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * sink.js\n * Gets keypoints out of the pipeline\n */\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/** next power of 2 */\nconst sink_nextPot = x => x > 1 ? 1 << Math.ceil(Math.log2(x)) : 1;\n\n/** empty array of bytes */\nconst ZERO_BYTES = new Uint8Array([]);\n\n/**\n * Gets keypoints out of the pipeline\n * @template {SpeedyKeypoint} T\n * @abstract\n */\nclass SpeedyPipelineNodeAbstractKeypointSink extends SpeedyPipelineSinkNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   * @param {number} [texCount]\n   * @param {SpeedyPipelinePortBuilder[]} [portBuilders]\n   */\n  constructor(name = 'keypoints', texCount = 0, portBuilders = []) {\n    super(name, texCount + 2, portBuilders);\n\n    /** @type {Array<T|null>} keypoints (output) */\n    this._keypoints = [];\n\n    /** @type {SpeedyTextureReader} texture reader */\n    this._textureReader = new SpeedyTextureReader();\n\n    /** @type {number} page flipping index */\n    this._page = 0;\n\n    /** @type {boolean} accelerate GPU-CPU transfers */\n    this._turbo = false;\n\n    /** @type {boolean} should discarded keypoints be exported as null or dropped altogether? */\n    this._includeDiscarded = false;\n  }\n\n  /**\n   * Accelerate GPU-CPU transfers\n   * @returns {boolean}\n   */\n  get turbo() {\n    return this._turbo;\n  }\n\n  /**\n   * Accelerate GPU-CPU transfers\n   * @param {boolean} value\n   */\n  set turbo(value) {\n    this._turbo = Boolean(value);\n  }\n\n  /**\n   * Should discarded keypoints be exported as null or dropped altogether?\n   * @returns {boolean}\n   */\n  get includeDiscarded() {\n    return this._includeDiscarded;\n  }\n\n  /**\n   * Should discarded keypoints be exported as null or dropped altogether?\n   * @param {boolean} value\n   */\n  set includeDiscarded(value) {\n    this._includeDiscarded = Boolean(value);\n  }\n\n  /**\n   * Initializes this node\n   * @param {SpeedyGPU} gpu\n   */\n  init(gpu) {\n    super.init(gpu);\n    this._textureReader.init(gpu);\n  }\n\n  /**\n   * Releases this node\n   * @param {SpeedyGPU} gpu\n   */\n  release(gpu) {\n    this._textureReader.release(gpu);\n    super.release(gpu);\n  }\n\n  /**\n   * Export data from this node to the user\n   * @returns {SpeedyPromise<Array<T|null>>}\n   */\n  export() {\n    return speedy_promise/* SpeedyPromise */.i.resolve(this._keypoints);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input().read();\n    return this._download(gpu, encodedKeypoints, descriptorSize, extraSize, encoderLength);\n  }\n\n  /**\n   * Download and decode keypoints from the GPU\n   * @param {SpeedyGPU} gpu\n   * @param {SpeedyDrawableTexture} encodedKeypoints\n   * @param {number} descriptorSize\n   * @param {number} extraSize\n   * @param {number} encoderLength\n   * @returns {SpeedyPromise<void>}\n   */\n  _download(gpu, encodedKeypoints, descriptorSize, extraSize, encoderLength) {\n    const useBufferedDownloads = this._turbo;\n\n    /*\n     I have found experimentally that, in Firefox, readPixelsAsync()\n    performs MUCH better if the width of the target texture is a power\n    of two. I have no idea why this is the case, nor if it's related to\n    some interaction with the GL drivers, somehow. This seems to make no\n    difference on Chrome, however. In any case, let's convert the input\n    texture to POT.\n     */\n    const encoderWidth = sink_nextPot(encoderLength);\n    //const encoderHeight = nextPot(Math.ceil(encoderLength * encoderLength / encoderWidth));\n    const encoderHeight = Math.ceil(encoderLength * encoderLength / encoderWidth);\n    //const encoderWidth=encoderLength,encoderHeight=encoderLength;\n\n    // copy the set of keypoints to an internal texture\n    const copiedTexture = this._tex[this._tex.length - 1 - this._page];\n    gpu.programs.utils.copyKeypoints.outputs(encoderWidth, encoderHeight, copiedTexture)(encodedKeypoints);\n\n    // flip page\n    this._page = 1 - this._page;\n\n    // download the internal texture\n    return this._textureReader.readPixelsAsync(copiedTexture, 0, 0, copiedTexture.width, copiedTexture.height, useBufferedDownloads).then(pixels => {\n      // decode the keypoints and store them in this._keypoints\n      this._keypoints = this._decode(pixels, descriptorSize, extraSize, encoderWidth, encoderHeight);\n    });\n  }\n\n  /**\n   * Decode a sequence of keypoints, given a flattened image of encoded pixels\n   * @param {Uint8Array} pixels pixels in the [r,g,b,a,...] format\n   * @param {number} descriptorSize in bytes\n   * @param {number} extraSize in bytes\n   * @param {number} encoderWidth\n   * @param {number} encoderHeight\n   * @returns {Array<T|null>} keypoints\n   */\n  _decode(pixels, descriptorSize, extraSize, encoderWidth, encoderHeight) {\n    const bytesPerKeypoint = globals.MIN_KEYPOINT_SIZE + descriptorSize + extraSize;\n    const m = globals.LOG2_PYRAMID_MAX_SCALE,\n      h = globals.PYRAMID_MAX_LEVELS;\n    const piOver255 = Math.PI / 255.0;\n    const keypoints = /** @type {Array<T|null>} */[];\n    const includeDiscarded = this._includeDiscarded;\n    let descriptorBytes = ZERO_BYTES,\n      extraBytes = ZERO_BYTES;\n    let x, y, z, w, lod, rotation, score;\n    let keypoint;\n\n    // validate\n    if (descriptorSize % 4 != 0 || extraSize % 4 != 0) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid descriptorSize (${descriptorSize}) / extraSize (${extraSize})`);\n\n    // how many bytes should we read?\n    const e2 = encoderWidth * encoderHeight * 4;\n    const size = pixels.byteLength;\n    if (size != e2) utils/* Utils */.A.warning(`Expected ${e2} bytes when decoding a set of keypoints, found ${size}`);\n\n    // copy the data (we use shared buffers when receiving pixels[])\n    if (descriptorSize + extraSize > 0) pixels = new Uint8Array(pixels);\n\n    // for each encoded keypoint\n    for (let i = 0; i < size; i += bytesPerKeypoint) {\n      // extract encoded header\n      x = pixels[i + 1] << 8 | pixels[i];\n      y = pixels[i + 3] << 8 | pixels[i + 2];\n      z = pixels[i + 5] << 8 | pixels[i + 4];\n      w = pixels[i + 7] << 8 | pixels[i + 6];\n\n      // the keypoint is \"null\": we have reached the end of the list\n      if (x == 0xFFFF && y == 0xFFFF) break;\n\n      // the header is zero: discard the keypoint\n      if (x + y + z + w == 0) {\n        if (includeDiscarded) keypoints.push(null);\n        continue;\n      }\n\n      // extract extra & descriptor bytes\n      if (extraSize > 0) {\n        extraBytes = pixels.subarray(8 + i, 8 + i + extraSize);\n        if (extraBytes.byteLength < extraSize) {\n          utils/* Utils */.A.warning(`KeypointSink: expected ${extraSize} extra bytes when decoding the ${i / bytesPerKeypoint}-th keypoint, found ${extraBytes.byteLength} instead`);\n          continue; // something is off here; discard\n        }\n      }\n      if (descriptorSize > 0) {\n        descriptorBytes = pixels.subarray(8 + i + extraSize, 8 + i + extraSize + descriptorSize);\n        if (descriptorBytes.byteLength < descriptorSize) {\n          utils/* Utils */.A.warning(`KeypointSink: expected ${descriptorSize} descriptor bytes when decoding the ${i / bytesPerKeypoint}-th keypoint, found ${descriptorBytes.byteLength} instead`);\n          continue; // something is off here; discard\n        }\n      }\n\n      // decode position: convert from fixed-point\n      x /= globals.FIX_RESOLUTION;\n      y /= globals.FIX_RESOLUTION;\n\n      // decode level-of-detail\n      lod = pixels[i + 4] < 255 ? -m + (m + h) * pixels[i + 4] / 255.0 : 0.0;\n\n      // decode orientation\n      rotation = (2 * pixels[i + 5] - 255) * piOver255;\n\n      // decode score\n      score = utils/* Utils */.A.decodeFloat16(w);\n\n      // create keypoint\n      keypoint = this._createKeypoint(x, y, lod, rotation, score, descriptorBytes, extraBytes);\n\n      // register keypoint\n      keypoints.push(keypoint);\n    }\n\n    // done!\n    return keypoints;\n  }\n\n  /**\n   * Instantiate a new keypoint\n   * @param {number} x\n   * @param {number} y\n   * @param {number} lod\n   * @param {number} rotation\n   * @param {number} score\n   * @param {Uint8Array} descriptorBytes\n   * @param {Uint8Array} extraBytes\n   * @returns {T}\n   */\n  _createKeypoint(x, y, lod, rotation, score, descriptorBytes, extraBytes) {\n    throw new utils_errors/* AbstractMethodError */.aQ();\n  }\n\n  /**\n   * Allocate extra space\n   * @param {SpeedyGPU} gpu\n   * @param {SpeedyDrawableTexture} output output texture\n   * @param {SpeedyTexture} inputEncodedKeypoints input with no extra space\n   * @param {number} inputDescriptorSize in bytes, must be positive\n   * @param {number} inputExtraSize must be 0\n   * @param {number} outputDescriptorSize must be inputDescriptorSize\n   * @param {number} outputExtraSize in bytes, must be positive and a multiple of 4\n   * @returns {SpeedyDrawableTexture} encodedKeypoints with extra space\n   */\n  _allocateExtra(gpu, output, inputEncodedKeypoints, inputDescriptorSize, inputExtraSize, outputDescriptorSize, outputExtraSize) {\n    utils/* Utils */.A.assert(inputExtraSize === 0);\n    utils/* Utils */.A.assert(outputDescriptorSize === inputDescriptorSize && outputExtraSize > 0 && outputExtraSize % 4 === 0);\n    const inputEncoderLength = inputEncodedKeypoints.width;\n    const inputEncoderCapacity = SpeedyPipelineNodeKeypointDetector.encoderCapacity(inputDescriptorSize, inputExtraSize, inputEncoderLength);\n    const outputEncoderCapacity = inputEncoderCapacity;\n    const outputEncoderLength = SpeedyPipelineNodeKeypointDetector.encoderLength(outputEncoderCapacity, outputDescriptorSize, outputExtraSize);\n    return gpu.programs.keypoints.allocateExtra.outputs(outputEncoderLength, outputEncoderLength, output)(inputEncodedKeypoints, inputDescriptorSize, inputExtraSize, inputEncoderLength, outputDescriptorSize, outputExtraSize, outputEncoderLength);\n  }\n}\n\n/**\n * Gets standard keypoints out of the pipeline\n * @extends {SpeedyPipelineNodeAbstractKeypointSink<SpeedyKeypoint>}\n */\nclass SpeedyPipelineNodeKeypointSink extends SpeedyPipelineNodeAbstractKeypointSink {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = 'keypoints') {\n    super(name, 0, [InputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n  }\n\n  /**\n   * Instantiate a new keypoint\n   * @param {number} x\n   * @param {number} y\n   * @param {number} lod\n   * @param {number} rotation\n   * @param {number} score\n   * @param {Uint8Array} descriptorBytes\n   * @param {Uint8Array} extraBytes\n   * @returns {SpeedyKeypoint}\n   */\n  _createKeypoint(x, y, lod, rotation, score, descriptorBytes, extraBytes) {\n    const descriptorSize = descriptorBytes.byteLength;\n\n    // read descriptor, if any\n    const descriptor = descriptorSize > 0 ? new SpeedyKeypointDescriptor(descriptorBytes) : null;\n\n    // create keypoint\n    return new SpeedyKeypoint(x, y, lod, rotation, score, descriptor);\n  }\n}\n\n/**\n * Gets tracked keypoints out of the pipeline\n * @extends {SpeedyPipelineNodeAbstractKeypointSink<SpeedyTrackedKeypoint>}\n */\nclass SpeedyPipelineNodeTrackedKeypointSink extends SpeedyPipelineNodeAbstractKeypointSink {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = 'keypoints') {\n    super(name, 2, [InputPort().expects(SpeedyPipelineMessageType.Keypoints).satisfying(( /** @type {SpeedyPipelineMessageWithKeypoints} */msg) => msg.extraSize == 0), InputPort('flow').expects(SpeedyPipelineMessageType.Vector2)]);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input().read();\n    const {\n      vectors\n    } = /** @type {SpeedyPipelineMessageWith2DVectors} */this.input('flow').read();\n\n    // allocate extra space\n    const newDescriptorSize = descriptorSize;\n    const newExtraSize = 4; // 1 pixel per flow vector per keypoint\n    const encodedKeypointsWithExtraSpace = this._allocateExtra(gpu, this._tex[0], encodedKeypoints, descriptorSize, extraSize, newDescriptorSize, newExtraSize);\n\n    // attach flow vectors\n    const newEncoderLength = encodedKeypointsWithExtraSpace.width;\n    const newEncodedKeypoints = gpu.programs.keypoints.transferToExtra.outputs(newEncoderLength, newEncoderLength, this._tex[1])(vectors, vectors.width, encodedKeypointsWithExtraSpace, newDescriptorSize, newExtraSize, newEncoderLength);\n\n    // done!\n    return this._download(gpu, newEncodedKeypoints, newDescriptorSize, newExtraSize, newEncoderLength);\n  }\n\n  /**\n   * Instantiate a new keypoint\n   * @param {number} x\n   * @param {number} y\n   * @param {number} lod\n   * @param {number} rotation\n   * @param {number} score\n   * @param {Uint8Array} descriptorBytes\n   * @param {Uint8Array} extraBytes\n   * @returns {SpeedyTrackedKeypoint}\n   */\n  _createKeypoint(x, y, lod, rotation, score, descriptorBytes, extraBytes) {\n    const descriptorSize = descriptorBytes.byteLength;\n    const extraSize = extraBytes.byteLength;\n\n    // read descriptor, if any\n    const descriptor = descriptorSize > 0 ? new SpeedyKeypointDescriptor(descriptorBytes) : null;\n\n    // read flow vector\n    const fx = utils/* Utils */.A.decodeFloat16(extraBytes[1] << 8 | extraBytes[0]);\n    const fy = utils/* Utils */.A.decodeFloat16(extraBytes[3] << 8 | extraBytes[2]);\n    const flow = new SpeedyVector2(fx, fy);\n\n    // create keypoint\n    return new SpeedyTrackedKeypoint(x, y, lod, rotation, score, descriptor, flow);\n  }\n}\n\n/**\n * Gets matched keypoints out of the pipeline\n * @extends SpeedyPipelineNodeAbstractKeypointSink<SpeedyMatchedKeypoint>\n */\nclass SpeedyPipelineNodeMatchedKeypointSink extends SpeedyPipelineNodeAbstractKeypointSink {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = 'keypoints') {\n    super(name, 2, [InputPort().expects(SpeedyPipelineMessageType.Keypoints).satisfying(( /** @type {SpeedyPipelineMessageWithKeypoints} */msg) => msg.extraSize == 0), InputPort('matches').expects(SpeedyPipelineMessageType.KeypointMatches)]);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input().read();\n    const {\n      encodedMatches,\n      matchesPerKeypoint\n    } = /** @type {SpeedyPipelineMessageWithKeypointMatches} */this.input('matches').read();\n\n    // allocate space for the matches\n    const newDescriptorSize = descriptorSize;\n    const newExtraSize = matchesPerKeypoint * 4; // 4 bytes per pixel\n    const encodedKeypointsWithExtraSpace = this._allocateExtra(gpu, this._tex[0], encodedKeypoints, descriptorSize, extraSize, newDescriptorSize, newExtraSize);\n\n    // transfer matches to a new texture\n    const newEncoderLength = encodedKeypointsWithExtraSpace.width;\n    const newEncodedKeypoints = gpu.programs.keypoints.transferToExtra.outputs(newEncoderLength, newEncoderLength, this._tex[1])(encodedMatches, encodedMatches.width, encodedKeypointsWithExtraSpace, newDescriptorSize, newExtraSize, newEncoderLength);\n\n    // done!\n    return this._download(gpu, newEncodedKeypoints, newDescriptorSize, newExtraSize, newEncoderLength);\n  }\n\n  /**\n   * Instantiate a new keypoint\n   * @param {number} x\n   * @param {number} y\n   * @param {number} lod\n   * @param {number} rotation\n   * @param {number} score\n   * @param {Uint8Array} descriptorBytes\n   * @param {Uint8Array} extraBytes\n   * @returns {SpeedyMatchedKeypoint}\n   */\n  _createKeypoint(x, y, lod, rotation, score, descriptorBytes, extraBytes) {\n    const descriptorSize = descriptorBytes.byteLength;\n    const extraSize = extraBytes.byteLength;\n\n    // read descriptor, if any\n    const descriptor = descriptorSize > 0 ? new SpeedyKeypointDescriptor(descriptorBytes) : null;\n\n    // decode matches\n    const matchesPerKeypoint = extraSize / 4;\n    const matches = /** @type {SpeedyKeypointMatch[]} */new Array(matchesPerKeypoint);\n    for (let matchIndex = 0; matchIndex < matchesPerKeypoint; matchIndex++) {\n      const base = matchIndex * 4;\n      const u32 = extraBytes[base] | extraBytes[base + 1] << 8 | extraBytes[base + 2] << 16 | extraBytes[base + 3] << 24;\n      const match = new SpeedyKeypointMatch(u32 & globals.MATCH_INDEX_MASK, u32 >>> globals.MATCH_INDEX_BITS);\n      matches[matchIndex] = match;\n    }\n\n    // done!\n    return new SpeedyMatchedKeypoint(x, y, lod, rotation, score, descriptor, matches);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/clipper.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * clipper.js\n * Keypoint clipper\n */\n\n\n\n\n\n\n\n\n\n\n\n// Constants\nconst LOG2_STRIDE = 5;\nconst MAX_SIZE = globals.MAX_ENCODER_CAPACITY;\n\n/**\n * Keypoint clipper: filters the best keypoints from a stream\n */\nclass SpeedyPipelineNodeKeypointClipper extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 4, [InputPort().expects(SpeedyPipelineMessageType.Keypoints), OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n\n    /** @type {number} the maximum number of keypoints in the output */\n    this._size = MAX_SIZE;\n  }\n\n  /**\n   * The maximum number of keypoints in the output\n   * @returns {number}\n   */\n  get size() {\n    return this._size;\n  }\n\n  /**\n   * The maximum number of keypoints in the output\n   * @param {number} size\n   */\n  set size(size) {\n    this._size = Math.max(0, Math.min(size | 0, MAX_SIZE));\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input().read();\n    const keypoints = gpu.programs.keypoints;\n    const clipValue = this._size;\n    const tex = this._tex;\n    const outputTexture = this._tex[3];\n\n    // find the minimum power of 2 pot such that pot >= capacity\n    const capacity = SpeedyPipelineNodeKeypointDetector.encoderCapacity(descriptorSize, extraSize, encoderLength);\n    //const pot = 1 << (Math.ceil(Math.log2(capacity)) | 0);\n\n    // find the dimensions of the sorting shaders\n    const stride = 1 << LOG2_STRIDE; // must be a power of 2\n    //const height = Math.max(1, pot >>> LOG2_STRIDE); // this is also a power of 2\n    const height = Math.ceil(capacity / stride); // more economical, maybe not a power of 2\n    const numberOfPixels = stride * height;\n\n    // find the dimensions of the output texture\n    const newCapacity = Math.min(capacity, clipValue);\n    const newEncoderLength = SpeedyPipelineNodeKeypointDetector.encoderLength(newCapacity, descriptorSize, extraSize);\n\n    // generate permutation of keypoints\n    keypoints.sortCreatePermutation.outputs(stride, height, tex[0]);\n    let permutation = keypoints.sortCreatePermutation(encodedKeypoints, descriptorSize, extraSize, encoderLength);\n\n    // sort permutation\n    const numPasses = Math.ceil(Math.log2(numberOfPixels));\n    keypoints.sortMergePermutation.outputs(stride, height, tex[1], tex[2]);\n    for (let i = 1; i <= numPasses; i++) {\n      const blockSize = 1 << i; // 2, 4, 8...\n      const dblLog2BlockSize = i << 1; // 2 * log2(blockSize)\n      permutation = keypoints.sortMergePermutation(permutation, blockSize, dblLog2BlockSize);\n    }\n\n    // apply permutation\n    keypoints.sortApplyPermutation.outputs(newEncoderLength, newEncoderLength, outputTexture);\n    keypoints.sortApplyPermutation(permutation, newCapacity, encodedKeypoints, descriptorSize, extraSize);\n\n    /*\n    // debug (read the contents of the permutation)\n    const pixels = permutation.inspect(gpu), debug = [];\n    for(let i = 0; i < pixels.length; i += 4) {\n        let id = pixels[i] | (pixels[i+1] << 8);\n        let score = pixels[i+2] / 255.0;\n        let valid = pixels[i+3] / 255.0;\n        debug.push([ id, valid, score, ].join(', '));\n    }\n    console.log(debug);\n    */\n\n    // done!\n    this.output().swrite(outputTexture, descriptorSize, extraSize, newEncoderLength);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/border-clipper.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * border-clipper.js\n * Keypoint Border Clipper\n */\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * The Border Clipper removes all keypoints within a border of the edges of an image\n */\nclass SpeedyPipelineNodeKeypointBorderClipper extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 5, [InputPort().expects(SpeedyPipelineMessageType.Keypoints), OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n\n    /** @type {SpeedySize} image size, in pixels */\n    this._imageSize = new SpeedySize(0, 0);\n\n    /** @type {SpeedyVector2} border size, in pixels */\n    this._borderSize = new SpeedyVector2(0, 0);\n  }\n\n  /**\n   * Image size, in pixels\n   * @returns {SpeedySize}\n   */\n  get imageSize() {\n    return this._imageSize;\n  }\n\n  /**\n   * Image size, in pixels\n   * @param {SpeedySize} imageSize\n   */\n  set imageSize(imageSize) {\n    this._imageSize = imageSize;\n  }\n\n  /**\n   * Border size, in pixels\n   * @returns {SpeedyVector2}\n   */\n  get borderSize() {\n    return this._borderSize;\n  }\n\n  /**\n   * Border size, in pixels\n   * @param {SpeedyVector2} borderSize\n   */\n  set borderSize(borderSize) {\n    this._borderSize = borderSize;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input().read();\n    const keypoints = gpu.programs.keypoints;\n    const imageSize = this._imageSize;\n    const borderSize = this._borderSize;\n    const imageWidth = imageSize.width,\n      imageHeight = imageSize.height;\n    const borderLeft = borderSize.x,\n      borderRight = borderSize.x;\n    const borderTop = borderSize.y,\n      borderBottom = borderSize.y;\n    const tex = this._tex;\n\n    // validate\n    if (imageWidth == 0 || imageHeight == 0) throw new utils_errors/* IllegalOperationError */.Er(`BorderClipper: did you forget to set the image size?`);\n\n    // find the capacity of the keypoint stream\n    const capacity = SpeedyPipelineNodeKeypointDetector.encoderCapacity(descriptorSize, extraSize, encoderLength);\n    const mixEncoderLength = Math.max(1, Math.ceil(Math.sqrt(capacity)));\n\n    // prepare programs\n    keypoints.clipBorder.outputs(encoderLength, encoderLength, tex[0]);\n    keypoints.mixKeypointsInit.outputs(mixEncoderLength, mixEncoderLength, tex[1]);\n    keypoints.mixKeypointsSort.outputs(mixEncoderLength, mixEncoderLength, tex[2], tex[3]);\n    keypoints.mixKeypointsApply.outputs(encoderLength, encoderLength, tex[4]);\n\n    // clip keypoints\n    let clippedKeypoints = keypoints.clipBorder(imageWidth, imageHeight, borderTop, borderRight, borderBottom, borderLeft, encodedKeypoints, descriptorSize, extraSize, encoderLength);\n\n    // sort keypoints\n    let sortedKeypoints = keypoints.mixKeypointsInit(clippedKeypoints, descriptorSize, extraSize, encoderLength, capacity);\n    for (let b = 1; b < capacity; b *= 2) sortedKeypoints = keypoints.mixKeypointsSort(sortedKeypoints, b);\n    clippedKeypoints = keypoints.mixKeypointsApply(sortedKeypoints, clippedKeypoints, descriptorSize, extraSize, encoderLength);\n\n    /*\n    // debug: view keypoints\n    keypoints.mixKeypointsView.outputs(mixEncoderLength, mixEncoderLength, tex[1]);\n    this._visualize(gpu, keypoints.mixKeypointsView(sortedKeypoints));\n    */\n\n    // done!\n    this.output().swrite(clippedKeypoints, descriptorSize, extraSize, encoderLength);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/buffer.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * buffer.js\n * Keypoint Buffer\n */\n\n\n\n\n\n\n\n\n\n\n/**\n * Keypoint Buffer: a node with memory.\n * At time t, it outputs the keypoints received at time t-1\n */\nclass SpeedyPipelineNodeKeypointBuffer extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 2, [InputPort().expects(SpeedyPipelineMessageType.Keypoints), OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n\n    /** @type {number} current page: 0 or 1 */\n    this._pageIndex = 0;\n\n    /** @type {boolean} first run? */\n    this._initialized = false;\n\n    /** @type {number} previous descriptor size, in bytes */\n    this._previousDescriptorSize = 0;\n\n    /** @type {number} previous extra size, in bytes */\n    this._previousExtraSize = 0;\n\n    /** @type {number} previous encoder length */\n    this._previousEncoderLength = 0;\n\n    /** @type {boolean} frozen buffer? */\n    this._frozen = false;\n  }\n\n  /**\n   * A frozen buffer discards the input, effectively increasing the buffering time\n   * @returns {boolean}\n   */\n  get frozen() {\n    return this._frozen;\n  }\n\n  /**\n   * A frozen buffer discards the input, effectively increasing the buffering time\n   * @param {boolean} value\n   */\n  set frozen(value) {\n    this._frozen = Boolean(value);\n  }\n\n  /**\n   * Releases this node\n   * @param {SpeedyGPU} gpu\n   */\n  release(gpu) {\n    this._initialized = false;\n    super.release(gpu);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input().read();\n    const previousDescriptorSize = this._previousDescriptorSize;\n    const previousExtraSize = this._previousExtraSize;\n    const previousEncoderLength = this._previousEncoderLength;\n    const page = this._tex;\n    const previousInputTexture = page[1 - this._pageIndex];\n    const outputTexture = page[this._pageIndex];\n\n    // bufferize\n    if (!this._frozen || !this._initialized) {\n      // store input\n      this._previousDescriptorSize = descriptorSize;\n      this._previousExtraSize = extraSize;\n      this._previousEncoderLength = encoderLength;\n      previousInputTexture.resize(encoderLength, encoderLength);\n      encodedKeypoints.copyTo(previousInputTexture);\n\n      // page flipping\n      this._pageIndex = 1 - this._pageIndex;\n    }\n\n    // first run?\n    if (!this._initialized) {\n      this._initialized = true;\n      this.output().swrite(previousInputTexture, descriptorSize, extraSize, encoderLength);\n      return;\n    }\n\n    // done!\n    this.output().swrite(outputTexture, previousDescriptorSize, previousExtraSize, previousEncoderLength);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/mixer.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * mixer.js\n * Keypoint Mixer\n */\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Keypoint Mixer: merges two sets of keypoints\n */\nclass SpeedyPipelineNodeKeypointMixer extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 5, [InputPort('in0').expects(SpeedyPipelineMessageType.Keypoints), InputPort('in1').expects(SpeedyPipelineMessageType.Keypoints), OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const kps0 = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input('in0').read();\n    const kps1 = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input('in1').read();\n    const descriptorSize = kps0.descriptorSize;\n    const extraSize = kps0.extraSize;\n    const keypoints = gpu.programs.keypoints;\n    const tex = this._tex;\n\n    // ensure that the format of kps0 equals the format of kps1\n    if (!(kps0.descriptorSize === kps1.descriptorSize && kps0.extraSize === kps0.extraSize)) throw new utils_errors/* IllegalOperationError */.Er(`Can't merge two sets of keypoints that have different formats`);\n\n    // find the capacity of kps0 + kps1\n    const cap0 = SpeedyPipelineNodeKeypointDetector.encoderCapacity(kps0.descriptorSize, kps0.extraSize, kps0.encoderLength);\n    const cap1 = SpeedyPipelineNodeKeypointDetector.encoderCapacity(kps1.descriptorSize, kps1.extraSize, kps1.encoderLength);\n    const capacity = cap0 + cap1;\n\n    // find the dimensions of the output texture\n    const encoderLength = SpeedyPipelineNodeKeypointDetector.encoderLength(capacity, descriptorSize, extraSize);\n    const mixEncoderLength = Math.max(1, Math.ceil(Math.sqrt(capacity)));\n\n    // prepare programs\n    keypoints.mixKeypointsPreInit.outputs(encoderLength, encoderLength, tex[0]);\n    keypoints.mixKeypointsInit.outputs(mixEncoderLength, mixEncoderLength, tex[1]);\n    keypoints.mixKeypointsSort.outputs(mixEncoderLength, mixEncoderLength, tex[2], tex[3]);\n    keypoints.mixKeypointsApply.outputs(encoderLength, encoderLength, tex[4]);\n\n    // mix keypoints\n    let mixedKeypoints = keypoints.mixKeypointsPreInit(kps0.encodedKeypoints, kps1.encodedKeypoints, kps0.encoderLength, kps1.encoderLength, cap0, cap1, descriptorSize, extraSize, encoderLength);\n    let sortedKeypoints = keypoints.mixKeypointsInit(mixedKeypoints, descriptorSize, extraSize, encoderLength, capacity);\n    for (let b = 1; b < capacity; b *= 2) sortedKeypoints = keypoints.mixKeypointsSort(sortedKeypoints, b);\n    mixedKeypoints = keypoints.mixKeypointsApply(sortedKeypoints, mixedKeypoints, descriptorSize, extraSize, encoderLength);\n\n    /*\n    // debug: view keypoints\n    keypoints.mixKeypointsView.outputs(mixEncoderLength, mixEncoderLength, tex[1]);\n    this._visualize(gpu, keypoints.mixKeypointsView(sortedKeypoints));\n    */\n\n    this.output().swrite(mixedKeypoints, descriptorSize, extraSize, encoderLength);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/shuffler.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * shuffler.js\n * Keypoint Shuffler\n */\n\n\n\n\n\n\n\n\n\n/**\n * The Keypoint Shuffler shuffles a list of keypoints\n */\nclass SpeedyPipelineNodeKeypointShuffler extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 6, [InputPort().expects(SpeedyPipelineMessageType.Keypoints), OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n\n    /** @type {number} maximum number of keypoints */\n    this._maxKeypoints = Number.NaN;\n  }\n\n  /**\n   * Maximum number of keypoints (optional)\n   * @returns {number}\n   */\n  get maxKeypoints() {\n    return this._maxKeypoints;\n  }\n\n  /**\n   * Maximum number of keypoints (optional)\n   * @param {number} value\n   */\n  set maxKeypoints(value) {\n    if (!Number.isNaN(value)) this._maxKeypoints = Math.max(0, value | 0);else this._maxKeypoints = Number.NaN;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    let {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input().read();\n    const capacity = SpeedyPipelineNodeKeypointDetector.encoderCapacity(descriptorSize, extraSize, encoderLength);\n    const maxKeypoints = this._maxKeypoints;\n\n    // shuffle the keypoints (including nulls)\n    const permutationMaxLength = gpu.programs.keypoints.shuffle.definedConstant('PERMUTATION_MAXLEN');\n    const permutationLength = Math.min(permutationMaxLength, capacity);\n    const permutation = this._generatePermutation(permutationLength, permutationMaxLength);\n    encodedKeypoints = gpu.programs.keypoints.shuffle.setUBO('Permutation', permutation).outputs(encoderLength, encoderLength, this._tex[0])(encodedKeypoints, descriptorSize, extraSize, encoderLength);\n\n    // sort the keypoints\n    gpu.programs.keypoints.mixKeypointsInit.outputs(encoderLength, encoderLength, this._tex[1]);\n    gpu.programs.keypoints.mixKeypointsSort.outputs(encoderLength, encoderLength, this._tex[2], this._tex[3]);\n    gpu.programs.keypoints.mixKeypointsApply.outputs(encoderLength, encoderLength, this._tex[4]);\n    let sortedKeypoints = gpu.programs.keypoints.mixKeypointsInit(encodedKeypoints, descriptorSize, extraSize, encoderLength, capacity);\n    for (let b = 1; b < capacity; b *= 2) sortedKeypoints = gpu.programs.keypoints.mixKeypointsSort(sortedKeypoints, b);\n    encodedKeypoints = gpu.programs.keypoints.mixKeypointsApply(sortedKeypoints, encodedKeypoints, descriptorSize, extraSize, encoderLength);\n\n    // clip the output?\n    if (!Number.isNaN(maxKeypoints) && maxKeypoints < capacity) {\n      const newEncoderLength = SpeedyPipelineNodeKeypointDetector.encoderLength(maxKeypoints, descriptorSize, extraSize);\n      encodedKeypoints = gpu.programs.keypoints.clip.outputs(newEncoderLength, newEncoderLength, this._tex[5])(encodedKeypoints, descriptorSize, extraSize, encoderLength, maxKeypoints);\n      encoderLength = newEncoderLength;\n    }\n\n    // done!\n    this.output().swrite(encodedKeypoints, descriptorSize, extraSize, encoderLength);\n  }\n\n  /**\n   * Generate a permutation p of { 0, 1, ..., n-1 } such that p(p(x)) = x for all x\n   * @param {number} n positive integer\n   * @param {number} [bufsize] size of the output array\n   * @returns {Int32Array} permutation\n   */\n  _generatePermutation(n, bufsize = n) {\n    const array = new Int32Array(bufsize);\n    const p = array.subarray(0, n).fill(-1);\n    const q = utils/* Utils */.A.shuffle(utils/* Utils */.A.range(n));\n    for (let i = 0, j = 0; i < n; i++) {\n      if (p[i] < 0) {\n        do {\n          p[i] = q[j++];\n        } while (p[i] < i);\n        p[p[i]] = i;\n      }\n    }\n    return array; // padded with zeros\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/multiplexer.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * multiplexer.js\n * Keypoint multiplexer\n */\n\n\n\n\n\n\n\n\n\n\n\n/** @type {string[]} the names of the input ports indexed by their number */\nconst multiplexer_INPUT_PORT = ['in0', 'in1'];\n\n/**\n * Keypoint multiplexer\n */\nclass SpeedyPipelineNodeKeypointMultiplexer extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 0, [...multiplexer_INPUT_PORT.map(portName => InputPort(portName).expects(SpeedyPipelineMessageType.Keypoints)), OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n\n    /** @type {number} which port should be linked to the output? */\n    this._port = 0;\n  }\n\n  /**\n   * The number of the port that should be linked to the output\n   * @returns {number}\n   */\n  get port() {\n    return this._port;\n  }\n\n  /**\n   * The number of the port that should be linked to the output\n   * @param {number} port\n   */\n  set port(port) {\n    if (port < 0 || port >= multiplexer_INPUT_PORT.length) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid port: ${port}`);\n    this._port = port | 0;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const message = this.input(multiplexer_INPUT_PORT[this._port]).read();\n    this.output().write(message);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/transformer.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * transformer.js\n * Apply a transformation matrix to a set of keypoints\n */\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Apply a transformation matrix to a set of keypoints\n */\nclass SpeedyPipelineNodeKeypointTransformer extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 1, [InputPort().expects(SpeedyPipelineMessageType.Keypoints), OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n\n    /** @type {SpeedyMatrix} transformation matrix */\n    this._transform = speedy_matrix.SpeedyMatrix.Create(3, 3, [1, 0, 0, 0, 1, 0, 0, 0, 1]); // identity matrix\n  }\n\n  /**\n   * Transformation matrix\n   * @returns {SpeedyMatrix}\n   */\n  get transform() {\n    return this._transform;\n  }\n\n  /**\n   * Transformation matrix. Must be 3x3\n   * @param {SpeedyMatrix} transform\n   */\n  set transform(transform) {\n    if (!(transform.rows == 3 && transform.columns == 3)) throw new utils_errors/* IllegalArgumentError */.qw(`Not a 3x3 transformation matrix: ${transform}`);\n    this._transform = transform;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input().read();\n    const outputTexture = this._tex[0];\n    const homography = this._transform.read();\n\n    // apply homography\n    gpu.programs.keypoints.applyHomography.outputs(encodedKeypoints.width, encodedKeypoints.height, outputTexture)(homography, encodedKeypoints, descriptorSize, extraSize, encoderLength);\n\n    // done!\n    this.output().swrite(outputTexture, descriptorSize, extraSize, encoderLength);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/subpixel.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * subpixel.js\n * Subpixel refinement of keypoint location\n */\n\n\n\n\n\n\n\n\n\n\n\n\n/** @typedef {\"quadratic1d\"|\"taylor2d\"|\"bicubic-upsample\"|\"bilinear-upsample\"} SubpixelRefinementMethod */\n\n/** @const {Object<SubpixelRefinementMethod,string>} method name to program name */\nconst METHOD2PROGRAM = Object.freeze({\n  'quadratic1d': 'subpixelQuadratic1d',\n  'taylor2d': 'subpixelTaylor2d',\n  'bicubic-upsample': 'subpixelBicubic',\n  'bilinear-upsample': 'subpixelBilinear'\n});\n\n/**\n * Subpixel refinement of keypoint location\n */\nclass SpeedyPipelineNodeKeypointSubpixelRefiner extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 2, [InputPort('image').expects(SpeedyPipelineMessageType.Image).satisfying(( /** @type {SpeedyPipelineMessageWithImage} */msg) => msg.format === types/* ImageFormat */.f5.GREY), InputPort('keypoints').expects(SpeedyPipelineMessageType.Keypoints), OutputPort().expects(SpeedyPipelineMessageType.Keypoints), OutputPort('displacements').expects(SpeedyPipelineMessageType.Vector2)]);\n\n    /** @type {SubpixelRefinementMethod} subpixel refinement method */\n    this._method = 'quadratic1d';\n\n    /** @type {number} max iterations for the upsampling methods */\n    this._maxIterations = 6;\n\n    /** @type {number} convergence threshold for the upsampling methods */\n    this._epsilon = 0.1;\n  }\n\n  /**\n   * Subpixel refinement method\n   * @returns {SubpixelRefinementMethod}\n   */\n  get method() {\n    return this._method;\n  }\n\n  /**\n   * Subpixel refinement method\n   * @param {SubpixelRefinementMethod} name\n   */\n  set method(name) {\n    if (!Object.prototype.hasOwnProperty.call(METHOD2PROGRAM, name)) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid method: \"${name}\"`);\n    this._method = name;\n  }\n\n  /**\n   * Max. iterations for the upsampling methods\n   * @returns {number}\n   */\n  get maxIterations() {\n    return this._maxIterations;\n  }\n\n  /**\n   * Max. iterations for the upsampling methods\n   * @param {number} value\n   */\n  set maxIterations(value) {\n    this._maxIterations = Math.max(0, +value);\n  }\n\n  /**\n   * Convergence threshold for the upsampling methods\n   * @returns {number}\n   */\n  get epsilon() {\n    return this._epsilon;\n  }\n\n  /**\n   * Convergence threshold for the upsampling methods\n   * @param {number} value\n   */\n  set epsilon(value) {\n    this._epsilon = Math.max(0, +value);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input('keypoints').read();\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input('image').read();\n    const tex = this._tex;\n    const program = METHOD2PROGRAM[this._method];\n    const maxIterations = this._maxIterations;\n    const epsilon = this._epsilon;\n\n    // note: if you detected the keypoints using a pyramid,\n    //       you need to pass that pyramid as input!\n\n    // we'll compute the offsets for each keypoint\n    const capacity = SpeedyPipelineNodeKeypointDetector.encoderCapacity(descriptorSize, extraSize, encoderLength);\n    const offsetEncoderLength = Math.max(1, Math.ceil(Math.sqrt(capacity))); // 1 pixel per refinement offset\n    const offsets = gpu.programs.keypoints[program].outputs(offsetEncoderLength, offsetEncoderLength, tex[0])(image, encodedKeypoints, descriptorSize, extraSize, encoderLength, maxIterations, epsilon);\n\n    // apply the offsets to the keypoints\n    const refinedKeypoints = gpu.programs.keypoints.transferFlow.outputs(encoderLength, encoderLength, tex[1])(offsets, encodedKeypoints, descriptorSize, extraSize, encoderLength);\n\n    // done!\n    this.output().swrite(refinedKeypoints, descriptorSize, extraSize, encoderLength);\n    this.output('displacements').swrite(offsets);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/detectors/fast.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * fast.js\n * FAST corner detector\n */\n\n\n\n\n\n\n\n\n\n\n\n\n// Constants\nconst DEFAULT_THRESHOLD = 20;\n\n/**\n * FAST corner detector\n */\nclass SpeedyPipelineNodeFASTKeypointDetector extends SpeedyPipelineNodeMultiscaleKeypointDetector {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 5, [InputPort().expects(SpeedyPipelineMessageType.Image).satisfying(( /** @type {SpeedyPipelineMessageWithImage} */msg) => msg.format === types/* ImageFormat */.f5.GREY), OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n\n    /** @type {number} FAST threshold in [0,255] */\n    this._threshold = DEFAULT_THRESHOLD;\n  }\n\n  /**\n   * FAST threshold in [0,255]\n   * @returns {number}\n   */\n  get threshold() {\n    return this._threshold;\n  }\n\n  /**\n   * FAST threshold in [0,255]\n   * @param {number} threshold\n   */\n  set threshold(threshold) {\n    this._threshold = Math.max(0, Math.min(threshold | 0, 255));\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const width = image.width,\n      height = image.height;\n    const tex = this._tex;\n    const capacity = this._capacity;\n    const threshold = this._threshold;\n    const lodStep = Math.log2(this.scaleFactor);\n    const levels = this.levels;\n\n    // validate pyramid\n    if (!(levels == 1 || image.hasMipmaps())) throw new utils_errors/* IllegalOperationError */.Er(`Expected a pyramid in ${this.fullName}`);\n\n    // skip if the capacity is zero\n    if (capacity == 0) {\n      const encodedKeypoints = this._encodeZeroKeypoints(gpu, tex[4]);\n      const encoderLength = encodedKeypoints.width;\n      this.output().swrite(encodedKeypoints, 0, 0, encoderLength);\n      return;\n    }\n\n    // FAST\n    gpu.programs.keypoints.fast9_16.outputs(width, height, tex[0], tex[1]);\n    gpu.programs.keypoints.nonmaxSpace.outputs(width, height, tex[2]);\n    let corners = tex[1].clear();\n    let numPasses = Math.max(1, Math.min(levels, globals.PYRAMID_MAX_LEVELS / lodStep | 0));\n    for (let lod = lodStep * (numPasses - 1); numPasses-- > 0; lod -= lodStep) {\n      corners = gpu.programs.keypoints.fast9_16(corners, image, lod, threshold);\n      //corners = gpu.programs.keypoints.nonmaxSpace(corners); // see below*\n    }\n\n    // Same-scale non-maximum suppression\n    // *nicer results inside the loop; faster outside\n    // Hard to notice a difference when using FAST\n    corners = gpu.programs.keypoints.nonmaxSpace(corners);\n\n    // Multi-scale non-maximum suppression\n    // (doesn't seem to remove many keypoints)\n    if (levels > 1) {\n      corners = gpu.programs.keypoints.nonmaxScaleSimple.outputs(width, height, tex[1])(corners, image, lodStep);\n    }\n\n    // encode keypoints\n    let encodedKeypoints = this._encodeKeypoints(gpu, corners, tex[3]);\n    const encoderLength = encodedKeypoints.width;\n\n    // scale refinement\n    if (levels > 1) {\n      encodedKeypoints = gpu.programs.keypoints.refineScaleFAST916.outputs(encoderLength, encoderLength, tex[4])(image, lodStep, encodedKeypoints, 0, 0, encoderLength, threshold);\n    }\n\n    // done!\n    this.output().swrite(encodedKeypoints, 0, 0, encoderLength);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/detectors/harris.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * harris.js\n * Harris corner detector\n */\n\n\n\n\n\n\n\n\n\n\n\n\n\n/** Window size helper */\nconst HARRIS = Object.freeze({\n  1: 'harris1',\n  3: 'harris3',\n  5: 'harris5',\n  7: 'harris7'\n});\n\n/**\n * Harris corner detector\n */\nclass SpeedyPipelineNodeHarrisKeypointDetector extends SpeedyPipelineNodeMultiscaleKeypointDetector {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 6, [InputPort().expects(SpeedyPipelineMessageType.Image).satisfying(( /** @type {SpeedyPipelineMessageWithImage} */msg) => msg.format === types/* ImageFormat */.f5.GREY), OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n\n    /** @type {SpeedySize} neighborhood size */\n    this._windowSize = new SpeedySize(3, 3);\n\n    /** @type {number} min corner quality in [0,1] */\n    this._quality = 0.1;\n  }\n\n  /**\n   * Minimum corner quality in [0,1] - this is a fraction of\n   * the largest min. eigenvalue of the autocorrelation matrix\n   * over the entire image\n   * @returns {number}\n   */\n  get quality() {\n    return this._quality;\n  }\n\n  /**\n   * Minimum corner quality in [0,1]\n   * @param {number} quality\n   */\n  set quality(quality) {\n    this._quality = Math.max(0.0, Math.min(+quality, 1.0));\n  }\n\n  /**\n   * Neighborhood size\n   * @returns {SpeedySize}\n   */\n  get windowSize() {\n    return this._windowSize;\n  }\n\n  /**\n   * Neighborhood size\n   * @param {SpeedySize} windowSize\n   */\n  set windowSize(windowSize) {\n    const d = windowSize.width;\n    if (!(d == windowSize.height && (d == 1 || d == 3 || d == 5 || d == 7))) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid window: ${windowSize}. Acceptable sizes: 1x1, 3x3, 5x5, 7x7`);\n    this._windowSize = windowSize;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      image,\n      format\n    } = /** @type {SpeedyPipelineMessageWithImage} */this.input().read();\n    const width = image.width,\n      height = image.height;\n    const capacity = this._capacity;\n    const quality = this._quality;\n    const windowSize = this._windowSize.width;\n    const levels = this.levels;\n    const lodStep = Math.log2(this.scaleFactor);\n    const intFactor = levels > 1 ? this.scaleFactor : 1;\n    const harris = gpu.programs.keypoints[HARRIS[windowSize]];\n    const tex = this._tex;\n\n    // validate pyramid\n    if (!(levels == 1 || image.hasMipmaps())) throw new utils_errors/* IllegalOperationError */.Er(`Expected a pyramid in ${this.fullName}`);\n\n    // skip if the capacity is zero\n    if (capacity == 0) {\n      const encodedKeypoints = this._encodeZeroKeypoints(gpu, tex[5]);\n      const encoderLength = encodedKeypoints.width;\n      this.output().swrite(encodedKeypoints, 0, 0, encoderLength);\n      return;\n    }\n\n    // compute corner response map\n    harris.outputs(width, height, tex[0], tex[1]);\n    gpu.programs.utils.sobelDerivatives.outputs(width, height, tex[2]);\n    gpu.programs.keypoints.nonmaxSpace.outputs(width, height, tex[3]);\n    let corners = tex[1].clear();\n    let numPasses = Math.max(1, Math.min(levels, globals.PYRAMID_MAX_LEVELS / lodStep | 0));\n    for (let lod = lodStep * (numPasses - 1); numPasses-- > 0; lod -= lodStep) {\n      const gaussian = utils/* Utils */.A.gaussianKernel(intFactor * (1 + lod), windowSize);\n      const derivatives = gpu.programs.utils.sobelDerivatives(image, lod);\n      corners = harris(corners, image, derivatives, lod, lodStep, gaussian);\n      corners = gpu.programs.keypoints.nonmaxSpace(corners); // see below*\n    }\n\n    // Same-scale non-maximum suppression\n    // *performs better inside the loop\n    //corners = gpu.programs.keypoints.nonmaxSpace(corners);\n\n    // Multi-scale non-maximum suppression\n    // (doesn't seem to remove many keypoints)\n    if (levels > 1) {\n      const laplacian = gpu.programs.keypoints.laplacian.outputs(width, height, tex[0])(corners, image, lodStep, 0);\n      corners = gpu.programs.keypoints.nonmaxScale.outputs(width, height, tex[2])(corners, image, laplacian, lodStep);\n    }\n\n    // find the maximum corner response over the entire image\n    gpu.programs.keypoints.harrisScoreFindMax.outputs(width, height, tex[0], tex[1]);\n    numPasses = Math.ceil(Math.log2(Math.max(width, height)));\n    let maxScore = corners;\n    for (let j = 0; j < numPasses; j++) maxScore = gpu.programs.keypoints.harrisScoreFindMax(maxScore, j);\n\n    // discard corners below a quality level\n    corners = gpu.programs.keypoints.harrisScoreCutoff.outputs(width, height, maxScore == tex[0] ? tex[1] : tex[0])(corners, maxScore, quality);\n\n    // encode keypoints\n    let encodedKeypoints = this._encodeKeypoints(gpu, corners, tex[4]);\n    const encoderLength = encodedKeypoints.width;\n\n    // scale refinement\n    if (levels > 1) {\n      encodedKeypoints = gpu.programs.keypoints.refineScaleLoG.outputs(encoderLength, encoderLength, tex[5])(image, lodStep, encodedKeypoints, 0, 0, encoderLength);\n    }\n\n    // done!\n    this.output().swrite(encodedKeypoints, 0, 0, encoderLength);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/descriptors/descriptor.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * descriptor.js\n * Abstract keypoint descriptor\n */\n\n\n\n\n\n\n\n\n/**\n * Abstract keypoint descriptor\n * @abstract\n */\nclass SpeedyPipelineNodeKeypointDescriptor extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   * @param {number} [texCount] number of work textures\n   * @param {SpeedyPipelinePortBuilder[]} [portBuilders] port builders\n   */\n  constructor(name = undefined, texCount = 0, portBuilders = undefined) {\n    super(name, texCount + 1, portBuilders);\n  }\n\n  /**\n   * \n   * Allocate space for keypoint descriptors\n   * @param {SpeedyGPU} gpu\n   * @param {number} inputDescriptorSize should be 0\n   * @param {number} inputExtraSize must be non-negative\n   * @param {number} outputDescriptorSize in bytes, must be a multiple of 4\n   * @param {number} outputExtraSize must be inputExtraSize\n   * @param {SpeedyTexture} inputEncodedKeypoints input with no descriptors\n   * @returns {SpeedyDrawableTexture} encodedKeypoints\n   */\n  _allocateDescriptors(gpu, inputDescriptorSize, inputExtraSize, outputDescriptorSize, outputExtraSize, inputEncodedKeypoints) {\n    utils/* Utils */.A.assert(inputDescriptorSize >= 0 && inputExtraSize >= 0);\n    utils/* Utils */.A.assert(outputDescriptorSize >= 0 && outputDescriptorSize % 4 === 0 && outputExtraSize === inputExtraSize);\n    const inputEncoderLength = inputEncodedKeypoints.width;\n    const inputEncoderCapacity = SpeedyPipelineNodeKeypointDetector.encoderCapacity(inputDescriptorSize, inputExtraSize, inputEncoderLength);\n    const outputEncoderCapacity = inputEncoderCapacity;\n    const outputEncoderLength = SpeedyPipelineNodeKeypointDetector.encoderLength(outputEncoderCapacity, outputDescriptorSize, outputExtraSize);\n    const tex = this._tex[this._tex.length - 1];\n    return gpu.programs.keypoints.allocateDescriptors.outputs(outputEncoderLength, outputEncoderLength, tex)(inputEncodedKeypoints, inputDescriptorSize, inputExtraSize, inputEncoderLength, outputDescriptorSize, outputExtraSize, outputEncoderLength);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/descriptors/orb.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * orb.js\n * ORB descriptors\n */\n\n\n\n\n\n\n\n\n\n\n\n\n// Constants\nconst DESCRIPTOR_SIZE = 32; // 256 bits\n\n/**\n * ORB descriptors\n */\nclass SpeedyPipelineNodeORBKeypointDescriptor extends SpeedyPipelineNodeKeypointDescriptor {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 3, [InputPort('image').expects(SpeedyPipelineMessageType.Image).satisfying(( /** @type {SpeedyPipelineMessageWithImage} */msg) => msg.format === types/* ImageFormat */.f5.GREY), InputPort('keypoints').expects(SpeedyPipelineMessageType.Keypoints), OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input('keypoints').read();\n    const image = ( /** @type {SpeedyPipelineMessageWithImage} */this.input('image').read()).image;\n    const tex = this._tex;\n    const outputTexture = this._tex[2];\n\n    // compute orientation\n    const capacity = SpeedyPipelineNodeKeypointDetector.encoderCapacity(descriptorSize, extraSize, encoderLength);\n    const orientationEncoderLength = Math.max(1, Math.ceil(Math.sqrt(capacity))); // 1 pixel per keypoint\n    const encodedOrientations = gpu.programs.keypoints.orbOrientation.outputs(orientationEncoderLength, orientationEncoderLength, tex[0])(image, encodedKeypoints, descriptorSize, extraSize, encoderLength);\n    const orientedKeypoints = gpu.programs.keypoints.transferOrientation.outputs(encoderLength, encoderLength, tex[1])(encodedOrientations, encodedKeypoints, descriptorSize, extraSize, encoderLength);\n\n    // allocate space\n    const encodedKps = this._allocateDescriptors(gpu, descriptorSize, extraSize, DESCRIPTOR_SIZE, extraSize, orientedKeypoints);\n    const newEncoderLength = encodedKps.width;\n\n    // compute descriptors (it's a good idea to blur the image)\n    const describedKeypoints = gpu.programs.keypoints.orbDescriptor.outputs(newEncoderLength, newEncoderLength, outputTexture)(image, encodedKps, extraSize, newEncoderLength);\n\n    // done!\n    this.output().swrite(describedKeypoints, DESCRIPTOR_SIZE, extraSize, newEncoderLength);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/trackers/lk.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * lk.js\n * LK optical-flow\n */\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// Constants\nconst DEFAULT_WINDOW_SIZE = new SpeedySize(11, 11); // nice on mobile?\nconst DEFAULT_DEPTH = Math.min(3, globals.PYRAMID_MAX_LEVELS);\nconst DEFAULT_NUMBER_OF_ITERATIONS = 30;\nconst DEFAULT_DISCARD_THRESHOLD = 0.0001;\nconst DEFAULT_EPSILON = 0.01;\nconst LK_PROGRAM = {\n  3: 'lk3',\n  5: 'lk5',\n  7: 'lk7',\n  9: 'lk9',\n  11: 'lk11',\n  13: 'lk13',\n  15: 'lk15',\n  17: 'lk17',\n  19: 'lk19',\n  21: 'lk21'\n};\n\n/**\n * LK optical-flow\n */\nclass SpeedyPipelineNodeLKKeypointTracker extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 3, [InputPort('previousImage').expects(SpeedyPipelineMessageType.Image).satisfying(( /** @type {SpeedyPipelineMessageWithImage} */msg) => msg.format === types/* ImageFormat */.f5.GREY), InputPort('nextImage').expects(SpeedyPipelineMessageType.Image).satisfying(( /** @type {SpeedyPipelineMessageWithImage} */msg) => msg.format === types/* ImageFormat */.f5.GREY), InputPort('previousKeypoints').expects(SpeedyPipelineMessageType.Keypoints), OutputPort().expects(SpeedyPipelineMessageType.Keypoints), OutputPort('flow').expects(SpeedyPipelineMessageType.Vector2)]);\n\n    /** @type {SpeedySize} window size */\n    this._windowSize = DEFAULT_WINDOW_SIZE;\n\n    /** @type {number} number of pyramid levels to use */\n    this._levels = DEFAULT_DEPTH;\n\n    /** @type {number} minimum acceptable corner response */\n    this._discardThreshold = DEFAULT_DISCARD_THRESHOLD;\n\n    /** @type {number} number of iterations per pyramid level (termination criteria) */\n    this._numberOfIterations = DEFAULT_NUMBER_OF_ITERATIONS;\n\n    /** @type {number} minimum increment per iteration (termination criteria) */\n    this._epsilon = DEFAULT_EPSILON;\n  }\n\n  /**\n   * Window size (use odd numbers)\n   * @returns {SpeedySize}\n   */\n  get windowSize() {\n    return this._windowSize;\n  }\n\n  /**\n   * Window size (use odd numbers)\n   * @param {SpeedySize} windowSize must be a square window\n   */\n  set windowSize(windowSize) {\n    if (windowSize.width != windowSize.height) {\n      throw new utils_errors/* NotSupportedError */.EM(`LK: window ${this._windowSize.toString()} is not square!`);\n    } else if (!Object.prototype.hasOwnProperty.call(LK_PROGRAM, windowSize.width)) {\n      const SUPPORTED_WINDOWS = Object.keys(LK_PROGRAM).sort((a, b) => a - b).map(k => k + 'x' + k).join(', ');\n      throw new utils_errors/* NotSupportedError */.EM(`LK: window of size ${this._windowSize.toString()} is not supported! Supported sizes: ${SUPPORTED_WINDOWS}`);\n    }\n    this._windowSize = windowSize;\n  }\n\n  /**\n   * Number of pyramid levels to use\n   * @returns {number}\n   */\n  get levels() {\n    return this._levels;\n  }\n\n  /**\n   * Number of pyramid levels to use\n   * @param {number} levels\n   */\n  set levels(levels) {\n    utils/* Utils */.A.assert(levels >= 1 && levels <= globals.PYRAMID_MAX_LEVELS);\n    this._levels = levels | 0;\n  }\n\n  /**\n   * Get the discard threshold, used to discard \"bad\" keypoints\n   * @returns {number}\n   */\n  get discardThreshold() {\n    return this._discardThreshold;\n  }\n\n  /**\n   * Set the discard threshold, used to discard \"bad\" keypoints\n   * @param {number} value typically 10^(-4) - increase to discard more\n   */\n  set discardThreshold(value) {\n    utils/* Utils */.A.assert(value >= 0);\n    this._discardThreshold = +value;\n  }\n\n  /**\n   * Get the maximum number of iterations of the pyramidal LK algorithm\n   * @returns {number}\n   */\n  get numberOfIterations() {\n    return this._numberOfIterations;\n  }\n\n  /**\n   * Set the maximum number of iterations of the pyramidal LK algorithm\n   * @param {number} value\n   */\n  set numberOfIterations(value) {\n    utils/* Utils */.A.assert(value >= 1);\n    this._numberOfIterations = value | 0;\n  }\n\n  /**\n   * Get the accuracy threshold, used to stop LK iterations\n   * @returns {number}\n   */\n  get epsilon() {\n    return this._epsilon;\n  }\n\n  /**\n   * Get the accuracy threshold, used to stop LK iterations\n   * @param {number} value typically 0.01\n   */\n  set epsilon(value) {\n    utils/* Utils */.A.assert(value >= 0);\n    this._epsilon = +value;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input('previousKeypoints').read();\n    const previousImage = ( /** @type {SpeedyPipelineMessageWithImage} */this.input('previousImage').read()).image;\n    const nextImage = ( /** @type {SpeedyPipelineMessageWithImage} */this.input('nextImage').read()).image;\n    const previousKeypoints = encodedKeypoints;\n    const levels = this._levels;\n    const windowSize = this._windowSize;\n    const wsize = windowSize.width; // square window\n    const numberOfIterations = this._numberOfIterations;\n    const discardThreshold = this._discardThreshold;\n    const epsilon = this._epsilon;\n    const keypoints = gpu.programs.keypoints;\n    const tex = this._tex;\n\n    // do we need a pyramid?\n    if (!(levels == 1 || previousImage.hasMipmaps() && nextImage.hasMipmaps())) throw new utils_errors/* IllegalOperationError */.Er(`LK: a pyramid is required if levels > 1`);else if (previousImage.width !== nextImage.width || previousImage.height !== nextImage.height) throw new utils_errors/* IllegalOperationError */.Er(`LK: can't use input images of different size`);\n\n    // select the appropriate program\n    const lk = keypoints[LK_PROGRAM[wsize]];\n\n    // find the dimensions of the flow texture (1 pixel per flow vector)\n    const numKeypoints = SpeedyPipelineNodeKeypointDetector.encoderCapacity(descriptorSize, extraSize, encoderLength);\n    const lkEncoderLength = Math.max(1, Math.ceil(Math.sqrt(numKeypoints)));\n    lk.outputs(lkEncoderLength, lkEncoderLength, tex[0], tex[1]);\n\n    // compute optical-flow\n    let flow = lk.clear();\n    for (let lod = levels - 1; lod >= 0; lod--) flow = lk(flow, previousKeypoints, nextImage, previousImage, lod, levels, numberOfIterations, discardThreshold, epsilon, descriptorSize, extraSize, encoderLength);\n\n    // transfer optical-flow to nextKeypoints\n    keypoints.transferFlow.outputs(encoderLength, encoderLength, tex[2]);\n    const nextKeypoints = keypoints.transferFlow(flow, previousKeypoints, descriptorSize, extraSize, encoderLength);\n\n    // done!\n    this.output().swrite(nextKeypoints, descriptorSize, extraSize, encoderLength);\n    this.output('flow').swrite(flow);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/matchers/lsh-static-tables.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * lsh-static-tables.js\n * Static LSH tables\n */\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Static LSH tables\n */\nclass SpeedyPipelineNodeStaticLSHTables extends SpeedyPipelineSourceNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 2, [OutputPort().expects(SpeedyPipelineMessageType.LSHTables)]);\n\n    /** @type {SpeedyKeypoint[]} \"training\" keypoints */\n    this._keypoints = [];\n\n    /** @type {SpeedyKeypoint[]} internal copy of the \"training\" keypoints */\n    this._keypointsCopy = [];\n\n    /** @type {number} number of tables in the LSH data structure */\n    this._numberOfTables = LSH_DEFAULT_NUMBER_OF_TABLES;\n\n    /** @type {number} number of bits of a hash */\n    this._hashSize = LSH_DEFAULT_HASH_SIZE;\n\n    /** @type {SpeedyLSH|null} LSH data structure */\n    this._lsh = null;\n  }\n\n  /**\n   * \"Training\" keypoints\n   * @returns {SpeedyKeypoint[]}\n   */\n  get keypoints() {\n    return this._keypoints;\n  }\n\n  /**\n   * \"Training\" keypoints\n   * @param {SpeedyKeypoint[]} keypoints\n   */\n  set keypoints(keypoints) {\n    if (!Array.isArray(keypoints) || keypoints.find(keypoint => !(keypoint instanceof SpeedyKeypoint))) throw new utils_errors/* IllegalArgumentError */.qw(`Static LSH tables: an invalid set of keypoints has been provided`);\n    if (this._keypoints !== keypoints) {\n      this._keypoints = keypoints; // update internal pointer\n      this._keypointsCopy = keypoints.slice(0); // clone the array, so it won't be modified externally\n      this._lsh = null; // (re)train the model\n    }\n  }\n\n  /**\n   * Number of tables in the LSH data structure\n   * @returns {number}\n   */\n  get numberOfTables() {\n    return this._numberOfTables;\n  }\n\n  /**\n   * Number of tables in the LSH data structure\n   * @param {number} n\n   */\n  set numberOfTables(n) {\n    if (!LSH_ACCEPTABLE_NUMBER_OF_TABLES.includes(n)) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid number of tables: ${n}. Acceptable values: ${LSH_ACCEPTABLE_NUMBER_OF_TABLES.join(', ')}`);\n    if (n !== this._numberOfTables) {\n      this._numberOfTables = n | 0;\n      this._lsh = null; // need to retrain the model\n    }\n  }\n\n  /**\n   * Number of bits of a hash\n   * @returns {number}\n   */\n  get hashSize() {\n    return this._hashSize;\n  }\n\n  /**\n   * Number of bits of a hash\n   * @param {number} h\n   */\n  set hashSize(h) {\n    if (!LSH_ACCEPTABLE_HASH_SIZES.includes(h)) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid hash size: ${h}. Acceptable values: ${LSH_ACCEPTABLE_HASH_SIZES.join(', ')}`);\n    if (h !== this._hashSize) {\n      this._hashSize = h | 0;\n      this._lsh = null; // need to retrain the model\n    }\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    // Need to train the model?\n    if (this._lsh == null) {\n      // internal work textures are only available after initialization,\n      // i.e., after calling this._init()\n      this._lsh = this._train();\n    }\n\n    // Pass it forward\n    this.output().swrite(this._lsh);\n  }\n\n  /**\n   * Train the model\n   * @returns {SpeedyLSH}\n   */\n  _train() {\n    const keypoints = this._keypointsCopy;\n    const numberOfTables = this._numberOfTables;\n    const hashSize = this._hashSize;\n    if (keypoints.find(keypoint => keypoint.descriptor == null)) throw new utils_errors/* IllegalOperationError */.Er(`Static LSH tables: can't train the model with no keypoint descriptors!`);\n    const descriptors = keypoints.map(keypoint => keypoint.descriptor.data);\n    const lshTables = this._tex[0];\n    const descriptorDB = this._tex[1];\n    return new SpeedyLSH(lshTables, descriptorDB, descriptors, numberOfTables, hashSize);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/matchers/lsh-knn.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * lsh-knn.js\n * K approximate nearest neighbors matcher\n */\n\n\n\n\n\n\n\n\n\n\n\n\n/** @typedef {'fastest' | 'default' | 'demanding'} LSHKNNQualityLevel quality of the approximate matching */\n\n/** @type {number} how many neighbors to search for, by default */\nconst DEFAULT_K = 1;\n\n/** @type {LSHKNNQualityLevel} default quality level */\nconst DEFAULT_QUALITY = 'default';\n\n/** @type {{ [key in LSHKNNQualityLevel]: number }} maps quality level to bit swaps */\nconst NUMBER_OF_BIT_SWAPS = {\n  'fastest': 0,\n  'default': 1,\n  'demanding': 2\n};\n\n/** @type {object} program names indexed as LSH_KNN[descriptorSize][hashSize][level] */\nconst LSH_KNN = (fd => LSH_ACCEPTABLE_DESCRIPTOR_SIZES.reduce((o, d) => (o[d] = fd(d), o), {}))(d => (fh => LSH_ACCEPTABLE_HASH_SIZES.reduce((o, h) => (o[h] = fh(h), o), {}))(h => (fl => [0, 1, 2].reduce((o, l) => (o[l] = fl(l), o), {}))(l => `lshKnn${d}h${h}lv${l}`)));\n\n/**\n * K approximate nearest neighbors matcher\n */\nclass SpeedyPipelineNodeLSHKNNKeypointMatcher extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 6, [InputPort('keypoints').expects(SpeedyPipelineMessageType.Keypoints).satisfying(( /** @type {SpeedyPipelineMessageWithKeypoints} */msg) => msg.descriptorSize > 0), InputPort('lsh').expects(SpeedyPipelineMessageType.LSHTables), OutputPort().expects(SpeedyPipelineMessageType.KeypointMatches)]);\n\n    /** @type {number} how many neighbors do you want? */\n    this._k = DEFAULT_K;\n\n    /** @type {LSHKNNQualityLevel} quality of the matching */\n    this._quality = DEFAULT_QUALITY;\n  }\n\n  /**\n   * How many neighbors do you want?\n   * @returns {number}\n   */\n  get k() {\n    return this._k;\n  }\n\n  /**\n   * How many neighbors do you want?\n   * @param {number} k number of neighbors\n   */\n  set k(k) {\n    this._k = Math.max(1, k | 0);\n  }\n\n  /**\n   * Quality of the matching\n   * @returns {LSHKNNQualityLevel}\n   */\n  get quality() {\n    return this._quality;\n  }\n\n  /**\n   * Quality of the matching\n   * @param {LSHKNNQualityLevel} quality\n   */\n  set quality(quality) {\n    if (!Object.prototype.hasOwnProperty.call(NUMBER_OF_BIT_SWAPS, quality)) throw new utils_errors/* IllegalArgumentError */.qw(`Invalid quality level: \"${quality}\"`);\n    this._quality = quality;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input('keypoints').read();\n    /** @type {SpeedyLSH} */\n    const lsh = this.input('lsh').read().lsh;\n    const keypoints = gpu.programs.keypoints;\n    const tables = lsh.tables;\n    const descriptorDB = lsh.descriptorDB;\n    const tablesStride = tables.width;\n    const descriptorDBStride = descriptorDB.width;\n    const tableCount = lsh.tableCount;\n    const hashSize = lsh.hashSize;\n    const bucketCapacity = lsh.bucketCapacity;\n    const bucketsPerTable = lsh.bucketsPerTable;\n    const sequences = lsh.sequences;\n    const candidatesA = this._tex[0];\n    const candidatesB = this._tex[1];\n    const candidatesC = this._tex[2];\n    const filters = this._tex[3];\n    const transferA = this._tex[4];\n    const transferB = this._tex[5];\n    const level = NUMBER_OF_BIT_SWAPS[this._quality];\n    const matchesPerKeypoint = this._k;\n\n    // validate parameters\n    if (descriptorSize !== lsh.descriptorSize) throw new utils_errors/* IllegalArgumentError */.qw(`Can't match different types of descriptors in ${this.fullName}`);\n    utils/* Utils */.A.assert(LSH_KNN[descriptorSize] != undefined);\n    utils/* Utils */.A.assert(LSH_KNN[descriptorSize][hashSize] != undefined);\n    utils/* Utils */.A.assert(LSH_KNN[descriptorSize][hashSize][level] != undefined);\n\n    // configure the output texture\n    const capacity = SpeedyPipelineNodeKeypointDetector.encoderCapacity(descriptorSize, extraSize, encoderLength);\n    const matcherLength = Math.max(1, Math.ceil(Math.sqrt(capacity * matchesPerKeypoint)));\n    let encodedMatches = transferB;\n    keypoints.lshKnnTransfer.outputs(matcherLength, matcherLength, transferA, transferB);\n\n    // prepare the LSH matching\n    const kthMatcherLength = Math.max(1, Math.ceil(Math.sqrt(capacity)));\n    keypoints.lshKnnInitCandidates.outputs(kthMatcherLength, kthMatcherLength, candidatesA);\n    keypoints.lshKnnInitFilters.outputs(kthMatcherLength, kthMatcherLength, filters);\n    const lshKnn = keypoints[LSH_KNN[descriptorSize][hashSize][level]];\n    lshKnn.outputs(kthMatcherLength, kthMatcherLength, candidatesB, candidatesC);\n    lshKnn.setUBO('LSHSequences', sequences);\n\n    // match keypoints\n    encodedMatches.clear();\n    keypoints.lshKnnInitFilters();\n    for (let i = 0; i < matchesPerKeypoint; i++) {\n      // find the (i+1)-th best match\n      let candidates = keypoints.lshKnnInitCandidates();\n      for (let tableIndex = 0; tableIndex < tableCount; tableIndex++) {\n        candidates = lshKnn(candidates, filters, kthMatcherLength, tables, descriptorDB, tableIndex, bucketCapacity, bucketsPerTable, tablesStride, descriptorDBStride, encodedKeypoints, descriptorSize, extraSize, encoderLength);\n        gpu.gl.flush();\n      }\n      candidates.copyTo(filters);\n\n      // transfer matches to an encoded matches texture\n      encodedMatches = keypoints.lshKnnTransfer(encodedMatches, candidates, matchesPerKeypoint, i);\n    }\n\n    // done\n    this.output().swrite(encodedMatches, matchesPerKeypoint);\n\n    /*\n    // debug\n    let data = filters.inspect32(gpu), debug = [];\n    for(let i = 0; i < data.length; i++) {\n        const bits = MATCH_INDEX_BITS;\n        const mask = (1 << bits) - 1;\n        const u32 = data[i];\n        const index = u32 & mask, distance = u32 >>> bits;\n        //debug.push('|'+[ u32 ].toString());\n        debug.push('|'+[ index, distance ].toString());\n    }\n    console.log(debug.join(','));\n    */\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/matchers/bf-knn.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * bf-knn.js\n * Brute Force KNN Keypoint Matcher\n */\n\n\n\n\n\n\n\n\n\n\n\n/** @type {Object<number,string>} program name indexed by descriptor size */\nconst PROGRAM_NAME = {\n  32: 'bfMatcher32',\n  64: 'bfMatcher64'\n};\n\n/**\n * Brute Force KNN Keypoint Matcher. Make sure to use a Keypoint Clipper before\n * invoking this (use a database of 50 keypoints or so - your mileage may vary)\n */\nclass SpeedyPipelineNodeBruteForceKNNKeypointMatcher extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 6, [InputPort('keypoints').expects(SpeedyPipelineMessageType.Keypoints).satisfying(( /** @type {SpeedyPipelineMessageWithKeypoints} */msg) => msg.descriptorSize > 0), InputPort('database').expects(SpeedyPipelineMessageType.Keypoints).satisfying(( /** @type {SpeedyPipelineMessageWithKeypoints} */msg) => msg.descriptorSize > 0), OutputPort().expects(SpeedyPipelineMessageType.KeypointMatches)]);\n\n    /** @type {number} number of matches per keypoint (the \"k\" of knn) */\n    this._matchesPerKeypoint = 1;\n  }\n\n  /**\n   * Number of matches per keypoint\n   * @returns {number}\n   */\n  get k() {\n    return this._matchesPerKeypoint;\n  }\n\n  /**\n   * Number of matches per keypoint\n   * @param {number} value\n   */\n  set k(value) {\n    this._matchesPerKeypoint = Math.max(1, value | 0);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input('keypoints').read();\n    const database = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input('database').read();\n    const candidatesA = this._tex[0];\n    const candidatesB = this._tex[1];\n    const candidatesC = this._tex[2];\n    const encodedFiltersA = this._tex[3];\n    const encodedMatchesA = this._tex[4];\n    const encodedMatchesB = this._tex[5];\n    const matchesPerKeypoint = this._matchesPerKeypoint;\n    const keypoints = gpu.programs.keypoints;\n\n    // validate parameters\n    if (descriptorSize !== database.descriptorSize) throw new utils_errors/* IllegalArgumentError */.qw(`Incompatible descriptors in ${this.fullName}`);else if (!Object.prototype.hasOwnProperty.call(PROGRAM_NAME, descriptorSize)) throw new utils_errors/* NotSupportedError */.EM(`Unsupported descriptor size (${descriptorSize}) in ${this.fullName}`);\n\n    // prepare the brute force matching\n    const bfMatcher = keypoints[PROGRAM_NAME[descriptorSize]];\n    const capacity = SpeedyPipelineNodeKeypointDetector.encoderCapacity(descriptorSize, extraSize, encoderLength);\n    const dbCapacity = SpeedyPipelineNodeKeypointDetector.encoderCapacity(database.descriptorSize, database.extraSize, database.encoderLength);\n    const numberOfKeypointsPerPass = bfMatcher.definedConstant('NUMBER_OF_KEYPOINTS_PER_PASS');\n    const numberOfPasses = Math.ceil(dbCapacity / numberOfKeypointsPerPass);\n    const partialMatcherLength = Math.max(1, Math.ceil(Math.sqrt(capacity)));\n    const matcherLength = Math.max(1, Math.ceil(Math.sqrt(capacity * matchesPerKeypoint)));\n    keypoints.bfMatcherTransfer.outputs(matcherLength, matcherLength, encodedMatchesA, encodedMatchesB);\n    keypoints.bfMatcherInitCandidates.outputs(partialMatcherLength, partialMatcherLength, candidatesC);\n    keypoints.bfMatcherInitFilters.outputs(partialMatcherLength, partialMatcherLength, encodedFiltersA);\n    bfMatcher.outputs(partialMatcherLength, partialMatcherLength, candidatesA, candidatesB);\n\n    // match keypoints\n    let encodedMatches = encodedMatchesB.clear(); // will hold all best matches\n    let encodedFilters = keypoints.bfMatcherInitFilters();\n    for (let k = 0; k < matchesPerKeypoint; k++) {\n      let encodedPartialMatches = keypoints.bfMatcherInitCandidates(); // hold the (k+1)-th best matches\n\n      // find the (k+1)-th best match\n      for (let passId = 0; passId < numberOfPasses; passId++) {\n        encodedPartialMatches = bfMatcher(encodedPartialMatches, encodedFilters, partialMatcherLength, database.encodedKeypoints, database.descriptorSize, database.extraSize, database.encoderLength, encodedKeypoints, descriptorSize, extraSize, encoderLength, passId);\n        gpu.gl.flush();\n      }\n      //gpu.gl.flush();\n\n      // copy the (k+1)-th best match to the filter\n      if (matchesPerKeypoint > 1) encodedPartialMatches.copyTo(encodedFilters);\n\n      // aggregate matches\n      encodedMatches = keypoints.bfMatcherTransfer(encodedMatches, encodedPartialMatches, matchesPerKeypoint, k);\n    }\n\n    // done!\n    this.output().swrite(encodedMatches, matchesPerKeypoint);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/distance-filter.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * distance-filter.js\n * Given a set of pairs of keypoints, discard all pairs whose distance is\n * above a user-defined threshold. Useful for bidirectional optical-flow.\n */\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Given a set of pairs of keypoints, discard all pairs whose distance is\n * above a user-defined threshold. Useful for bidirectional optical-flow.\n * \n * The pairs of keypoints are provided as two separate sets, \"in\" and\n * \"reference\". Keypoints that are kept will have their data extracted\n * from the \"in\" set.\n */\nclass SpeedyPipelineNodeKeypointDistanceFilter extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 1, [InputPort('in').expects(SpeedyPipelineMessageType.Keypoints), InputPort('reference').expects(SpeedyPipelineMessageType.Keypoints), OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n\n    /** @type {number} maximum accepted distance */\n    this._threshold = globals.MAX_TEXTURE_LENGTH + 1;\n  }\n\n  /**\n   * Maximum accepted distance\n   * @returns {number}\n   */\n  get threshold() {\n    return this._threshold;\n  }\n\n  /**\n   * Maximum accepted distance\n   * @param {number} value\n   */\n  set threshold(value) {\n    this._threshold = Math.max(0, +value);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const set0 = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input('in').read();\n    const set1 = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input('reference').read();\n    const threshold = this._threshold;\n\n    // validate shapes\n    if (set0.descriptorSize != set1.descriptorSize || set0.extraSize != set1.extraSize) throw new utils_errors/* IllegalOperationError */.Er(`The distance filter requires two compatible shapes of keypoint streams`);\n\n    // calculate the shape of the output\n    const outputTexture = this._tex[0];\n    const encoderLength = Math.max(set0.encoderLength, set1.encoderLength);\n    const descriptorSize = set0.descriptorSize;\n    const extraSize = set0.extraSize;\n\n    // apply the distance filter\n    gpu.programs.keypoints.distanceFilter.outputs(encoderLength, encoderLength, outputTexture)(set0.encodedKeypoints, set0.encoderLength, set1.encodedKeypoints, set1.encoderLength, descriptorSize, extraSize, encoderLength, threshold);\n\n    // done!\n    this.output().swrite(outputTexture, descriptorSize, extraSize, encoderLength);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/hamming-distance-filter.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * hamming-distance-filter.js\n * Given a set of pairs of keypoints, discard all pairs whose hamming\n * distance (of descriptor) is above a user-defined threshold\n */\n\n\n\n\n\n\n\n\n\n\n\n\n/** @type {Object<number,string>} Program names */\nconst hamming_distance_filter_PROGRAM_NAME = {\n  32: 'hammingDistanceFilter32',\n  64: 'hammingDistanceFilter64'\n};\n\n/**\n * Given a set of pairs of keypoints, discard all pairs whose hamming\n * distance (of descriptor) is above a user-defined threshold\n * \n * The pairs of keypoints are provided as two separate sets, \"in\" and\n * \"reference\". Keypoints that are kept will have their data extracted\n * from the \"in\" set.\n */\nclass SpeedyPipelineNodeKeypointHammingDistanceFilter extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 1, [InputPort('in').expects(SpeedyPipelineMessageType.Keypoints).satisfying(( /** @type {SpeedyPipelineMessageWithKeypoints} */msg) => msg.descriptorSize > 0), InputPort('reference').expects(SpeedyPipelineMessageType.Keypoints).satisfying(( /** @type {SpeedyPipelineMessageWithKeypoints} */msg) => msg.descriptorSize > 0), OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n\n    /** @type {number} distance threshold, an integer */\n    this._threshold = globals.MAX_DESCRIPTOR_SIZE * 8; // convert from bytes to bits\n  }\n\n  /**\n   * Distance threshold, an integer\n   * @returns {number}\n   */\n  get threshold() {\n    return this._threshold;\n  }\n\n  /**\n   * Distance threshold, an integer\n   * @param {number} value\n   */\n  set threshold(value) {\n    this._threshold = Math.max(0, value | 0);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const set0 = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input('in').read();\n    const set1 = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input('reference').read();\n    const threshold = this._threshold;\n\n    // validate shapes\n    if (set0.descriptorSize != set1.descriptorSize || set0.extraSize != set1.extraSize) throw new utils_errors/* IllegalOperationError */.Er(`The Hamming distance filter requires two compatible shapes of keypoint streams`);\n\n    // validate descriptor size\n    if (!Object.prototype.hasOwnProperty.call(hamming_distance_filter_PROGRAM_NAME, set0.descriptorSize)) throw new utils_errors/* NotSupportedError */.EM(`Hamming distance filter - invalid descriptor size: ${set0.descriptorSize}`);\n\n    // calculate the shape of the output\n    const outputTexture = this._tex[0];\n    const encoderLength = Math.max(set0.encoderLength, set1.encoderLength);\n    const descriptorSize = set0.descriptorSize;\n    const extraSize = set0.extraSize;\n\n    // apply the distance filter\n    const program = hamming_distance_filter_PROGRAM_NAME[set0.descriptorSize];\n    gpu.programs.keypoints[program].outputs(encoderLength, encoderLength, outputTexture)(set0.encodedKeypoints, set0.encoderLength, set1.encodedKeypoints, set1.encoderLength, descriptorSize, extraSize, encoderLength, threshold);\n\n    // done!\n    this.output().swrite(outputTexture, descriptorSize, extraSize, encoderLength);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/keypoints/portal.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * portal.js\n * Keypoint Portals\n */\n\n\n\n\n\n\n\n\n\n\n\n/**\n * A sink of a Keypoint Portal\n * This is not a pipeline sink - it doesn't export any data!\n */\nclass SpeedyPipelineNodeKeypointPortalSink extends SpeedyPipelineNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 1, [InputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n\n    /** @type {number} descriptor size, in bytes */\n    this._descriptorSize = 0;\n\n    /** @type {number} extra size, in bytes */\n    this._extraSize = 0;\n\n    /** @type {number} extra size */\n    this._encoderLength = 0;\n\n    /** @type {boolean} is this node initialized? */\n    this._initialized = false;\n  }\n\n  /**\n   * Encoded keypoints\n   * @returns {SpeedyTexture}\n   */\n  get encodedKeypoints() {\n    if (!this._initialized) throw new utils_errors/* IllegalOperationError */.Er(`Portal error: ${this.fullName} holds no data`);\n    return this._tex[0];\n  }\n\n  /**\n   * Descriptor size, in bytes\n   * @returns {number}\n   */\n  get descriptorSize() {\n    if (!this._initialized) throw new utils_errors/* IllegalOperationError */.Er(`Portal error: ${this.fullName} holds no data`);\n    return this._descriptorSize;\n  }\n\n  /**\n   * Extra size, in bytes\n   * @returns {number}\n   */\n  get extraSize() {\n    if (!this._initialized) throw new utils_errors/* IllegalOperationError */.Er(`Portal error: ${this.fullName} holds no data`);\n    return this._extraSize;\n  }\n\n  /**\n   * Encoder length\n   * @returns {number}\n   */\n  get encoderLength() {\n    if (!this._initialized) throw new utils_errors/* IllegalOperationError */.Er(`Portal error: ${this.fullName} holds no data`);\n    return this._encoderLength;\n  }\n\n  /**\n   * Initializes this node\n   * @param {SpeedyGPU} gpu\n   */\n  init(gpu) {\n    super.init(gpu);\n    const encoderLength = SpeedyPipelineNodeKeypointDetector.encoderLength(0, 0, 0);\n    this._tex[0].resize(encoderLength, encoderLength).clearToColor(1, 1, 1, 1); // initial texture\n    this._descriptorSize = this._extraSize = 0;\n    this._encoderLength = encoderLength;\n    this._initialized = true;\n  }\n\n  /**\n   * Releases this node\n   * @param {SpeedyGPU} gpu\n   */\n  release(gpu) {\n    this._initialized = false;\n    super.release(gpu);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      encodedKeypoints,\n      descriptorSize,\n      extraSize,\n      encoderLength\n    } = /** @type {SpeedyPipelineMessageWithKeypoints} */this.input().read();\n    const tex = this._tex[0];\n\n    // copy input\n    tex.resize(encodedKeypoints.width, encodedKeypoints.height);\n    encodedKeypoints.copyTo(tex);\n    this._descriptorSize = descriptorSize;\n    this._extraSize = extraSize;\n    this._encoderLength = encoderLength;\n  }\n}\n\n/**\n * A source of a Keypoint Portal\n */\nclass SpeedyPipelineNodeKeypointPortalSource extends SpeedyPipelineSourceNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = undefined) {\n    super(name, 0, [OutputPort().expects(SpeedyPipelineMessageType.Keypoints)]);\n\n    /** @type {SpeedyPipelineNodeKeypointPortalSink|null} portal sink */\n    this._source = null;\n  }\n\n  /**\n   * Data source\n   * @returns {SpeedyPipelineNodeKeypointPortalSink|null}\n   */\n  get source() {\n    return this._source;\n  }\n\n  /**\n   * Data source\n   * @param {SpeedyPipelineNodeKeypointPortalSink|null} node\n   */\n  set source(node) {\n    if (node !== null && !(node instanceof SpeedyPipelineNodeKeypointPortalSink)) throw new utils_errors/* IllegalArgumentError */.qw(`Incompatible source for ${this.fullName}`);\n    this._source = node;\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    if (this._source == null) throw new utils_errors/* IllegalOperationError */.Er(`${this.fullName} has no source`);\n    this.output().swrite(this._source.encodedKeypoints, this._source.descriptorSize, this._source.extraSize, this._source.encoderLength);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/factories/keypoint-factory.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * keypoint-factory.js\n * Keypoint-related nodes\n */\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Keypoint detectors\n */\nclass SpeedyPipelineKeypointDetectorFactory extends speedy_namespace/* SpeedyNamespace */.Q {\n  /**\n   * FAST corner detector\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeFASTKeypointDetector}\n   */\n  static FAST(name = undefined) {\n    return new SpeedyPipelineNodeFASTKeypointDetector(name);\n  }\n\n  /**\n   * Harris corner detector\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeHarrisKeypointDetector}\n   */\n  static Harris(name = undefined) {\n    return new SpeedyPipelineNodeHarrisKeypointDetector(name);\n  }\n}\n\n/**\n * Keypoint descriptors\n */\nclass SpeedyPipelineKeypointDescriptorFactory extends speedy_namespace/* SpeedyNamespace */.Q {\n  /**\n   * ORB descriptors\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeORBKeypointDescriptor}\n   */\n  static ORB(name = undefined) {\n    return new SpeedyPipelineNodeORBKeypointDescriptor(name);\n  }\n}\n\n/**\n * Keypoint trackers\n */\nclass SpeedyPipelineKeypointTrackerFactory extends speedy_namespace/* SpeedyNamespace */.Q {\n  /**\n   * LK optical-flow\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeLKKeypointTracker}\n   */\n  static LK(name = undefined) {\n    return new SpeedyPipelineNodeLKKeypointTracker(name);\n  }\n}\n\n/**\n * Keypoint matchers\n */\nclass SpeedyPipelineKeypointMatcherFactory extends speedy_namespace/* SpeedyNamespace */.Q {\n  /**\n   * Static LSH tables\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeStaticLSHTables}\n   */\n  static StaticLSHTables(name = undefined) {\n    return new SpeedyPipelineNodeStaticLSHTables(name);\n  }\n\n  /**\n   * LSH-based K-approximate nearest neighbors\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeLSHKNNKeypointMatcher}\n   */\n  static LSHKNN(name = undefined) {\n    return new SpeedyPipelineNodeLSHKNNKeypointMatcher(name);\n  }\n\n  /**\n   * Brute-force K-nearest neighbors keypoint matcher\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeBruteForceKNNKeypointMatcher}\n   */\n  static BFKNN(name = undefined) {\n    return new SpeedyPipelineNodeBruteForceKNNKeypointMatcher(name);\n  }\n}\n\n/**\n * Portal nodes\n */\nclass SpeedyPipelineKeypointPortalFactory extends speedy_namespace/* SpeedyNamespace */.Q {\n  /**\n   * Create an image portal source\n   * @param {string} [name] name of the node\n   * @returns {SpeedyPipelineNodeKeypointPortalSource}\n   */\n  static Source(name = undefined) {\n    return new SpeedyPipelineNodeKeypointPortalSource(name);\n  }\n\n  /**\n   * Create an image portal sink\n   * @param {string} [name] name of the node\n   * @returns {SpeedyPipelineNodeKeypointPortalSink}\n   */\n  static Sink(name = undefined) {\n    return new SpeedyPipelineNodeKeypointPortalSink(name);\n  }\n}\n\n/**\n * Keypoint-related nodes\n */\nclass SpeedyPipelineKeypointFactory extends speedy_namespace/* SpeedyNamespace */.Q {\n  /**\n   * Keypoint detectors\n   * @returns {typeof SpeedyPipelineKeypointDetectorFactory}\n   */\n  static get Detector() {\n    return SpeedyPipelineKeypointDetectorFactory;\n  }\n\n  /**\n   * Keypoint descriptors\n   * @returns {typeof SpeedyPipelineKeypointDescriptorFactory}\n   */\n  static get Descriptor() {\n    return SpeedyPipelineKeypointDescriptorFactory;\n  }\n\n  /**\n   * Keypoint trackers\n   * @returns {typeof SpeedyPipelineKeypointTrackerFactory}\n   */\n  static get Tracker() {\n    return SpeedyPipelineKeypointTrackerFactory;\n  }\n\n  /**\n   * Keypoint matchers\n   * @returns {typeof SpeedyPipelineKeypointMatcherFactory}\n   */\n  static get Matcher() {\n    return SpeedyPipelineKeypointMatcherFactory;\n  }\n\n  /**\n   * Keypoint Portals\n   * @returns {typeof SpeedyPipelineKeypointPortalFactory}\n   */\n  static get Portal() {\n    return SpeedyPipelineKeypointPortalFactory;\n  }\n\n  /**\n   * Create a keypoint source\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeKeypointSource}\n   */\n  static Source(name = undefined) {\n    return new SpeedyPipelineNodeKeypointSource(name);\n  }\n\n  /**\n   * Create a keypoint sink\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeKeypointSink}\n   */\n  static Sink(name = undefined) {\n    return new SpeedyPipelineNodeKeypointSink(name);\n  }\n\n  /**\n   * Create a sink of tracked keypoints\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeTrackedKeypointSink}\n   */\n  static SinkOfTrackedKeypoints(name = undefined) {\n    return new SpeedyPipelineNodeTrackedKeypointSink(name);\n  }\n\n  /**\n   * Create a sink of matched keypoints\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeMatchedKeypointSink}\n   */\n  static SinkOfMatchedKeypoints(name = undefined) {\n    return new SpeedyPipelineNodeMatchedKeypointSink(name);\n  }\n\n  /**\n   * Keypoint clipper\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeKeypointClipper}\n   */\n  static Clipper(name = undefined) {\n    return new SpeedyPipelineNodeKeypointClipper(name);\n  }\n\n  /**\n   * Border Clipper\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeKeypointBorderClipper}\n   */\n  static BorderClipper(name = undefined) {\n    return new SpeedyPipelineNodeKeypointBorderClipper(name);\n  }\n\n  /**\n   * Create a keypoint buffer\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeKeypointBuffer}\n   */\n  static Buffer(name = undefined) {\n    return new SpeedyPipelineNodeKeypointBuffer(name);\n  }\n\n  /**\n   * Create a keypoint mixer\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeKeypointMixer}\n   */\n  static Mixer(name = undefined) {\n    return new SpeedyPipelineNodeKeypointMixer(name);\n  }\n\n  /**\n   * Create a keypoint shuffler\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeKeypointShuffler}\n   */\n  static Shuffler(name = undefined) {\n    return new SpeedyPipelineNodeKeypointShuffler(name);\n  }\n\n  /**\n   * Create a keypoint multiplexer\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeKeypointMultiplexer}\n   */\n  static Multiplexer(name = undefined) {\n    return new SpeedyPipelineNodeKeypointMultiplexer(name);\n  }\n\n  /**\n   * Create a keypoint transformer\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeKeypointTransformer}\n   */\n  static Transformer(name = undefined) {\n    return new SpeedyPipelineNodeKeypointTransformer(name);\n  }\n\n  /**\n   * Create a subpixel refiner of keypoint locations\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeKeypointSubpixelRefiner}\n   */\n  static SubpixelRefiner(name = undefined) {\n    return new SpeedyPipelineNodeKeypointSubpixelRefiner(name);\n  }\n\n  /**\n   * Distance filter\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeDistanceFilter}\n   */\n  static DistanceFilter(name = undefined) {\n    return new SpeedyPipelineNodeKeypointDistanceFilter(name);\n  }\n\n  /**\n   * Hamming distance filter\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeHammingDistanceFilter}\n   */\n  static HammingDistanceFilter(name = undefined) {\n    return new SpeedyPipelineNodeKeypointHammingDistanceFilter(name);\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/nodes/vector2/sink.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * sink.js\n * Gets keypoints out of the pipeline\n */\n\n\n\n\n\n\n\n\n\n\n\n// next power of 2\nconst vector2_sink_nextPot = x => x > 1 ? 1 << Math.ceil(Math.log2(x)) : 1;\n\n/**\n * Gets 2D vectors out of the pipeline\n */\nclass SpeedyPipelineNodeVector2Sink extends SpeedyPipelineSinkNode {\n  /**\n   * Constructor\n   * @param {string} [name] name of the node\n   */\n  constructor(name = 'vec2') {\n    super(name, 2, [InputPort().expects(SpeedyPipelineMessageType.Vector2)]);\n\n    /** @type {SpeedyVector2[]} 2D vectors (output) */\n    this._vectors = [];\n\n    /** @type {SpeedyTextureReader} texture reader */\n    this._textureReader = new SpeedyTextureReader();\n\n    /** @type {number} page flipping index */\n    this._page = 0;\n\n    /** @type {boolean} accelerate GPU-CPU transfers */\n    this._turbo = false;\n  }\n\n  /**\n   * Accelerate GPU-CPU transfers\n   * @returns {boolean}\n   */\n  get turbo() {\n    return this._turbo;\n  }\n\n  /**\n   * Accelerate GPU-CPU transfers\n   * @param {boolean} value\n   */\n  set turbo(value) {\n    this._turbo = Boolean(value);\n  }\n\n  /**\n   * Initializes this node\n   * @param {SpeedyGPU} gpu\n   */\n  init(gpu) {\n    super.init(gpu);\n    this._textureReader.init(gpu);\n  }\n\n  /**\n   * Releases this node\n   * @param {SpeedyGPU} gpu\n   */\n  release(gpu) {\n    this._textureReader.release(gpu);\n    super.release(gpu);\n  }\n\n  /**\n   * Export data from this node to the user\n   * @returns {SpeedyPromise<SpeedyVector2[]>}\n   */\n  export() {\n    return speedy_promise/* SpeedyPromise */.i.resolve(this._vectors);\n  }\n\n  /**\n   * Run the specific task of this node\n   * @param {SpeedyGPU} gpu\n   * @returns {void|SpeedyPromise<void>}\n   */\n  _run(gpu) {\n    const {\n      vectors\n    } = /** @type {SpeedyPipelineMessageWith2DVectors} */this.input().read();\n    const useBufferedDownloads = this._turbo;\n    const encoderLength = vectors.width;\n\n    /*\n     I have found experimentally that, in Firefox, readPixelsAsync()\n    performs MUCH better if the width of the target texture is a power\n    of two. I have no idea why this is the case, nor if it's related to\n    some interaction with the GL drivers, somehow. This seems to make no\n    difference on Chrome, however. In any case, let's convert the input\n    texture to POT.\n     */\n    const encoderWidth = vector2_sink_nextPot(encoderLength);\n    const encoderHeight = vector2_sink_nextPot(Math.ceil(encoderLength * encoderLength / encoderWidth));\n    //const encoderHeight = (Math.ceil(encoderLength * encoderLength / encoderWidth));\n\n    // copy the set of vectors to an internal texture\n    const copiedTexture = this._tex[this._page];\n    gpu.programs.utils.copy2DVectors.outputs(encoderWidth, encoderHeight, copiedTexture)(vectors);\n\n    // flip page\n    this._page = 1 - this._page;\n\n    // download the internal texture\n    return this._textureReader.readPixelsAsync(copiedTexture, 0, 0, copiedTexture.width, copiedTexture.height, useBufferedDownloads).then(pixels => {\n      this._vectors = SpeedyPipelineNodeVector2Sink._decode(pixels, encoderWidth, encoderHeight);\n    });\n  }\n\n  /**\n   * Decode a sequence of vectors, given a flattened image of encoded pixels\n   * @param {Uint8Array} pixels pixels in the [r,g,b,a,...] format\n   * @param {number} encoderWidth\n   * @param {number} encoderHeight\n   * @returns {SpeedyVector2[]} vectors\n   */\n  static _decode(pixels, encoderWidth, encoderHeight) {\n    const bytesPerVector = 4; // 1 pixel per vector\n    const vectors = [];\n    let hi = 0,\n      lo = 0;\n    let x = 0,\n      y = 0;\n\n    // how many bytes should we read?\n    const e2 = encoderWidth * encoderHeight * bytesPerVector;\n    const size = Math.min(pixels.length, e2);\n\n    // for each encoded vector\n    for (let i = 0; i < size; i += bytesPerVector) {\n      // extract 16-bit words\n      lo = pixels[i + 1] << 8 | pixels[i];\n      hi = pixels[i + 3] << 8 | pixels[i + 2];\n\n      // the vector is \"null\": we have reached the end of the list\n      if (lo == 0xFFFF && hi == 0xFFFF) break;\n\n      // the vector must be discarded\n      if (lo == 0xFF00 && hi == 0xFF00) continue;\n\n      // decode floats\n      x = utils/* Utils */.A.decodeFloat16(lo);\n      y = utils/* Utils */.A.decodeFloat16(hi);\n\n      // register vector\n      vectors.push(new SpeedyVector2(x, y));\n    }\n\n    // done!\n    return vectors;\n  }\n}\n;// CONCATENATED MODULE: ./src/core/pipeline/factories/vector2-factory.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * vector2-factory.js\n * 2D vectors\n */\n\n\n\n\n/**\n * 2D vectors\n */\nclass SpeedyPipelineVector2Factory extends Function {\n  /**\n   * Constructor\n   */\n  constructor() {\n    // This factory can be invoked as a function\n    super('...args', 'return this._create(...args)');\n    return this.bind(this);\n  }\n\n  /**\n   * @private\n   *\n   * Create a 2D vector\n   * @param {number} x x-coordinate\n   * @param {number} y y-coordinate\n   * @returns {SpeedyVector2}\n   */\n  _create(x, y) {\n    return new SpeedyVector2(x, y);\n  }\n\n  /**\n   * Create a Vector2 sink\n   * @param {string} [name]\n   * @returns {SpeedyPipelineNodeVector2Sink}\n   */\n  Sink(name = undefined) {\n    return new SpeedyPipelineNodeVector2Sink(name);\n  }\n}\n;// CONCATENATED MODULE: ./src/utils/fps-counter.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * fps-counter.js\n * A FPS counter\n */\n\n\n\n/** @const {number} update interval in milliseconds */\nconst UPDATE_INTERVAL = 500;\n\n/** @type {FPSCounter|null} Singleton */\nlet instance = null;\n\n/**\n * FPS counter\n */\nclass FPSCounter {\n  /**\n   * Creates a new FPSCounter\n   * @private\n   */\n  constructor() {\n    /** @type {number} current FPS rate */\n    this._fps = 60;\n\n    /** @type {number} frame counter */\n    this._frames = 0;\n\n    /** @type {number} update interval in milliseconds */\n    this._updateInterval = UPDATE_INTERVAL;\n\n    /** @type {number} time of the last update */\n    this._lastUpdate = performance.now();\n\n    /** @type {function(): void} bound update function */\n    this._boundUpdate = this._update.bind(this);\n\n    // this should never happen...\n    if (instance !== null) throw new utils_errors/* IllegalOperationError */.Er(`Can't have multiple instances of FPSCounter`);\n\n    // start FPS counter\n    this._boundUpdate();\n  }\n\n  /**\n   * Gets an instance of the FPS counter.\n   * We use lazy loading, i.e., we will not\n   * create a FPS counter unless we need to!\n   * @returns {FPSCounter}\n   */\n  static get instance() {\n    if (instance === null) instance = new FPSCounter();\n    return instance;\n  }\n\n  /**\n   * Get the FPS rate\n   * @returns {number} frames per second\n   */\n  get fps() {\n    return this._fps;\n  }\n\n  /**\n   * Updates the FPS counter\n   */\n  _update() {\n    const now = performance.now();\n    const deltaTime = now - this._lastUpdate;\n    if (deltaTime >= this._updateInterval) {\n      this._fps = Math.round(this._frames / (deltaTime * 0.001));\n      this._frames = 0;\n      this._lastUpdate = now;\n    }\n    this._frames++;\n    requestAnimationFrame(this._boundUpdate);\n  }\n}\n;// CONCATENATED MODULE: ./src/main.js\n/*\n * speedy-vision.js\n * GPU-accelerated Computer Vision for JavaScript\n * Copyright 2020-2024 Alexandre Martins <alemartf(at)gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * main.js\n * The entry point of the library\n */\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* eslint-disable no-undef */\n/** @typedef {import('./core/speedy-matrix').SpeedyMatrix} SpeedyMatrix */\n/** @typedef {import('./core/speedy-matrix-expr').SpeedyMatrixExpr} SpeedyMatrixExpr */\n/** @typedef {import('./core/speedy-media').SpeedyMediaOptions} SpeedyMediaOptions */\n/** @typedef {import('./core/speedy-media-source').SpeedyMediaSourceNativeElement} SpeedyMediaSourceNativeElement */\n\n// Constants\n\n/** @type {SpeedyMatrixFactory} */\nconst matrixFactory = new SpeedyMatrixFactory();\n\n/** @type {SpeedyPipelineVector2Factory} */\nconst vector2Factory = new SpeedyPipelineVector2Factory();\n\n/**\n * GPU-accelerated Computer Vision for JavaScript\n */\nclass Speedy {\n  /**\n   * The version of the library\n   * @returns {string}\n   */\n  static get version() {\n    if (false) {}else return \"0.9.1\";\n  }\n\n  /**\n   * Checks if Speedy can be executed in this machine & browser\n   * @returns {boolean}\n   */\n  static isSupported() {\n    return typeof WebAssembly !== 'undefined' && typeof WebGL2RenderingContext !== 'undefined' && speedy_gl/* SpeedyGL */.c.instance.gl != null;\n  }\n\n  /**\n   * Global settings\n   * @returns {typeof Settings}\n   */\n  static get Settings() {\n    return settings/* Settings */.w;\n  }\n\n  /**\n   * Create a 2D vector\n   * @returns {SpeedyPipelineVector2Factory & ((x: number, y: number) => SpeedyVector2)}\n   */\n  static get Vector2() {\n    return vector2Factory;\n  }\n\n  /**\n   * Create a 2D point\n   * @param {number} x\n   * @param {number} y\n   * @returns {SpeedyPoint2}\n   */\n  static Point2(x, y) {\n    return new SpeedyPoint2(x, y);\n  }\n\n  /**\n   * Create a new size object\n   * @param {number} width\n   * @param {number} height\n   * @returns {SpeedySize}\n   */\n  static Size(width, height) {\n    return new SpeedySize(width, height);\n  }\n\n  /**\n   * Create a Matrix (entries are given in column-major format)\n   * @returns {SpeedyMatrixFactory & ((rows: number, columns: number, entries: number[]) => SpeedyMatrix) & ((expr: SpeedyMatrixExpr) => SpeedyMatrix)}\n   */\n  static get Matrix() {\n    return matrixFactory;\n  }\n\n  /**\n   * Speedy Promises\n   * @returns {typeof SpeedyPromise}\n   */\n  static get Promise() {\n    return speedy_promise/* SpeedyPromise */.i;\n  }\n\n  /**\n   * Create a new Pipeline\n   * @returns {SpeedyPipeline}\n   */\n  static Pipeline() {\n    return new SpeedyPipeline();\n  }\n\n  /**\n   * Image-related nodes\n   * @returns {typeof SpeedyPipelineImageFactory}\n   */\n  static get Image() {\n    return SpeedyPipelineImageFactory;\n  }\n\n  /**\n   * Image filters\n   * @returns {typeof SpeedyPipelineFilterFactory}\n   */\n  static get Filter() {\n    return SpeedyPipelineFilterFactory;\n  }\n\n  /**\n   * Image transforms\n   * @returns {typeof SpeedyPipelineTransformFactory}\n   */\n  static get Transform() {\n    return SpeedyPipelineTransformFactory;\n  }\n\n  /**\n   * Keypoint-related nodes\n   * @returns {typeof SpeedyPipelineKeypointFactory}\n   */\n  static get Keypoint() {\n    return SpeedyPipelineKeypointFactory;\n  }\n\n  /**\n   * Loads a SpeedyMedia object based on the provided source element\n   * @param {SpeedyMediaSourceNativeElement} sourceElement The source media\n   * @param {SpeedyMediaOptions} [options] Additional options for advanced configuration\n   * @returns {SpeedyPromise<SpeedyMedia>}\n   */\n  static load(sourceElement, options = {}) {\n    return SpeedyMedia.load(sourceElement, options);\n  }\n\n  /**\n   * Loads a camera stream\n   * @param {number | MediaStreamConstraints} [widthOrConstraints] width of the stream or contraints object\n   * @param {number} [height] height of the stream\n   * @returns {SpeedyPromise<SpeedyMedia>}\n   */\n  static camera(widthOrConstraints = 640, height = 360) {\n    const constraints = typeof widthOrConstraints === 'object' ? widthOrConstraints : {\n      audio: false,\n      video: {\n        width: widthOrConstraints | 0,\n        height: height | 0\n      }\n    };\n    return utils/* Utils */.A.requestCameraStream(constraints).then(video => SpeedyMedia.load(video));\n  }\n\n  /**\n   * Utilities to query information about the graphics driver\n   * @returns {typeof SpeedyPlatform}\n   */\n  static get Platform() {\n    return SpeedyPlatform;\n  }\n\n  /**\n   * The FPS rate\n   * @returns {number} Frames per second (FPS)\n   */\n  static get fps() {\n    return FPSCounter.instance.fps;\n  }\n}\n\n// Freeze the namespace\nObject.freeze(Speedy);\n\n// Display a notice\nutils/* Utils */.A.log(`Speedy Vision version ${Speedy.version}. ` + `GPU-accelerated Computer Vision for JavaScript by Alexandre Martins. ` + \"https://github.com/alemart/speedy-vision\");\n\n// Big-endian machine? Currently untested.\nif (!globals.LITTLE_ENDIAN) utils/* Utils */.A.warning('Running on a big-endian machine');\n})();\n\n__webpack_exports__ = __webpack_exports__[\"default\"];\n/******/ \treturn __webpack_exports__;\n/******/ })()\n;\n});", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * errors.ts\n * Error classes\n */\n\n/**\n * Base error class\n */\nexport abstract class ARError extends Error\n{\n    /**\n     * Constructor\n     * @param message error message\n     * @param cause cause of the error\n     */\n    constructor(message = '', public readonly cause: Error | null = null)\n    {\n        super(message);\n    }\n\n    /**\n     * Error name\n     */\n    public abstract get name(): string;\n    /*{\n        // incorrect when minified\n        //return this.constructor.name;\n    }*/\n\n    /**\n     * Convert to string\n     */\n    public toString(): string\n    {\n        const extendedMessage = this.cause ? '\\n-> ' + this.cause.toString() : '';\n\n        if(this.message != '')\n            return this.name + ': ' + this.message + extendedMessage;\n        else\n            return this.name + extendedMessage;\n    }\n}\n\n/**\n * A method has received one or more illegal arguments\n */\nexport class IllegalArgumentError extends ARError\n{\n    public get name(): string\n    {\n        return 'IllegalArgumentError';\n    }\n}\n\n/**\n * The method arguments are valid, but the method can't be called due to the\n * current state of the object\n */\nexport class IllegalOperationError extends ARError\n{\n    public get name(): string\n    {\n        return 'IllegalOperationError';\n    }\n}\n\n/**\n * The requested operation is not supported\n */\nexport class NotSupportedError extends ARError\n{\n    public get name(): string\n    {\n        return 'NotSupportedError';\n    }\n}\n\n/**\n * Access denied\n */\nexport class AccessDeniedError extends ARError\n{\n    public get name(): string\n    {\n        return 'AccessDeniedError';\n    }\n}\n\n/**\n * Timeout\n */\nexport class TimeoutError extends ARError\n{\n    public get name(): string\n    {\n        return 'TimeoutError';\n    }\n}\n\n/**\n * Assertion error\n */\nexport class AssertionError extends ARError\n{\n    public get name(): string\n    {\n        return 'AssertionError';\n    }\n}\n\n/**\n * Numerical error\n */\nexport class NumericalError extends ARError\n{\n    public get name(): string\n    {\n        return 'NumericalError';\n    }\n}\n\n/**\n * Tracking error\n */\nexport class TrackingError extends ARError\n{\n    public get name(): string\n    {\n        return 'TrackingError';\n    }\n}\n\n/**\n * Detection error\n */\nexport class DetectionError extends ARError\n{\n    public get name(): string\n    {\n        return 'DetectionError';\n    }\n}\n\n/**\n * Training error\n */\nexport class TrainingError extends ARError\n{\n    public get name(): string\n    {\n        return 'TrainingError';\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * resolution.ts\n * Resolution utilities\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { IllegalArgumentError } from './errors';\n\ntype Digit = '0' | '1' | '2' | '3' | '4' | '5' | '6' | '7' | '8' | '9';\ntype EvenDigit = '0' | '2' | '4' | '6' | '8';\ntype PositiveDigit = '1' | '2' | '3' | '4' | '5' | '6' | '7' | '8' | '9';\ntype OptionalDigit = Digit | '';\ntype CustomResolution = `${PositiveDigit}${OptionalDigit}${Digit}${EvenDigit}p`;\ntype ResolutionAlias = 'xs' | 'xs+' | 'sm' | 'sm+' | 'md' | 'md+' | 'lg' | 'lg+' | 'xl' | 'xl+' | 'xxl';\n\n/** Resolution type */\nexport type Resolution = ResolutionAlias | CustomResolution;\n\n/** A regex that identifies custom resolutions */\nconst CUSTOM_RESOLUTION_REGEX = /^[1-9][0-9]?[0-9][02468]p$/;\n\n/** Reference heights when in landscape mode, measured in pixels, for all aliases */\nconst ALIAS_TO_HEIGHT: { readonly [R in ResolutionAlias]: number } = {\n    'xs' : 120,\n    'xs+': 144,\n    'sm' : 240,\n    'sm+': 288,\n    'md' : 320,\n    'md+': 360,\n    'lg' : 480,\n    'lg+': 600,\n    'xl' : 720,\n    'xl+': 900,\n    'xxl': 1080,\n};\n\n/**\n * Convert a resolution type to a (width, height) pair\n * @param resolution resolution type\n * @param aspectRatio desired width / height ratio\n * @returns size in pixels\n */\nexport function computeResolution(resolution: Resolution, aspectRatio: number): SpeedySize\n{\n    const referenceHeight = parseHeight(resolution);\n    let width = 0, height = 0;\n\n    if(Number.isNaN(referenceHeight))\n        throw new IllegalArgumentError('Invalid resolution: ' + resolution);\n    else if(aspectRatio <= 0)\n        throw new IllegalArgumentError('Invalid aspect ratio: ' + aspectRatio);\n\n    if(aspectRatio >= 1) {\n        // landscape\n        height = referenceHeight;\n        width = Math.floor(height * aspectRatio);\n        width += width % 2;\n    }\n    else {\n        // portrait\n        width = referenceHeight;\n        height = Math.floor(width / aspectRatio);\n        height += height % 2;\n    }\n\n    return Speedy.Size(width, height);\n}\n\n/**\n * Get the height in pixels of a resolution\n * @param resolution resolution type\n * @returns the height in pixels, or NaN on error\n */\nfunction parseHeight(resolution: Resolution): number\n{\n    if(ALIAS_TO_HEIGHT.hasOwnProperty(resolution))\n        return ALIAS_TO_HEIGHT[resolution as ResolutionAlias];\n\n    //if(CUSTOM_RESOLUTION_REGEX.test(resolution)) // really needed? is it fast?\n    if(resolution.endsWith('p')) {\n        const r = resolution[0];\n        if(r >= '1' && r <= '9')\n            return parseInt(resolution);\n    }\n\n    return Number.NaN;\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * utils.ts\n * Generic utilities\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { AssertionError, IllegalArgumentError } from './errors';\nimport { Resolution, computeResolution } from './resolution';\n\n/**\n * Nullable type\n */\nexport type Nullable<T> = T | null;\n\n/**\n * Generic utilities\n */\nexport class Utils\n{\n    /**\n     * Log a message\n     * @param message\n     * @param args optional additional messages\n     */\n    static log(message: string, ...args: any[]): void\n    {\n        console.log('[encantar-js]', message, ...args);\n    }\n\n    /**\n     * Display a warning\n     * @param message\n     * @param args optional additional messages\n     */\n    static warning(message: string, ...args: any[]): void\n    {\n        console.warn('[encantar-js]', message, ...args);\n    }\n\n    /**\n     * Display an error message\n     * @param message\n     * @param args optional additional messages\n     */\n    static error(message: string, ...args: any[]): void\n    {\n        console.error('[encantar-js]', message, ...args);\n    }\n\n    /**\n     * Assertion\n     * @param expr expression\n     * @param errorMessage optional error message\n     * @throws {AssertionError}\n     */\n    static assert(expr: boolean, errorMessage: string = ''): void\n    {\n        if(!expr)\n            throw new AssertionError(errorMessage);\n    }\n\n    /**\n     * Generate the range [0, 1, ..., n-1]\n     * @param n non-negative integer\n     * @returns range from 0 to n-1, inclusive, as a new array\n     */\n    static range(n: number): number[]\n    {\n        if((n |= 0) < 0)\n            throw new IllegalArgumentError();\n\n        return Array.from({ length: n }, (_, i) => i);\n    }\n\n    /**\n     * Shuffle an array\n     * @param arr array to be shuffled in-place\n     * @returns shuffled arr\n     */\n    static shuffle<T>(arr: T[]): T[]\n    {\n        // Fisher-Yattes shuffle\n        for(let i = arr.length - 1; i >= 1; i--) {\n            const j = Math.floor(Math.random() * (i + 1)); // 0 <= j <= i\n            const tmp = arr[i];\n            arr[i] = arr[j];\n            arr[j] = tmp;\n        }\n\n        return arr;\n    }\n\n    /**\n     * Wait a few milliseconds\n     * @param milliseconds how long should we wait?\n     * @returns a promise that is resolved soon after the specified time\n     */\n    static wait(milliseconds: number): SpeedyPromise<void>\n    {\n        return new Speedy.Promise<void>(resolve => {\n            setTimeout(resolve, milliseconds);\n        });\n    }\n\n    /**\n     * Run SpeedyPromises sequentially\n     * @param promises an array of SpeedyPromises\n     * @returns a promise that is resolved as soon as all input promises are\n     * resolved, or that is rejected as soon as an input promise is rejected\n     */\n    static runInSequence<T>(promises: SpeedyPromise<T>[]): SpeedyPromise<T>\n    {\n        return promises.reduce(\n            (prev, curr) => prev.then(() => curr),\n            Speedy.Promise.resolve()\n        );\n    }\n\n    /**\n     * Convert a resolution type to a resolution measured in pixels\n     * @param resolution resolution type\n     * @param aspectRatio width / height ratio\n     * @returns resolution measured in pixels\n     */\n    static resolution(resolution: Resolution, aspectRatio: number): SpeedySize\n    {\n        return computeResolution(resolution, aspectRatio);\n    }\n\n    /**\n     * Checks if we're on iOS\n     * @returns true if we're on iOS\n     */\n    static isIOS(): boolean\n    {\n        // at the time of this writing, navigator.userAgentData is not yet\n        // compatible with Safari. navigator.platform is deprecated, but\n        // predictable.\n\n        if(/(iOS|iPhone|iPad|iPod)/i.test(navigator.platform))\n            return true;\n\n        if(/Mac/i.test(navigator.platform) && navigator.maxTouchPoints !== undefined) // iPad OS 13+\n            return navigator.maxTouchPoints > 2;\n\n        return false;\n    }\n\n    /**\n     * Checks if we're on a WebKit-based browser\n     * @returns true if we're on a WebKit-based browser\n     */\n    static isWebKit(): boolean\n    {\n        // note: navigator.vendor is deprecated\n        if(/Apple/.test(navigator.vendor))\n            return true;\n\n        // Can a non WebKit-based browser pass this test?\n        // Test masked GL_RENDERER == \"Apple GPU\" (valid since Feb 2020)\n        // https://bugs.webkit.org/show_bug.cgi?id=207608\n        /*\n        if(Speedy.Platform.renderer == 'Apple GPU' && Speedy.Platform.vendor == 'Apple Inc.')\n            return true;\n        */\n\n        // Desktop and Mobile Safari, Epiphany on Linux\n        if(/AppleWebKit\\/.* Version\\//.test(navigator.userAgent))\n            return true;\n\n        // Chrome, Firefox, Edge on iOS\n        if(/(CriOS\\/|FxiOS\\/|EdgiOS\\/)/.test(navigator.userAgent))\n            return true;\n\n        // not WebKit\n        return false;\n    }\n\n    /**\n     * Device-specific information for debugging purposes\n     */\n    static deviceInfo(): string\n    {\n        return 'Device info: ' + JSON.stringify({\n            isIOS: Utils.isIOS(),\n            isWebKit: Utils.isWebKit(),\n            renderer: Speedy.Platform.renderer,\n            vendor: Speedy.Platform.vendor,\n            screen: [screen.width, screen.height].join('x'),\n            platform: [navigator.platform, navigator.vendor].join('; '),\n            userAgent: navigator.userAgent,\n            userAgentData: (navigator as any).userAgentData || null,\n        }, null, 2);\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * ar-events.ts\n * AR-related Events\n */\n\n/**\n * AR Event Type\n * @internal\n */\ntype AREventType = string;\n\n/**\n * AR Event\n */\nexport class AREvent<T extends AREventType> extends Event\n{\n    /**\n     * Constructor\n     * @param type event type\n     */\n    constructor(type: T)\n    {\n        super(type);\n    }\n\n    /**\n     * Event type\n     */\n    get type(): T\n    {\n        return super.type as T;\n    }\n}\n\n/**\n * Extract the AREventType from an AREvent\n * @internal\n */\ntype AREventTypeOf<T> = T extends AREvent<infer U> ? U : never;\n\n/**\n * AR Event Listener (a callback)\n * @internal\n */\ninterface AREventListener<T>\n{\n    (evt: T extends AREvent<infer U> ? T : never): void;\n}\n\n/**\n * AR Event Target\n */\nexport class AREventTarget<T>\n{\n    /** event target delegate */\n    private readonly _delegate: EventTarget;\n\n\n\n    /**\n     * Constructor\n     */\n    constructor()\n    {\n        this._delegate = new EventTarget();\n    }\n\n    /**\n     * Add event listener\n     * @param type event type\n     * @param callback\n     */\n    addEventListener(type: AREventTypeOf<T>, callback: AREventListener<T>): void\n    {\n        this._delegate.addEventListener(type, callback as EventListener);\n    }\n\n    /**\n     * Remove event listener\n     * @param type event type\n     * @param callback\n     */\n    removeEventListener(type: AREventTypeOf<T>, callback: AREventListener<T>): void\n    {\n        this._delegate.removeEventListener(type, callback as EventListener);\n    }\n\n    /**\n     * Synchronously trigger an event\n     * @param event\n     * @returns same value as a standard event target\n     * @internal\n     */\n    dispatchEvent(event: T extends AREvent<infer U> ? T : never): boolean\n    {\n        return this._delegate.dispatchEvent(event);\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * stats.ts\n * Stats for performance measurements\n */\n\n/** update interval, given in seconds */\nconst UPDATE_INTERVAL = 0.5;\n\n/**\n * Stats for performance measurements\n */\nexport class Stats\n{\n    private _timeOfLastUpdate: number;\n    private _partialCycleCount: number;\n    private _cyclesPerSecond: number;\n\n    /**\n     * Constructor\n     */\n    constructor()\n    {\n        this._timeOfLastUpdate = this._now();\n        this._partialCycleCount = 0;\n        this._cyclesPerSecond = 0;\n    }\n\n    /**\n     * Update stats - call every frame\n     */\n    update(): void\n    {\n        const now = this._now();\n\n        ++this._partialCycleCount;\n        if(now >= this._timeOfLastUpdate + 1000 * UPDATE_INTERVAL) {\n            this._cyclesPerSecond = this._partialCycleCount / UPDATE_INTERVAL;\n            this._partialCycleCount = 0;\n            this._timeOfLastUpdate = now;\n        }\n    }\n\n    /**\n     * Reset stats\n     */\n    reset(): void\n    {\n        this._timeOfLastUpdate = this._now();\n        this._partialCycleCount = 0;\n        this._cyclesPerSecond = 0;\n    }\n\n    /**\n     * Number of cycles per second\n     */\n    get cyclesPerSecond(): number\n    {\n        return this._cyclesPerSecond;\n    }\n\n    /**\n     * A measurement of time, in milliseconds\n     * @returns time in ms\n     */\n    private _now(): number\n    {\n        return performance.now();\n    }\n}\n\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * settings.ts\n * Settings of the Image Tracker\n */\n\n/** Maximum number of keypoints to be stored for each reference image when in the training state */\nexport const TRAIN_MAX_KEYPOINTS = 1024; //512;\n\n/** Percentage relative to the screen size adjusted to the aspect ratio of the reference image */\nexport const TRAIN_IMAGE_SCALE = 0.8; // ORB is not scale invariant\n\n/** Width and height of the Normalized Image Space (NIS) */\nexport const NIS_SIZE = 1024; // keypoint positions are stored as fixed point\n\n/** Used to identify the best maches */\nexport const SCAN_MATCH_RATIO = 0.7; // usually a value in [0.6, 0.8]\n\n/** Maximum number of keypoints to be analyzed when in the scanning state */\nexport const SCAN_MAX_KEYPOINTS = 512;\n\n/** Number of pyramid levels to be scanned by the corner detector when in the scanning & training states */\nexport const SCAN_PYRAMID_LEVELS = 4; //7;\n\n/** Scale factor between pyramid levels to be scanned by the corner detector when in the scanning & training states */\nexport const SCAN_PYRAMID_SCALEFACTOR = 1.19; // 2 ^ 0.25\n\n/** Threshold of the FAST corner detector used in the scanning/training states */\nexport const SCAN_FAST_THRESHOLD = 60;\n\n/** Minimum number of accepted matches for us to move out of the scanning state */\nexport const SCAN_MIN_MATCHES = 20; //30;\n\n/** When in the scanning state, we require the image to be matched during a few consecutive frames before accepting it */\nexport const SCAN_CONSECUTIVE_FRAMES = 30;//15;//45;\n\n/** Reprojection error, in NIS pixels, used when estimating a motion model (scanning state) */\nexport const SCAN_RANSAC_REPROJECTIONERROR_NIS = (NIS_SIZE * 0.0125) | 0;\n\n/** Reprojection error, in NDC, used when estimating a motion model (scanning state) */\nexport const SCAN_RANSAC_REPROJECTIONERROR_NDC = SCAN_RANSAC_REPROJECTIONERROR_NIS / (NIS_SIZE / 2);\n\n/** Number of tables used in the LSH-based keypoint matching */\nexport const SCAN_LSH_TABLES = 8; // up to 32\n\n/** Hash size, in bits, used in the LSH-based keypoint matching */\nexport const SCAN_LSH_HASHSIZE = 15; // up to 16\n\n/** Use the Nightvision filter when in the scanning/training state? */\nexport const SCAN_WITH_NIGHTVISION = true;\n\n/** Nightvision filter: gain */\nexport const NIGHTVISION_GAIN = 0.3; // 0.2;\n\n/** Nightvision filter: offset */\nexport const NIGHTVISION_OFFSET = 0.5;\n\n/** Nightvision filter: decay */\nexport const NIGHTVISION_DECAY = 0.0;\n\n/** Nightvision filter: quality level */\nexport const NIGHTVISION_QUALITY = 'low';\n\n/** Kernel size (square) of the Gaussian filter applied before computing the ORB descriptors */\nexport const ORB_GAUSSIAN_KSIZE = 9;\n\n/** Sigma of the Gaussian filter applied before computing the ORB descriptors */\nexport const ORB_GAUSSIAN_SIGMA = 2.0;\n\n/** Kernel size (square) of the Gaussian filter applied before subpixel refinement for noise reduction */\nexport const SUBPIXEL_GAUSSIAN_KSIZE = 5;\n\n/** Sigma of the Gaussian filter applied before subpixel refinement for noise reduction */\nexport const SUBPIXEL_GAUSSIAN_SIGMA = 1.0;\n\n/** Subpixel refinement method */\nexport const SUBPIXEL_METHOD = 'bilinear-upsample'; // 'quadratic1d';\n\n/** Minimum acceptable number of matched keypoints when in a pre-tracking state */\nexport const PRE_TRACK_MIN_MATCHES = 4;\n\n/** Used to identify the best maches */\nexport const PRE_TRACK_MATCH_RATIO = 0.6; // usually a value in [0.6, 0.8] - low values => strict tracking\n\n/** Reprojection error, in NIS pixels, used when pre-tracking */\nexport const PRE_TRACK_RANSAC_REPROJECTIONERROR_NIS = (NIS_SIZE * 0.0125 * 0.5) | 0;\n\n/** Reprojection error, in NDC, used when pre-tracking */\nexport const PRE_TRACK_RANSAC_REPROJECTIONERROR_NDC = PRE_TRACK_RANSAC_REPROJECTIONERROR_NIS / (NIS_SIZE / 2);\n\n/** Interpolation filter: interpolation factor */\nexport const PRE_TRACK_FILTER_ALPHA = 0.8;\n\n/** Interpolation filter: correction strength for noisy corners */\nexport const PRE_TRACK_FILTER_BETA = 1;\n\n/** Maximum number of iterations in Pre-tracking B */\nexport const PRE_TRACK_MAX_ITERATIONS = 8; //6; // the less the interpolation factor, the more iterations are needed\n\n/** Minimum acceptable number of matched keypoints when in the tracking state */\nexport const TRACK_MIN_MATCHES = 4;//10; //20;\n\n/** Maximum number of keypoints to be analyzed in the tracking state */\nexport const TRACK_MAX_KEYPOINTS = 200; //400; // <-- impacts performance!\n\n/** Capacity of the keypoint detector used in the the tracking state */\nexport const TRACK_DETECTOR_CAPACITY = 2048; //4096;\n\n/** Quality of the Harris/Shi-Tomasi corner detector */\nexport const TRACK_HARRIS_QUALITY = 0.005; // get a lot of keypoints\n\n/** Use the Nightvision filter when in the tracking state? */\nexport const TRACK_WITH_NIGHTVISION = false; // produces shaking?\n\n/** Relative size (%) of the (top, right, bottom, left) borders of the rectified image */\nexport const TRACK_RECTIFIED_BORDER = 0.15; //0.20;\n\n/** Relative size (%) used to clip keypoints from the borders of the rectified image */\nexport const TRACK_CLIPPING_BORDER = TRACK_RECTIFIED_BORDER * 1.20; //1.25; //1.15;\n\n/** Scale of the rectified image in NDC, without taking the aspect ratio into consideration */\nexport const TRACK_RECTIFIED_SCALE = 1 - 2 * TRACK_RECTIFIED_BORDER;\n\n/** Reprojection error, in NIS pixels, used when estimating a motion model (tracking state) */\nexport const TRACK_RANSAC_REPROJECTIONERROR_NIS = (NIS_SIZE * 0.0125) | 0;\n\n/** Reprojection error, in NDC, used when estimating a motion model (tracking state) */\nexport const TRACK_RANSAC_REPROJECTIONERROR_NDC = TRACK_RANSAC_REPROJECTIONERROR_NIS / (NIS_SIZE / 2);\n\n/** We use a N x N grid to spatially distribute the keypoints in order to compute a better homography */\nexport const TRACK_GRID_GRANULARITY = 15; //20; //10; // the value of N\n\n/** Used to identify the best maches */\nexport const TRACK_MATCH_RATIO = 0.7; // usually a value in [0.6, 0.8] - low values => strict tracking\n\n/** Number of consecutive frames in which we tolerate a  \"target lost\" situation */\nexport const TRACK_LOST_TOLERANCE = 20; //15;\n\n/** Interpolation filter: interpolation factor */\nexport const TRACK_FILTER_ALPHA = 0.3; //0.4;\n\n/** Interpolation filter: correction strength for noisy corners */\nexport const TRACK_FILTER_BETA = 1;\n\n/** Extrapolation filter: extrapolation factor */\nexport const TRACK_EXTRAPOLATION_ALPHA = 6; // 12+ = follows faster, but looks unstable (jitter)\n\n/** Extrapolation filter: correction strength for noisy corners */\nexport const TRACK_EXTRAPOLATION_BETA = 1.33;", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * gizmos.ts\n * Visual cues for testing & debugging\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyPoint2 } from 'speedy-vision/types/core/speedy-point';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { SpeedyKeypoint, SpeedyMatchedKeypoint } from 'speedy-vision/types/core/speedy-keypoint';\nimport { Viewport } from '../core/viewport';\nimport { CameraModel } from '../geometry/camera-model';\nimport { Tracker, TrackerOutput } from '../trackers/tracker';\nimport { ImageTrackerOutput } from '../trackers/image-tracker/image-tracker';\nimport { NIS_SIZE } from '../trackers/image-tracker/settings';\n\n\n\n/**\n * Visual cues for testing & debugging\n */\nexport class Gizmos\n{\n    /** Should we render the gizmos? */\n    private _visible: boolean;\n\n    /** Gizmos renderer of Image Trackers */\n    private _imageTrackerGizmos: ImageTrackerGizmos;\n\n\n\n    /**\n     * Constructor\n     */\n    constructor()\n    {\n        this._visible = false;\n        this._imageTrackerGizmos = new ImageTrackerGizmos();\n    }\n\n    /**\n     * Whether or not the gizmos will be rendered\n     */\n    get visible(): boolean\n    {\n        return this._visible;\n    }\n\n    /**\n     * Whether or not the gizmos will be rendered\n     */\n    set visible(visible: boolean)\n    {\n        this._visible = visible;\n    }\n\n    /**\n     * Render gizmos\n     * @param viewport\n     * @param trackers\n     * @internal\n     */\n    _render(viewport: Viewport, trackers: Tracker[]): void\n    {\n        // no need to render?\n        if(!this._visible)\n            return;\n\n        // render the gizmos of each tracker\n        for(let i = 0; i < trackers.length; i++) {\n            const tracker = trackers[i];\n            if(tracker.is('image-tracker')) {\n                const output = tracker._output;\n                this._imageTrackerGizmos.render(viewport, output);\n            }\n        }\n    }\n}\n\n\n\n/**\n * Gizmos renderer\n */\ninterface GizmosRenderer\n{\n    render(viewport: Viewport, output: TrackerOutput): void;\n}\n\n\n\n/**\n * Gizmos renderer of Image Trackers\n */\nclass ImageTrackerGizmos implements GizmosRenderer\n{\n    /**\n     * Render gizmos\n     * @param viewport viewport\n     * @param output tracker output\n     */\n    render(viewport: Viewport, output: ImageTrackerOutput): void\n    {\n        const canvas = viewport._backgroundCanvas;\n        const ctx = canvas.getContext('2d', { alpha: false });\n\n        if(!ctx)\n            return;\n\n        const viewportSize = viewport._realSize;\n        const keypointsNIS = output.keypointsNIS;\n        const polylineNDC = output.polylineNDC;\n        const camera = output.camera;\n\n        // debug\n        //ctx.fillStyle = '#000';\n        //ctx.fillRect(0, 0, canvas.width, canvas.height);\n        //ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n        // render keypoints\n        if(keypointsNIS !== undefined)\n            this._splitAndRenderKeypointsNIS(ctx, keypointsNIS, viewportSize);\n\n        // render polylines\n        if(polylineNDC !== undefined)\n            this._renderPolylineNDC(ctx, polylineNDC, viewportSize);\n\n        // render the axes of the 3D coordinate system\n        if(camera !== undefined)\n            this._renderAxes(ctx, camera, viewportSize);\n    }\n\n    /**\n     * Split keypoints in matched/unmatched categories and\n     * render them for testing & development purposes\n     * @param ctx canvas 2D context\n     * @param keypoints keypoints in Normalized Image Space (NIS)\n     * @param viewportSize viewport size\n     * @param size base keypoint rendering size\n     */\n    private _splitAndRenderKeypointsNIS(ctx: CanvasRenderingContext2D, keypoints: SpeedyKeypoint[], viewportSize: SpeedySize, size = 1): void\n    {\n        if(keypoints.length == 0)\n            return;\n\n        if(!Object.prototype.hasOwnProperty.call(keypoints[0], '_matches')) { // hack...\n            this._renderKeypointsNIS(ctx, keypoints, viewportSize, '#f00', size);\n            return;\n        }\n\n        const goodMatches = [], badMatches = [];\n        for(let i = 0; i < keypoints.length; i++) {\n            const keypoint = keypoints[i] as SpeedyMatchedKeypoint;\n\n            if(this._isGoodMatch(keypoint))\n                goodMatches.push(keypoint);\n            else\n                badMatches.push(keypoint);\n        }\n\n        this._renderKeypointsNIS(ctx, badMatches, viewportSize, '#f00', size);\n        this._renderKeypointsNIS(ctx, goodMatches, viewportSize, '#0f0', size);\n    }\n\n    /**\n     * Check if a matched keypoint is \"good enough\"\n     * @param keypoint matched keypoint\n     * @returns a boolean\n     */\n    private _isGoodMatch(keypoint: SpeedyMatchedKeypoint): boolean\n    {\n        const GOOD_MATCH_THRESHOLD = 0.7; // the maximum match distance ratio we'll consider to be \"good\"\n        const n = keypoint.matches.length;\n\n        if(n > 1) {\n            return (\n                keypoint.matches[0].index >= 0 &&\n                keypoint.matches[1].index >= 0 &&\n                keypoint.matches[0].distance <= GOOD_MATCH_THRESHOLD * keypoint.matches[1].distance\n            );\n        }\n        else if(n == 1)\n            return keypoint.matches[0].index >= 0;\n\n        return false;\n    }\n\n    /**\n     * Render keypoints for testing & development purposes\n     * @param ctx canvas 2D context\n     * @param keypoints keypoints in Normalized Image Space (NIS)\n     * @param viewportSize viewport size\n     * @param color color of the rendered keypoints\n     * @param size base keypoint rendering size\n     */\n    private _renderKeypointsNIS(ctx: CanvasRenderingContext2D, keypoints: SpeedyKeypoint[], viewportSize: SpeedySize, color = 'red', size = 1): void\n    {\n        const sx = viewportSize.width / NIS_SIZE;\n        const sy = viewportSize.height / NIS_SIZE;\n\n        ctx.beginPath();\n\n        for(let i = keypoints.length - 1; i >= 0; i--) {\n            const keypoint = keypoints[i];\n            const x = (keypoint.x * sx + 0.5) | 0;\n            const y = (keypoint.y * sy + 0.5) | 0;\n            const r = (size * keypoint.scale + 0.5) | 0;\n\n            ctx.rect(x-r, y-r, 2*r, 2*r);\n        }\n\n        ctx.strokeStyle = color;\n        ctx.lineWidth = 1;\n        ctx.stroke();\n    }\n\n    /**\n     * Render a polyline for testing & development purposes\n     * @param ctx canvas 2D context\n     * @param polyline vertices in NDC\n     * @param viewportSize viewport size\n     * @param color color of the rendered polyline\n     * @param lineWidth\n     */\n    private _renderPolylineNDC(ctx: CanvasRenderingContext2D, polyline: SpeedyPoint2[], viewportSize: SpeedySize, color = '#0f0', lineWidth = 2): void\n    {\n        const n = polyline.length;\n        const w = viewportSize.width;\n        const h = viewportSize.height;\n\n        if(n == 0)\n            return;\n\n        ctx.beginPath();\n        ctx.moveTo((polyline[n-1].x * 0.5 + 0.5) * w, (polyline[n-1].y * -0.5 + 0.5) * h);\n        for(let j = 0; j < n; j++)\n            ctx.lineTo((polyline[j].x * 0.5 + 0.5) * w, (polyline[j].y * -0.5 + 0.5) * h);\n        ctx.strokeStyle = color;\n        ctx.lineWidth = lineWidth;\n        ctx.stroke();\n    }\n\n    /**\n     * Render the axes of a 3D coordinate system\n     * @param ctx canvas 2D context\n     * @param camera camera model\n     * @param viewportSize viewport size\n     * @param lineWidth\n     */\n    private _renderAxes(ctx: CanvasRenderingContext2D, camera: CameraModel, viewportSize: SpeedySize, lineWidth = 4): void\n    {\n        const RED = '#f00', GREEN = '#0f0', BLUE = '#00f';\n        const color = [ RED, GREEN, BLUE ]; // color of each axis: (X,Y,Z)\n        const length = 1; // length of each axis-corresponding line, given in normalized space units\n        const w = viewportSize.width;\n        const h = viewportSize.height;\n        const iw = 1 / (camera.imageSize.width / 2);\n        const ih = -1 / (camera.imageSize.height / 2);\n\n        /*\n\n        Multiply the 3x4 camera matrix by:\n\n        [ 0  L  0  0 ]\n        [ 0  0  L  0 ] , where L = length in normalized space of the lines\n        [ 0  0  0  L ]             corresponding to the 3 axes (typically 1)\n        [ 1  1  1  1 ]\n\n        Each column of the resulting matrix will give us the pixel coordinates\n        we're looking for: origin and the axes.\n\n        Note: we're working with homogeneous coordinates\n\n        */\n\n        const p = camera.matrix.read();\n        const l = length;\n        const o = [ p[9], p[10], p[11] ]; // origin of the coordinate system\n        const x = [ l*p[0]+p[9], l*p[1]+p[10], l*p[2]+p[11] ]; // x-axis\n        const y = [ l*p[3]+p[9], l*p[4]+p[10], l*p[5]+p[11] ]; // y-axis\n        const z = [ l*p[6]+p[9], l*p[7]+p[10], l*p[8]+p[11] ]; // z-axis\n        const axis = [ x, y, z ];\n\n        // draw each axis\n        const ox = o[0] / o[2], oy = o[1] / o[2];\n        for(let i = 0; i < 3; i++) {\n            const q = axis[i];\n            const x = q[0] / q[2], y = q[1] / q[2];\n\n            ctx.beginPath();\n            ctx.moveTo((ox * iw * 0.5 + 0.5) * w, (oy * ih * 0.5 + 0.5) * h);\n            ctx.lineTo((x * iw * 0.5 + 0.5) * w, (y * ih * 0.5 + 0.5) * h);\n            ctx.strokeStyle = color[i];\n            ctx.lineWidth = lineWidth;\n            ctx.stroke();\n        }\n\n        //console.log(\"Origin\",ox,oy);\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * frame.ts\n * A Frame holds information used to render a single animation frame of a Session\n */\n\nimport { Session } from './session';\nimport { TrackerResult } from '../trackers/tracker';\n\n/**\n * A Frame holds information used to render a single animation frame of a Session\n */\nexport class Frame\n{\n    /** A reference to the session */\n    private readonly _session: Session;\n\n    /** Results of all trackers (in the current frame) */\n    private readonly _results: TrackerResult[];\n\n\n\n    /**\n     * Constructor\n     * @param session\n     * @param results\n     */\n    constructor(session: Session, results: TrackerResult[])\n    {\n        this._session = session;\n        this._results = results;\n    }\n\n    /**\n     * The session of which this frame holds data\n     */\n    get session(): Session\n    {\n        return this._session;\n    }\n\n    /**\n     * The results of all trackers in this frame\n     */\n    get results(): Iterable<TrackerResult>\n    {\n        // we want to be able to iterate over the results of a frame multiple times\n        return this._results[Symbol.iterator]();\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * tracker.ts\n * Abstract Tracker\n */\n\nimport { Session } from '../core/session';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { ImageTracker, ImageTrackerResult } from './image-tracker/image-tracker';\nimport { PointerTracker, PointerTrackerResult } from './pointer-tracker/pointer-tracker';\n\n/**\n * A Trackable is something that can be tracked\n */\nexport interface Trackable\n{\n    /** the tracker that generated this trackable */\n    readonly tracker: Tracker;\n}\n\n/**\n * The result of a Tracker in a particular frame of a session. Such result is\n * meant to be consumed by the user/application.\n */\nexport abstract class TrackerResult\n{\n    /** the tracker that generated this result */\n    abstract readonly tracker: Tracker;\n\n    /** an array of trackables (possibly empty) */\n    abstract readonly trackables: Trackable[];\n\n    /** check if this result was generated by a tracker of a certain type */\n    of<T extends keyof TrackerResultType>(trackerType: T): this is TrackerResultType[T]\n    {\n        return this.tracker.is(trackerType);\n    }\n}\n\n/**\n * The output generated by a Tracker in a particular Frame of a Session\n */\nexport interface TrackerOutput\n{\n    /** tracker result to be consumed by the user */\n    readonly exports?: TrackerResult;\n\n    /** optional image for testing */\n    readonly image?: SpeedyMedia;\n}\n\n/**\n * A Tracker is an AR subsystem attached to a Session\n */\nexport interface Tracker\n{\n    /** check if this tracker is of a certain type */\n    is<T extends keyof TrackerType>(type: T): this is TrackerType[T];\n\n    /** initialize tracker @internal */\n    _init(session: Session): SpeedyPromise<void>;\n\n    /** release resources @internal */\n    _release(): SpeedyPromise<void>;\n\n    /** update cycle @internal */\n    _update(): SpeedyPromise<void>;\n\n    /** output of the last frame @internal */\n    readonly _output: TrackerOutput;\n\n    /** stats related to this tracker @internal */\n    readonly _stats: string;\n\n    /** a string that identifies the type of the tracker\n     *  @deprecated use is() instead */\n    readonly type: keyof TrackerType;\n}\n\n/**\n * A helper for type-narrowing\n * @internal\n */\nexport type TrackerType = {\n    'image-tracker': ImageTracker,\n    'pointer-tracker': PointerTracker\n};\n\n/**\n * A helper for type-narrowing\n * @internal\n */\nexport type TrackerResultType = {\n    'image-tracker': ImageTrackerResult,\n    'pointer-tracker': PointerTrackerResult\n};", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * time-manager.ts\n * Time Manager\n */\n\n/**\n * Time Manager\n */\nexport class TimeManager\n{\n    /** time scale */\n    private _scale: number = 1;\n\n    /** time since the start of the session, in milliseconds */\n    private _time: DOMHighResTimeStamp = 0;\n\n    /** unscaled time since the start of the session, in milliseconds */\n    private _unscaledTime: DOMHighResTimeStamp = 0;\n\n    /** elapsed time between the current and the previous frame, in milliseconds */\n    private _delta: DOMHighResTimeStamp = 0;\n\n    /** time of the first update call, in milliseconds */\n    private _firstUpdate: DOMHighResTimeStamp = 0;\n\n    /** time of the last update call, in milliseconds */\n    private _lastUpdate: DOMHighResTimeStamp = Number.POSITIVE_INFINITY;\n\n\n\n    /**\n     * Update the Time Manager\n     * @param timestamp in milliseconds\n     * @internal\n     */\n    _update(timestamp: DOMHighResTimeStamp): void\n    {\n        if(timestamp < this._lastUpdate) {\n            this._firstUpdate = this._lastUpdate = timestamp;\n            return;\n        }\n\n        this._delta = (timestamp - this._lastUpdate) * this._scale;\n        this._time += this._delta;\n        this._unscaledTime = timestamp - this._firstUpdate;\n        this._lastUpdate = timestamp;\n    }\n\n    /**\n     * Elapsed time since the start of the session, measured at the\n     * beginning of the current animation frame and given in seconds\n     */\n    get elapsed(): number\n    {\n        return this._time * 0.001;\n    }\n\n    /**\n     * Elapsed time between the current and the previous animation\n     * frame, given in seconds\n     */\n    get delta(): number\n    {\n        return this._delta * 0.001;\n    }\n\n    /**\n     * Time scale (defaults to 1)\n     */\n    get scale(): number\n    {\n        return this._scale;\n    }\n\n    /**\n     * Time scale (defaults to 1)\n     */\n    set scale(scale: number)\n    {\n        this._scale = Math.max(0, +scale);\n    }\n\n    /**\n     * Time scale independent elapsed time since the start of the session,\n     * measured at the beginning of the current animation frame and given\n     * in seconds\n     */\n    get unscaled(): number\n    {\n        return this._unscaledTime * 0.001;\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * asap.ts\n * Schedule a function to run \"as soon as possible\"\n */\n\n/** callbacks */\nconst callbacks: Function[] = [];\n\n/** arguments to be passed to the callbacks */\nconst args: any[][] = [];\n\n/** asap key */\nconst ASAP_KEY = 'asap' + Math.random().toString(36).substr(1);\n\n// Register an event listener\nwindow.addEventListener('message', event => {\n    if(event.source !== window || event.data !== ASAP_KEY)\n        return;\n\n    event.stopPropagation();\n    if(callbacks.length == 0)\n        return;\n\n    const fn = callbacks.pop() as Function;\n    const argArray = args.pop() as any[];\n    fn.apply(undefined, argArray);\n}, true);\n\n/**\n * Schedule a function to run \"as soon as possible\"\n * @param fn callback\n * @param params optional parameters\n */\nexport function asap(fn: Function, ...params: any[]): void\n{\n    callbacks.unshift(fn);\n    args.unshift(params);\n    window.postMessage(ASAP_KEY, '*');\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * session.ts\n * WebAR Session\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { SpeedyMediaSourceNativeElement } from 'speedy-vision/types/core/speedy-media-source';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { AR } from '../main';\nimport { Nullable, Utils } from '../utils/utils';\nimport { AREvent, AREventTarget } from '../utils/ar-events';\nimport { IllegalArgumentError, IllegalOperationError, NotSupportedError, AccessDeniedError } from '../utils/errors';\nimport { Viewport } from './viewport';\nimport { Settings } from './settings';\nimport { Stats } from './stats';\nimport { Gizmos } from '../ui/gizmos';\nimport { Frame } from './frame';\nimport { Trackable, Tracker, TrackerResult } from '../trackers/tracker';\nimport { TimeManager } from './time-manager';\nimport { Source } from '../sources/source';\nimport { VideoSource } from '../sources/video-source';\nimport { CanvasSource } from '../sources/canvas-source';\nimport { asap } from '../utils/asap';\n\n/** Session mode */\nexport type SessionMode = 'immersive' | 'inline';\n\n/** Session options */\nexport interface SessionOptions\n{\n    /** session mode */\n    mode?: SessionMode;\n\n    /** trackers */\n    trackers: Tracker[];\n\n    /** sources of data */\n    sources: Source[];\n\n    /** viewport */\n    viewport: Nullable<Viewport>;\n\n    /** show stats? */\n    stats?: boolean;\n\n    /** Render gizmos? */\n    gizmos?: boolean;\n}\n\n/** requestAnimationFrame callback */\ntype SessionRequestAnimationFrameCallback = (time: DOMHighResTimeStamp, frame: Frame) => void;\n\n/** requestAnimationFrame callback handle */\ntype SessionRequestAnimationFrameHandle = symbol;\n\n/** All possible event types emitted by a Session */\ntype SessionEventType = 'end';\n\n/** An event emitted by a Session */\nclass SessionEvent extends AREvent<SessionEventType> { }\n\n/** Default options when starting a session */\nconst DEFAULT_OPTIONS: Readonly<Required<SessionOptions>> = {\n    mode: 'immersive',\n    trackers: [],\n    sources: [],\n    viewport: null,\n    stats: false,\n    gizmos: false,\n};\n\n/** Helper class */\nclass EmptyTrackerResult extends TrackerResult\n{\n    readonly tracker: Tracker;\n    readonly trackables: Trackable[];\n\n    constructor(tracker: Tracker)\n    {\n        super();\n        this.tracker = tracker;\n        this.trackables = [];\n    }\n}\n\n\n\n\n/**\n * A Session represents an intent to display AR content\n * and encapsulates the main loop (update-render cycle)\n */\nexport class Session extends AREventTarget<SessionEvent>\n{\n    /** Number of active sessions */\n    private static _count = 0;\n\n    /** Session mode */\n    private readonly _mode: SessionMode;\n\n    /** Attached trackers */\n    private _trackers: Tracker[];\n\n    /** Sources of data */\n    private readonly _sources: Source[];\n\n    /** Rendering viewport */\n    private readonly _viewport: Viewport;\n\n    /** Primary source of data */\n    private readonly _primarySource: Nullable<VideoSource | CanvasSource>;\n\n    /** Time Manager */\n    private _time: TimeManager;\n\n    /** Is the session currently active? */\n    private _active: boolean;\n\n    /** Whether or not the frame is ready to be rendered */\n    private _frameReady: boolean;\n\n    /** Request animation frame callback queue */\n    private _rafQueue: Array<[SessionRequestAnimationFrameHandle, SessionRequestAnimationFrameCallback]>;\n\n    /** Update stats (GPU cycles/s) */\n    private _updateStats: Stats;\n\n    /** Render stats (FPS) */\n    private _renderStats: Stats;\n\n    /** Gizmos */\n    private _gizmos: Gizmos;\n\n\n\n    /**\n     * Constructor\n     * @param sources previously initialized sources of data\n     * @param mode session mode\n     * @param viewport viewport\n     * @param stats render stats panel?\n     * @param gizmos render gizmos?\n     */\n    private constructor(sources: Source[], mode: SessionMode, viewport: Viewport, stats: boolean, gizmos: boolean)\n    {\n        super();\n\n        this._mode = mode;\n        this._trackers = [];\n        this._sources = sources;\n        this._updateStats = new Stats();\n        this._renderStats = new Stats();\n        this._active = true;\n        this._frameReady = true; // no trackers at the moment\n        this._rafQueue = [];\n        this._time = new TimeManager();\n        this._gizmos = new Gizmos();\n        this._gizmos.visible = gizmos;\n\n        // validate the mode\n        if(mode != 'immersive' && mode != 'inline')\n            throw new IllegalArgumentError(`Invalid session mode \"${mode}\"`);\n\n        // find the primary source of data\n        this._primarySource = this._findPrimarySource(sources);\n\n        // setup the viewport\n        this._viewport = viewport;\n        if(this._primarySource !== null)\n            this._viewport._init(() => this._primarySource!._internalMedia.size, mode, stats);\n        else\n            this._viewport._init(() => Utils.resolution('sm', window.innerWidth / window.innerHeight), mode, stats);\n\n        // done!\n        Session._count++;\n        Utils.log(`The ${this._mode} session is now active!`);\n    }\n\n    /**\n     * Checks if the engine can be run in the browser the client is using\n     * @returns true if the engine is compatible with the browser\n     */\n    static isSupported(): boolean\n    {\n        //alert(Utils.deviceInfo()); // debug\n\n        // If Safari / iOS, require version 15.2 or later\n        if(/(Mac|iOS|iPhone|iPad|iPod)/i.test(navigator.platform)) {\n\n            /*\n\n            iOS compatibility\n            -----------------\n\n            The engine is known to work on iPhone 8 or later, with iOS 15.2 or\n            later. Tested on many devices, including iPads, on the cloud.\n\n            The engine crashes on an iPhone 13 Pro Max with iOS 15.1 and on an\n            iPhone 12 Pro with iOS 15.0.2. A (valid) shader from speedy-vision\n            version 0.9.1 (bf-knn) fails to compile: \"WebGL error. Program has\n            not been successfully linked\".\n\n            The engine freezes on an older iPhone 6S (2015) with iOS 15.8.2.\n            The exact cause is unknown, but it happens when training an image\n            tracker, at ImageTrackerTrainingState._gpuUpdate() (a WebGL error?\n            a hardware limitation?)\n\n            Successfully tested down to iPhone 8 so far.\n            Successfully tested down to iOS 15.2.\n\n            >> WebGL2 support was introduced in Safari 15 <<\n\n            Note: the webp image format used in the demos is supported on\n            Safari for iOS 14+. Desktop Safari 14-15.6 supports webp, but\n            requires macOS 11 Big Sur or later. https://caniuse.com/webp\n\n            */\n\n            const ios = /(iPhone|iPad|iPod).* (CPU[\\s\\w]* OS|CPU iPhone|iOS) ([\\d\\._]+)/.exec(navigator.userAgent); // Chrome, Firefox, Edge, Safari on iOS\n            const safari = /(AppleWebKit)\\/.* (Version)\\/([\\d\\.]+)/.exec(navigator.userAgent); // Desktop and Mobile Safari, Epiphany on Linux\n            const matches = safari || ios; // match safari first (min version)\n\n            if(matches !== null) {\n                const version = matches[3] || '0.0';\n                const [x, y] = version.split(/[\\._]/).map(v => parseInt(v) | 0);\n\n                if((x < 15) || (x == 15 && y < 2)) {\n                    Utils.error(`${matches === safari ? 'Safari' : 'iOS'} version ${version} is not supported! User agent: ${navigator.userAgent}`);\n                    return false;\n                }\n\n                // XXX reject older iPhone models? Which ones?\n                /*if(navigator.userAgent.includes('iPhone')) {\n                    // detect screen size?\n                }*/\n            }\n            else\n                Utils.warning(`Unrecognized user agent: ${navigator.userAgent}`);\n        }\n\n        // Android: reject very old / weak devices?\n        // XXX establish criteria?\n        /*if(Utils.isAndroid()) {\n        }*/\n\n        // Check if WebGL2 and WebAssembly are supported\n        return Speedy.isSupported();\n    }\n\n    /** \n     * Instantiate a session\n     * @param options options\n     * @returns a promise that resolves to a new session\n     */\n    static instantiate(options: SessionOptions = DEFAULT_OPTIONS): SpeedyPromise<Session>\n    {\n        const {\n            mode = DEFAULT_OPTIONS.mode,\n            sources = DEFAULT_OPTIONS.sources,\n            trackers = DEFAULT_OPTIONS.trackers,\n            viewport = DEFAULT_OPTIONS.viewport,\n            stats = DEFAULT_OPTIONS.stats,\n            gizmos = DEFAULT_OPTIONS.gizmos,\n        } = options;\n\n        Utils.log(`Starting a new ${mode} session...`);\n\n        return Speedy.Promise.resolve().then(() => {\n\n            // is the engine supported?\n            if(!Session.isSupported())\n                throw new NotSupportedError('You need a browser/device compatible with WebGL2 and WebAssembly in order to experience Augmented Reality with encantar.js');\n\n            // block multiple sessions when requesting the immersive mode\n            if(mode !== 'inline' && Session.count > 0)\n                throw new IllegalOperationError(`Can't start multiple sessions, except in inline mode`);\n\n            // dev build? work-in-progress\n            const isStableBuild = /^\\d+\\.\\d+(\\.\\d+)*$/.test(AR.version);\n            if(!isStableBuild) {\n                if(!(['localhost', '127.0.0.1', '[::1]', '', 'encantar.dev', 'alemart.github.io'].includes(location.hostname))) {\n                    if(!(location.hostname.startsWith('192.168.') || location.hostname.startsWith('10.') || /^172\\.(1[6-9]|2[0-9]|3[01])\\./.test(location.hostname))) {\n                        const message = 'This is a development build (unstable). Do not use it in production. Get a stable release at encantar.dev';\n                        Utils.warning(message);\n                        if(!confirm(message + '\\n\\nAre you sure you want to continue?'))\n                            throw new AccessDeniedError('Aborted');\n                    }\n                }\n            }\n\n            // initialize matrix routines\n            return Speedy.Matrix.ready();\n\n        }).then(() => {\n\n            // validate sources of data\n            for(let i = sources.length - 1; i >= 0; i--) {\n                if(sources.indexOf(sources[i]) < i)\n                    throw new IllegalArgumentError(`Found repeated sources of data`);\n            }\n\n            // initialize sources of data\n            return Speedy.Promise.all(\n                sources.map(source => source._init())\n            );\n\n        }).then(() => {\n\n            // get the viewport\n            if(!viewport)\n                throw new IllegalArgumentError(`Can't create a session without a viewport`);\n\n            // instantiate session\n            return new Session(sources, mode, viewport, stats, gizmos);\n\n        }).then(session => {\n\n            // validate the trackers\n            if(trackers.length == 0)\n                Utils.warning(`No trackers have been attached to the session!`);\n\n            for(let i = trackers.length - 1; i >= 0; i--) {\n                if(trackers.indexOf(trackers[i]) < i)\n                    throw new IllegalArgumentError(`Found repeated trackers`);\n            }\n\n            // attach the trackers\n            return Speedy.Promise.all(\n                trackers.map(tracker => session._attachTracker(tracker))\n            ).then(() => session);\n\n        }).then(session => {\n\n            // start the main loop and return the session\n            session._startMainLoop();\n            return session;\n\n        }).catch(err => {\n\n            // log errors, if any\n            Utils.error(`Can't start session: ${err.message}`);\n            throw err;\n\n        });\n    }\n\n    /**\n     * Number of active sessions\n     */\n    static get count(): number\n    {\n        return this._count;\n    }\n\n    /**\n     * End the session\n     * @returns promise that resolves after the session is shut down\n     */\n    end(): SpeedyPromise<void>\n    {\n        // is the session inactive?\n        if(!this._active)\n            return Speedy.Promise.resolve();\n\n        // deactivate the session\n        Utils.log('Shutting down the session...');\n        this._active = false; // set before wait()\n\n        // wait a few ms, so that the GPU is no longer sending any data\n        // then, release resources\n        return Utils.wait(100).then(() => Speedy.Promise.all(\n\n            // release trackers\n            this._trackers.map(tracker => tracker._release())\n\n        )).then(() => Speedy.Promise.all(\n\n            // release input sources\n            this._sources.map(source => source._release())\n\n        )).then(() => {\n\n            this._sources.length = 0;\n            this._trackers.length = 0;\n\n            // release internal components\n            this._updateStats.reset();\n            this._renderStats.reset();\n            this._viewport._release();\n\n            // end the session\n            Session._count--;\n\n            // dispatch event\n            const event = new SessionEvent('end');\n            this.dispatchEvent(event);\n\n            // done!\n            Utils.log('Session ended.');\n\n        });\n    }\n\n    /**\n     * Analogous to window.requestAnimationFrame()\n     * @param callback\n     * @returns a handle\n     */\n    requestAnimationFrame(callback: SessionRequestAnimationFrameCallback): SessionRequestAnimationFrameHandle\n    {\n        const handle: SessionRequestAnimationFrameHandle = Symbol('raf-handle');\n\n        if(this._active) {\n            this._rafQueue.push([ handle, callback ]);\n        }\n        else {\n            // if the session is inactive, we simply ignore this call\n            // this is friendly behavior, since RAF is used in animation loops\n        }\n\n        return handle;\n    }\n\n    /**\n     * Analogous to window.cancelAnimationFrame()\n     * @param handle a handle returned by this.requestAnimationFrame()\n     */\n    cancelAnimationFrame(handle: SessionRequestAnimationFrameHandle): void\n    {\n        for(let i = this._rafQueue.length - 1; i >= 0; i--) {\n            if(this._rafQueue[i][0] === handle) {\n                this._rafQueue.splice(i, 1);\n                break;\n            }\n        }\n    }\n\n    /**\n     * Session mode\n     */\n    get mode(): SessionMode\n    {\n        return this._mode;\n    }\n\n    /**\n     * Whether or not the session has been ended\n     */\n    get ended(): boolean\n    {\n        return !this._active;\n    }\n\n    /**\n     * Time Manager\n     */\n    get time(): TimeManager\n    {\n        return this._time;\n    }\n\n    /**\n     * Visual cues for testing & debugging\n     */\n    get gizmos(): Gizmos\n    {\n        return this._gizmos;\n    }\n\n    /**\n     * Rendering viewport\n     */\n    get viewport(): Viewport\n    {\n        return this._viewport;\n    }\n\n    /**\n     * Attached trackers\n     */\n    get trackers(): Iterable<Tracker>\n    {\n        return this._trackers[Symbol.iterator]();\n    }\n\n    /**\n     * Sources of data\n     */\n    get sources(): Iterable<Source>\n    {\n        return this._sources[Symbol.iterator]();\n    }\n\n    /**\n     * Start the main loop\n     */\n    private _startMainLoop(): void\n    {\n        this._setupUpdateLoop();\n        this._setupRenderLoop();\n\n        Utils.log('The main loop has been started!');\n    }\n\n    /**\n     * Find the primary source of data (generally a camera stream)\n     * @param sources\n     * @returns the primary source, or null if there isn't any\n     */\n    private _findPrimarySource(sources: Source[]): Nullable<VideoSource | CanvasSource>\n    {\n        // prefer video sources\n        for(let i = 0; i < sources.length; i++) {\n            const source = sources[i];\n            if(source._is('video-source'))\n                return source;\n        }\n        for(let i = 0; i < sources.length; i++) {\n            const source = sources[i];\n            if(source._is('canvas-source'))\n                return source;\n        }\n\n        // emit warning\n        Utils.warning(`No primary source of data was found!`);\n        return null;\n    }\n\n    /**\n     * Attach a tracker to the session\n     * @param tracker\n     * @returns a promise that resolves as soon as the tracker is attached and initialized\n     */\n    private _attachTracker(tracker: Tracker): SpeedyPromise<void>\n    {\n        if(this._trackers.indexOf(tracker) >= 0)\n            return Speedy.Promise.reject(new IllegalArgumentError(`Duplicate tracker attached to the session`));\n        else if(!this._active)\n            return Speedy.Promise.reject(new IllegalOperationError(`Inactive session`));\n\n        this._trackers.push(tracker);\n        return tracker._init(this);\n    }\n\n    /**\n     * Render content to the background canvas\n     */\n    private _renderBackground(): void\n    {\n        const canvas = this._viewport._backgroundCanvas;\n        const ctx = canvas.getContext('2d', { alpha: false });\n\n        // error?\n        if(!ctx)\n            return;\n        ctx.imageSmoothingEnabled = false;\n\n        // render user media\n        if(this._primarySource !== null) {\n            const media = this._primarySource._internalMedia;\n            this._renderMedia(ctx, media, true);\n        }\n\n        // render output image(s) for debugging\n        for(let i = 0; i < this._trackers.length; i++) {\n            const media = this._trackers[i]._output.image;\n            if(media !== undefined)\n                this._renderMedia(ctx, media, false);\n        }\n\n        // render gizmos\n        this._gizmos._render(this._viewport, this._trackers);\n    }\n\n    /**\n     * Render a SpeedyMedia\n     * @param ctx rendering context\n     * @param media\n     * @param stretch\n     */\n    private _renderMedia(ctx: CanvasRenderingContext2D, media: SpeedyMedia, stretch: boolean): void\n    {\n        const canvas = ctx.canvas;\n        const width = stretch ? canvas.width : media.width;\n        const height = stretch ? canvas.height : media.height;\n\n        if(media.type != 'data') {\n            const image = media.source as Exclude<SpeedyMediaSourceNativeElement, ImageData>;\n            ctx.drawImage(image, 0, 0, width, height);\n        }\n        else {\n            const image = media.source as ImageData;\n            ctx.putImageData(image, 0, 0, 0, 0, width, height);\n        }\n    }\n\n    /**\n     * Setup the update loop\n     */\n    private _setupUpdateLoop(): void\n    {\n        const scheduleNextFrame = () => {\n            if(!this._active)\n                return;\n            else if(Settings.powerPreference == 'high-performance')\n                asap(repeat);\n            else\n                window.requestAnimationFrame(repeat);\n        };\n        \n        const update = () => {\n            this._update().then(scheduleNextFrame).turbocharge();\n        };\n\n        function repeat() {\n            if(Settings.powerPreference == 'low-power') // 30 fps\n                window.requestAnimationFrame(update);\n            else\n                update();\n        }\n\n        window.requestAnimationFrame(update);\n    }\n\n    /**\n     * The core of the update loop\n     */\n    private _update(): SpeedyPromise<void>\n    {\n        // active session?\n        if(this._active) {\n            return Speedy.Promise.all(\n                // update trackers\n                this._trackers.map(tracker => tracker._update().turbocharge())\n            ).then(() => {\n                // update internals\n                this._updateStats.update();\n                this._frameReady = true;\n            }).catch(err => {\n                // log error\n                Utils.error('Tracking error: ' + err.toString(), err);\n\n                // handle WebGL errors\n                const cause = (err as any).cause;\n                if(err.name == 'GLError') {\n                    alert(err.message); // fatal error?\n                    alert(Utils.deviceInfo()); // display useful info\n                    throw err;\n                }\n                else if(typeof cause == 'object' && cause.name == 'GLError') {\n                    alert(err.message);\n                    alert(cause.message);\n                    alert(Utils.deviceInfo());\n                    throw err;\n                }\n            });\n        }\n        else {\n            // inactive session\n            this._updateStats.reset();\n            return Speedy.Promise.resolve();\n        }\n    }\n\n    /**\n     * Setup the render loop\n     */\n    private _setupRenderLoop(): void\n    {\n        let skip = false, toggle = false;\n\n        const render = (timestamp: DOMHighResTimeStamp) => {\n            const enableFrameSkipping = (Settings.powerPreference == 'low-power');\n            const highPerformance = (Settings.powerPreference == 'high-performance');\n\n            // advance time\n            this._time._update(timestamp);\n\n            // skip frames\n            if(!enableFrameSkipping || !(skip = !skip))\n                this._render(timestamp);\n                //this._render(timestamp, !enableFrameSkipping && !highPerformance && (toggle = !toggle));\n\n            // repeat\n            if(this._active)\n                window.requestAnimationFrame(render);\n        };\n\n        window.requestAnimationFrame(render);\n    }\n\n    /**\n     * Render a frame (RAF callback)\n     * @param time current time, in ms\n     * @param skipUserMedia skip copying the pixels of the user media to the background canvas in order to reduce the processing load (video stream is probably at 30fps?)\n     */\n    private _render(time: DOMHighResTimeStamp, skipUserMedia: boolean = false): void\n    {\n        // is the session active?\n        if(this._active) {\n\n            // are we ready to render a frame?\n            if(this._frameReady) {\n\n                // create a frame\n                const results = this._trackers.map(tracker =>\n                    tracker._output.exports || new EmptyTrackerResult(tracker)\n                );\n                const frame = new Frame(this, results);\n\n                // clone & clear the RAF queue\n                const rafQueue = this._rafQueue.slice(0);\n                this._rafQueue.length = 0;\n\n                // render content to the background canvas\n                if(!skipUserMedia)\n                    this._renderBackground();\n\n                // render frame\n                for(let i = 0; i < rafQueue.length; i++)\n                    rafQueue[i][1].call(undefined, time, frame);\n\n                // update internals\n                this._renderStats.update();\n                this._frameReady = false;\n\n                // update stats panel\n                const statsPanel = this._viewport.hud._statsPanel;\n                statsPanel.update(time, this._sources, this._trackers, this._viewport, this._updateStats.cyclesPerSecond, this._renderStats.cyclesPerSecond);\n\n            }\n            else {\n\n                // skip frame\n                ;\n\n                // we'll update the renderStats even if we skip the frame,\n                // otherwise this becomes updateStats! (approximately)\n                // This is a window.requestAnimationFrame() call, so the\n                // browser is rendering content even if we're not.\n                this._renderStats.update();\n\n            }\n\n        }\n        else {\n\n            // inactive session\n            this._renderStats.reset();\n\n        }\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * settings.ts\n * Global Settings\n */\n\nimport Speedy from 'speedy-vision';\nimport { Session } from './session';\nimport { IllegalArgumentError, IllegalOperationError } from '../utils/errors';\nimport { Utils } from '../utils/utils';\n\n/** Power preference (may impact performance x battery life) */\nexport type PowerPreference = 'default' | 'low-power' | 'high-performance';\n\n/**\n * Global Settings\n */\nexport class Settings\n{\n    private static _powerPreference: PowerPreference = 'default';\n\n    /**\n     * Power preference (may impact performance x battery life)\n     */\n    static get powerPreference(): PowerPreference\n    {\n        return this._powerPreference;\n    }\n\n    /**\n     * Power preference (may impact performance x battery life)\n     * Note: this setting should be the very first thing you set\n     * (before the WebGL context is created by Speedy)\n     */\n    static set powerPreference(value: PowerPreference)\n    {\n        // validate\n        if(Session.count > 0)\n            throw new IllegalOperationError(`Can't change the powerPreference while there are active sessions going on`);\n        else if(!('low-power' == value || 'default' == value || 'high-performance' == value))\n            throw new IllegalArgumentError(`Invalid powerPreference: \"${value}\"`);\n\n        /*\n        // we won't use 'high-performance' for Speedy's GPU computations\n        // see the WebGL 1.0 spec sec 5.2.1 for battery life considerations\n        // also, it seems like low-power mode may break WebGL2 in some drivers?!\n\n        if(value == 'high-performance')\n            Speedy.Settings.powerPreference = 'default';\n        else\n            Speedy.Settings.powerPreference = value;\n        */\n\n        // change the GPU polling mode\n        if(value == 'high-performance')\n            Speedy.Settings.gpuPollingMode = 'asap';\n        else\n            Speedy.Settings.gpuPollingMode = 'raf';\n\n        // update the power preference\n        this._powerPreference = value;\n\n        // log\n        Utils.log(`Changed the powerPreference to \"${this._powerPreference}\"`);\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * reference-image.ts\n * Reference Image for tracking\n */\n\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\n\ntype ReferenceImageType = HTMLImageElement | ImageBitmap | ImageData;\n\n\n\n/**\n * Reference Image for tracking\n */\nexport interface ReferenceImage\n{\n    /** Reference Images should have unique names given by the user */\n    name?: string;\n\n    /** Image data */\n    readonly image: ReferenceImageType;\n}\n\n/**\n * A ReferenceImage decorated with a SpeedyMedia\n */\nexport class ReferenceImageWithMedia implements ReferenceImage\n{\n    /** The decorated reference image */\n    private readonly _referenceImage: ReferenceImage;\n\n    /** A SpeedyMedia corresponding to the reference image */\n    private readonly _media: SpeedyMedia;\n\n    /** The aspect ratio of the reference image */\n    private readonly _aspectRatio: number;\n\n\n\n    /**\n     * Constructor\n     * @param referenceImage\n     * @param media\n     */\n    constructor(referenceImage: ReferenceImage, media: SpeedyMedia)\n    {\n        this._referenceImage = Object.assign({}, referenceImage);\n        this._media = media;\n\n        // generate a unique name if none is given\n        if(this._referenceImage.name === undefined)\n            this._referenceImage.name = this._generateUniqueName();\n\n        // store the aspect ratio\n        this._aspectRatio = media.width / media.height;\n    }\n\n    /**\n     * Getter of the name of the reference image\n     */\n    get name(): string\n    {\n        return this._referenceImage.name!;\n    }\n\n    /**\n     * Setter of the name of the reference image\n     */\n    set name(name: string)\n    {\n        this._referenceImage.name = name;\n    }\n\n    /**\n     * Image data\n     */\n    get image(): ReferenceImageType\n    {\n        return this._referenceImage.image;\n    }\n\n    /**\n     * A SpeedyMedia corresponding to the reference media\n     */\n    get media(): SpeedyMedia\n    {\n        return this._media;\n    }\n\n    /**\n     * The aspect ratio of the reference image\n     */\n    get aspectRatio(): number\n    {\n        return this._aspectRatio;\n    }\n\n    /**\n     * Generate a unique name for a reference image\n     * @returns a unique name\n     */\n    private _generateUniqueName(): string\n    {\n        return 'target-' + Math.random().toString(16).substr(2);\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * reference-image-database.ts\n * A collection of Reference Images\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { ReferenceImage, ReferenceImageWithMedia } from './reference-image';\nimport { Utils } from '../../utils/utils';\nimport { IllegalArgumentError, IllegalOperationError } from '../../utils/errors';\n\n/** Default capacity of a Reference Image Database */\nconst DEFAULT_CAPACITY = 100; // this number should exceed normal usage\n                              // XXX this number may be changed (is 100 too conservative?)\n                              // further testing is needed to verify the appropriateness of this number;\n                              // it depends on the images, on the keypoint descriptors, and even on the target devices\n\n/**\n * A collection of Reference Images\n */\nexport class ReferenceImageDatabase implements Iterable<ReferenceImage>\n{\n    /** Entries */\n    private _entries: Map<string, ReferenceImageWithMedia>;\n\n    /** Maximum number of entries */\n    private _capacity: number;\n\n    /** Is the database locked? */\n    private _locked: boolean;\n\n\n\n\n    /**\n     * Constructor\n     */\n    constructor()\n    {\n        this._capacity = DEFAULT_CAPACITY;\n        this._entries = new Map();\n        this._locked = false;\n    }\n\n    /**\n     * The number of reference images stored in this database\n     */\n    get count(): number\n    {\n        return this._entries.size;\n    }\n\n    /**\n     * Maximum number of elements\n     */\n    get capacity(): number\n    {\n        return this._capacity;\n    }\n\n    /**\n     * Maximum number of elements\n     * Increasing the capacity is considered experimental\n     */\n    set capacity(value: number)\n    {\n        const capacity = Math.max(0, value | 0);\n\n        if(this.count > capacity)\n            throw new IllegalArgumentError(`Can't set the capacity of the database to ${capacity}: it currently stores ${this.count} entries`);\n\n        this._capacity = capacity;\n    }\n\n    /**\n     * Iterates over the collection\n     */\n    [Symbol.iterator](): Iterator<ReferenceImageWithMedia>\n    {\n        return this._entries.values();\n    }\n\n    /**\n     * Add reference images to this database\n     * Add only the images you actually need to track!\n     * (each image take up storage space)\n     * @param referenceImages one or more reference images with unique names (a unique name will\n     *                        be generated automatically if you don't specify one)\n     * @returns a promise that resolves as soon as the images are loaded and added to this database\n     */\n    add(referenceImages: ReferenceImage[]): SpeedyPromise<void>\n    {\n        return this._preloadMany(referenceImages).then(referenceImagesWithMedia => {\n            referenceImagesWithMedia.forEach(referenceImageWithMedia => {\n                this._addOne(referenceImageWithMedia);\n            });\n        });\n    }\n\n    /**\n     * Add a single preloaded reference image to the database\n     * @param referenceImage\n     */\n    _addOne(referenceImage: ReferenceImageWithMedia): void\n    {\n        const name = referenceImage.name;\n\n        // locked database?\n        if(this._locked)\n            throw new IllegalOperationError(`Can't add reference image \"${name}\" to the database: it's locked`);\n\n        // reached full capacity?\n        if(this.count >= this.capacity)\n            throw new IllegalOperationError(`Can't add reference image \"${name}\" to the database: the capacity of ${this.capacity} images has been exceeded.`);\n\n        // check if the image is valid\n        if(\n            !(referenceImage.image instanceof HTMLImageElement) &&\n            !(referenceImage.image instanceof ImageBitmap) &&\n            !(referenceImage.image instanceof ImageData)\n        )\n            throw new IllegalArgumentError(`Can't add reference image \"${name}\" to the database: invalid image`);\n\n        // check for duplicate names\n        if(this._entries.has(name))\n            throw new IllegalArgumentError(`Can't add reference image \"${name}\" to the database: found duplicated name`);\n\n        // add the reference image to the database\n        Utils.log(`Adding reference image \"${name}\" to the database...`);\n        this._entries.set(name, referenceImage);\n    }\n\n    /**\n     * Lock the database, so that new reference images can no longer be added to it\n     * @internal\n     */\n    _lock(): void\n    {\n        this._locked = true;\n    }\n\n    /**\n     * Get reference image by name\n     * @param name\n     * @returns the reference image with the given name, or null if there isn't any\n     * @internal\n     */\n    _find(name: string): ReferenceImageWithMedia | null\n    {\n        return this._entries.get(name) || null;\n    }\n\n    /**\n     * Load a reference image\n     * @param referenceImage\n     * @returns a promise that resolves to a corresponding ReferenceImageWithMedia\n     */\n    private _preloadOne(referenceImage: ReferenceImage): SpeedyPromise<ReferenceImageWithMedia>\n    {\n        if(referenceImage.name !== undefined)\n            Utils.log(`Loading reference image \\\"${referenceImage.name}\\\"...`);\n        else\n            Utils.log(`Loading reference image...`);\n\n        if(!referenceImage.image)\n            return Speedy.Promise.reject(new IllegalArgumentError('The reference image was not provided!'));\n\n        return Speedy.load(referenceImage.image).then(media => {\n            return new ReferenceImageWithMedia(referenceImage, media);\n        });\n    }\n\n    /**\n     * Load multiple reference images\n     * @param referenceImages\n     * @returns a promise that resolves to corresponding ReferenceImageWithMedia objects\n     */\n    private _preloadMany(referenceImages: ReferenceImage[]): SpeedyPromise<ReferenceImageWithMedia[]>\n    {\n        const n = referenceImages.length;\n        Utils.log(`Loading ${n} reference image${n != 1 ? 's' : ''}...`);\n\n        const promises = referenceImages.map(referenceImage => this._preloadOne(referenceImage));\n        return Speedy.Promise.all<ReferenceImageWithMedia>(promises);\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * state.ts\n * Abstract state of the Image Tracker\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { SpeedyPoint2 } from 'speedy-vision/types/core/speedy-point';\nimport { SpeedyVector2 } from 'speedy-vision/types/core/speedy-vector';\nimport { SpeedyPipeline, SpeedyPipelineOutput } from 'speedy-vision/types/core/pipeline/pipeline';\nimport { SpeedyPipelineNodeImageSource } from 'speedy-vision/types/core/pipeline/nodes/images/source';\nimport { SpeedyPipelineNodeResize } from 'speedy-vision/types/core/pipeline/nodes/transforms/resize';\nimport { SpeedyPipelineNodeKeypointTransformer } from 'speedy-vision/types/core/pipeline/nodes/keypoints/transformer';\nimport { SpeedyKeypoint } from 'speedy-vision/types/core/speedy-keypoint';\nimport { ImageTracker, ImageTrackerOutput, ImageTrackerStateName } from '../image-tracker';\nimport { ReferenceImage } from '../reference-image';\nimport { TrackerOutput } from '../../tracker';\nimport { Nullable } from '../../../utils/utils';\nimport { IllegalOperationError, IllegalArgumentError } from '../../../utils/errors';\n\n/** State output */\nexport interface ImageTrackerStateOutput\n{\n    readonly trackerOutput: ImageTrackerOutput;\n    readonly nextState: ImageTrackerStateName;\n    readonly nextStateSettings?: Record<string,any>;\n}\n\n/**\n * Abstract state of the Image Tracker\n */\nexport abstract class ImageTrackerState\n{\n    /** image tracker */\n    protected readonly _imageTracker: ImageTracker;\n\n    /** state name */\n    protected readonly _name: ImageTrackerStateName;\n\n    /** pipeline */\n    protected _pipeline: SpeedyPipeline;\n\n    /** a flag telling whether or not the pipeline has been released */\n    protected _pipelineReleased: boolean;\n\n\n    /**\n     * Constructor\n     * @param name\n     * @param imageTracker\n     */\n    constructor(name: ImageTrackerStateName, imageTracker: ImageTracker)\n    {\n        this._name = name;\n        this._imageTracker = imageTracker;\n        this._pipeline = this._createPipeline();\n        this._pipelineReleased = false;\n    }\n\n    /**\n     * State name\n     */\n    get name(): ImageTrackerStateName\n    {\n        return this._name;\n    }\n\n    /**\n     * AR screen size\n     * It may change over time, as when flipping a phone\n     */\n    get screenSize(): SpeedySize\n    {\n        const screen = this._pipeline.node('screen') as Nullable<SpeedyPipelineNodeResize>;\n        if(!screen)\n            throw new IllegalOperationError();\n\n        // this is available once this state has run at least once\n        return screen.size;\n    }\n\n    /**\n     * Initialize the state\n     */\n    init(): void\n    {\n    }\n\n    /**\n     * Release resources\n     */\n    release(): null\n    {\n        if(!this._pipelineReleased) {\n            this._pipeline.release();\n            this._pipelineReleased = true;\n        }\n\n        return null;\n    }\n\n    /**\n     * Update the state\n     * @param media user media\n     * @param screenSize AR screen size for image processing\n     * @param state all states\n     * @returns promise\n     */\n    update(media: SpeedyMedia, screenSize: SpeedySize): SpeedyPromise<ImageTrackerStateOutput>\n    {\n        const source = this._pipeline.node('source') as Nullable<SpeedyPipelineNodeImageSource>;\n        const screen = this._pipeline.node('screen') as Nullable<SpeedyPipelineNodeResize>;\n\n        // validate the pipeline\n        if(!source || !screen)\n            throw new IllegalOperationError();\n\n        // prepare the pipeline\n        source.media = media;\n        screen.size = screenSize;\n\n        // run the pipeline\n        return this._beforeUpdate().then(() =>\n            this._gpuUpdate()\n        ).then(result =>\n            this._afterUpdate(result)\n        );\n    }\n\n    /**\n     * Called as soon as this becomes the active state, just before update() runs for the first time\n     * @param settings\n     */\n    onEnterState(settings: Record<string,any>): void\n    {\n    }\n\n    /**\n     * Called when leaving the state, after update()\n     */\n    onLeaveState(): void\n    {\n    }\n\n    /**\n     * Called just before the GPU processing\n     * @returns promise\n     */\n    protected _beforeUpdate(): SpeedyPromise<void>\n    {\n        return Speedy.Promise.resolve();\n    }\n\n    /**\n     * GPU processing\n     * @returns promise with the pipeline results\n     */\n    protected _gpuUpdate(): SpeedyPromise<SpeedyPipelineOutput>\n    {\n        return this._pipeline.run();\n    }\n\n    /**\n     * Post processing that takes place just after the GPU processing\n     * @param result pipeline results\n     * @returns state output\n     */\n    protected abstract _afterUpdate(result: SpeedyPipelineOutput): SpeedyPromise<ImageTrackerStateOutput>;\n\n    /**\n     * Create & setup the pipeline\n     * @returns pipeline\n     */\n    protected abstract _createPipeline(): SpeedyPipeline;\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * initial.ts\n * Initial state of the Image Tracker\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { SpeedyPipeline, SpeedyPipelineOutput } from 'speedy-vision/types/core/pipeline/pipeline';\nimport { ImageTracker, ImageTrackerOutput, ImageTrackerStateName } from '../image-tracker';\nimport { ImageTrackerState, ImageTrackerStateOutput } from './state';\nimport { NIGHTVISION_QUALITY, SUBPIXEL_METHOD } from '../settings';\nimport { SpeedyPipelineNodeImageSource } from 'speedy-vision/types/core/pipeline/nodes/images/source';\nimport { Utils } from '../../../utils/utils';\n\n\n\n/**\n * The purpose of the initial state of the Image Tracker\n * is to initialize the training state using the state machine\n */\nexport class ImageTrackerInitialState extends ImageTrackerState\n{\n    /**\n     * Constructor\n     * @param imageTracker\n     */\n    constructor(imageTracker: ImageTracker)\n    {\n        super('initial', imageTracker);\n    }\n\n    /**\n     * Called just before the GPU processing\n     * @returns promise\n     */\n    protected _beforeUpdate(): SpeedyPromise<void>\n    {\n        const source = this._pipeline.node('source') as SpeedyPipelineNodeImageSource;\n        const media = source.media as SpeedyMedia;\n        const mediaSize = media.size;\n\n        if(mediaSize.area() < this.screenSize.area())\n            Utils.warning('The resolution of the tracker is larger than the resolution of the video. This is inefficient.');\n\n        return Speedy.Promise.resolve();\n    }\n\n    /**\n     * Post processing that takes place just after the GPU processing\n     * @param result pipeline results\n     * @returns state output\n     */\n    protected _afterUpdate(result: SpeedyPipelineOutput): SpeedyPromise<ImageTrackerStateOutput>\n    {\n        return Speedy.Promise.resolve({\n            nextState: 'training',\n            trackerOutput: { },\n        });\n    }\n\n    /**\n     * Called when leaving the state, after update()\n     */\n    onLeaveState(): void\n    {\n        // we don't return to this state, so we can release the pipeline early\n        this._pipeline.release();\n        this._pipelineReleased = true;\n    }\n\n    /**\n     * Create & setup the pipeline\n     * @returns pipeline\n     */\n    protected _createPipeline(): SpeedyPipeline\n    {\n        // this pipeline does nothing useful,\n        // but it does preload some shaders...\n        const pipeline = Speedy.Pipeline();\n\n        const source = Speedy.Image.Source('source');\n        const screen = Speedy.Transform.Resize('screen');\n        const greyscale = Speedy.Filter.Greyscale();\n        const imageRectifier = Speedy.Transform.PerspectiveWarp();\n        const nightvision = Speedy.Filter.Nightvision();\n        const nightvisionMux = Speedy.Image.Multiplexer();\n        const detector = Speedy.Keypoint.Detector.Harris();\n        const descriptor = Speedy.Keypoint.Descriptor.ORB();\n        const blur = Speedy.Filter.GaussianBlur();\n        const clipper = Speedy.Keypoint.Clipper();\n        const borderClipper = Speedy.Keypoint.BorderClipper();\n        const denoiser = Speedy.Filter.GaussianBlur();\n        const subpixel = Speedy.Keypoint.SubpixelRefiner();\n        const matcher = Speedy.Keypoint.Matcher.BFKNN();\n        const keypointRectifier = Speedy.Keypoint.Transformer();\n        const keypointPortalSink = Speedy.Keypoint.Portal.Sink();\n        const keypointPortalSource = Speedy.Keypoint.Portal.Source();\n        const muxOfReferenceKeypoints = Speedy.Keypoint.Multiplexer();\n        const bufferOfReferenceKeypoints = Speedy.Keypoint.Buffer();\n        const muxOfBufferOfReferenceKeypoints = Speedy.Keypoint.Multiplexer();\n        const keypointSink = Speedy.Keypoint.SinkOfMatchedKeypoints();\n\n        source.media = null;\n        screen.size = Speedy.Size(0,0);\n        imageRectifier.transform = Speedy.Matrix.Eye(3);\n        nightvision.quality = NIGHTVISION_QUALITY;\n        subpixel.method = SUBPIXEL_METHOD;\n        //borderClipper.imageSize = screen.size;\n        borderClipper.imageSize = Speedy.Size(100,100);\n        borderClipper.borderSize = Speedy.Vector2(0,0);\n        matcher.k = 1; //2;\n        keypointRectifier.transform = Speedy.Matrix.Eye(3);\n        keypointPortalSource.source = keypointPortalSink;\n        muxOfReferenceKeypoints.port = 0;\n        muxOfBufferOfReferenceKeypoints.port = 0;\n        bufferOfReferenceKeypoints.frozen = false;\n        keypointSink.turbo = false;\n\n        // prepare input\n        source.output().connectTo(screen.input());\n        screen.output().connectTo(greyscale.input());\n\n        // preprocess images\n        greyscale.output().connectTo(imageRectifier.input());\n        imageRectifier.output().connectTo(nightvisionMux.input('in0'));\n        imageRectifier.output().connectTo(nightvision.input());\n        nightvision.output().connectTo(nightvisionMux.input('in1'));\n        nightvisionMux.output().connectTo(blur.input());\n\n        // keypoint detection & clipping\n        nightvisionMux.output().connectTo(detector.input());\n        detector.output().connectTo(borderClipper.input());\n        borderClipper.output().connectTo(clipper.input());\n\n        // keypoint refinement\n        imageRectifier.output().connectTo(denoiser.input());\n        denoiser.output().connectTo(subpixel.input('image'));\n        clipper.output().connectTo(subpixel.input('keypoints'));\n\n        // keypoint description\n        blur.output().connectTo(descriptor.input('image'));\n        subpixel.output().connectTo(descriptor.input('keypoints'));\n\n        // keypoint matching\n        descriptor.output().connectTo(muxOfReferenceKeypoints.input('in0'));\n        muxOfBufferOfReferenceKeypoints.output().connectTo(muxOfReferenceKeypoints.input('in1'));\n        muxOfReferenceKeypoints.output().connectTo(matcher.input('database'));\n        descriptor.output().connectTo(matcher.input('keypoints'));\n\n        // store reference keypoints\n        keypointPortalSource.output().connectTo(muxOfBufferOfReferenceKeypoints.input('in0'));\n        bufferOfReferenceKeypoints.output().connectTo(muxOfBufferOfReferenceKeypoints.input('in1'));\n        keypointPortalSource.output().connectTo(bufferOfReferenceKeypoints.input());\n\n        // portals\n        descriptor.output().connectTo(keypointPortalSink.input());\n\n        // prepare output\n        descriptor.output().connectTo(keypointRectifier.input());\n        keypointRectifier.output().connectTo(keypointSink.input());\n        matcher.output().connectTo(keypointSink.input('matches'));\n\n        // done!\n        pipeline.init(\n            source, screen,\n            greyscale, imageRectifier, nightvision, nightvisionMux, blur,\n            detector, subpixel, clipper, borderClipper, denoiser, descriptor,\n            keypointPortalSource, muxOfReferenceKeypoints, matcher,\n            bufferOfReferenceKeypoints, muxOfBufferOfReferenceKeypoints,\n            keypointRectifier, keypointSink,\n            keypointPortalSink,\n        );\n\n        /*\n        const run = pipeline.run.bind(pipeline);\n        pipeline.run = function() {\n            console.time(\"TIME\");\n            return run().then(x => {\n                console.timeEnd(\"TIME\");\n                return x;\n            });\n        };\n        */\n\n        return pipeline;\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * pnp.ts\n * Perspective-N-Point for Planar Tracking\n */\n\n/*\n\nMy Approach to Perspective-N-Point for Planar Tracking\n------------------------------------------------------\n                                            by alemart\n                                          Jan-Feb 2025\n\nProblem statement: we are given two images, A and B, of a planar target T, as well\nas a pinhole camera and correspondences between points of the images. On image A,\nthe target is parallel to the image plane of the camera. On image B, the target is\nviewed in some way. We're looking for a rigid transform [ R | t ] of T, in 3D space,\nthat is consistent with the observations of the camera (from image A to B). In my\nformulation, the target moves and the camera stays fixed. The camera intrinsics K\nare known.\n\nDesign goals: I'm looking for an algorithm that is both fast and simple. Of course,\n\"simple\" is a relative term. What I mean is that I can easily implement it by hand\nhere, without requiring external dependencies such as numerical packages, and\nwithout needing to implement long or overly complicated routines myself. By fast,\nI mean that it's suitable for AR, preferably an analytical solution (closed formula).\n\n\n\n1. Definitions\n--------------\n\nView space: a 3D space centered at the optical center O of the camera\n\nModel space: a 3D space centered at some pivot point of the planar target T\n\nImage space: a 2D space induced by the image plane of the camera and centered at\nits principal point\n\n\n\n2. Problem formulation\n----------------------\n\nWe are given two sets of n >= 4 points in image space: P = { p1, ..., pn } and\nQ = { q1, ..., qn }. Points pi belong to image A. Points qi, to image B. The pair\n(pj, qj) represents a known correspondence between points of these images. Even\nthough these are 2D points represented by 2x1 vectors, when appropriate I will\nuse the same notation to represent these points as homogeneous 3x1 vectors.\n\nLet's consider image A for a moment. The planar target T is, by design, parallel\nto the image plane of the camera. As a convention, I'll say that all points of the\nplanar target, in view space, are located at the plane Z = z0 for some constant\nz0 > f (f: focal length of the camera). We can recover the 3D coordinates of all\npoints in P by unprojecting them. Let Kinv be the inverse of the 3x3 intrinsics\nmatrix K. For all i, let's define point ui as:\n\nui = z0 * Kinv * pi\n\n(pi in homogeneous coordinates)\n\nIn a nutshell, ui is just pi in view space. Example: if K = diag(f, f, 1), then\nui = [ z0 * pix / f    z0 * piy / f    z0 ]'. This result is trivially found\nusing similar triangles.\n\n\n                            | ui\n            | pi            |\n  .---------|---------------|--------------------> Z-axis\n  O         |               |\n                            |\n         image            planar\n         plane            target\n         Z = f            Z = z0\n\nNow let's consider image B. We do not know the pose of the planar target T at\nthis time, and so we do not know (beforehand) the distances between the points\nof T and the optical center O. We'll figure out these distances later. For now,\nit's enough to say that, for each point qi of Q, we can recover a line in view\nspace passing through O (origin) and qi. For all i, let's define unit vector vi:\n\n        Kinv * qi\nvi = ---------------\n     || Kinv * qi ||\n\n(qi in homogeneous coordinates)\n\nIn summary, we're unprojecting the qi's to recover the lines of sight.\n\nWe want (R,t), a rigid transform of T that is consistent with the observations of\nthe camera (from image A to B). R is a 3x3 rotation matrix. t is a 3x1 translation\nvector. Notice that if we apply that transform to the ui's, the 3D points of image\nA, we'll get points somewhere along the vi's, the lines of sight of image B:\n\nR * ui + t = si * vi\n\nfor some constant si > 0 (points are in front of the camera).\n\nIn the presence of noise, this won't be an equality. Write ri = R * ui + t - si * vi,\nwhere ri is a residual vector. This inspires us to write the following cost function:\n\n~E(R,t) = sum_i of ||ri||^2 = sum_i of ri'ri\n\nthe si's are unknown at this moment.\n\n\n\n3. Separating translation and rotation\n--------------------------------------\n\nWe'll find the rotation and the translation separately. By computing the derivative\nof ~E(R,t) w.r.t t and setting it to zero, we find the optimal translation vector:\n\n0 = 2 * n * t + 2 * sum_i of ( R * ui - si vi ), meaning that\n\nt = [ (1/n) * sum_i of (si * vi) ] - R * ^u\n\nwhere ^u is the centroid of the ui's, i.e.,\n\n^u = (1/n) sum_i of ui\n\nSo far so good. For all i, let's define point #ui as:\n\n#ui = ui - ^u\n\nPoints { #ui } define a space centered at ^u. We'll use them to write a minimization\nproblem for the rotation alone.\n\nI have just shown that, for all j, sj * vj = R * uj + t for some constant sj > 0 when\nignoring the noise. Substituting t by the optimal translation vector, we get\n\nsj * vj =\nR * uj + t =\nR * uj + [ (1/n) * sum_i of (si * vi) ] - R ^u =\nR * (uj - ^u) + [ (1/n) * sum_i of (si * vi) ] =\nR * #uj + [ (1/n) * sum_i of (si * vi) ]\n\nTherefore, we find that R * #uj = sj * vj - [ (1/n) * sum_i of (si * vi) ] or,\nequivalently, that\n\nR * #uj = s0 * [ (sj/s0) * vj - (1/n) * sum_i of ( (si/s0) * vi ) ]\n\nwhere s0 is some element of { sk | k = 1, 2, ..., n }. Note that s0 > 0 by design.\n\nFor simplicity, let's define, for all j, unit vector #vj as follows:\n\n         (sj/s0) * vj - (1/n) sum_i of ( (si/s0) * vi )\n#vj = ----------------------------------------------------\n      || (sj/s0) * vj - (1/n) sum_i of ( (si/s0) * vi ) ||\n\nWe may then rewrite the above equation to\n\nR * #uj = c * #vj\n\nwhere c is the constant s0 * || (sj/s0) * vj - (1/n) sum_i of ( (si/s0) * vi ) ||\n\nSo far so good! Now, the projection of R * #uj onto unit vector #vj is given by\n#vj * ( #vj' R*#uj ) = (#vj * #vj') * R*#uj. We'll use this result to define the\nfollowing difference for all j:\n\nDj = R * #uj - projection of (R * #uj) onto #vj\nDj = R * #uj - (#vj * #vj') * R * #uj\nDj = (I - #vj * #vj') * (R * #uj)\n\nThe intent here is to minimize the distance between the rotated points and the\nlines of sight. This inspires us to write the following cost function:\n\n^E = sum_j of ||Dj||^2 = sum_j of Dj'Dj\n\nWe'll find R by minimizing ^E. We have successfully separated the problem of\nfinding the rigid transform into two: first, we'll find the rotation. Later,\nwe'll find the translation. Note that the ratios sj/s0 are unknown at this point.\nThey represent a relative distance between the points. We need them before we can\nminimize ^E.\n\n\n\n4. Model space magic\n--------------------\n\nOur goal now is to find the ratios sj/s0 for all j. We'll start by selecting a\npivot point u0 in { u1, ..., un } of the planar target. u0 is the origin of the\nmodel space.\n\nAny point ut can be converted from view space to model space by writing ut - u0.\nPick two non-pivot points, ui and uj. It turns out that < u0, { ui-u0, uj-u0 } >\nforms a basis in model space (if the points are colinear, we exit with an error).\nThis means that any point uk-u0 in model space can be expressed as a linear\ncombination of ui-u0 and uj-u0:\n\nuk-u0 = ai * (ui-u0) + aj * (uj-u0)\n\nAll ut's are at Z = z0 by design. Consequently, this is a system of 2 linear\nequations and 2 unknowns. We can trivially solve it for ai and aj.\n\nThey key insight here is that, no matter what the rigid transform (R,t) is,\npoints in model space are not affected by it. Another way of saying this is:\nai and aj are unaffected by the rigid transform! This is the magic that lets\nus write:\n\nR * (uk-u0) = R * (ai * (ui-u0) + aj * (uj-u0))\nR*uk - R*u0 = ai * (R*ui - R*u0) + aj * (R*uj - R*u0)\nR*uk - R*u0 + t - t = ai * (R*ui - R*u0 + t - t) + aj * (R*uj - R*u0 + t - t)\n(R*uk+t) - (R*u0+t) = ai * ((R*ui+t) - (R*u0+t)) + aj * ((R*uj+t) - (R*u0+t))\nsk vk - s0 v0 = ai * (si vi - s0 v0) + aj * (sj vj - s0 v0)\n\nNow, we divide this equation by s0 and regroup:\n\n(ai + aj - 1) v0 = (si/s0) ai vi + (sj/s0) aj vj - (sk/s0) vk\n\nThis is a system of 3 linear equations and 3 unknowns: si/s0, sj/s0 and sk/s0.\nWe can trivially solve it.\n\nOkay, we have found 3 ratios. However, we need all ratios. We can repeat this\nprocedure with other points, but let's investigate a different way as a curiosity.\n\n(((\n    \nBy the way...\n\nWe can compute s0 by noticing that the squared distance ||ui-u0||^2 is known:\n\n||ui-u0||^2 = (*)\n||si vi - s0 v0||^2 =\n(si vi - s0 v0)'(si vi - s0 v0) =\nsi^2 - 2 si s0 vi'v0 + s0^2 =\ns0^2 * ((si/s0)^2 - 2 vi'v0 (si/s0) + 1)\n\nTherefore, s0 = sqrt( ||ui-u0||^2 / ((si/s0)^2 - 2 vi'v0 (si/s0) + 1) ). Now\nwe can recover si, sj and sk.\n\n(*) note that a rigid transform preserves distances: ||(Rp + t) - (Rq + t)||^2 =\n||Rp - Rq||^2 = ||R(p-q)||^2 = [R(p-q)]'[R(p-q)] = (p-q)'R'R(p-q) = (p-q)'I(p-q) =\n(p-q)'(p-q) = ||p-q||^2.\n\n)))\n\n\n\n5. Normal vector\n----------------\n\nSuppose that all points of the planar target in view space are perfectly noiseless,\nand that they all belong to the plane ax + by + cz + d = 0. N = [a b c]' is a normal\nvector to the plane and d is an offset value. If (sj vj) and (s0 v0) belong to the\nplane, then it follows that N'(sj vj) = N'(s0 v0) = -d. Therefore, we have the ratio:\n\n sj     N'v0\n---- = ------\n s0     N'vj\n\nIf we have a normal vector, we can quickly compute any ratio. A normal vector can be\ncomputed by taking the cross product between any non-parallel vectors in model space,\nsay, (si vi - s0 v0) and (sj vj - s0 v0). Let's call that ^N:\n\n^N = (si vi - s0 v0) x (sj vj - s0 v0) =\n[ s0 ((si/s0) vi - v0) ] x [ s0 ((sj/s0) vj - v0) ] =\ns0^2 * [ ((si/s0) vi - v0) x ((sj/s0) vj - v0 ) ] =\ns0^2 * #N\n\nwhere #N = ((si/s0) vi - v0) x ((sj/s0) vj - v0)\n\nNote that ^N and #N are parallel. Since we know si/s0 and sj/s0 from the previous\nstep, we can just compute #N and normalize it as a convenience. That's our normal\nvector:\n\n       #N\nN = --------\n    || #N ||\n\nNow we can quickly find any ratio.\n\nQuestion: when does N'vj = 0 ? When N'(sj vj) = 0 = d. In other words, the plane\npasses through the origin of view space (optical center). That's a degenerate case!\nIt doesn't happen in practice: we can't detect points that way.\n\nHere we need a word of caution. In practice, points have noise. If the normal vector\nis noisy, then the ratios will be noisy, which means that the entire estimated pose\nwill be noisy. This can be remedied with a RANSAC scheme, but it's not really robust.\n\n\n\n6. Finding the rotation\n-----------------------\n\nRecall that we wish to find the rotation matrix R by minimizing the cost function ^E:\n\n^E = sum_j of ||Dj||^2 = sum_j of Dj'Dj\n\nwhere Dj = (I - #vj * #vj') * (R * #uj)\n\nSince we know all ratios sj/s0, we can compute all #vj's. Cool! Now let's expand ^E:\n\n^E = sum_j of [ (R * #uj)' * (I - #vj * #vj')' (I - #vj * #vj') * (R * #uj) ] =\nsum_j of [ (R * #uj)' * (I - #vj * #vj') * (R * #uj) ] = ... =\nsum_j of [ #uj' * #uj - ( #vj' * R * #uj )^2 ]\n\nMinimizing ^E is equivalent to maximizing G = sum_j of ( #vj' * R * #uj )^2. Clearly,\nG is maximized when all #vj and R * #uj are parallel (dot product => cosine = +-1).\nIf R* maximizes G, then so does -R*. It turns out that we're only interested in one\nrotation: the one that maximizes the dot product #vj' * ( R * #uj ). That's because\nthe planar target is expected to be in front of the image plane. So, let's rewrite\nthe rotation problem as:\n\nfind R such that the scalar G(R) = sum_j of ( #vj' * R * #uj ) is maximized.\n\nWe could write R in terms of a unit quaternion and solve this problem numerically.\nHowever, let's explore a different approach that is faster (and elegant!)\n\n\n\n7. Quaternions\n--------------\n\nIn this section, we explore an elegant derivation inspired by the paper: \"Closed-form\nsolution of absolute orientation using unit quaternions\" (B.K.P. Horn). There is a\nlecture on YouTube about this subject by the author: https://youtu.be/kigLhcTm_gg\nEven though I'm using a different convention for quaternions when compared to the\npaper, the spirit of the idea is the same. The specific matrices change a bit. We're\nrelating points to rays rather than points to points as in the paper, but that's ok.\n\nThe key insight in the derivation that follows is that quaternion multiplication can\nbe expressed as matrix multiplication (see quaternion.ts for details). Here I'll be\nusing the same notation to express quaternions and 3D vectors; the appropriate object\ncan be inferred by the context. A 3D vector can be expressed as a pure quaternion,\ni.e., a quaternion (x,y,z,w) whose real part is zero (w = 0).\n\nLet's take the scalar Gj = #vj' * R * #uj. If q is a unit quaternion representing R,\nthen this same scalar can be rewritten as #vj' * ( q * #uj * q* ), where q* denotes\nthe conjugate of q. From quaternion.ts, we can rewrite this again as a multiplication\nof matrices: Gj = #vj' * ( Qr' * Ql * #uj ), where\n\n     [  w  -z   y   x  ]           [  w  -z   y  -x  ]\nQl = [  z   w  -x   y  ] and Qr' = [  z   w  -x  -y  ]\n     [ -y   x   w   z  ]           [ -y   x   w  -z  ]\n     [ -x  -y  -z   w  ]           [  x   y   z   w  ]\n\nSince matrix multiplication is associative, we have Gj = (#vj' * Qr') * (Ql * #uj),\nor equivalently, Gj = (Qr * #vj)' * (Ql * #uj) = (#vj * q)' * (q * #uj). Since both\n#uj and #vj are viewed as quaternions, we can convert this quaternion multiplication\nto matrix multiplication: Gj = (#Vjl * q)' * (#Ujr * q) = q' * ( #Vjl' * #Ujr ) * q.\nHere, q is a 4x1 column vector and ( #Vjl' * #Ujr ) is a known 4x4 matrix. The cost\nfunction G is just the sum_j of Gj. Therefore, the problem can be rewritten as:\n\nfind a unit quaternion q such that G(q) = q' * M * q is maximized,\n\nwhere M = sum_j of ( #Vjl' * #Ujr ).\n\nWhat an elegant formulation!\n\nAfter a few algebraic manipulations, we find M to be a symmetric matrix of this form:\n\n    [ xx-yy   xy+yx  zx      zy    ]\nM = [ xy+yx  -xx+yy  zy     -zx    ]\n    [ zx      zy    -xx-yy  -xy+yx ]\n    [ zy     -zx    -xy+yx   xx+yy ]\n\nwhere\n\nxx = sum_j of #vj.x * #uj.x\nxy = sum_j of #vj.x * #uj.y\nyx = sum_j of #vj.y * #uj.x\n...\nand so on.\n\nNote that #uj.z = 0 for all j because uj.z = z0 for all j. This result is not\nexactly the same as that of the paper; it's a simpler one, because we're only\nconcerned with a planar target.\n\nOkay, all good! Now fasten your seatbelts! Get ready for the icing of the cake!\n\n\n\n8. Eigenvalues\n--------------\n\nLet A be a symmetric matrix and x be a compatible column-vector. Suppose we wish to\nmaximize the scalar f(x) = x'Ax subject to the constraint ||x||^2 = x'x = 1. We can\nemploy the method of Lagrange multipliers. The Lagrangian of f is given by:\n\nL(x,t) = x'Ax - t(x'x - 1), where t is the Lagrange multiplier.\n\nLet's take the derivative of L with respect to x and set it to zero:\n\ndL/dx = (A + A')x - t(2 x) = 2 A x - 2 t x = 2(Ax - tx) = 0\n\nIn other words, Ax = tx. This is an eigenvalue problem!\n\nIf we wish to maximize f, we pick an eigenvector corresponding to the largest\neigenvalue of A. If we wish to minimize f, we pick an eigenvector corresponding\nto the smallest eigenvalue of A.\n\nSo, going back to the problem finding a rotation, we'll follow this recipe:\n\na) find the largest eigenvalue of M\nb) find a corresponding eigenvector\nc) normalize the eigenvector to get a unit quaternion\nd) convert the unit quaternion to a rotation matrix\n\nAND WE'RE DONE!\n\nYEAH!!!!!!!!!!!\n\nNow check this out: M is a 4x4 matrix of a particular form. We can compute its\ncharacteristic polynomial to find its eigenvalues: we'll see a quartic equation.\nI'll spare the reader (and myself) of the long algebraic details, but it turns\nout that this quartic equation is actually a biquadratic equation (!!!!!!!!!!!)\nthat is readily and easily solvable! Sweet!\n\nOnce we compute the rotation matrix R, we can recover the translation vector t\nas I explained earlier. Now we've found (R,t) with a quick analytic solution!\n\n*/\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { Utils, Nullable } from '../utils/utils';\nimport { IllegalArgumentError } from '../utils/errors';\n\n\n\n/** A guess of the width of the imaging sensor */\nconst DEFAULT_SENSOR_WIDTH_IN_METERS = 5 * 0.001; // 5 mm\n\n/** A guess of the width of the planar target */\nconst DEFAULT_TARGET_WIDTH_IN_METERS = 20 * 0.01; // 20 cm\n\n/** Whether or not to use a normal vector to find the relative distances between the points */\nconst USE_NORMAL_VECTOR = false;\n\n/** Small number */\nconst EPSILON = 1e-8;\n\n/** Debug flag */\nconst DEBUG = false;\n\n\n\n/** \"Static\" variables used by the mathematical method\n    (this is to avoid too many memory allocations) */\n\n/** Tiny Matrix type */\ntype TinyMatrix = Float64Array & { _rows: number, _cols: number };\n\n/** Maximum number of data points */\nconst MAX_POINTS = 1024;\n\n// solvePlanarPnP\nconst INVALID_POSE = Speedy.Matrix(3, 4, new Array<number>(12).fill(Number.NaN));\nconst Kinv = mat3(0);\nconst p = Array.from({ length: MAX_POINTS }, () => vec3(0));\nconst q = Array.from({ length: MAX_POINTS }, () => vec3(0));\nconst u = Array.from({ length: MAX_POINTS }, () => vec3(0));\nconst v = Array.from({ length: MAX_POINTS }, () => vec3(0));\nconst uc = Array.from({ length: MAX_POINTS }, () => vec3(0));\nconst vc = Array.from({ length: MAX_POINTS }, () => vec3(0));\nconst sjs0 = new Array<number>(MAX_POINTS).fill(0);\nconst uhat = vec3(0), vhat = vec3(0), vstar = vec3(0);\nconst A = mat3(0), invA = mat3(0), b = vec3(0), eigenvec = vec3(0);\nconst R = mat3(0), quaternion = vec4(0), Ruhat = vec3(0);\nconst centroid = vec3(0), t = vec3(0);\nconst pose = new Array<number>(12).fill(0);\n\n// findNormalVector, findRatios\nconst wi = vec3(0), wj = vec3(0), wk = vec3(0);\nconst _b = vec3(0), _A = mat3(0), _invA = mat3(0), _x = vec3(0);\nconst ri = vec3(0), rj = vec3(0), nvec = vec3(0);\n\n// buildHomography, computeReprojectionError\nconst H = mat3(0), invH = mat3(0);\nconst M = mat3x4(0), rt = mat3(0), A4 = mat4(0);\n\n\n\n\n/** Options for the RANSAC scheme */\nexport interface solvePlanarPnPRansacOptions\n{\n    /** maximum number of models to be generated */\n    numberOfHypotheses?: number;\n\n    /** reprojection error threshold for a point to be considered an outlier */\n    reprojectionError?: number;\n\n    /** a value used to exit early if a good percentage of inliers is found */\n    acceptablePercentageOfInliers?: number;\n\n    /** output mask of inliers */\n    mask?: Nullable<SpeedyMatrix>;\n}\n\n/** Options for find6DoFHomography() */\nexport interface find6DoFHomographyOptions extends solvePlanarPnPRansacOptions\n{\n    /** quality of the refinement: a value in [0,1] */\n    refinementQuality?: number;\n}\n\n/** Default options for the RANSAC scheme */\nconst DEFAULT_RANSAC_OPTIONS: Required<solvePlanarPnPRansacOptions> = {\n    numberOfHypotheses: 100,\n    reprojectionError: 3,\n    acceptablePercentageOfInliers: Number.POSITIVE_INFINITY, // never exit early\n    mask: null,\n};\n\n/** Default options for find6DoFHomography() */\nconst DEFAULT_FIND6DOFHOMOGRAPHY_OPTIONS: Required<find6DoFHomographyOptions> = Object.assign(\n    {}, DEFAULT_RANSAC_OPTIONS, {\n        refinementQuality: 1.0\n    }\n);\n\n\n\n\n/**\n * Perspective-N-Point for planar tracking. Requires n >= 4 points.\n * @param referencePoints 2 x n matrix with reference points in a plane parallel to the image plane (Z = z0 > 0)\n * @param observedPoints 2 x n matrix with the observed points corresponding to the reference points\n * @param cameraIntrinsics 3x3 matrix\n * @returns 3x4 [ R | t ] matrix describing the pose of the planar target in view space, or a matrix of NaNs if no pose is found\n */\nexport function solvePlanarPnP(referencePoints: SpeedyMatrix, observedPoints: SpeedyMatrix, cameraIntrinsics: SpeedyMatrix): SpeedyMatrix\n{\n    // sanity check\n    if(referencePoints.rows != 2 || observedPoints.rows != 2 || referencePoints.columns != observedPoints.columns)\n        throw new IllegalArgumentError('Bad input');\n    else if(cameraIntrinsics.rows != 3 || cameraIntrinsics.columns != 3)\n        throw new IllegalArgumentError('Bad intrinsics');\n\n    // we require at least 4 points\n    let n = referencePoints.columns;\n    if(n < 4)\n        throw new IllegalArgumentError('solvePlanarPnP requires at least 4 points');\n    else if(n > MAX_POINTS)\n        n = MAX_POINTS;\n\n    // invert the intrinsics matrix\n    const K = cameraIntrinsics.read();\n    const fx = K[0], fy = K[4], cx = K[6], cy = K[7];\n    Kinv[0] = 1/fx;\n    Kinv[4] = 1/fy;\n    Kinv[6] = -cx/fx;\n    Kinv[7] = -cy/fy;\n    Kinv[8] = 1;\n\n    // reference points belong to the target plane,\n    // which is parallel to the image plane located at Z = f\n    const z0 = getZ0(fx);\n\n    // convert input to homogeneous coordinates\n    const P = referencePoints.read(), Q = observedPoints.read();\n    for(let i = 0, j = 0; i < n; i++, j += 2) {\n        const pi = p[i], qi = q[i];\n\n        pi[0] = P[j];\n        pi[1] = P[j+1];\n        pi[2] = 1;\n\n        qi[0] = Q[j];\n        qi[1] = Q[j+1];\n        qi[2] = 1;\n    }\n\n    // unproject pi's to get ui's, coplanar points at Z = z0\n    for(let i = 0; i < n; i++) {\n        mul(u[i], Kinv, p[i]);\n        scale(u[i], u[i], z0);\n    }\n\n    // unproject qi's and normalize to get the lines of sight\n    for(let i = 0; i < n; i++) {\n        mul(v[i], Kinv, q[i]);\n        normalize(v[i], v[i]);        \n    }\n\n    // find u^, the centroid of ui's\n    uhat[0] = uhat[1] = uhat[2] = 0;\n    for(let i = 0; i < n; i++) {\n        const ui = u[i];\n        uhat[0] += ui[0];\n        uhat[1] += ui[1];\n        uhat[2] += ui[2];\n    }\n    uhat[0] /= n;\n    uhat[1] /= n;\n    uhat[2] /= n;\n\n    // find uc's\n    for(let i = 0; i < n; i++)\n        sub(uc[i], u[i], uhat);\n\n    // find the relative distances between the points\n    if(USE_NORMAL_VECTOR) {\n\n        // find a normal vector to the plane in view space\n        const normal = findNormalVector(u, v, n);\n        if(Number.isNaN(normal[0]))\n            return INVALID_POSE;\n\n        // find the ratios sj/s0 for all j\n        const nv0 = dot(normal, v[0]);\n        for(let j = 0; j < n; j++)\n            sjs0[j] = nv0 / dot(normal, v[j]);\n\n    }\n    else {\n\n        // find the ratios sj/s0 for all j\n        sjs0[0] = 1;\n        for(let k = 3; k < n; k += 3) {\n            const o = 0, i = k-2, j = k-1;\n            const ratios = findRatios(u, v, n, o, i, j, k);\n\n            if(Number.isNaN(ratios[0]))\n                return INVALID_POSE;\n\n            sjs0[i] = ratios[0];\n            sjs0[j] = ratios[1];\n            sjs0[k] = ratios[2];\n\n            if(k+3 >= n)\n                k -= 2; // change the increment of k to +1\n        }\n\n    }\n\n    /*\n    DEBUG && print({\n        sjs0: sjs0.slice(0, n).join(',')\n    });\n    */\n\n    // find v^, the centroid (up to a scale) of the transformed points\n    vhat[0] = vhat[1] = vhat[2] = 0;\n    for(let i = 0; i < n; i++) {\n        const vi = v[i];\n        const sis0 = sjs0[i];\n\n        vhat[0] += sis0 * vi[0];\n        vhat[1] += sis0 * vi[1];\n        vhat[2] += sis0 * vi[2];\n    }\n    vhat[0] /= n;\n    vhat[1] /= n;\n    vhat[2] /= n;\n\n    // find vc's\n    for(let j = 0; j < n; j++) {\n        scale(vstar, v[j], sjs0[j]);\n        sub(vstar, vstar, vhat);\n        normalize(vc[j], vstar);\n    }\n\n    /*\n    DEBUG && print({\n        helpers: {\n            v0: v[0],\n            nv0,\n            sjs0,\n            uhat,\n            vhat,\n            uc,\n            vc,\n        }\n    });\n    */\n\n    // compute the factors of M\n    let xx = 0, yy = 0, xy = 0, yx = 0, zx = 0, zy = 0;\n    for(let j = 0; j < n; j++) {\n        const ucj = uc[j];\n        const vcj = vc[j];\n\n        xx += vcj[0] * ucj[0];\n        yy += vcj[1] * ucj[1];\n        xy += vcj[0] * ucj[1];\n        yx += vcj[1] * ucj[0];\n        zx += vcj[2] * ucj[0];\n        zy += vcj[2] * ucj[1];\n    }\n\n    /*\n    DEBUG && print({\n        M: mat4([\n            xx-yy, xy+yx, zx, zy,\n            xy+yx, -xx+yy, zy, -zx,\n            zx, zy, -xx-yy, -xy+yx,\n            zy, -zx, -xy+yx, xx+yy,\n        ]),\n    });\n    */\n\n    // find the largest eigenvalue of M\n    const xx2 = xx*xx, yy2 = yy*yy, xy2 = xy*xy, yx2 = yx*yx, zx2 = zx*zx, zy2 = zy*zy;\n    const delta = xx2 * (yy2 + zy2) + xy2 * (yx2 + zx2) + yx2*zy2 + yy2*zx2 - 2 * (xx*xy * (yx*yy + zx*zy) + yx*yy*zx*zy);\n    const eigenval = Math.sqrt(xx2 + xy2 + yx2 + yy2 + zx2 + zy2 + 2 * Math.sqrt(delta));\n\n    // find an eigenvector corresponding to the largest eigenvalue of M\n    // (we arbitrarily set its last entry to 1; if there is no rotation, then we expect its other entries to be 0)\n    A[0] = xx-yy-eigenval;\n    A[1] = xy+yx;\n    A[2] = zx;\n    A[3] = xy+yx;\n    A[4] = -xx+yy-eigenval;\n    A[5] = zy;\n    A[6] = zx;\n    A[7] = zy;\n    A[8] = -(xx+yy+eigenval);\n\n    b[0] = -zy;\n    b[1] = zx;\n    b[2] = xy-yx;\n\n    /*\n    DEBUG && print({\n        eigen: {\n            eigenval,\n            A, detA: determinant(A),\n            b\n        }\n    });\n    */\n\n    mul(eigenvec, inverse(invA, A), b); // solve Ax = b\n    if(Number.isNaN(eigenvec[0]))\n        return INVALID_POSE;\n\n    // build a unit quaternion\n    const qx = eigenvec[0], qy = eigenvec[1], qz = eigenvec[2], qw = 1;\n    const qlen = Math.sqrt(qx*qx + qy*qy + qz*qz + qw*qw);\n    quaternion[0] = qx / qlen;\n    quaternion[1] = qy / qlen;\n    quaternion[2] = qz / qlen;\n    quaternion[3] = qw / qlen;\n\n    /*\n    DEBUG && print({\n        rotation: {\n            eigenval,\n            eigenvec,\n            quaternion\n        }\n    });\n    */\n\n    // find s0, the distance between the pivot and the optical center\n    const h = findFarthestPointIndex(u, n, 0);\n    const shs0 = sjs0[h];\n    const vhv0 = dot(v[h], v[0]);\n    const lh0 = distance2(u[h], u[0]);\n    const s02 = lh0 / (shs0 * (shs0 - 2 * vhv0) + 1);\n    const s0 = Math.sqrt(s02);\n\n    /*\n    // find s0, the distance between the pivot and the optical center\n    const s02guess = new Array<number>(n-1);\n    for(let h = 1; h < n; h++) {\n        const shs0 = sjs0[h];\n        const vhv0 = dot(v[h], v[0]);\n        const lh0 = distance2(u[h], u[0]);\n        const s02 = lh0 / (shs0 * (shs0 - 2 * vhv0) + 1);\n        s02guess[h-1] = s02;\n    }\n    s02guess.sort((a,b) => a-b);\n    const s02 = s02guess[(n-1) >>> 1]; // median\n    const s0 = Math.sqrt(s02);\n    */\n\n    /*\n    DEBUG && print({\n        distance: {\n            s0, s02\n        }\n    });\n    */\n\n    // compute the rotation matrix R\n    quat2mat(R, quaternion);\n\n    // compute the translation vector t (up to a scale)\n    scale(centroid, vhat, s0);\n    sub(t, centroid, mul(Ruhat, R, uhat));\n\n    // build the pose [ R | t ]\n    for(let i = 0; i < 9; i++)\n        pose[i] = R[i];\n    for(let i = 0; i < 3; i++)\n        pose[9+i] = t[i];\n\n    /*\n    DEBUG && print({\n        pose: mat3x4(pose)\n    });\n    */\n\n    // done!\n    return Speedy.Matrix(3, 4, pose);\n}\n\n/**\n * Perspective-N-Point for planar tracking with RANSAC. Requires n >= 4 points.\n * @param referencePoints 2 x n matrix with reference points in a plane parallel to the image plane (Z = z0 > 0)\n * @param observedPoints 2 x n matrix with the observed points corresponding to the reference points\n * @param cameraIntrinsics 3x3 matrix\n * @param options RANSAC options\n * @returns 3x4 [ R | t ] matrix describing the pose of the planar target in view space, or a matrix of NaNs if no pose is found\n */\nexport function solvePlanarPnPRansac(referencePoints: SpeedyMatrix, observedPoints: SpeedyMatrix, cameraIntrinsics: SpeedyMatrix, options: solvePlanarPnPRansacOptions = {}): SpeedyMatrix\n{\n    const settings = Object.assign({}, DEFAULT_RANSAC_OPTIONS, options);\n    const numberOfHypotheses = settings.numberOfHypotheses;\n    const threshold = settings.reprojectionError;\n    const acceptablePercentageOfInliers = settings.acceptablePercentageOfInliers;\n    const outputMask = settings.mask;\n\n    const n = referencePoints.columns;\n    if(n < 4)\n        throw new IllegalArgumentError('solvePlanarPnP requires at least 4 points');\n\n    const K = mat3(cameraIntrinsics.read()), E = mat3x4(0);\n    const mask = new Array<number>(n);\n    mask.fill(0);\n\n    const src = referencePoints.read();\n    const dest = observedPoints.read();\n    const permutation = Utils.range(n); // vector of indices\n\n    const p = new Array<number>(2*4), q = new Array<number>(2*4);\n    let mp = Speedy.Matrix.Zeros(2, 4), mq = Speedy.Matrix.Zeros(2, 4);\n\n    let bestError = Number.POSITIVE_INFINITY;\n    let bestPose = INVALID_POSE;\n\n    for(let i = 0; i < numberOfHypotheses; i++) {\n\n        // Preprocessing\n        // Set p = shuffled referencePoints and q = shuffled observedPoints\n        Utils.shuffle(permutation);\n        reorderPoints4(mp, mq, p, q, src, dest, permutation);\n\n        // Generate a model with 4 points only\n        const pose = solvePlanarPnP(mp, mq, cameraIntrinsics);\n        E.set(pose.read()); //E.set(pose.data);\n        const homography = buildHomography(K, E);\n\n        // Evaluate the model against the entire dataset\n        const error = computeReprojectionError(homography, src, dest, threshold, mask);\n\n        /*\n        DEBUG && print({\n            ransac: {\n                iteration: i+1,\n                pose: mat3x4(pose.read()),\n                error,\n                homography,\n            }\n        });\n        */\n\n        // Count the inliers\n        let count = 0;\n        for(let j = 0; j < n; j++)\n            count += mask[j];\n\n        /*\n        DEBUG && print({\n            ransac: {\n                iteration: i+1,\n                inliers: count,\n                percentageOfInliers: 100 * count / n\n            }\n        });\n        */\n\n        /*\n        // Insufficient inliers? Discard the model\n        if(count < 4)\n            continue;\n        */\n\n        // We don't generate a new model with all the inliers. We can expect a\n        // coarse estimate of the intrinsics K. The model will need refinement.\n        // We're just using n = 4. We'll refine the homography later.\n        const newPose = pose;\n        const newError = error;\n        //const newError = n - count;\n\n        // Not the best model? Discard it\n        if(newError > bestError)\n            continue;\n\n        // This is the best model so far!\n        bestError = newError;\n        bestPose = newPose;\n\n        /*\n        const newHomography = homography;\n        DEBUG && print({\n            ransac: {\n                iteration: i+1,\n                bestPose: mat3x4(bestPose.read()),\n                bestError,\n                newHomography,\n            }\n        });\n        */\n\n        // Exit early?\n        if(count / n >= acceptablePercentageOfInliers)\n            break;\n\n    }\n\n    // set the output mask of inliers\n    if(outputMask != null)\n        outputMask.setToSync(Speedy.Matrix(1, n, mask));\n\n    // done!\n    return bestPose;\n}\n\n/**\n * Find a homography matrix with 6 degrees of freedom (rotation and translation) instead of the usual 8 of the DLT\n * @param referencePoints 2 x n matrix with reference points in a plane parallel to the image plane (Z = z0 > 0)\n * @param observedPoints 2 x n matrix with the observed points corresponding to the reference points\n * @param cameraIntrinsics 3x3 matrix\n * @param options options\n * @returns 3x3 homography matrix or a matrix of NaNs if no suitable homography is found\n */\nexport function find6DoFHomography(referencePoints: SpeedyMatrix, observedPoints: SpeedyMatrix, cameraIntrinsics: SpeedyMatrix, options: find6DoFHomographyOptions = {}): SpeedyPromise<SpeedyMatrix>\n{\n    const n = referencePoints.columns;\n    const settings = Object.assign({}, DEFAULT_FIND6DOFHOMOGRAPHY_OPTIONS, options);\n    const refinementQuality = Math.max(0, Math.min(settings.refinementQuality, 1));\n    const reprojectionError = settings.reprojectionError;\n    const mask = settings.mask;\n\n    // validate\n    if(n < 4)\n        return Speedy.Promise.reject(new IllegalArgumentError('find6DofHomography() requires at least 4 points'));\n    else if(referencePoints.columns != observedPoints.columns || referencePoints.rows != 2 || observedPoints.rows != 2)\n        return Speedy.Promise.reject(new IllegalArgumentError('Bad input'));\n    else if(cameraIntrinsics.columns != 3 || cameraIntrinsics.rows != 3)\n        return Speedy.Promise.reject(new IllegalArgumentError('Bad intrinsics'));\n\n    // find a pose. 6DoF: 3 for rotation + 3 for translation\n    const pose = solvePlanarPnPRansac(referencePoints, observedPoints, cameraIntrinsics, options);\n\n    /*\n    DEBUG && print({\n        find6DoFHomography: {\n            R: pose.block(0, 2, 0, 2).toString(),\n            t: pose.block(0, 2, 3, 3).toString(),\n            //q: new Quaternion()._fromRotationMatrix(pose.block(0, 2, 0, 2)).toString(),\n        }\n    });\n    */\n\n    // build an initial homography\n    const K = mat3(cameraIntrinsics.read());\n    const E = mat3x4(pose.read());\n    const hom = buildHomography(K, E);\n    const entries = Array.from<number>(hom);\n    const homography = Speedy.Matrix(3, 3, entries);\n\n    // quit without refinement (for testing purposes)\n    // we can expect a coarse estimate of the camera intrinsics\n    if(refinementQuality == 0 || Number.isNaN(entries[0]))\n        return Speedy.Promise.resolve(homography);\n\n    // refine the homography with DLT + RANSAC\n    const src = referencePoints, dest = observedPoints;\n    const intermediate = Speedy.Matrix.Zeros(2, n);\n\n    return Speedy.Matrix.applyPerspectiveTransform(intermediate, src, homography)\n    .then(intermediate =>\n        Speedy.Matrix.findHomography(\n            Speedy.Matrix.Zeros(3),\n            intermediate,\n            dest,\n            {\n                method: 'pransac',\n                numberOfHypotheses: Math.ceil(512 * refinementQuality), // XXX we can reduce this number without compromising quality\n                bundleSize: Math.ceil(128 * refinementQuality),\n                reprojectionError: reprojectionError,\n                mask,\n            }\n        )\n    )\n    .then(adjustment =>\n        adjustment.setTo(adjustment.times(homography))\n    );\n}\n\n\n\n\n// ----------------------------------------------------------------------------\n// private stuff\n// ----------------------------------------------------------------------------\n\n\n\n\n/**\n * Build a homography matrix\n * @param K 3x3 intrinsics\n * @param E 3x4 extrinsics\n * @returns 3x3 homography as a TinyMatrix\n */\nfunction buildHomography(K: TinyMatrix, E: TinyMatrix): TinyMatrix\n{\n    const fx = K[0], fy = K[4], cx = K[6], cy = K[7];\n    const z0 = getZ0(fx);\n\n    /*\n\n    Convert points from 2D image space to 3D view space\n\n    1. unproject by inverting K\n    2. scale by z0 (similar triangles)\n    3. translate Z=0 (input points) to Z=z0 (target plane in view space)\n\n    so let's pre-multiply the input points by\n\n    [ 1   0   0   0 ]   [ z0   0   0   0 ]   [ 1/fx   0     0  -cx/fx ]\n    [ 0   1   0   0 ] * [  0  z0   0   0 ] * [  0    1/fy   0  -cy/fy ]\n    [ 0   0   1  z0 ]   [  0   0  z0   0 ]   [  0     0     1     0   ]\n    [ 0   0   0   1 ]   [  0   0   0   1 ]   [  0     0     0     1   ]\n        translate             scale                  unproject\n\n    each input point is thought of as a 4x1 homogeneous column vector with its\n    third coordinate set to zero (i.e., input points are given at Z=0).\n\n    Note: in practice, points are given as 3x1 homogeneous vectors because Z=0.\n\n    */\n\n    // pre-multiply the input points by this adjustment matrix\n    //A4.fill(0);\n    A4[0] = z0/fx;\n    A4[5] = z0/fy;\n    A4[10] = z0;\n    A4[12] = -cx*z0/fx;\n    A4[13] = -cy*z0/fy;\n    A4[14] = z0;\n    A4[15] = 1;\n\n    // compose with the pose. The result M is 3x4\n    mul(M, E, A4);\n\n    // remove the third column from the extrinsics matrix\n    // (input points are always given at Z=0)\n    rt[0] = M[0]; // r1\n    rt[1] = M[1];\n    rt[2] = M[2];\n    rt[3] = M[3]; // r2\n    rt[4] = M[4];\n    rt[5] = M[5];\n    rt[6] = M[9]; // t\n    rt[7] = M[10];\n    rt[8] = M[11];\n\n    // build the homography by rotating, translating and projecting 3D points\n    // back to 2D image space\n    mul(H, K, rt);\n\n    // normalize it?\n    const scale = 1 / H[8];\n    for(let i = 0; i < 9; i++)\n        H[i] *= scale;\n\n    // done!\n    return H;\n}\n\n/**\n * Given a homography matrix and n correspondences (pi, qi), compute the reprojection error\n * @param homography 3x3 homography matrix\n * @param src reference points as a 2 x n matrix\n * @param dest observed points as a 2 x n matrix\n * @param threshold for a point to be considered an outlier\n * @param mask inliers mask (output)\n * @returns a measure of the error (less is better)\n */\nfunction computeReprojectionError(homography: TinyMatrix, src: number[], dest: number[], threshold: number = 3, mask: number[] = []): number\n{\n    const [ h11, h21, h31, h12, h22, h32, h13, h23, h33 ] = homography;\n    const [ ih11, ih21, ih31, ih12, ih22, ih32, ih13, ih23, ih33 ] = inverse(invH, homography);\n    const n = src.length / 2;\n    const thr2 = threshold * threshold;\n    let totalError = 0;\n\n    mask.length = n;\n    mask.fill(0);\n\n    // sanity check\n    if(Number.isNaN(h11 * ih11))\n        return Number.POSITIVE_INFINITY;\n\n    // for each point correspondence (p,q)\n    for(let i = 0, j = 0; i < n; i++, j += 2) {\n        const px = src[j+0];\n        const py = src[j+1];\n        const pz = 1; // homogeneous\n\n        const qx = dest[j+0];\n        const qy = dest[j+1];\n        const qz = 1;\n\n        // compute the reprojection error H*p - q\n        const hpx = h11 * px + h12 * py + h13 * pz;\n        const hpy = h21 * px + h22 * py + h23 * pz;\n        const hpz = h31 * px + h32 * py + h33 * pz;\n\n        const ux = hpx / hpz, uy = hpy / hpz;\n        const vx = qx / qz, vy = qy / qz;\n\n        const dx = ux - vx, dy = uy - vy;\n        const error2 = dx*dx + dy*dy;\n\n        // compute the reprojection error Hinv*q - p\n        const ihqx = ih11 * qx + ih12 * qy + ih13 * qz;\n        const ihqy = ih21 * qx + ih22 * qy + ih23 * qz;\n        const ihqz = ih31 * qx + ih32 * qy + ih33 * qz;\n\n        const iux = ihqx / ihqz, iuy = ihqy / ihqz;\n        const ivx = px / pz, ivy = py / pz;\n\n        const idx = iux - ivx, idy = iuy - ivy;\n        const ierror2 = idx*idx + idy*idy;\n\n        // accumulate\n        totalError += error2 + ierror2;\n        mask[i] = +(error2 < thr2 && ierror2 < thr2); // 1 if this is an inlier\n\n        /*\n        DEBUG && mask[i] && print({\n            reprojectionError: {\n                p: vec3([px,py,pz]),\n                q: vec3([qx,qy,qz]),\n\n                u: vec2([ux,uy]),\n                v: vec2([vx,vy]),\n                error2,\n\n                iu: vec2([iux, iuy]),\n                iv: vec2([ivx, ivy]),\n                ierror2,\n\n                thr2,\n                inlier: mask[i]\n            }\n        });\n        */\n    }\n\n    // return the average error\n    //return Math.sqrt(totalError / n);\n    return totalError / n;\n}\n\n/**\n * Given n 3D points u[i] and a pivot index, find j such that || u[j] - u[pivot] || is maximized\n * @param u points\n * @param pivot index\n * @param n the size of the dataset\n * @returns an index of u\n */\nfunction findFarthestPointIndex(u: TinyMatrix[], n: number, pivot: number = 0): number\n{\n    const u0 = u[pivot];\n\n    if(n > u.length)\n        throw new IllegalArgumentError();\n\n    let maxdist = 0, idx = 0;\n    for(let i = 0; i < n; i++) {\n        const dist = distance2(u0, u[i]);\n\n        if(dist > maxdist) {\n            maxdist = dist;\n            idx = i;\n        }\n    }\n\n    return idx;\n}\n\n/**\n * Find a vector that is perpendicular to the planar target in view space\n * @param u\n * @param v\n * @param n the size of the dataset\n * @returns normal vector with length 1\n */\nfunction findNormalVector(u: TinyMatrix[], v: TinyMatrix[], n: number): TinyMatrix\n{\n    // validate\n    if(u.length < 4 || v.length < 4 || u.length != v.length || n > u.length)\n        throw new IllegalArgumentError();\n\n    // let's pick 4 points from the dataset\n    const o = 0;\n    const i = Math.floor((n-1) / 3);\n    const j = Math.floor((n-1) * 2 / 3);\n    const k = n-1;\n\n    // find the ratios si/s0, sj/s0 and sk/s0\n    const ratios = findRatios(u, v, n, o, i, j, k);\n    if(Number.isNaN(ratios[0]))\n        return vec3(Number.NaN);\n\n    // compute a normal vector\n    const v0 = v[o], vi = v[i], vj = v[j];\n    scale(ri, vi, ratios[0]);\n    sub(ri, ri, v0);\n    scale(rj, vj, ratios[1]);\n    sub(rj, rj, v0);\n    normalize(nvec, cross(nvec, ri, rj));\n\n    /*\n    DEBUG && print({\n        normal: {\n            _x,\n            ri, rj,\n            nvec\n        }\n    });\n    */\n\n    // done!\n    return nvec;\n}\n\n/**\n * Find the ratios si/s0, sj/s0 and sk/s0\n * @param u \n * @param v \n * @param n the size of the dataset\n * @param o index of the pivot\n * @param i index of a point\n * @param j index of a point\n * @param k index of a point\n * @returns the ratios si/s0, sj/s0 and sk/s0\n */\nfunction findRatios(u: TinyMatrix[], v: TinyMatrix[], n: number, o: number, i: number, j: number, k: number): TinyMatrix\n{\n    // validate\n    if(u.length < 4 || v.length < 4 || u.length != v.length || n > u.length)\n        throw new IllegalArgumentError();\n    else if(Math.min(o, i, j, k) < 0 || Math.max(o, i, j, k) >= n)\n        throw new IllegalArgumentError();\n\n    // pick the points from the dataset\n    const u0 = u[o], ui = u[i], uj = u[j], uk = u[k];\n    const v0 = v[o], vi = v[i], vj = v[j], vk = v[k];\n\n    /*\n    DEBUG && print({\n        unprojectedPoints: {\n            u: { u0, ui, uj, uk },\n            v: { v0, vi, vj, vk },\n            phi_0i: angle(v0, vi),\n            phi_0j: angle(v0, vj),\n            phi_0k: angle(v0, vk),\n        }\n    });\n    */\n\n    // let wa be ua - u0 for a in { i, j, k }\n    sub(wi, ui, u0);\n    sub(wj, uj, u0);\n    sub(wk, uk, u0);\n\n    /*\n    DEBUG && print({\n        planeBasis: {\n            wi, wj, wk,\n        }\n    });\n    */\n\n    // find (ai, aj) such that wk = ai wi + aj wj\n    const det2 = wi[0] * wj[1] - wi[1] * wj[0];\n    if(Math.abs(det2) < EPSILON) // wi and wj are colinear\n        return vec3(Number.NaN);\n\n    const ai = (wj[1] * wk[0] - wj[0] * wk[1]) / det2;\n    const aj = (wi[0] * wk[1] - wi[1] * wk[0]) / det2;\n\n    /*\n    DEBUG && print({\n        planePair: {\n            det2,\n            ai, aj,\n        }\n    });\n    */\n\n    // solve Ax = b for x = [ si/s0  sj/s0  sk/s0 ]'\n    const bm = ai + aj - 1;\n\n    _b[0] = bm * v0[0];\n    _b[1] = bm * v0[1];\n    _b[2] = bm * v0[2];\n\n    _A[0] = ai * vi[0],\n    _A[1] = ai * vi[1],\n    _A[2] = ai * vi[2],\n    _A[3] = aj * vj[0],\n    _A[4] = aj * vj[1],\n    _A[5] = aj * vj[2],\n    _A[6] = -vk[0],\n    _A[7] = -vk[1],\n    _A[8] = -vk[2]\n\n    /*\n    DEBUG && print({\n        findRatios: {\n            _A,\n            detA: determinant(_A),\n            _b\n        }\n    });\n    */\n\n    inverse(_invA, _A);\n    mul(_x, _invA, _b);\n    return _x;\n}\n\n/**\n * Find z0, the distance along the Z-axis between the center of projection and\n * the plane of the reference points, which is parallel to the image plane\n * @param fx focal length of the camera\n * @param targetWidthInMeters\n * @param sensorWidthInMeters\n * @returns Z distance\n */\nfunction getZ0(fx: number, targetWidthInMeters: number = DEFAULT_TARGET_WIDTH_IN_METERS, sensorWidthInMeters: number = DEFAULT_SENSOR_WIDTH_IN_METERS): number\n{\n    // Actually, in camera-model.ts, we work with the image plane being measured\n    // in virtual units rather than mm. I'm just picking this number to get a\n    // nice multiplier. The result will be in virtual units rather than meters.\n    const PIXELS_PER_WORLD_UNIT = 20; // XXX NDC\n\n    // fx is the focal length in \"pixels\" (the projection distance in the pinhole model)\n    // It's the same as f * sx, where f is the focal length in world units and\n    // sx is the number of \"pixels\" per world unit\n    // \"pixels\" means image plane units\n    const f = fx / PIXELS_PER_WORLD_UNIT;\n\n    // The ratio between target size and image size in view space.\n    // Since this is set arbitrarily, we can see that the translation\n    // vector returned by solvePlanarPnP() is only defined up to a scale\n    const r = targetWidthInMeters / sensorWidthInMeters;\n\n    // z0 should be greater than fx; vi's should not be ~parallel,\n    // so we pick a small multiplier r\n    const z0 = r * f;\n\n    // done!\n    return z0;\n}\n\n/**\n * Reorder n = 4 points according to a permutation\n * @param mp output\n * @param mq output\n * @param p temporary\n * @param q temporary\n * @param src reference points as a 2 x n matrix\n * @param dest observed points as a 2 x n matrix\n * @param permutation permutation of n indices\n */\nfunction reorderPoints4(mp: SpeedyMatrix, mq: SpeedyMatrix, p: number[], q: number[], src: number[], dest: number[], permutation: number[])\n{\n    const n = 4;\n\n    // validate\n    Utils.assert(\n        permutation.length >= n &&\n        p.length == n*2 && q.length == n*2 &&\n        mp.rows == 2 && mp.columns == n &&\n        mq.rows == 2 && mq.columns == n\n    );\n\n    // reorder elements according to the permutation\n    for(let j = 0; j < n; j++) {\n        const k = permutation[j];\n        for(let a = 0; a < 2; a++) {\n            p[j*2 + a] = src[k*2 + a];\n            q[j*2 + a] = dest[k*2 + a];\n        }\n    }\n\n    // matrices may NOT be resized\n    mp.data.set(p);\n    mq.data.set(q);\n}\n\n\n\n\n\n// ----------------------------------------------------------------------------\n// The following routines implement matrix and vector operations with minimal\n// overhead. They only operate on small matrices. They are meant to be very\n// lightweight and specific. solvePlanarPnP() is meant to be used often!!!\n// \n// maybe move these to a separate module? So far they're only used here...\n// maybe port everything to WASM?\n// ----------------------------------------------------------------------------\n\n\n\n\n// instantiate a matrix\nfunction mat(copy: TinyMatrix): TinyMatrix;\nfunction mat(rows: number, cols?: number, entries?: TinyMatrix | number[] | number): TinyMatrix;\n\nfunction mat(rows: number | TinyMatrix, cols: number = rows as number, entries: TinyMatrix | number[] | number = 0): TinyMatrix\n{\n    if(typeof rows == 'object')\n        return mat(rows._rows, rows._cols, rows); // clone\n\n    const isSequence = (typeof entries == 'object');\n    if(isSequence && entries.length != rows * cols)\n        throw new IllegalArgumentError();\n\n    const M = (isSequence ? new Float64Array(entries) : new Float64Array(rows * cols)) as TinyMatrix;\n    M._rows = rows;\n    M._cols = cols;\n\n    if(typeof entries == 'number')\n        M.fill(entries);\n\n    return M;\n}\n\nfunction mat2(entries: number[] | number): TinyMatrix { return mat(2, 2, entries); }\nfunction mat3(entries: number[] | number): TinyMatrix { return mat(3, 3, entries); }\nfunction mat4(entries: number[] | number): TinyMatrix { return mat(4, 4, entries); }\nfunction mat3x4(entries: number[] | number): TinyMatrix { return mat(3, 4, entries); }\nfunction vec2(entries: number[] | number): TinyMatrix { return mat(2, 1, entries); }\nfunction vec3(entries: number[] | number): TinyMatrix { return mat(3, 1, entries); }\nfunction vec4(entries: number[] | number): TinyMatrix { return mat(4, 1, entries); }\n\n// matrix addition\nfunction add(C: TinyMatrix, A: TinyMatrix, B: TinyMatrix): TinyMatrix\n{\n    const rowsA = A._rows, colsA = A._cols;\n    const rowsB = B._rows, colsB = B._cols;\n    const rowsC = C._rows, colsC = C._cols;\n\n    if(rowsA != rowsB || colsA != colsB || rowsA != rowsC || colsA != colsC)\n        throw new IllegalArgumentError();\n\n    for(let i = 0; i < C.length; i++)\n        C[i] = A[i] + B[i];\n\n    return C;\n}\n\n// matrix subtraction\nfunction sub(C: TinyMatrix, A: TinyMatrix, B: TinyMatrix): TinyMatrix\n{\n    const rowsA = A._rows, colsA = A._cols;\n    const rowsB = B._rows, colsB = B._cols;\n    const rowsC = C._rows, colsC = C._cols;\n\n    if(rowsA != rowsB || colsA != colsB || rowsA != rowsC || colsA != colsC)\n        throw new IllegalArgumentError();\n\n    for(let i = 0; i < C.length; i++)\n        C[i] = A[i] - B[i];\n\n    return C;\n}\n\n// matrix multiplication\nfunction mul(C: TinyMatrix, A: TinyMatrix, B: TinyMatrix): TinyMatrix\n{\n    const rowsA = A._rows, colsA = A._cols;\n    const rowsB = B._rows, colsB = B._cols;\n    const rowsC = C._rows, colsC = C._cols;\n\n    if(rowsC != rowsA || colsC != colsB || colsA != rowsB)\n        throw new IllegalArgumentError();\n\n    C.fill(0);\n    for(let k = 0; k < colsC; k++) {\n        for(let j = 0; j < rowsA; j++) {\n            for(let i = 0; i < colsA; i++)\n                C[k * rowsC + j] += A[i * rowsA + j] * B[k * rowsB + i]\n        }\n    }\n\n    return C;\n}\n\n// multiplication by a scalar\nfunction scale(B: TinyMatrix, A: TinyMatrix, s: number): TinyMatrix\n{\n    if(A._rows != B._rows || A._cols != B._cols)\n        throw new IllegalArgumentError();\n\n    for(let i = 0; i < B.length; i++)\n        B[i] = A[i] * s;\n\n    return B;\n}\n\n// inverse of a 3x3 matrix\nfunction inverse(B: TinyMatrix, A: TinyMatrix): TinyMatrix\n{\n    if(A._rows != B._rows || A._cols != B._cols)\n        throw new IllegalArgumentError();\n\n    // matrix of minors\n    const m0 = A[4] * A[8] - A[7] * A[5];\n    const m1 = A[3] * A[8] - A[6] * A[5];\n    const m2 = A[3] * A[7] - A[6] * A[4];\n    const m3 = A[1] * A[8] - A[7] * A[2];\n    const m4 = A[0] * A[8] - A[6] * A[2];\n    const m5 = A[0] * A[7] - A[6] * A[1];\n    const m6 = A[1] * A[5] - A[4] * A[2];\n    const m7 = A[0] * A[5] - A[3] * A[2];\n    const m8 = A[0] * A[4] - A[3] * A[1];\n\n    // determinant of A\n    const det = A[0] * m0 - A[1] * m1 + A[2] * m2;\n    if(Math.abs(det) < EPSILON)\n        return B.fill(Number.NaN);\n\n    // invert via cofactor expansion\n    const idet = 1.0 / det;\n\n    B[0] = m0 * idet;\n    B[1] = -m3 * idet;\n    B[2] = m6 * idet;\n    B[3] = -m1 * idet;\n    B[4] = m4 * idet;\n    B[5] = -m7 * idet;\n    B[6] = m2 * idet;\n    B[7] = -m5 * idet;\n    B[8] = m8 * idet;\n\n    return B;\n}\n\n// determinant of a 3x3 matrix\nfunction determinant(A: TinyMatrix): number\n{\n    const m0 = A[4] * A[8] - A[7] * A[5];\n    const m1 = A[3] * A[8] - A[6] * A[5];\n    const m2 = A[3] * A[7] - A[6] * A[4];\n\n    return A[0] * m0 - A[1] * m1 + A[2] * m2;\n}\n\n// normalize a 3D vector\nfunction normalize(w: TinyMatrix, v: TinyMatrix): TinyMatrix\n{\n    const len2 = dot(v, v);\n    const len = Math.sqrt(len2);\n\n    w[0] = v[0] / len;\n    w[1] = v[1] / len;\n    w[2] = v[2] / len;\n\n    return w;\n}\n\n// find the squared distance between two points in 3D\nfunction distance2(u: TinyMatrix, v: TinyMatrix): number\n{\n    const dx = u[0] - v[0];\n    const dy = u[1] - v[1];\n    const dz = u[2] - v[2];\n\n    return dx*dx + dy*dy + dz*dz;\n}\n\n// dot product u'v; u and v are 3D\nfunction dot(u: TinyMatrix, v: TinyMatrix): number\n{\n    return u[0]*v[0] + u[1]*v[1] + u[2]*v[2];\n}\n\n// angle in degrees between two unit vectors\nfunction angle(u: TinyMatrix, v: TinyMatrix): number\n{\n    return Math.acos(dot(u, v)) * 180 / Math.PI;\n}\n\n// cross product u x v\nfunction cross(w: TinyMatrix, u: TinyMatrix, v: TinyMatrix): TinyMatrix\n{\n    w[0] = u[1] * v[2] - u[2] * v[1];\n    w[1] = u[2] * v[0] - u[0] * v[2];\n    w[2] = u[0] * v[1] - u[1] * v[0];\n\n    return w;\n}\n\n// outer product u v'\nfunction outer(w: TinyMatrix, u: TinyMatrix, v: TinyMatrix): TinyMatrix\n{\n    w[0] = u[0] * v[0], u[1] * v[0], u[2] * v[0];\n    w[1] = u[0] * v[1], u[1] * v[1], u[2] * v[1];\n    w[2] = u[0] * v[2], u[1] * v[2], u[2] * v[2];\n\n    return w;\n}\n\n// convert unit quaternion to rotation matrix\nfunction quat2mat(R: TinyMatrix, q: TinyMatrix): TinyMatrix\n{\n    const x = q[0], y = q[1], z = q[2], w = q[3];\n    const x2 = 2*x*x, y2 = 2*y*y, z2 = 2*z*z;\n    const xy = 2*x*y, xz = 2*x*z, yz = 2*y*z;\n    const wx = 2*w*x, wy = 2*w*y, wz = 2*w*z;\n\n    R[0] = 1-(y2+z2);\n    R[1] = xy+wz;\n    R[2] = xz-wy;\n    R[3] = xy-wz;\n    R[4] = 1-(x2+z2);\n    R[5] = yz+wx;\n    R[6] = xz+wy;\n    R[7] = yz-wx;\n    R[8] = 1-(x2+y2);\n\n    return R;\n}\n\n// sweet print\nfunction print(data: any, spaces: string = ''): void\n{\n    if(typeof data !== 'object') {\n        console.log(spaces, data);\n        return;\n    }\n\n    if(ArrayBuffer.isView(data)) {\n        printmat(data as TinyMatrix, spaces);\n        return;\n    }\n\n    for(const key of Object.keys(data)) {\n        console.log('%s%s:', spaces, key);\n        print(data[key], spaces + '  ');\n    }\n\n    if(spaces == '')\n        console.log('\\n');\n}\n\n// print matrix\nfunction printmat(m: TinyMatrix, spaces: string = '', precision: number = 4): void\n{\n    const rows = m._rows, cols = m._cols;\n    const indices = (row: number) => Array.from({ length: cols }, (_, i) => i * rows + row);\n\n    console.log(Array.from({ length: rows }, (_, row) => indices(row)).map(\n        indices => spaces + indices.map(k => m[k].toFixed(precision)).join('  ')\n    ).join('\\n'));\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * image-tracker-utils.ts\n * Image Tracker: Utilities\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { SpeedyPoint2 } from 'speedy-vision/types/core/speedy-point';\nimport { SpeedyVector2 } from 'speedy-vision/types/core/speedy-vector';\nimport { SpeedyKeypoint } from 'speedy-vision/types/core/speedy-keypoint';\nimport { ReferenceImageWithMedia } from './reference-image';\nimport { Utils } from '../../utils/utils';\nimport { IllegalOperationError, IllegalArgumentError, NumericalError } from '../../utils/errors';\nimport { NIS_SIZE, TRACK_GRID_GRANULARITY } from './settings';\nimport { find6DoFHomography, find6DoFHomographyOptions } from '../../geometry/pnp';\n\n/*\n\nDefinitions:\n------------\n\n1. Raster space:\n   an image space whose top-left coordinate is (0,0) and whose bottom-right\n   coordinate is (w-1,h-1), where (w,h) is its size. The y-axis points down.\n\n2. AR screen size:\n   size in pixels used for image processing operations. It's determined by the\n   resolution of the tracker and by the aspect ratio of the input media.\n\n3. AR screen space (screen):\n   a raster space whose size is the AR screen size.\n\n4. Normalized Image Space (NIS):\n   a raster space whose size is N x N, where N = NIS_SIZE.\n\n5. Normalized Device Coordinates (NDC):\n   the normalized 2D space [-1,1]x[-1,1]. The origin is at the center and the\n   y-axis points up.\n\n*/\n\n/** An ordered pair [src, dest] of keypoints */\nexport type ImageTrackerKeypointPair = [ Readonly<SpeedyKeypoint>, Readonly<SpeedyKeypoint> ];\n\n/**\n * Utilities for the Image Tracker\n */\nexport class ImageTrackerUtils\n{\n    /**\n     * Find a transformation that converts a raster space to NIS\n     * @param size size of the raster space\n     * @returns a 3x3 matrix\n     */\n    static rasterToNIS(size: SpeedySize): SpeedyMatrix\n    {\n        const sx = NIS_SIZE / size.width;\n        const sy = NIS_SIZE / size.height;\n\n        return Speedy.Matrix(3, 3, [\n            sx, 0,  0,\n            0,  sy, 0,\n            0,  0,  1\n        ]);\n    }\n\n    /**\n     * Find a transformation that converts a raster space to NDC\n     * @param size size of the raster space\n     * @returns a 3x3 matrix\n     */\n    static rasterToNDC(size: SpeedySize): SpeedyMatrix\n    {\n        const w = size.width, h = size.height;\n\n        return Speedy.Matrix(3, 3, [\n            2/w, 0,   0,\n            0,  -2/h, 0,\n           -1,   1,   1\n        ]);\n    }\n\n    /**\n     * Find a transformation that converts NDC to a raster space\n     * @param size size of the raster space\n     * @returns a 3x3 matrix\n     */\n    static NDCToRaster(size: SpeedySize): SpeedyMatrix\n    {\n        const w = size.width, h = size.height;\n\n        return Speedy.Matrix(3, 3, [\n            w/2, 0,   0,\n            0,  -h/2, 0,\n            w/2, h/2, 1\n        ]);\n    }\n\n    /**\n     * Find a transformation that scales points in NDC\n     * @param sx horizontal scale factor\n     * @param sy vertical scale factor\n     * @returns a 3x3 matrix\n     */\n    static scaleNDC(sx: number, sy: number = sx): SpeedyMatrix\n    {\n        // In NDC, the origin is at the center of the space!\n        return Speedy.Matrix(3, 3, [\n            sx, 0,  0,\n            0,  sy, 0,\n            0,  0,  1\n        ]);\n    }\n\n    /**\n     * Find a scale transformation in NDC such that the output has a desired aspect ratio\n     * @param aspectRatio desired aspect ratio\n     * @param scale optional scale factor in both axes\n     * @returns a 3x3 matrix\n     */\n    static bestFitScaleNDC(aspectRatio: number, scale: number = 1): SpeedyMatrix\n    {\n        if(aspectRatio >= 1)\n            return this.scaleNDC(scale, scale / aspectRatio); // s/(s/a) = a, sx >= sy\n        else\n            return this.scaleNDC(scale * aspectRatio, scale); // (s*a)/s = a, sx < sy\n    }\n\n    /**\n     * Find the inverse matrix of bestFitScaleNDC()\n     * @param aspectRatio as given to bestFitScaleNDC()\n     * @param scale optional, as given to bestFitScaleNDC()\n     * @returns a 3x3 matrix\n     */\n    static inverseBestFitScaleNDC(aspectRatio: number, scale: number = 1): SpeedyMatrix\n    {\n        if(aspectRatio >= 1)\n            return this.scaleNDC(1 / scale, aspectRatio / scale);\n        else\n            return this.scaleNDC(1 / (scale * aspectRatio), 1 / scale);\n    }\n\n    /**\n     * Find the best-fit aspect ratio for the rectification of the reference image in NDC\n     * @param screenSize\n     * @param referenceImage\n     * @returns a best-fit aspect ratio\n     */\n    static bestFitAspectRatioNDC(screenSize: SpeedySize, referenceImage: ReferenceImageWithMedia): number\n    {\n        /*\n        \n        The best-fit aspectRatio (a) is constructed as follows:\n\n        1) a fully stretched(*) and distorted reference image in NDC:\n           a = 1\n\n        2) a square in NDC:\n           a = 1 / screenAspectRatio\n\n        3) an image with the aspect ratio of the reference image in NDC:\n           a = referenceImageAspectRatio * (1 / screenAspectRatio)\n\n        (*) AR screen space\n\n        By transforming the reference image twice, first by converting it to AR\n        screen space, and then by rectifying it, we lose a little bit of quality.\n        Nothing to be too concerned about, though?\n\n        */\n\n        const screenAspectRatio = screenSize.width / screenSize.height;\n        return referenceImage.aspectRatio / screenAspectRatio;\n    }\n\n    /**\n     * Given n > 0 pairs (src_i, dest_i) of keypoints in NIS,\n     * convert them to NDC and output a 2 x 2n matrix of the form:\n     * [ src_0.x  src_1.x  ... | dest_0.x  dest_1.x  ... ]\n     * [ src_0.y  src_1.y  ... | dest_0.y  dest_1.y  ... ]\n     * @param pairs pairs of keypoints in NIS\n     * @returns 2 x 2n matrix with two 2 x n blocks: [ src | dest ]\n     * @throws\n     */\n    static compilePairsOfKeypointsNDC(pairs: ImageTrackerKeypointPair[]): SpeedyMatrix\n    {\n        const n = pairs.length;\n\n        if(n == 0)\n            throw new IllegalArgumentError();\n\n        const scale = 2 / NIS_SIZE;\n        const data = new Array<number>(2 * 2*n);\n\n        for(let i = 0, j = 0, k = 2*n; i < n; i++, j += 2, k += 2) {\n            const src = pairs[i][0];\n            const dest = pairs[i][1];\n\n            data[j] = src.x * scale - 1; // convert from NIS to NDC\n            data[j+1] = 1 - src.y * scale; // flip y-axis\n\n            data[k] = dest.x * scale - 1;\n            data[k+1] = 1 - dest.y * scale;\n        }\n\n        return Speedy.Matrix(2, 2*n, data);\n    }\n\n    /**\n     * Interpolation filter for homographies\n     * In its simplest form, it's similar to linear interpolation: src (1-alpha) + dest alpha\n     * @param src homography\n     * @param dest homography\n     * @param alpha interpolation factor in [0,1] (1 means no interpolation)\n     * @param beta correction strength for noisy corners (optional)\n     * @param tau translation factor (optional)\n     * @param omega rotational factor (optional)\n     * @returns interpolated homography\n     */\n    static interpolateHomographies(src: SpeedyMatrix, dest: SpeedyMatrix, alpha: number, beta: number = 0, tau: number = 0, omega: number = 0): SpeedyPromise<SpeedyMatrix>\n    {\n        const d = new Array<number>(4), q = new Array<number>(8), p = [\n            // NDC\n            -1, 1,\n            1, 1,\n            1, -1,\n            -1, -1,\n        ];\n\n        const ha = src.read(), hb = dest.read();\n        for(let i = 0, j = 0; i < 4; i++, j += 2) {\n            const x = p[j], y = p[j+1];\n\n            const hax = ha[0] * x + ha[3] * y + ha[6];\n            const hay = ha[1] * x + ha[4] * y + ha[7];\n            const haz = ha[2] * x + ha[5] * y + ha[8];\n\n            const hbx = hb[0] * x + hb[3] * y + hb[6];\n            const hby = hb[1] * x + hb[4] * y + hb[7];\n            const hbz = hb[2] * x + hb[5] * y + hb[8];\n\n            const dx = hbx/hbz - hax/haz;\n            const dy = hby/hbz - hay/haz;\n            d[i] = dx*dx + dy*dy;\n        }\n\n        let tx = 0, ty = 0, sin = 0, cos = 1;\n        const max = Math.max(d[0], d[1], d[2], d[3]); // max = Math.max(...d)\n        const min = Math.min(d[0], d[1], d[2], d[3]);\n        //const quality = min / max;\n\n        // no change?\n        if(max < 1e-5)\n            return Speedy.Promise.resolve(Speedy.Matrix(dest));\n\n        for(let i = 0, j = 0; i < 4; i++, j += 2) {\n            const x = p[j], y = p[j+1];\n\n            const hax = ha[0] * x + ha[3] * y + ha[6];\n            const hay = ha[1] * x + ha[4] * y + ha[7];\n            const haz = ha[2] * x + ha[5] * y + ha[8];\n\n            const hbx = hb[0] * x + hb[3] * y + hb[6];\n            const hby = hb[1] * x + hb[4] * y + hb[7];\n            const hbz = hb[2] * x + hb[5] * y + hb[8];\n\n            const ax = hax/haz, ay = hay/haz;\n            const bx = hbx/hbz, by = hby/hbz;\n\n            // correct noisy corners, if any\n            if(d[i] == min) {\n                // we take the min for the translation\n                // because there may be noisy corners\n                tx = bx - ax;\n                ty = by - ay;\n\n                const dot = ax * bx + ay * by;\n                const signedArea = ax * by - ay * bx;\n                const la2 = ax * ax + ay * ay;\n                const lb2 = bx * bx + by * by;\n                const lalb = Math.sqrt(la2 * lb2);\n\n                sin = signedArea / lalb;\n                cos = dot / lalb;\n            }\n\n            // compute the interpolation factor t = t(alpha, beta)\n            // t is alpha if beta is zero\n            const gamma = alpha * Math.pow(2, -beta);\n            const f = 1 - Math.sqrt(d[i] / max); // f is zero when d[i] is max (hence, it minimizes t and contributes to src)\n            const g = (alpha - gamma) * f + gamma; // gamma when f is zero; alpha when f is one\n            //const t = Math.max(0, Math.min(g, 1)); // clamp\n            const t = g; // allow extrapolation; don't clamp\n            const _t = 1 - t;\n\n            // a (1-t) + b t == a + (b-a) t\n            q[ j ] = ax * _t + bx * t;\n            q[j+1] = ay * _t + by * t;\n        }\n\n        const _omega = 1 - omega;\n        for(let j = 0; j < 8; j += 2) {\n            const x = q[j], y = q[j+1];\n            q[ j ] = x * _omega + (x * cos - y * sin) * omega;\n            q[j+1] = y * _omega + (x * sin + y * cos) * omega;\n        }\n\n        for(let j = 0; j < 8; j += 2) {\n            q[ j ] += tx * tau;\n            q[j+1] += ty * tau;\n        }\n\n        return Speedy.Matrix.perspective(\n            Speedy.Matrix.Zeros(3),\n            Speedy.Matrix(2, 4, p),\n            Speedy.Matrix(2, 4, q)\n        );\n    }\n\n    /**\n     * Given n > 0 pairs of keypoints in NDC as a 2 x 2n [ src | dest ] matrix,\n     * find a 6 DoF perspective warp (homography) from src to dest in NDC\n     * @param cameraIntrinsics 3x3 camera intrinsics\n     * @param points compiled pairs of keypoints in NDC\n     * @param options to be passed to find6DofHomography\n     * @returns a pair [ 3x3 transformation matrix, quality score ]\n     */\n    static find6DoFHomographyNDC(cameraIntrinsics: SpeedyMatrix, points: SpeedyMatrix, options: find6DoFHomographyOptions): SpeedyPromise<[SpeedyMatrix,number]>\n    {\n        // too few data points?\n        const n = points.columns / 2;\n        if(n < 4) {\n            return Speedy.Promise.reject(\n                new IllegalArgumentError(`Too few data points to compute a perspective warp`)\n            );\n        }\n\n        // compute a homography\n        const src = points.block(0, 1, 0, n-1);\n        const dest = points.block(0, 1, n, 2*n-1);\n        const mask = options.mask || Speedy.Matrix.Zeros(1, n);\n\n        return find6DoFHomography(\n            src,\n            dest,\n            cameraIntrinsics,\n            Object.assign({ mask }, options)\n        ).then(homography => {\n\n            // check if this is a valid homography\n            const a00 = homography.at(0,0);\n            if(Number.isNaN(a00))\n                throw new NumericalError(`Can't compute a perspective warp: bad keypoints`);\n\n            // count inliers\n            let m = 0;\n            const inliers = mask.read();\n            for(let i = 0; i < n; i++)\n                m += inliers[i];\n\n            // done!\n            const score = m / n;\n            return [homography, score];\n\n        });\n    }\n\n    /**\n     * Given n > 0 pairs of keypoints in NDC as a 2 x 2n [ src | dest ] matrix,\n     * find a perspective warp (homography) from src to dest in NDC\n     * @param points compiled pairs of keypoints in NDC\n     * @param options to be passed to speedy-vision\n     * @returns a pair [ 3x3 transformation matrix, quality score ]\n     */\n    static findPerspectiveWarpNDC(points: SpeedyMatrix, options: object): SpeedyPromise<[SpeedyMatrix,number]>\n    {\n        // too few data points?\n        const n = points.columns / 2;\n        if(n < 4) {\n            return Speedy.Promise.reject(\n                new IllegalArgumentError(`Too few data points to compute a perspective warp`)\n            );\n        }\n\n        // compute a homography\n        const src = points.block(0, 1, 0, n-1);\n        const dest = points.block(0, 1, n, 2*n-1);\n        const mask = ((options as any).mask as SpeedyMatrix | null | undefined) || Speedy.Matrix.Zeros(1, n);\n\n        return Speedy.Matrix.findHomography(\n            Speedy.Matrix.Zeros(3),\n            src,\n            dest,\n            Object.assign({ mask }, options)\n        ).then(homography => {\n\n            // check if this is a valid warp\n            const a00 = homography.at(0,0);\n            if(Number.isNaN(a00))\n                throw new NumericalError(`Can't compute a perspective warp: bad keypoints`);\n\n            // count inliers\n            let m = 0;\n            const inliers = mask.read();\n            for(let i = 0; i < n; i++)\n                m += inliers[i];\n\n            // done!\n            const score = m / n;\n            return [homography, score];\n\n        });\n    }\n\n    /**\n     * Given n > 0 pairs of keypoints in NDC as a 2 x 2n [ src | dest ] matrix,\n     * find an affine warp from src to dest in NDC. The affine warp is given as\n     * a 3x3 matrix whose last row is [0 0 1]\n     * @param points compiled pairs of keypoints in NDC\n     * @param options to be passed to speedy-vision\n     * @returns a pair [ 3x3 transformation matrix, quality score ]\n     */\n    static findAffineWarpNDC(points: SpeedyMatrix, options: object): SpeedyPromise<[SpeedyMatrix,number]>\n    {\n        // too few data points?\n        const n = points.columns / 2;\n        if(n < 3) {\n            return Speedy.Promise.reject(\n                new IllegalArgumentError(`Too few data points to compute an affine warp`)\n            );\n        }\n\n        // compute an affine transformation\n        const model = Speedy.Matrix.Eye(3);\n        const src = points.block(0, 1, 0, n-1);\n        const dest = points.block(0, 1, n, 2*n-1);\n        const mask = ((options as any).mask as SpeedyMatrix | null | undefined) || Speedy.Matrix.Zeros(1, n);\n\n        return Speedy.Matrix.findAffineTransform(\n            model.block(0, 1, 0, 2), // 2x3 submatrix\n            src,\n            dest,\n            Object.assign({ mask }, options)\n        ).then(_ => {\n\n            // check if this is a valid warp\n            const a00 = model.at(0,0);\n            if(Number.isNaN(a00))\n                throw new NumericalError(`Can't compute an affine warp: bad keypoints`);\n\n            // count inliers\n            let m = 0;\n            const inliers = mask.read();\n            for(let i = 0; i < n; i++)\n                m += inliers[i];\n\n            // done!\n            const score = m / n;\n            return [model, score];\n\n        });\n    }\n\n    /**\n     * Find a polyline in Normalized Device Coordinates (NDC)\n     * @param homography maps the corners of NDC to a quadrilateral in NDC\n     * @returns 4 points in NDC\n     */\n    static findPolylineNDC(homography: SpeedyMatrix): SpeedyPoint2[]\n    {\n        const h = homography.read();\n        const uv = [ -1, +1,    -1, -1,    +1, -1,    +1, +1 ]; // the corners of a reference image in NDC\n        const polyline = new Array<SpeedyPoint2>(4);\n\n        for(let i = 0, j = 0; i < 4; i++, j += 2) {\n            const u = uv[j], v = uv[j+1];\n\n            const x = h[0]*u + h[3]*v + h[6];\n            const y = h[1]*u + h[4]*v + h[7];\n            const w = h[2]*u + h[5]*v + h[8];\n\n            polyline[i] = Speedy.Point2(x/w, y/w);\n        }\n\n        return polyline;\n    }\n\n    /**\n     * Find a better spatial distribution of the input matches\n     * @param pairs in the [src, dest] format\n     * @returns refined pairs of quality matches\n     */\n    static refineMatchingPairs(pairs: ImageTrackerKeypointPair[]): ImageTrackerKeypointPair[]\n    {\n        // collect all keypoints obtained in this frame\n        const m = pairs.length;\n        const destKeypoints = new Array<SpeedyKeypoint>(m);\n\n        for(let j = 0; j < m; j++)\n            destKeypoints[j] = pairs[j][1];\n\n        // find a better spatial distribution of the keypoints\n        const indices = this._distributeKeypoints(destKeypoints);\n\n        // assemble output\n        const n = indices.length; // number of refined matches\n        const result = new Array<ImageTrackerKeypointPair>(n);\n\n        for(let i = 0; i < n; i++)\n            result[i] = pairs[indices[i]];\n\n        // done!\n        return result;\n    }\n\n    /**\n     * Spatially distribute keypoints over a grid\n     * @param keypoints keypoints to be distributed\n     * @returns a list of indices of keypoints[]\n     */\n    private static _distributeKeypoints(keypoints: SpeedyKeypoint[]): number[]\n    {\n        // create a grid\n        const gridCells = TRACK_GRID_GRANULARITY; // number of grid elements in each axis\n        const numberOfCells = gridCells * gridCells;\n        const n = keypoints.length;\n\n        // get the coordinates of the keypoints\n        const points: number[] = new Array(2 * n);\n        for(let i = 0, j = 0; i < n; i++, j += 2) {\n            points[j] = keypoints[i].x;\n            points[j+1] = keypoints[i].y;\n        }\n\n        // normalize the coordinates to [0,1) x [0,1)\n        this._normalizePoints(points);\n\n        // distribute the keypoints over the grid\n        const grid = new Array<number>(numberOfCells).fill(-1);\n        for(let i = 0, j = 0; i < n; i++, j += 2) {\n            // find the grid location of the i-th point\n            const xg = Math.floor(points[j] * gridCells); // 0 <= xg,yg < gridCells\n            const yg = Math.floor(points[j+1] * gridCells);\n\n            // store the index of the i-th point in the grid\n            const k = yg * gridCells + xg;\n            if(grid[k] < 0)\n                grid[k] = i;\n        }\n\n        // retrieve points of the grid\n        let m = 0;\n        const indices = new Array<number>(numberOfCells);\n        for(let g = 0; g < numberOfCells; g++) {\n            if(grid[g] >= 0)\n                indices[m++] = grid[g];\n        }\n        indices.length = m;\n\n        // done!\n        return indices;\n    }\n\n    /**\n     * Normalize points to [0,1)^2\n     * @param points 2 x n matrix of points in column-major format\n     * @returns points\n     */\n    private static _normalizePoints(points: number[]): number[]\n    {\n        Utils.assert(points.length % 2 == 0);\n\n        const n = points.length / 2;\n        if(n == 0)\n            return points;\n\n        let xmin = Number.POSITIVE_INFINITY, xmax = Number.NEGATIVE_INFINITY;\n        let ymin = Number.POSITIVE_INFINITY, ymax = Number.NEGATIVE_INFINITY;\n        for(let i = 0, j = 0; i < n; i++, j += 2) {\n            const x = points[j], y = points[j+1];\n            xmin = x < xmin ? x : xmin;\n            ymin = y < ymin ? y : ymin;\n            xmax = x > xmax ? x : xmax;\n            ymax = y > ymax ? y : ymax;\n        }\n\n        const xlen = xmax - xmin + 1; // +1 is a correction factor, so that 0 <= x,y < 1\n        const ylen = ymax - ymin + 1;\n        for(let i = 0, j = 0; i < n; i++, j += 2) {\n            points[j] = (points[j] - xmin) / xlen;\n            points[j+1] = (points[j+1] - ymin) / ylen;\n        }\n\n        return points;\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * training.ts\n * Training state of the Image Tracker\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { SpeedyPipeline, SpeedyPipelineOutput } from 'speedy-vision/types/core/pipeline/pipeline';\nimport { SpeedyPipelineNodeImageSource } from 'speedy-vision/types/core/pipeline/nodes/images/source';\nimport { SpeedyPipelineNodeResize } from 'speedy-vision/types/core/pipeline/nodes/transforms/resize';\nimport { SpeedyPipelineNodeKeypointTransformer } from 'speedy-vision/types/core/pipeline/nodes/keypoints/transformer';\nimport { SpeedyKeypoint } from 'speedy-vision/types/core/speedy-keypoint';\nimport { Resolution } from '../../../utils/resolution';\nimport { ImageTracker, ImageTrackerOutput, ImageTrackerStateName } from '../image-tracker';\nimport { ImageTrackerUtils, ImageTrackerKeypointPair } from '../image-tracker-utils';\nimport { ImageTrackerState, ImageTrackerStateOutput } from './state';\nimport { ReferenceImage, ReferenceImageWithMedia } from '../reference-image';\nimport { Nullable, Utils } from '../../../utils/utils';\nimport { IllegalOperationError, TrainingError } from '../../../utils/errors';\nimport {\n    TRAIN_MAX_KEYPOINTS, SCAN_FAST_THRESHOLD,\n    ORB_GAUSSIAN_KSIZE, ORB_GAUSSIAN_SIGMA,\n    SCAN_PYRAMID_LEVELS, SCAN_PYRAMID_SCALEFACTOR,\n    SCAN_WITH_NIGHTVISION, NIGHTVISION_GAIN, NIGHTVISION_OFFSET, NIGHTVISION_DECAY,\n    SUBPIXEL_GAUSSIAN_KSIZE, SUBPIXEL_GAUSSIAN_SIGMA,\n    TRAIN_IMAGE_SCALE,\n    NIGHTVISION_QUALITY,\n    SUBPIXEL_METHOD,\n} from '../settings';\n\n\n\n/** The training map maps keypoints to reference images */\ninterface TrainingMap\n{\n    /** the collection of all keypoints (of all images) */\n    readonly keypoints: SpeedyKeypoint[];\n\n    /** maps a keypoint index to an image index */\n    readonly referenceImageIndex: number[];\n\n    /** reference images */\n    readonly referenceImages: ReferenceImageWithMedia[];\n}\n\n\n\n/**\n * Training state of the Image Tracker\n */\nexport class ImageTrackerTrainingState extends ImageTrackerState\n{\n    /** index of the image being used to train the tracker */\n    private _currentImageIndex = 0;\n\n    /** training map */\n    private _trainingMap: TrainingMap;\n\n\n\n    /**\n     * Constructor\n     * @param imageTracker\n     */\n    constructor(imageTracker: ImageTracker)\n    {\n        super('training', imageTracker);\n\n        // initialize the training map\n        this._trainingMap = {\n            keypoints: [],\n            referenceImageIndex: [],\n            referenceImages: [],\n        };\n    }\n\n    /**\n     * Called as soon as this becomes the active state, just before update() runs for the first time\n     * @param settings\n     */\n    onEnterState(settings: Record<string,any>)\n    {\n        const database = this._imageTracker.database;\n\n        // validate\n        if(database.count == 0)\n            throw new TrainingError(`Can't train the Image Tracker: the Reference Image Database is empty`);\n\n        // prepare to train...\n        this._currentImageIndex = 0;\n        this._trainingMap.keypoints.length = 0;\n        this._trainingMap.referenceImageIndex.length = 0;\n        this._trainingMap.referenceImages.length = 0;\n\n        // lock the database\n        Utils.log(`Image Tracker: training using ${database.count} reference image${database.count != 1 ? 's' : ''}`);\n        database._lock();\n\n        // collect all images\n        for(const referenceImage of database)\n            this._trainingMap.referenceImages.push(referenceImage);\n    }\n\n    /**\n     * Called when leaving the state, after update()\n     */\n    onLeaveState(): void\n    {\n        // we don't return to this state, so we can release the pipeline early\n        this._pipeline.release();\n        this._pipelineReleased = true;\n    }\n\n    /**\n     * Called just before the GPU processing\n     * @returns promise\n     */\n    protected _beforeUpdate(): SpeedyPromise<void>\n    {\n        const source = this._pipeline.node('source') as SpeedyPipelineNodeImageSource;\n        const screen = this._pipeline.node('screen') as SpeedyPipelineNodeResize;\n        const keypointScaler = this._pipeline.node('keypointScaler') as SpeedyPipelineNodeKeypointTransformer;\n\n        // set the appropriate training media\n        const referenceImage = this._trainingMap.referenceImages[this._currentImageIndex];\n        source.media = referenceImage.media;\n\n        // compute the appropriate size of the training image space\n        const resolution = this._imageTracker.resolution;\n        const scale = TRAIN_IMAGE_SCALE; // ORB is not scale-invariant\n        const aspectRatioOfTrainingImage = referenceImage.aspectRatio;\n\n        screen.size = Utils.resolution(resolution, aspectRatioOfTrainingImage);\n        screen.size.width = Math.round(screen.size.width * scale);\n        screen.size.height = Math.round(screen.size.height * scale);\n\n        // convert keypoints to NIS\n        keypointScaler.transform = ImageTrackerUtils.rasterToNIS(screen.size);\n\n        // log\n        Utils.log(`Image Tracker: training using reference image \"${referenceImage.name}\" at ${screen.size.width}x${screen.size.height}...`);\n\n        // done!\n        return Speedy.Promise.resolve();\n    }\n\n    /**\n     * Post processing that takes place just after the GPU processing\n     * @param result pipeline results\n     * @returns state output\n     */\n    protected _afterUpdate(result: SpeedyPipelineOutput): SpeedyPromise<ImageTrackerStateOutput>\n    {\n        const referenceImage = this._trainingMap.referenceImages[this._currentImageIndex];\n        const keypoints = result.keypoints as SpeedyKeypoint[];\n        const image = result.image as SpeedyMedia | undefined;\n\n        // log\n        Utils.log(`Image Tracker: found ${keypoints.length} keypoints in reference image \"${referenceImage.name}\"`);\n\n        // tracker output\n        const trackerOutput: ImageTrackerOutput = {\n            keypointsNIS: image !== undefined ? keypoints : undefined, // debug only\n            image: image,\n        };\n\n        // set the training map, so that we can map all keypoints of the current image to the current image\n        for(let i = 0; i < keypoints.length; i++) {\n            this._trainingMap.keypoints.push(keypoints[i]);\n            this._trainingMap.referenceImageIndex.push(this._currentImageIndex);\n        }\n\n        // the current image has been processed!\n        ++this._currentImageIndex;\n\n        // we're not done yet\n        if(this._currentImageIndex < this._trainingMap.referenceImages.length) {\n            return Speedy.Promise.resolve({\n                nextState: 'training',\n                trackerOutput: trackerOutput\n            });\n        }\n\n        // finished training!\n        return Speedy.Promise.resolve({\n            nextState: 'scanning',\n            trackerOutput: trackerOutput,\n            nextStateSettings: {\n                database: this._trainingMap.keypoints,\n            }\n        });\n    }\n\n    /**\n     * Create & setup the pipeline\n     * @returns pipeline\n     */\n    protected _createPipeline(): SpeedyPipeline\n    {\n        const pipeline = Speedy.Pipeline();\n\n        const source = Speedy.Image.Source('source');\n        const screen = Speedy.Transform.Resize('screen');\n        const greyscale = Speedy.Filter.Greyscale();\n        const blur = Speedy.Filter.GaussianBlur();\n        const nightvision = Speedy.Filter.Nightvision();\n        const nightvisionMux = Speedy.Image.Multiplexer('nightvisionMux');\n        const pyramid = Speedy.Image.Pyramid();\n        const detector = Speedy.Keypoint.Detector.FAST('fast');\n        const descriptor = Speedy.Keypoint.Descriptor.ORB();\n        const subpixel = Speedy.Keypoint.SubpixelRefiner();\n        const blurredPyramid = Speedy.Image.Pyramid();\n        const denoiser = Speedy.Filter.GaussianBlur();\n        const clipper = Speedy.Keypoint.Clipper();\n        const keypointScaler = Speedy.Keypoint.Transformer('keypointScaler');\n        const keypointSink = Speedy.Keypoint.Sink('keypoints');\n        //const imageSink = Speedy.Image.Sink('image');\n\n        source.media = null;\n        screen.size = Speedy.Size(0,0);\n        blur.kernelSize = Speedy.Size(ORB_GAUSSIAN_KSIZE, ORB_GAUSSIAN_KSIZE);\n        blur.sigma = Speedy.Vector2(ORB_GAUSSIAN_SIGMA, ORB_GAUSSIAN_SIGMA);\n        nightvision.gain = NIGHTVISION_GAIN;\n        nightvision.offset = NIGHTVISION_OFFSET;\n        nightvision.decay = NIGHTVISION_DECAY;\n        nightvision.quality = NIGHTVISION_QUALITY;\n        nightvisionMux.port = SCAN_WITH_NIGHTVISION ? 1 : 0; // 1 = enable nightvision\n        detector.levels = SCAN_PYRAMID_LEVELS;\n        detector.scaleFactor = SCAN_PYRAMID_SCALEFACTOR;\n        detector.threshold = SCAN_FAST_THRESHOLD;\n        detector.capacity = 8192;\n        subpixel.method = SUBPIXEL_METHOD;\n        denoiser.kernelSize = Speedy.Size(SUBPIXEL_GAUSSIAN_KSIZE, SUBPIXEL_GAUSSIAN_KSIZE);\n        denoiser.sigma = Speedy.Vector2(SUBPIXEL_GAUSSIAN_SIGMA, SUBPIXEL_GAUSSIAN_SIGMA);\n        clipper.size = TRAIN_MAX_KEYPOINTS;\n        keypointScaler.transform = Speedy.Matrix.Eye(3);\n        keypointSink.turbo = false;\n\n        // prepare input\n        source.output().connectTo(screen.input());\n        screen.output().connectTo(greyscale.input());\n\n        // preprocess image\n        greyscale.output().connectTo(nightvisionMux.input('in0'));\n        greyscale.output().connectTo(nightvision.input());\n        nightvision.output().connectTo(nightvisionMux.input('in1'));\n        nightvisionMux.output().connectTo(pyramid.input());\n\n        // keypoint detection\n        pyramid.output().connectTo(detector.input());\n        detector.output().connectTo(clipper.input());\n\n        // keypoint refinement\n        greyscale.output().connectTo(denoiser.input()); // reduce noise\n        denoiser.output().connectTo(blurredPyramid.input());\n        clipper.output().connectTo(subpixel.input('keypoints'));\n        blurredPyramid.output().connectTo(subpixel.input('image'));\n\n        // keypoint description\n        greyscale.output().connectTo(blur.input());\n        blur.output().connectTo(descriptor.input('image'));\n        subpixel.output().connectTo(descriptor.input('keypoints'));\n\n        // prepare output\n        descriptor.output().connectTo(keypointScaler.input());\n        keypointScaler.output().connectTo(keypointSink.input());\n        //nightvisionMux.output().connectTo(imageSink.input());\n\n        // done!\n        pipeline.init(\n            source, screen,\n            greyscale, nightvision, nightvisionMux,\n            pyramid, detector, blur, descriptor, clipper,\n            denoiser, blurredPyramid, subpixel,\n            keypointScaler, keypointSink,\n            //imageSink\n        );\n        return pipeline;\n    }\n\n    /**\n     * Get the reference image associated with a keypoint index in the training map\n     * @param keypointIndex -1 if not found\n     * @returns reference image\n     */\n    referenceImageOfKeypoint(keypointIndex: number): Nullable<ReferenceImageWithMedia>\n    {\n        const imageIndex = this.referenceImageIndexOfKeypoint(keypointIndex);\n        if(imageIndex < 0)\n            return null;\n\n        return this._trainingMap.referenceImages[imageIndex];\n    }\n\n    /**\n     * Get the reference image index associated with a keypoint index in the training map\n     * @param keypointIndex -1 if not found\n     * @returns reference image index, or -1 if not found\n     */\n    referenceImageIndexOfKeypoint(keypointIndex: number): number\n    {\n        const n = this._trainingMap.referenceImageIndex.length;\n        if(keypointIndex < 0 || keypointIndex >= n)\n            return -1;\n\n        const imageIndex = this._trainingMap.referenceImageIndex[keypointIndex];\n        if(imageIndex < 0 || imageIndex >= this._trainingMap.referenceImages.length)\n            return -1;\n\n        return imageIndex;\n    }\n\n    /**\n     * Get a keypoint of the trained set\n     * @param keypointIndex -1 if not found\n     * @returns a keypoint\n     */\n    referenceKeypoint(keypointIndex: number): Nullable<SpeedyKeypoint>\n    {\n        if(keypointIndex < 0 || keypointIndex >= this._trainingMap.keypoints.length)\n            return null;\n\n        return this._trainingMap.keypoints[keypointIndex];\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * scanning.ts\n * Scanning state of the Image Tracker\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { SpeedyPoint2 } from 'speedy-vision/types/core/speedy-point';\nimport { SpeedyVector2 } from 'speedy-vision/types/core/speedy-vector';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { SpeedyPipeline, SpeedyPipelineOutput } from 'speedy-vision/types/core/pipeline/pipeline';\nimport { SpeedyPipelineNodeImageSource } from 'speedy-vision/types/core/pipeline/nodes/images/source';\nimport { SpeedyPipelineNodeImageMultiplexer } from 'speedy-vision/types/core/pipeline/nodes/images/multiplexer';\nimport { SpeedyPipelineNodeResize } from 'speedy-vision/types/core/pipeline/nodes/transforms/resize';\nimport { SpeedyPipelineNodeKeypointTransformer } from 'speedy-vision/types/core/pipeline/nodes/keypoints/transformer';\nimport { SpeedyPipelineNodeKeypointBorderClipper } from 'speedy-vision/types/core/pipeline/nodes/keypoints/border-clipper';\nimport { SpeedyPipelineNodeImagePortalSource, SpeedyPipelineNodeImagePortalSink } from 'speedy-vision/types/core/pipeline/nodes/images/portal';\nimport { SpeedyPipelineNodeStaticLSHTables } from 'speedy-vision/types/core/pipeline/nodes/keypoints/matchers/lsh-static-tables';\nimport { SpeedyKeypoint, SpeedyMatchedKeypoint } from 'speedy-vision/types/core/speedy-keypoint';\nimport { ImageTracker, ImageTrackerOutput, ImageTrackerStateName } from '../image-tracker';\nimport { ImageTrackerUtils, ImageTrackerKeypointPair } from '../image-tracker-utils';\nimport { ImageTrackerState, ImageTrackerStateOutput } from './state';\nimport { Nullable, Utils } from '../../../utils/utils';\nimport { DetectionError } from '../../../utils/errors';\nimport { \n    SCAN_MATCH_RATIO, SCAN_MIN_MATCHES, SCAN_CONSECUTIVE_FRAMES,\n    ORB_GAUSSIAN_KSIZE, ORB_GAUSSIAN_SIGMA,\n    NIGHTVISION_GAIN, NIGHTVISION_OFFSET, NIGHTVISION_DECAY,\n    SCAN_WITH_NIGHTVISION, SCAN_PYRAMID_LEVELS, SCAN_PYRAMID_SCALEFACTOR,\n    SCAN_FAST_THRESHOLD, SCAN_MAX_KEYPOINTS, SCAN_LSH_TABLES, SCAN_LSH_HASHSIZE,\n    SCAN_RANSAC_REPROJECTIONERROR_NDC,\n    NIGHTVISION_QUALITY,\n} from '../settings';\n\n\n/** Port of the portal multiplexer: get new data from the camera */\nconst PORT_CAMERA = 0;\n\n/** Port of the portal multiplexer: get previously memorized data */\nconst PORT_MEMORY = 1;\n\n\n\n/**\n * In the scanning state we look for a reference image in the video\n */\nexport class ImageTrackerScanningState extends ImageTrackerState\n{\n    /** counts consecutive frames (matching) */\n    private _counter: number;\n\n    /** best homography matrix found so far */\n    private _bestHomography: SpeedyMatrix;\n\n    /** score related to the number of inliers (for robust homography estimation) */\n    private _bestScore: number;\n\n\n\n    /**\n     * Constructor\n     * @param imageTracker\n     */\n    constructor(imageTracker: ImageTracker)\n    {\n        super('scanning', imageTracker);\n\n        this._counter = 0;\n        this._bestScore = 0;\n        this._bestHomography = Speedy.Matrix.Eye(3);\n    }\n\n    /**\n     * Called as soon as this becomes the active state, just before update() runs for the first time\n     * @param settings\n     */\n    onEnterState(settings: Record<string,any>)\n    {\n        const imagePortalMux = this._pipeline.node('imagePortalMux') as SpeedyPipelineNodeImageMultiplexer;\n        const lshTables = this._pipeline.node('lshTables') as SpeedyPipelineNodeStaticLSHTables;\n        const database = settings.database as SpeedyKeypoint[] | undefined;\n\n        // set attributes\n        this._counter = 0;\n        this._bestScore = 0;\n\n        // reset the image memorization circuit\n        imagePortalMux.port = PORT_CAMERA;\n\n        // prepare the keypoint matcher\n        if(database !== undefined)\n            lshTables.keypoints = database;\n    }\n\n    /**\n     * Called just before the GPU processing\n     * @returns promise\n     */\n    protected _beforeUpdate(): SpeedyPromise<void>\n    {\n        const keypointScaler = this._pipeline.node('keypointScaler') as SpeedyPipelineNodeKeypointTransformer;\n        const screenSize = this.screenSize;\n\n        // convert keypoints to NIS\n        keypointScaler.transform = ImageTrackerUtils.rasterToNIS(screenSize);\n\n        // done!\n        return Speedy.Promise.resolve();\n    }\n\n    /**\n     * Post processing that takes place just after the GPU processing\n     * @param result pipeline results\n     * @returns state output\n     */\n    protected _afterUpdate(result: SpeedyPipelineOutput): SpeedyPromise<ImageTrackerStateOutput>\n    {\n        const imagePortalMux = this._pipeline.node('imagePortalMux') as SpeedyPipelineNodeImageMultiplexer;\n        const keypoints = result.keypoints as SpeedyMatchedKeypoint[];\n        const image = result.image as SpeedyMedia | undefined;\n\n        // tracker output\n        const trackerOutput: ImageTrackerOutput = {\n            keypointsNIS: keypoints,\n            polylineNDC: [],\n            image: image,\n        };\n\n        // keep the last memorized image\n        imagePortalMux.port = PORT_MEMORY;\n\n        // find high quality matches\n        const matchedKeypoints = this._selectGoodMatches(keypoints);\n        if(matchedKeypoints.length < SCAN_MIN_MATCHES) {\n\n            // not enough high quality matches?\n            // we'll continue to scan the scene\n            this._counter = 0;\n            this._bestScore = 0;\n\n            return Speedy.Promise.resolve({\n                nextState: 'scanning',\n                trackerOutput: trackerOutput,\n            });\n\n        }\n\n        // we have enough high quality matches!\n        const pairs = this._findMatchingPairs(matchedKeypoints);\n        const points = ImageTrackerUtils.compilePairsOfKeypointsNDC(pairs);\n\n        // find a homography\n        return this._findHomographyNDC(points).then(([homography, score]) => {\n\n            // have we found the best homography so far?\n            if(score >= this._bestScore) {\n\n                // store it only if we'll be running the pipeline again\n                if(this._counter < SCAN_CONSECUTIVE_FRAMES - 1) {\n                    this._bestScore = score;\n                    this._bestHomography = homography;\n\n                    // memorize the last image, corresponding to the best homography(*)\n                    imagePortalMux.port = PORT_CAMERA;\n\n                    /*\n\n                    (*) technically speaking, this is not exactly the case. Since we're\n                        using turbo to download the keypoints, there's a slight difference\n                        between the data used to compute the homography and the last image.\n                        Still, assuming continuity of the video stream, this logic is\n                        good enough.\n\n                    */\n                }\n\n            }\n\n            // find a polyline surrounding the target\n            const polylineNDC = ImageTrackerUtils.findPolylineNDC(homography);\n            trackerOutput.polylineNDC!.push(...polylineNDC);\n\n            // continue a little longer in the scanning state\n            if(++this._counter < SCAN_CONSECUTIVE_FRAMES) {\n                return {\n                    nextState: 'scanning',\n                    trackerOutput: trackerOutput\n                };\n            }\n\n            // this image should correspond to the best homography\n            const snapshot = this._pipeline.node('imagePortalSink') as SpeedyPipelineNodeImagePortalSink;\n\n            // the reference image that we'll track\n            const referenceImage = this._imageTracker._referenceImageOfKeypoint(\n                matchedKeypoints[0].matches[0].index\n            );\n\n            // this shouldn't happen\n            if(!referenceImage)\n                throw new DetectionError(`Can't track an unknown reference image`);\n\n            // let's track the target!\n            return {\n                nextState: 'pre-tracking-a',\n                nextStateSettings: {\n                    homography: this._bestHomography,\n                    snapshot: snapshot,\n                    referenceImage: referenceImage,\n                },\n                trackerOutput: trackerOutput\n            };\n\n        })\n        .catch(err => {\n\n            // continue in the scanning state\n            Utils.warning(`Error when scanning: ${err.toString()}`)\n            return {\n                nextState: 'scanning',\n                trackerOutput: trackerOutput,\n            };\n\n        });\n    }\n\n    /**\n     * Select high quality matches of a single reference image\n     * @param keypoints matched keypoints of any quality, to any reference image\n     * @returns high quality matches of a single reference image\n     */\n    private _selectGoodMatches(keypoints: SpeedyMatchedKeypoint[]): SpeedyMatchedKeypoint[]\n    {\n        const matchedKeypointsPerImageIndex: Record<number,SpeedyMatchedKeypoint[]> = Object.create(null);\n\n        // find high quality matches, regardless of reference image\n        for(let j = keypoints.length - 1; j >= 0; j--) {\n            const keypoint = keypoints[j];\n            if(keypoint.matches[0].index >= 0 && keypoint.matches[1].index >= 0) {\n                const d1 = keypoint.matches[0].distance, d2 = keypoint.matches[1].distance;\n\n                // the best match should be \"much better\" than the second best match,\n                // which means that they are \"distinct enough\"\n                if(d1 <= SCAN_MATCH_RATIO * d2) {\n                    const idx = this._imageTracker._referenceImageIndexOfKeypoint(keypoint.matches[0].index);\n                    if(idx >= 0) {\n                        if(!Object.prototype.hasOwnProperty.call(matchedKeypointsPerImageIndex, idx))\n                            matchedKeypointsPerImageIndex[idx] = [];\n                        matchedKeypointsPerImageIndex[idx].push(keypoint);\n                    }\n                }\n\n            }\n        }\n\n        // find the reference image with the most high quality matches\n        let matchedKeypoints: SpeedyMatchedKeypoint[] = [];\n        for(const imageIndex in matchedKeypointsPerImageIndex) {\n            if(matchedKeypointsPerImageIndex[imageIndex].length > matchedKeypoints.length)\n                matchedKeypoints = matchedKeypointsPerImageIndex[imageIndex];\n        }\n\n        // done!\n        return matchedKeypoints;\n    }\n\n    /**\n     * Find a homography matrix using matched keypoints in NDC\n     * @param points compiled pairs of keypoints in NDC\n     * @returns homography (from reference to matched, NDC) & \"quality\" score\n     */\n    private _findHomographyNDC(points: SpeedyMatrix): SpeedyPromise<[SpeedyMatrix,number]>\n    {\n        return ImageTrackerUtils.findPerspectiveWarpNDC(points, {\n            method: 'pransac',\n            reprojectionError: SCAN_RANSAC_REPROJECTIONERROR_NDC,\n            numberOfHypotheses: 512*2,\n            bundleSize: 128,\n        });\n    }\n\n    /**\n     * Find matching pairs of keypoints from reference image (src) to matched image (dest)\n     * @param matchedKeypoints\n     * @returns an array of matching pairs [src, dest]\n     */\n    private _findMatchingPairs(matchedKeypoints: SpeedyMatchedKeypoint[]): ImageTrackerKeypointPair[]\n    {\n        const pairs = new Array<ImageTrackerKeypointPair>(matchedKeypoints.length);\n\n        for(let i = matchedKeypoints.length - 1; i >= 0; i--) {\n            const matchedKeypoint = matchedKeypoints[i];\n            const referenceKeypoint = this._imageTracker._referenceKeypoint(matchedKeypoint.matches[0].index);\n\n            // this shouldn't happen\n            if(referenceKeypoint == null)\n                throw new DetectionError(`Invalid keypoint match index: ${matchedKeypoint.matches[0].index} from ${matchedKeypoint.toString()}`);\n\n            pairs[i] = [ referenceKeypoint, matchedKeypoint ];\n        }\n\n        return pairs;\n    }\n\n    /**\n     * Create & setup the pipeline\n     * @returns pipeline\n     */\n    protected _createPipeline(): SpeedyPipeline\n    {\n        const pipeline = Speedy.Pipeline();\n\n        const source = Speedy.Image.Source('source');\n        const screen = Speedy.Transform.Resize('screen');\n        const greyscale = Speedy.Filter.Greyscale();\n        const blur = Speedy.Filter.GaussianBlur();\n        const nightvision = Speedy.Filter.Nightvision();\n        const nightvisionMux = Speedy.Image.Multiplexer('nightvisionMux');\n        const pyramid = Speedy.Image.Pyramid();\n        const detector = Speedy.Keypoint.Detector.FAST();\n        const descriptor = Speedy.Keypoint.Descriptor.ORB();\n        const clipper = Speedy.Keypoint.Clipper();\n        const lshTables = Speedy.Keypoint.Matcher.StaticLSHTables('lshTables');\n        const knn = Speedy.Keypoint.Matcher.LSHKNN();\n        const keypointScaler = Speedy.Keypoint.Transformer('keypointScaler');\n        const keypointSink = Speedy.Keypoint.SinkOfMatchedKeypoints('keypoints');\n        const imagePortalSink = Speedy.Image.Portal.Sink('imagePortalSink');\n        const imagePortalSource = Speedy.Image.Portal.Source('imagePortalSource');\n        const imagePortalMux = Speedy.Image.Multiplexer('imagePortalMux');\n        const imagePortalBuffer = Speedy.Image.Buffer();\n        const imagePortalCopy = Speedy.Transform.Resize();\n        //const imageSink = Speedy.Image.Sink('image');\n\n        source.media = null;\n        screen.size = Speedy.Size(0,0);\n        blur.kernelSize = Speedy.Size(ORB_GAUSSIAN_KSIZE, ORB_GAUSSIAN_KSIZE);\n        blur.sigma = Speedy.Vector2(ORB_GAUSSIAN_SIGMA, ORB_GAUSSIAN_SIGMA);\n        nightvision.gain = NIGHTVISION_GAIN;\n        nightvision.offset = NIGHTVISION_OFFSET;\n        nightvision.decay = NIGHTVISION_DECAY;\n        nightvision.quality = NIGHTVISION_QUALITY;\n        nightvisionMux.port = SCAN_WITH_NIGHTVISION ? 1 : 0; // 1 = enable nightvision\n        detector.levels = SCAN_PYRAMID_LEVELS;\n        detector.scaleFactor = SCAN_PYRAMID_SCALEFACTOR;\n        detector.threshold = SCAN_FAST_THRESHOLD;\n        detector.capacity = 2048;\n        clipper.size = SCAN_MAX_KEYPOINTS;\n        lshTables.keypoints = [];\n        lshTables.numberOfTables = SCAN_LSH_TABLES;\n        lshTables.hashSize = SCAN_LSH_HASHSIZE;\n        knn.k = 2;\n        knn.quality = 'default';\n        //knn.quality = 'fastest';\n        imagePortalSource.source = imagePortalSink;\n        imagePortalMux.port = PORT_CAMERA; // 0 = camera stream; 1 = lock image\n        imagePortalCopy.size = Speedy.Size(0,0);\n        imagePortalCopy.scale = Speedy.Vector2(1,1);\n        keypointScaler.transform = Speedy.Matrix.Eye(3);\n        keypointSink.turbo = true;\n\n        // prepare input\n        source.output().connectTo(screen.input());\n        screen.output().connectTo(greyscale.input());\n\n        // preprocess image\n        greyscale.output().connectTo(blur.input());\n        greyscale.output().connectTo(nightvisionMux.input('in0'));\n        greyscale.output().connectTo(nightvision.input());\n        nightvision.output().connectTo(nightvisionMux.input('in1'));\n        nightvisionMux.output().connectTo(pyramid.input());\n\n        // keypoint detection\n        pyramid.output().connectTo(detector.input());\n        detector.output().connectTo(clipper.input());\n\n        // keypoint description\n        blur.output().connectTo(descriptor.input('image'));\n        clipper.output().connectTo(descriptor.input('keypoints'));\n\n        // keypoint matching\n        descriptor.output().connectTo(knn.input('keypoints'));\n        lshTables.output().connectTo(knn.input('lsh'));\n\n        // prepare output\n        clipper.output().connectTo(keypointScaler.input());\n        keypointScaler.output().connectTo(keypointSink.input());\n        knn.output().connectTo(keypointSink.input('matches'));\n        //pyramid.output().connectTo(imageSink.input());\n\n        // memorize image\n        source.output().connectTo(imagePortalBuffer.input());\n        imagePortalBuffer.output().connectTo(imagePortalMux.input('in0'));\n        imagePortalSource.output().connectTo(imagePortalCopy.input());\n        imagePortalCopy.output().connectTo(imagePortalMux.input('in1'));\n        imagePortalMux.output().connectTo(imagePortalSink.input());\n\n        // done!\n        pipeline.init(\n            source, screen,\n            greyscale, blur, nightvision, nightvisionMux, pyramid,\n            detector, descriptor, clipper,\n            lshTables, knn,\n            keypointScaler, keypointSink,\n            imagePortalSink, imagePortalSource,\n            imagePortalMux, imagePortalBuffer, imagePortalCopy,\n            //, imageSink\n        );\n        return pipeline;\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * pre-tracking-a.ts\n * Image tracker: Pre-Tracking A state\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { SpeedyPipeline, SpeedyPipelineOutput } from 'speedy-vision/types/core/pipeline/pipeline';\nimport { SpeedyPipelineNodeImageSource } from 'speedy-vision/types/core/pipeline/nodes/images/source';\nimport { SpeedyPipelineNodeImageMultiplexer } from 'speedy-vision/types/core/pipeline/nodes/images/multiplexer';\nimport { SpeedyPipelineNodeImagePortalSource, SpeedyPipelineNodeImagePortalSink } from 'speedy-vision/types/core/pipeline/nodes/images/portal';\nimport { SpeedyPipelineNodeKeypointPortalSource, SpeedyPipelineNodeKeypointPortalSink } from 'speedy-vision/types/core/pipeline/nodes/keypoints/portal';\nimport { SpeedyPipelineNodeResize } from 'speedy-vision/types/core/pipeline/nodes/transforms/resize';\nimport { SpeedyPipelineNodePerspectiveWarp } from 'speedy-vision/types/core/pipeline/nodes/transforms/perspective-warp';\nimport { SpeedyPipelineNodeKeypointBorderClipper } from 'speedy-vision/types/core/pipeline/nodes/keypoints/border-clipper';\nimport { SpeedyPipelineNodeKeypointTransformer } from 'speedy-vision/types/core/pipeline/nodes/keypoints/transformer';\nimport { SpeedyKeypoint, SpeedyMatchedKeypoint } from 'speedy-vision/types/core/speedy-keypoint';\nimport { ImageTracker, ImageTrackerOutput, ImageTrackerStateName } from '../image-tracker';\nimport { ImageTrackerUtils, ImageTrackerKeypointPair } from '../image-tracker-utils';\nimport { ImageTrackerState, ImageTrackerStateOutput } from './state';\nimport { ReferenceImage, ReferenceImageWithMedia } from '../reference-image';\nimport { Nullable, Utils } from '../../../utils/utils';\nimport { TrackingError } from '../../../utils/errors';\nimport {\n    TRACK_RECTIFIED_SCALE, TRACK_CLIPPING_BORDER,\n    NIGHTVISION_GAIN, NIGHTVISION_OFFSET, NIGHTVISION_DECAY, TRACK_WITH_NIGHTVISION,\n    ORB_GAUSSIAN_KSIZE, ORB_GAUSSIAN_SIGMA,\n    TRACK_HARRIS_QUALITY, TRACK_DETECTOR_CAPACITY, TRACK_MAX_KEYPOINTS,\n    SUBPIXEL_GAUSSIAN_KSIZE, SUBPIXEL_GAUSSIAN_SIGMA,\n    PRE_TRACK_MIN_MATCHES,\n    NIGHTVISION_QUALITY,\n    SUBPIXEL_METHOD,\n} from '../settings';\n\n\n\n/**\n * Pre-Tracking A is a new training phase. The reference image that was found\n * in the scanning state is transported to AR screen space, and a new training\n * takes place there, with new keypoints and in a suitable warp.\n */\nexport class ImageTrackerPreTrackingAState extends ImageTrackerState\n{\n    /** reference image */\n    private _referenceImage: Nullable<ReferenceImageWithMedia>;\n\n    /** a snapshot of the video from the scanning state and corresponding to the initial homography */\n    private _snapshot: Nullable<SpeedyPipelineNodeImagePortalSink>;\n\n    /** initial homography, from reference image to scanned image, NDC */\n    private _homography: SpeedyMatrix;\n\n\n\n    /**\n     * Constructor\n     * @param imageTracker\n     */\n    constructor(imageTracker: ImageTracker)\n    {\n        super('pre-tracking-a', imageTracker);\n\n        this._homography = Speedy.Matrix.Eye(3);\n        this._referenceImage = null;\n        this._snapshot = null;\n    }\n\n    /**\n     * Called as soon as this becomes the active state, just before update() runs for the first time\n     * @param settings\n     */\n    onEnterState(settings: Record<string,any>)\n    {\n        const homography = settings.homography as SpeedyMatrix;\n        const referenceImage = settings.referenceImage as ReferenceImageWithMedia;\n        const snapshot = settings.snapshot as SpeedyPipelineNodeImagePortalSink;\n\n        // set attributes\n        this._homography = homography;\n        this._referenceImage = referenceImage;\n        this._snapshot = snapshot;\n    }\n\n    /**\n     * Called just before the GPU processing\n     * @returns promise\n     */\n    protected _beforeUpdate(): SpeedyPromise<void>\n    {\n        const screenSize = this.screenSize;\n        const source = this._pipeline.node('source') as SpeedyPipelineNodeImageSource;\n        const imageRectifier = this._pipeline.node('imageRectifier') as SpeedyPipelineNodePerspectiveWarp;\n        const keypointScaler = this._pipeline.node('keypointScaler') as SpeedyPipelineNodeKeypointTransformer;\n        const borderClipper = this._pipeline.node('borderClipper') as SpeedyPipelineNodeKeypointBorderClipper;\n\n        // set the reference image as the source image\n        source.media = this._referenceImage!.media;\n\n        // clip keypoints from the borders of the target image\n        borderClipper.imageSize = screenSize;\n        borderClipper.borderSize = Speedy.Vector2(\n            screenSize.width * TRACK_CLIPPING_BORDER,\n            screenSize.height * TRACK_CLIPPING_BORDER\n        );\n\n        // convert keypoints to NIS\n        keypointScaler.transform = ImageTrackerUtils.rasterToNIS(screenSize);\n\n        // rectify the image\n        const scale = TRACK_RECTIFIED_SCALE;\n        const aspectRatio = ImageTrackerUtils.bestFitAspectRatioNDC(screenSize, this._referenceImage!);\n        const shrink = ImageTrackerUtils.bestFitScaleNDC(aspectRatio, scale);\n        const toScreen = ImageTrackerUtils.NDCToRaster(screenSize);\n        const toNDC = ImageTrackerUtils.rasterToNDC(screenSize);\n\n        return imageRectifier.transform.setTo(\n            toScreen.times(shrink).times(toNDC)\n        ).then(() => void 0);\n    }\n\n    /**\n     * Post processing that takes place just after the GPU processing\n     * @param result pipeline results\n     * @returns state output\n     */\n    protected _afterUpdate(result: SpeedyPipelineOutput): SpeedyPromise<ImageTrackerStateOutput>\n    {\n        const referenceImage = this._referenceImage!;\n        const keypointPortalSink = this._pipeline.node('keypointPortalSink') as SpeedyPipelineNodeKeypointPortalSink;\n        const keypoints = result.keypoints as SpeedyKeypoint[];\n        const image = result.image as SpeedyMedia | undefined;\n\n        // tracker output\n        const trackerOutput: ImageTrackerOutput = {\n            keypointsNIS: image !== undefined ? keypoints : undefined, // debug only\n            image: image,\n        };\n\n        // not enough keypoints? something went wrong!\n        if(keypoints.length < PRE_TRACK_MIN_MATCHES) {\n            Utils.warning(`Can't pre-track \"${referenceImage.name}\" in ${this.name}!`);\n            return Speedy.Promise.resolve({\n                nextState: 'scanning',\n                trackerOutput: trackerOutput,\n            });\n        }\n\n        // done!\n        return Speedy.Promise.resolve({\n            nextState: 'pre-tracking-b',\n            trackerOutput: trackerOutput,\n            nextStateSettings: {\n                referenceKeypointPortalSink: keypointPortalSink,\n                referenceImage: this._referenceImage,\n                snapshot: this._snapshot,\n                homography: this._homography,\n            }\n        });\n    }\n\n    /**\n     * Create & setup the pipeline\n     * @returns pipeline\n     */\n    protected _createPipeline(): SpeedyPipeline\n    {\n        const pipeline = Speedy.Pipeline();\n\n        const source = Speedy.Image.Source('source');\n        const screen = Speedy.Transform.Resize('screen');\n        const greyscale = Speedy.Filter.Greyscale();\n        const imageRectifier = Speedy.Transform.PerspectiveWarp('imageRectifier');\n        const nightvision = Speedy.Filter.Nightvision();\n        const nightvisionMux = Speedy.Image.Multiplexer();\n        const detector = Speedy.Keypoint.Detector.Harris();\n        const descriptor = Speedy.Keypoint.Descriptor.ORB();\n        const blur = Speedy.Filter.GaussianBlur();\n        const clipper = Speedy.Keypoint.Clipper();\n        const borderClipper = Speedy.Keypoint.BorderClipper('borderClipper');\n        const denoiser = Speedy.Filter.GaussianBlur();\n        const subpixel = Speedy.Keypoint.SubpixelRefiner();\n        const keypointScaler = Speedy.Keypoint.Transformer('keypointScaler');\n        const keypointPortalSink = Speedy.Keypoint.Portal.Sink('keypointPortalSink');\n        const keypointSink = Speedy.Keypoint.Sink('keypoints');\n        //const imageSink = Speedy.Image.Sink('image');\n\n        source.media = null;\n        imageRectifier.transform = Speedy.Matrix.Eye(3);\n        screen.size = Speedy.Size(0,0);\n        nightvision.gain = NIGHTVISION_GAIN;\n        nightvision.offset = NIGHTVISION_OFFSET;\n        nightvision.decay = NIGHTVISION_DECAY;\n        nightvision.quality = NIGHTVISION_QUALITY;\n        nightvisionMux.port = TRACK_WITH_NIGHTVISION ? 1 : 0; // 1 = enable nightvision\n        blur.kernelSize = Speedy.Size(ORB_GAUSSIAN_KSIZE, ORB_GAUSSIAN_KSIZE);\n        blur.sigma = Speedy.Vector2(ORB_GAUSSIAN_SIGMA, ORB_GAUSSIAN_SIGMA);\n        denoiser.kernelSize = Speedy.Size(SUBPIXEL_GAUSSIAN_KSIZE, SUBPIXEL_GAUSSIAN_KSIZE);\n        denoiser.sigma = Speedy.Vector2(SUBPIXEL_GAUSSIAN_SIGMA, SUBPIXEL_GAUSSIAN_SIGMA);\n        detector.quality = TRACK_HARRIS_QUALITY;\n        detector.capacity = TRACK_DETECTOR_CAPACITY;\n        subpixel.method = SUBPIXEL_METHOD;\n        clipper.size = TRACK_MAX_KEYPOINTS;\n        borderClipper.imageSize = screen.size;\n        borderClipper.borderSize = Speedy.Vector2(0,0);\n        keypointScaler.transform = Speedy.Matrix.Eye(3);\n        keypointSink.turbo = false;\n\n        // prepare input\n        source.output().connectTo(screen.input());\n        screen.output().connectTo(greyscale.input());\n\n        // preprocess images\n        greyscale.output().connectTo(imageRectifier.input());\n        imageRectifier.output().connectTo(nightvisionMux.input('in0'));\n        imageRectifier.output().connectTo(nightvision.input());\n        nightvision.output().connectTo(nightvisionMux.input('in1'));\n\n        // keypoint detection & clipping\n        nightvisionMux.output().connectTo(detector.input());\n        detector.output().connectTo(borderClipper.input());\n        borderClipper.output().connectTo(clipper.input());\n\n        // keypoint refinement\n        imageRectifier.output().connectTo(denoiser.input());\n        denoiser.output().connectTo(subpixel.input('image'));\n        clipper.output().connectTo(subpixel.input('keypoints'));\n\n        // keypoint description\n        nightvisionMux.output().connectTo(blur.input());\n        blur.output().connectTo(descriptor.input('image'));\n        subpixel.output().connectTo(descriptor.input('keypoints'));\n\n        // prepare output\n        descriptor.output().connectTo(keypointScaler.input());\n        keypointScaler.output().connectTo(keypointSink.input());\n        keypointScaler.output().connectTo(keypointPortalSink.input());\n        //imageRectifier.output().connectTo(imageSink.input());\n\n        // done!\n        pipeline.init(\n            source, screen,\n            greyscale, imageRectifier,\n            nightvision, nightvisionMux,\n            detector, borderClipper, clipper,\n            denoiser, subpixel,\n            blur, descriptor,\n            keypointScaler, keypointSink, keypointPortalSink,\n            //imageSink\n        );\n\n        return pipeline;\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * pre-tracking-b.ts\n * Image tracker: Pre-Tracking B state\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { SpeedyMatrixExpr } from 'speedy-vision/types/core/speedy-matrix-expr';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { SpeedyPipeline, SpeedyPipelineOutput } from 'speedy-vision/types/core/pipeline/pipeline';\nimport { SpeedyPipelineNodeImageSource } from 'speedy-vision/types/core/pipeline/nodes/images/source';\nimport { SpeedyPipelineNodeImageMultiplexer } from 'speedy-vision/types/core/pipeline/nodes/images/multiplexer';\nimport { SpeedyPipelineNodeImageBuffer } from 'speedy-vision/types/core/pipeline/nodes/images/buffer';\nimport { SpeedyPipelineNodeImagePortalSource, SpeedyPipelineNodeImagePortalSink } from 'speedy-vision/types/core/pipeline/nodes/images/portal';\nimport { SpeedyPipelineNodeKeypointPortalSource, SpeedyPipelineNodeKeypointPortalSink } from 'speedy-vision/types/core/pipeline/nodes/keypoints/portal';\nimport { SpeedyPipelineNodeResize } from 'speedy-vision/types/core/pipeline/nodes/transforms/resize';\nimport { SpeedyPipelineNodePerspectiveWarp } from 'speedy-vision/types/core/pipeline/nodes/transforms/perspective-warp';\nimport { SpeedyPipelineNodeKeypointBorderClipper } from 'speedy-vision/types/core/pipeline/nodes/keypoints/border-clipper';\nimport { SpeedyPipelineNodeKeypointTransformer } from 'speedy-vision/types/core/pipeline/nodes/keypoints/transformer';\nimport { SpeedyKeypoint, SpeedyMatchedKeypoint } from 'speedy-vision/types/core/speedy-keypoint';\nimport { ImageTracker, ImageTrackerOutput, ImageTrackerStateName } from '../image-tracker';\nimport { ImageTrackerUtils, ImageTrackerKeypointPair } from '../image-tracker-utils';\nimport { ImageTrackerState, ImageTrackerStateOutput } from './state';\nimport { ReferenceImageWithMedia } from '../reference-image';\nimport { Nullable, Utils } from '../../../utils/utils';\nimport { TrackingError } from '../../../utils/errors';\nimport {\n    TRACK_RECTIFIED_SCALE, TRACK_CLIPPING_BORDER,\n    NIGHTVISION_GAIN, NIGHTVISION_OFFSET, NIGHTVISION_DECAY, TRACK_WITH_NIGHTVISION,\n    ORB_GAUSSIAN_KSIZE, ORB_GAUSSIAN_SIGMA,\n    TRACK_HARRIS_QUALITY, TRACK_DETECTOR_CAPACITY, TRACK_MAX_KEYPOINTS,\n    SUBPIXEL_GAUSSIAN_KSIZE, SUBPIXEL_GAUSSIAN_SIGMA,\n    PRE_TRACK_MIN_MATCHES, PRE_TRACK_MAX_ITERATIONS,\n    PRE_TRACK_MATCH_RATIO, PRE_TRACK_RANSAC_REPROJECTIONERROR_NDC,\n    PRE_TRACK_FILTER_ALPHA, PRE_TRACK_FILTER_BETA,\n    NIGHTVISION_QUALITY,\n    SUBPIXEL_METHOD,\n} from '../settings';\n\n/** Port of the source image multiplexer: get data from the portal */\nconst PORT_PORTAL = 0;\n\n/** Port of the source image multiplexer: get data from the camera */\nconst PORT_CAMERA = 1;\n\n\n\n\n/**\n * In Pre-Tracking B, we refine the homography obtained at the scanning state.\n * We find a transformation that warps the snapshot obtained from the scanning\n * state to an image that closely resembles the output of Pre-Tracking A.\n */\nexport class ImageTrackerPreTrackingBState extends ImageTrackerState\n{\n    /** reference image */\n    private _referenceImage: Nullable<ReferenceImageWithMedia>;\n\n    /** a snapshot of the video from the scanning state and corresponding to the initial homography */\n    private _snapshot: Nullable<SpeedyPipelineNodeImagePortalSink>;\n\n    /** initial homography, from reference image to scanned image, NDC */\n    private _homography: SpeedyMatrix;\n\n    /** portal with keypoints from Pre-Tracking A */\n    private _referenceKeypointPortalSink: Nullable<SpeedyPipelineNodeKeypointPortalSink>;\n\n    /** number of iterations */\n    private _iterations: number;\n\n\n\n\n\n\n    /**\n     * Constructor\n     * @param imageTracker\n     */\n    constructor(imageTracker: ImageTracker)\n    {\n        super('pre-tracking-b', imageTracker);\n\n        this._homography = Speedy.Matrix.Eye(3);\n        this._referenceImage = null;\n        this._snapshot = null;\n        this._referenceKeypointPortalSink = null;\n        this._iterations = 0;\n    }\n\n    /**\n     * Called as soon as this becomes the active state, just before update() runs for the first time\n     * @param settings\n     */\n    onEnterState(settings: Record<string,any>)\n    {\n        const homography = settings.homography as SpeedyMatrix;\n        const referenceImage = settings.referenceImage as ReferenceImageWithMedia;\n        const snapshot = settings.snapshot as SpeedyPipelineNodeImagePortalSink;\n        const referenceKeypointPortalSink = settings.referenceKeypointPortalSink as SpeedyPipelineNodeKeypointPortalSink;\n        const sourceMux = this._pipeline.node('sourceMux') as SpeedyPipelineNodeImageMultiplexer;\n        const sourceBuffer = this._pipeline.node('sourceBuffer') as SpeedyPipelineNodeImageBuffer;\n\n        // set attributes\n        this._homography = homography;\n        this._referenceImage = referenceImage;\n        this._snapshot = snapshot;\n        this._referenceKeypointPortalSink = referenceKeypointPortalSink;\n        this._iterations = 0;\n\n        // reset nodes\n        sourceMux.port = PORT_PORTAL;\n        sourceBuffer.frozen = false;\n    }\n\n    /**\n     * Called just before the GPU processing\n     * @returns promise\n     */\n    protected _beforeUpdate(): SpeedyPromise<void>\n    {\n        const screenSize = this.screenSize;\n        const imageRectifier = this._pipeline.node('imageRectifier') as SpeedyPipelineNodePerspectiveWarp;\n        const keypointScaler = this._pipeline.node('keypointScaler') as SpeedyPipelineNodeKeypointTransformer;\n        const borderClipper = this._pipeline.node('borderClipper') as SpeedyPipelineNodeKeypointBorderClipper;\n        const imagePortalSource = this._pipeline.node('imagePortalSource') as SpeedyPipelineNodeImagePortalSource;\n        const referenceKeypointPortalSource = this._pipeline.node('referenceKeypointPortalSource') as SpeedyPipelineNodeKeypointPortalSource;\n\n        // get the snapshot from the scanning state\n        imagePortalSource.source = this._snapshot!;\n\n        // get the reference keypoints from Pre-Tracking A\n        referenceKeypointPortalSource.source = this._referenceKeypointPortalSink!;\n\n        // clip keypoints from the borders of the target image\n        borderClipper.imageSize = screenSize;\n        borderClipper.borderSize = Speedy.Vector2(\n            screenSize.width * TRACK_CLIPPING_BORDER,\n            screenSize.height * TRACK_CLIPPING_BORDER\n        );\n\n        // convert keypoints to NIS\n        keypointScaler.transform = ImageTrackerUtils.rasterToNIS(screenSize);\n\n        // rectify the image\n        const scale = TRACK_RECTIFIED_SCALE;\n        const aspectRatio = ImageTrackerUtils.bestFitAspectRatioNDC(screenSize, this._referenceImage!);\n        const shrink = ImageTrackerUtils.bestFitScaleNDC(aspectRatio, scale);\n        const undistort = this._homography.inverse();\n        const toScreen = ImageTrackerUtils.NDCToRaster(screenSize);\n        const toNDC = ImageTrackerUtils.rasterToNDC(screenSize);\n\n        return imageRectifier.transform.setTo(\n            toScreen.times(shrink.times(undistort)).times(toNDC)\n        ).then(() => void 0);\n    }\n\n    /**\n     * Post processing that takes place just after the GPU processing\n     * @param result pipeline results\n     * @returns state output\n     */\n    protected _afterUpdate(result: SpeedyPipelineOutput): SpeedyPromise<ImageTrackerStateOutput>\n    {\n        const referenceImage = this._referenceImage!;\n        const referenceKeypoints = result.referenceKeypoints as SpeedyKeypoint[]; // from Pre-Tracking A\n        const keypoints = result.keypoints as SpeedyMatchedKeypoint[]; // from Pre-Tracking B\n        const image = result.image as SpeedyMedia | undefined;\n        const keypointPortalSink = this._pipeline.node('keypointPortalSink') as SpeedyPipelineNodeKeypointPortalSink;\n        const sourceMux = this._pipeline.node('sourceMux') as SpeedyPipelineNodeImageMultiplexer;\n        const sourceBuffer = this._pipeline.node('sourceBuffer') as SpeedyPipelineNodeImageBuffer;\n\n        // tracker output\n        const trackerOutput: ImageTrackerOutput = {\n            keypointsNIS: image !== undefined ? keypoints : undefined, // debug only\n            image: image,\n        };\n\n        return Speedy.Promise.resolve()\n        .then(() => {\n\n            // find matching pairs of keypoints\n            const pairs = this._findMatchingPairs(referenceKeypoints, keypoints);\n            //const pairs = ImageTrackerUtils.refineMatchingPairs(allPairs);\n            if(pairs.length < PRE_TRACK_MIN_MATCHES)\n                throw new TrackingError('Not enough data points');\n\n            // find a warp\n            const points = ImageTrackerUtils.compilePairsOfKeypointsNDC(pairs);\n            return this._findMotionNDC(points);\n\n        })\n        .then(warp => {\n\n            // get the camera image in the next iteration\n            // the warped snapshot from the scanning state is occasionally very blurry\n            sourceMux.port = PORT_CAMERA;\n            sourceBuffer.frozen = true;\n\n            // refine the homography\n            //return this._homography.setTo(warp.times(this._homography));\n\n            // apply filter\n            return ImageTrackerUtils.interpolateHomographies(\n                this._homography,\n                Speedy.Matrix(warp.times(this._homography)),\n                PRE_TRACK_FILTER_ALPHA,\n                PRE_TRACK_FILTER_BETA\n            );\n\n        })\n        .then(filteredHomography => {\n\n            // test: count the number of iterations needed\n            // for stabilization with this setup of the filter\n            //console.log(this._iterations);\n\n            // refine the homography\n            return this._homography.setTo(filteredHomography);\n\n        })\n        .then(_ => ({\n            nextState: (++this._iterations < PRE_TRACK_MAX_ITERATIONS) ? 'pre-tracking-b' : 'tracking',\n            trackerOutput: trackerOutput,\n            nextStateSettings: {\n                // we export keypoints obtained in Pre-Tracking B, not in A.\n                templateKeypoints: keypoints,\n                templateKeypointPortalSink: keypointPortalSink,\n                referenceImage: this._referenceImage,\n                homography: this._homography,\n                initialScreenSize: this.screenSize,\n            }\n        }))\n        .catch(err => {\n            Utils.warning(`Can't pre-track \"${referenceImage.name}\" in ${this.name}! ${err.toString()}`);\n            return {\n                nextState: 'scanning',\n                trackerOutput: trackerOutput,\n            };\n        });\n    }\n\n    /**\n     * Find a motion model in NDC between pairs of keypoints in NDC\n     * given as a 2 x 2n [ src | dest ] matrix\n     * @param points compiled pairs of keypoints in NDC\n     * @returns a promise that resolves to a 3x3 warp in NDC that maps source to destination\n     */\n    private _findMotionNDC(points: SpeedyMatrix): SpeedyPromise<SpeedyMatrixExpr>\n    {\n        //return ImageTrackerUtils.findAffineWarpNDC(points, {\n        return ImageTrackerUtils.findPerspectiveWarpNDC(points, {\n            method: 'pransac',\n            reprojectionError: PRE_TRACK_RANSAC_REPROJECTIONERROR_NDC,\n            numberOfHypotheses: 512,\n            bundleSize: 128,\n            mask: undefined // score is not needed\n        }).then(([ warp, score ]) => {\n\n            const scale = TRACK_RECTIFIED_SCALE;\n            const aspectRatio = ImageTrackerUtils.bestFitAspectRatioNDC(this.screenSize, this._referenceImage!);\n            const shrink = ImageTrackerUtils.bestFitScaleNDC(aspectRatio, scale);\n            const grow = ImageTrackerUtils.inverseBestFitScaleNDC(aspectRatio, scale);\n            const scaledWarp = grow.times(warp).times(shrink);\n\n            const distort = this._homography;\n            const undistort = distort.inverse();\n            const correctedWarp = distort.times(scaledWarp).times(undistort);\n\n            //console.log(Speedy.Matrix(warp).toString());\n            //console.log(Speedy.Matrix(scaledWarp).toString());\n            //console.log(Speedy.Matrix(correctedWarp).toString());\n\n            return correctedWarp;\n\n        });\n    }\n\n    /**\n     * Find matching pairs of two sets of keypoints matched via brute force\n     * @param srcKeypoints source (database)\n     * @param destKeypoints destination\n     * @returns an array of matching pairs [src, dest]\n     */\n    private _findMatchingPairs(srcKeypoints: SpeedyKeypoint[], destKeypoints: SpeedyMatchedKeypoint[]): ImageTrackerKeypointPair[]\n    {\n        const pairs: ImageTrackerKeypointPair[] = [];\n\n        for(let i = 0; i < destKeypoints.length; i++) {\n            const destKeypoint = destKeypoints[i];\n\n            if(destKeypoint.matches[0].index >= 0 && destKeypoint.matches[1].index >= 0) {\n                const d1 = destKeypoint.matches[0].distance;\n                const d2 = destKeypoint.matches[1].distance;\n\n                // the best match should be \"much better\" than the second best match,\n                // which means that they are \"distinct enough\"\n                if(d1 <= PRE_TRACK_MATCH_RATIO * d2) {\n                    const srcKeypoint = srcKeypoints[destKeypoint.matches[0].index];\n                    pairs.push([srcKeypoint, destKeypoint]);\n                }\n            }\n        }\n\n        return pairs;\n    }\n\n    /**\n     * Create & setup the pipeline\n     * @returns pipeline\n     */\n    protected _createPipeline(): SpeedyPipeline\n    {\n        const pipeline = Speedy.Pipeline();\n\n        const source = Speedy.Image.Source('source');\n        const imagePortalSource = Speedy.Image.Portal.Source('imagePortalSource');\n        const sourceMux = Speedy.Image.Multiplexer('sourceMux');\n        const sourceBuffer = Speedy.Image.Buffer('sourceBuffer');\n        const referenceKeypointPortalSource = Speedy.Keypoint.Portal.Source('referenceKeypointPortalSource');\n        const screen = Speedy.Transform.Resize('screen');\n        const greyscale = Speedy.Filter.Greyscale();\n        const imageRectifier = Speedy.Transform.PerspectiveWarp('imageRectifier');\n        const nightvision = Speedy.Filter.Nightvision();\n        const nightvisionMux = Speedy.Image.Multiplexer();\n        const detector = Speedy.Keypoint.Detector.Harris();\n        const descriptor = Speedy.Keypoint.Descriptor.ORB();\n        const blur = Speedy.Filter.GaussianBlur();\n        const clipper = Speedy.Keypoint.Clipper();\n        const borderClipper = Speedy.Keypoint.BorderClipper('borderClipper');\n        const denoiser = Speedy.Filter.GaussianBlur();\n        const subpixel = Speedy.Keypoint.SubpixelRefiner();\n        const matcher = Speedy.Keypoint.Matcher.BFKNN();\n        const keypointScaler = Speedy.Keypoint.Transformer('keypointScaler');\n        const keypointSink = Speedy.Keypoint.SinkOfMatchedKeypoints('keypoints');\n        const keypointPortalSink = Speedy.Keypoint.Portal.Sink('keypointPortalSink');\n        const referenceKeypointSink = Speedy.Keypoint.Sink('referenceKeypoints');\n        //const imageSink = Speedy.Image.Sink('image');\n\n        source.media = null;\n        imagePortalSource.source = null;\n        sourceMux.port = PORT_PORTAL;\n        sourceBuffer.frozen = false;\n        referenceKeypointPortalSource.source = null;\n        imageRectifier.transform = Speedy.Matrix.Eye(3);\n        screen.size = Speedy.Size(0,0);\n        nightvision.gain = NIGHTVISION_GAIN;\n        nightvision.offset = NIGHTVISION_OFFSET;\n        nightvision.decay = NIGHTVISION_DECAY;\n        nightvision.quality = NIGHTVISION_QUALITY;\n        nightvisionMux.port = TRACK_WITH_NIGHTVISION ? 1 : 0; // 1 = enable nightvision\n        blur.kernelSize = Speedy.Size(ORB_GAUSSIAN_KSIZE, ORB_GAUSSIAN_KSIZE);\n        blur.sigma = Speedy.Vector2(ORB_GAUSSIAN_SIGMA, ORB_GAUSSIAN_SIGMA);\n        denoiser.kernelSize = Speedy.Size(SUBPIXEL_GAUSSIAN_KSIZE, SUBPIXEL_GAUSSIAN_KSIZE);\n        denoiser.sigma = Speedy.Vector2(SUBPIXEL_GAUSSIAN_SIGMA, SUBPIXEL_GAUSSIAN_SIGMA);\n        detector.quality = TRACK_HARRIS_QUALITY;\n        detector.capacity = TRACK_DETECTOR_CAPACITY;\n        subpixel.method = SUBPIXEL_METHOD;\n        clipper.size = TRACK_MAX_KEYPOINTS;\n        borderClipper.imageSize = screen.size;\n        borderClipper.borderSize = Speedy.Vector2(0,0);\n        matcher.k = 2;\n        keypointScaler.transform = Speedy.Matrix.Eye(3);\n        keypointSink.turbo = false;\n\n        // prepare input\n        imagePortalSource.output().connectTo(sourceMux.input('in0'));\n        source.output().connectTo(sourceBuffer.input());\n        sourceBuffer.output().connectTo(sourceMux.input('in1'));\n        sourceMux.output().connectTo(screen.input());\n        screen.output().connectTo(greyscale.input());\n\n        // preprocess images\n        greyscale.output().connectTo(imageRectifier.input());\n        imageRectifier.output().connectTo(nightvisionMux.input('in0'));\n        imageRectifier.output().connectTo(nightvision.input());\n        nightvision.output().connectTo(nightvisionMux.input('in1'));\n\n        // keypoint detection & clipping\n        nightvisionMux.output().connectTo(detector.input());\n        detector.output().connectTo(borderClipper.input());\n        borderClipper.output().connectTo(clipper.input());\n\n        // keypoint refinement\n        imageRectifier.output().connectTo(denoiser.input());\n        denoiser.output().connectTo(subpixel.input('image'));\n        clipper.output().connectTo(subpixel.input('keypoints'));\n\n        // keypoint description\n        nightvisionMux.output().connectTo(blur.input());\n        blur.output().connectTo(descriptor.input('image'));\n        subpixel.output().connectTo(descriptor.input('keypoints'));\n\n        // keypoint matching\n        descriptor.output().connectTo(matcher.input('keypoints'));\n        referenceKeypointPortalSource.output().connectTo(matcher.input('database'));\n\n        // prepare output\n        descriptor.output().connectTo(keypointScaler.input());\n        keypointScaler.output().connectTo(keypointPortalSink.input());\n        keypointScaler.output().connectTo(keypointSink.input());\n        matcher.output().connectTo(keypointSink.input('matches'));\n        referenceKeypointPortalSource.output().connectTo(referenceKeypointSink.input());\n        //imageRectifier.output().connectTo(imageSink.input());\n\n        // done!\n        pipeline.init(\n            source, imagePortalSource, sourceBuffer, sourceMux, screen,\n            referenceKeypointPortalSource,\n            greyscale, imageRectifier,\n            nightvision, nightvisionMux,\n            detector, borderClipper, clipper,\n            denoiser, subpixel,\n            blur, descriptor,\n            matcher,\n            keypointScaler, keypointSink, keypointPortalSink, referenceKeypointSink,\n            //imageSink\n        );\n\n        return pipeline;\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * image-tracker-event.ts\n * Events emitted by an Image Tracker\n */\n\nimport { ReferenceImage } from './reference-image';\nimport { AREvent } from '../../utils/ar-events';\n\n/** All possible event types emitted by an Image Tracker */\nexport type ImageTrackerEventType = 'targetfound' | 'targetlost';\n\n/**\n * An event emitted by an Image Tracker\n */\nexport class ImageTrackerEvent extends AREvent<ImageTrackerEventType>\n{\n    /* the reference image to which this event is related to */\n    private _referenceImage: ReferenceImage;\n\n\n\n    /**\n     * Constructor\n     * @param type event type\n     * @param referenceImage optional reference image\n     */\n    constructor(type: ImageTrackerEventType, referenceImage: ReferenceImage)\n    {\n        super(type);\n        this._referenceImage = referenceImage;\n    }\n\n    /**\n     * Reference image\n     */\n    get referenceImage(): ReferenceImage\n    {\n        return this._referenceImage;\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * quaternion.ts\n * Quaternions\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { IllegalArgumentError } from '../utils/errors';\nimport { Vector3 } from './vector3';\n\n/** Small number */\nconst EPSILON = 1e-6;\n\n// public / non-internal methods do not change the contents of the quaternion\n\n\n\n/**\n * Quaternion q = x i + y j + z k + w\n */\nexport class Quaternion\n{\n    /** x coordinate (imaginary) */\n    private _x: number;\n\n    /** y coordinate (imaginary) */\n    private _y: number;\n\n    /** z coordinate (imaginary) */\n    private _z: number;\n\n    /** w coordinate (real) */\n    private _w: number;\n\n\n\n    /**\n     * Constructor\n     * @param x x coordinate (imaginary)\n     * @param y y coordinate (imaginary)\n     * @param z z coordinate (imaginary)\n     * @param w w coordinate (real)\n     */\n    constructor(x: number = 0, y: number = 0, z: number = 0, w: number = 1)\n    {\n        this._x = +x;\n        this._y = +y;\n        this._z = +z;\n        this._w = +w;\n    }\n\n    /**\n     * Instantiate an identity quaternion q = 1\n     * @returns a new identity quaternion\n     */\n    static Identity(): Quaternion\n    {\n        return new Quaternion(0, 0, 0, 1);\n    }\n\n    /**\n     * Create a unit quaternion from an axis-angle representation of a rotation\n     * @param axis non-zero\n     * @param angle in radians\n     * @returns a new quaternion\n     */\n    static FromAxisAngle(axis: Vector3, angle: number): Quaternion\n    {\n        // sanity check\n        if(axis.dot(axis) < EPSILON * EPSILON)\n            return Quaternion.Identity();\n\n        // create the quaternion\n        const sin = Math.sin(angle / 2);\n        const cos = Math.cos(angle / 2);\n        const r = axis.normalized();\n\n        const x = r.x * sin;\n        const y = r.y * sin;\n        const z = r.z * sin;\n        const w = cos;\n\n        return new Quaternion(x, y, z, w);\n    }\n\n    /**\n     * The x coordinate of the quaternion (imaginary)\n     */\n    get x(): number\n    {\n        return this._x;\n    }\n\n    /**\n     * The y coordinate of the quaternion (imaginary)\n     */\n    get y(): number\n    {\n        return this._y;\n    }\n\n    /**\n     * The z coordinate of the quaternion (imaginary)\n     */\n    get z(): number\n    {\n        return this._z;\n    }\n\n    /**\n     * The w coordinate of the quaternion (real)\n     */\n    get w(): number\n    {\n        return this._w;\n    }\n\n    /**\n     * The length of this quaternion\n     * @returns sqrt(x^2 + y^2 + z^2 + w^2)\n     */\n    length(): number\n    {\n        const x = this._x;\n        const y = this._y;\n        const z = this._z;\n        const w = this._w;\n\n        return Math.sqrt(x*x + y*y + z*z + w*w);\n    }\n\n    /**\n     * Check if this and q have the same coordinates\n     * @param q a quaternion\n     * @returns true if this and q have the same coordinates\n     */\n    equals(q: Quaternion): boolean\n    {\n        return this._w === q._w && this._x === q._x && this._y === q._y && this._z === q._z;\n    }\n\n    /**\n     * Convert to string\n     * @returns a string\n     */\n    toString(): string\n    {\n        const x = this._x.toFixed(4);\n        const y = this._y.toFixed(4);\n        const z = this._z.toFixed(4);\n        const w = this._w.toFixed(4);\n\n        return `Quaternion(${x},${y},${z},${w})`;\n    }\n\n    /**\n     * Normalize this quaternion\n     * @returns this quaternion, normalized\n     * @internal\n     */\n    _normalize(): Quaternion\n    {\n        const length = this.length();\n\n        if(length < EPSILON) // zero?\n            return this;\n\n        this._x /= length;\n        this._y /= length;\n        this._z /= length;\n        this._w /= length;\n\n        return this;\n    }\n\n    /**\n     * Conjugate this quaternion\n     * @returns this quaternion, conjugated\n     * @internal\n     */\n    _conjugate(): Quaternion\n    {\n        this._x = -this._x;\n        this._y = -this._y;\n        this._z = -this._z;\n\n        return this;\n    }\n\n    /**\n     * Set the coordinates of this quaternion\n     * @param x x-coordinate\n     * @param y y-coordinate\n     * @param z z-coordinate\n     * @param w w-coordinate\n     * @returns this quaternion\n     * @internal\n     */\n    _set(x: number, y: number, z: number, w: number): Quaternion\n    {\n        this._x = +x;\n        this._y = +y;\n        this._z = +z;\n        this._w = +w;\n\n        return this;\n    }\n\n    /**\n     * Copy q to this\n     * @param q a quaternion\n     * @returns this quaternion\n     * @internal\n     */\n    _copyFrom(q: Quaternion): Quaternion\n    {\n        this._x = q._x;\n        this._y = q._y;\n        this._z = q._z;\n        this._w = q._w;\n\n        return this;\n    }\n\n    /**\n     * Convert a quaternion to a 3x3 rotation matrix\n     * @returns a 3x3 rotation matrix\n     * @internal\n     */\n    _toRotationMatrix(): SpeedyMatrix\n    {\n        const length = this.length(); // should be ~ 1\n\n        // sanity check\n        if(length < EPSILON)\n            return Speedy.Matrix.Eye(3);\n\n        // let q = (x,y,z,w) be a unit quaternion\n        const x = this._x / length;\n        const y = this._y / length;\n        const z = this._z / length;\n        const w = this._w / length;\n\n        /*\n\n        Let q = x i + y j + z k + w be a unit quaternion and\n        p = x_p i + y_p j + z_p k be a purely imaginary quaternion (w_p = 0)\n        representing a vector or point P = (x_p, y_p, z_p) in 3D space.\n\n        Let's rewrite q as q = v + w, where v = x i + y j + z k, and then\n        substitute v by the unit vector u = v / |v|, so that q = |v| u + w.\n        Since q is a unit quaternion, it follows that:\n\n        1 = |q|^2 = x^2 + y^2 + z^2 + w^2 = |v|^2 + w^2.\n\n        Given that cos(t~)^2 + sin(t~)^2 = 1 for all real t~, there is a real t\n        such that cos(t) = w and sin(t) = |v|. Let's rewrite q as:\n\n        q = cos(t) + u sin(t)\n\n        (since 0 <= |v| = sin(t), it follows that 0 <= t <= pi)\n\n        A rotation of P, of 2t radians around axis u, can be computed as:\n\n        r_q(p) = q p q*\n\n        where q* is the conjugate of q. (note: since |q| = 1, q q* = q* q = 1)\n\n        ---\n\n        Let h = x_h i + y_h j + z_h k + w_h be a quaternion. The multplication\n        q h can be performed by pre-multiplying h, written as a column vector,\n        by the following L_q matrix:\n\n                      [  w  -z   y   x  ] [ x_h ]\n        q h = L_q h = [  z   w  -x   y  ] [ y_h ]\n                      [ -y   x   w   z  ] [ z_h ]\n                      [ -x  -y  -z   w  ] [ w_h ]\n\n        (expand q h = (x i + y j + z k + w) (x_h i + y_h j + z_h k + w_h) to see)\n\n        Similarly, the product h q* can be expressed by pre-multiplying h by the\n        following R_q* matrix:\n\n                        [  w  -z   y  -x ] [ x_h ]\n        h q* = R_q* h = [  z   w  -x  -y ] [ y_h ]\n                        [ -y   x   w  -z ] [ z_h ]\n                        [  x   y   z   w ] [ w_h ]\n\n        (expand h q* = (x_h i + y_h j + z_h k + w_h) (-x i - y j - z k + w) to see)\n\n        Note that matrices L_q and R_h* have orthogonal columns / rows and are\n        antisymmetric. Additionally, L_q' = L_q* and R_q' = R_q* by symmetry.\n\n        ---\n\n        Although quaternion multiplication is not commutative, it is associative,\n        i.e., r_q(p) = (q p)q* = q(p q*). From the matrix equations above, it\n        follows that r_q(p) can be expressed as R_q* L_q p = L_q R_q* p. If we\n        define M_q = L_q R_q* = R_q* L_q, we can write r_q(p) = M_q p. Matrix M_q\n        has the following form:\n\n              [ w^2 + x^2 - y^2 - z^2  2xy - 2wz              2xz + 2wy              0 ]\n        M_q = [ 2xy + 2wz              w^2 - x^2 + y^2 - z^2  2yz - 2wx              0 ]\n              [ 2xz - 2wy              2yz + 2wx              w^2 - x^2 - y^2 + z^2  0 ]\n              [ 0                      0                      0                      1 ]\n\n        Note: the bottom-right entry is x^2 + y^2 + z^2 + w^2 = |q|^2 = 1.\n\n        Let M be the top-left 3x3 submatrix of M_q. A direct, but boring,\n        computation shows that M'M = M M' = I, where M' is the transpose of M.\n        In addition, det M = |q|^6 = +1. Therefore, M is a 3x3 rotation matrix.\n\n        */\n\n        const x2 = 2*x*x, y2 = 2*y*y, z2 = 2*z*z;\n        const xy = 2*x*y, xz = 2*x*z, yz = 2*y*z;\n        const wx = 2*w*x, wy = 2*w*y, wz = 2*w*z;\n\n        return Speedy.Matrix(3, 3, [\n            1-(y2+z2), xy+wz, xz-wy,\n            xy-wz, 1-(x2+z2), yz+wx,\n            xz+wy, yz-wx, 1-(x2+y2)\n        ]);\n    }\n\n    /**\n     * Convert a 3x3 rotation matrix to a unit quaternion\n     * @param m a 3x3 rotation matrix. You should ensure that it is a rotation matrix\n     * @returns this quaternion\n     * @internal\n     */\n    _fromRotationMatrix(m: SpeedyMatrix): Quaternion\n    {\n        if(m.rows != 3 || m.columns != 3)\n            throw new IllegalArgumentError();\n\n        /*\n\n        Let M be the rotation matrix defined above. We're going to find a\n        unit quaternion q associated with M.\n\n        Before we begin, note that q and (-q) encode the same rotation, for\n        r_(-q)(p) = (-q)p(-q)* = (-1)q p (-1)q* = (-1)(-1)q p q* = q p q* = r_q(p).\n        Quaternion multiplication is commutative when a factor is a scalar, i.e.,\n        d p = p d for a real d and a quaternion p (check: distributive operation).\n\n        The trace of M, denoted as tr M, is 3w^2 - x^2 - y^2 - z^2. Since |q| = 1,\n        it follows that tr M = 3w^2 - (1 - w^2), which means that 4w^2 = 1 + tr M.\n        That being the case, we can write:\n\n        |w| = sqrt(1 + tr M) / 2\n\n        We'll arbitrarily pick w >= 0, for q and (-q) encode the same rotation.\n\n        Let mij denote the element at the i-th row and at the j-th column of M.\n        A direct verification shows that m21 - m12 = 4wz. Since w >= 0, it follows\n        that sign(z) = sign(m21 - m12). Similarly, sign(y) = sign(m13 - m31) and\n        sign(x) = sign(m32 - m23).\n\n        The quantity m11 + m22 is equal to 2w^2 - 2z^2, which means that 4z^2 =\n        4w^2 - 2(m11 + m22) = (1 + tr M) - 2(m11 + m22). Therefore, let's write:\n\n        |z| = sqrt((1 + tr M) - 2(m11 + m22)) / 2\n\n        Of course, z = |z| sign(z). Similarly,\n\n        |y| = sqrt((1 + tr M) - 2(m11 + m33)) / 2\n\n        |x| = sqrt((1 + tr M) - 2(m22 + m33)) / 2\n\n        This gives (x, y, z, w).\n\n        ---\n\n        We quickly verify that (1 + tr M) - 2(m11 + m22) >= 0 if M is (really)\n        a rotation matrix: (1 + tr M) - 2(m11 + m22) = 1 + tr M - 2(tr M - m33) =\n        1 - tr M + 2 m33 = 1 - (3w^2 - x^2 - y^2 - z^2) + 2(w^2 - x^2 - y^2 + z^2) =\n        1 - w^2 + z^2 = (x^2 + y^2 + z^2 + w^2) - w^2 + z^2 = x^2 + y^2 + 2 z^2 >= 0.\n        Similarly, (1 + tr M) - 2(m11 + m33) >= 0 and (1 + tr M) - 2(m22 + m33) >= 0.\n\n        */\n\n        const data = m.read();\n        const m11 = data[0], m21 = data[1], m31 = data[2],\n              m12 = data[3], m22 = data[4], m32 = data[5],\n              m13 = data[6], m23 = data[7], m33 = data[8];\n\n        const tr = 1 + m11 + m22 + m33; // 1 + tr M\n        const sx = +(m32 >= m23) - +(m32 < m23); // sign(x)\n        const sy = +(m13 >= m31) - +(m13 < m31); // sign(y)\n        const sz = +(m21 >= m12) - +(m21 < m12); // sign(z)\n\n        const w = 0.5 * Math.sqrt(Math.max(0, tr)); // |w| = w\n        const x = 0.5 * Math.sqrt(Math.max(0, tr - 2 * (m22 + m33))); // |x|\n        const y = 0.5 * Math.sqrt(Math.max(0, tr - 2 * (m11 + m33))); // |y|\n        const z = 0.5 * Math.sqrt(Math.max(0, tr - 2 * (m11 + m22))); // |z|\n\n        const length = Math.sqrt(x*x + y*y + z*z + w*w); // should be ~ 1\n        this._x = (x * sx) / length;\n        this._y = (y * sy) / length;\n        this._z = (z * sz) / length;\n        this._w = w / length;\n\n        return this;\n    }\n\n    /**\n     * Clone this quaternion\n     * @returns a clone of this quaternion\n     * @internal\n     */\n    _clone(): Quaternion\n    {\n        return new Quaternion(this._x, this._y, this._z, this._w);\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * vector3.ts\n * 3D vectors\n */\n\nimport { Nullable } from '../utils/utils';\nimport { Quaternion } from './quaternion';\n\n/** Small number */\nconst EPSILON = 1e-6;\n\n/** Immutable zero vector */\nlet ZERO: Nullable<Vector3> = null;\n\n// public / non-internal methods do not change the contents of the vector\n\n\n\n/**\n * A vector in 3D space\n */\nexport class Vector3\n{\n    /** x coordinate */\n    private _x: number;\n\n    /** y coordinate */\n    private _y: number;\n\n    /** z coordinate */\n    private _z: number;\n\n\n\n    /**\n     * Constructor\n     */\n    constructor(x: number = 0, y: number = 0, z: number = 0)\n    {\n        this._x = +x;\n        this._y = +y;\n        this._z = +z;\n    }\n\n    /**\n     * Instantiate a zero vector\n     * @returns a new zero vector\n     */\n    static Zero(): Vector3\n    {\n        return new Vector3(0, 0, 0);\n    }\n\n    /**\n     * Immutable zero vector\n     * @returns an immutable zero vector\n     */\n    static get ZERO(): Vector3\n    {\n        return ZERO || (ZERO = Object.freeze(Vector3.Zero()) as Vector3);\n    }\n\n    /**\n     * The x coordinate of the vector\n     */\n    get x(): number\n    {\n        return this._x;\n    }\n\n    /**\n     * The y coordinate of the vector\n     */\n    get y(): number\n    {\n        return this._y;\n    }\n\n    /**\n     * The z coordinate of the vector\n     */\n    get z(): number\n    {\n        return this._z;\n    }\n\n    /**\n     * The length of this vector\n     * @returns sqrt(x^2 + y^2 + z^2)\n     */\n    length(): number\n    {\n        const x = this._x;\n        const y = this._y;\n        const z = this._z;\n\n        return Math.sqrt(x*x + y*y + z*z);\n    }\n\n    /**\n     * Compute the dot product of this and v\n     * @param v a vector\n     * @returns the dot product of the vectors\n     */\n    dot(v: Vector3): number\n    {\n        return this._x * v._x + this._y * v._y + this._z * v._z;\n    }\n\n    /**\n     * Compute the distance between points this and v\n     * @param v a vector / point\n     * @returns the distance between the points\n     */\n    distanceTo(v: Vector3): number\n    {\n        const dx = this._x - v._x;\n        const dy = this._y - v._y;\n        const dz = this._z - v._z;\n\n        return Math.sqrt(dx*dx + dy*dy + dz*dz);\n    }\n\n    /**\n     * Compute the direction from this to v\n     * @param v a vector\n     * @returns a new unit vector pointing to v from this\n     */\n    directionTo(v: Vector3): Vector3\n    {\n        return v._clone()._subtract(this)._normalize();\n    }\n\n    /**\n     * The cross product of this and v\n     * @param v a vector\n     * @returns the cross product this x v\n     */\n    cross(v: Vector3): Vector3\n    {\n        const x = this._y * v._z - this._z * v._y;\n        const y = this._z * v._x - this._x * v._z;\n        const z = this._x * v._y - this._y * v._x;\n\n        return new Vector3(x, y, z);\n    }\n\n    /**\n     * Compute a unit vector with the same direction as this\n     * @returns a new unit vector with the same direction as this\n     */\n    normalized(): Vector3\n    {\n        return this._clone()._normalize();\n    }\n\n    /**\n     * Compute the sum between this vector and v\n     * @param v a vector\n     * @returns a new vector equal to the sum between this and v\n     */\n    plus(v: Vector3): Vector3\n    {\n        return this._clone()._add(v);\n    }\n\n    /**\n     * Compute the difference between this vector and v\n     * @param v a vector\n     * @returns a new vector equal to the difference this - v\n     */\n    minus(v: Vector3): Vector3\n    {\n        return this._clone()._subtract(v);\n    }\n\n    /**\n     * Compute the multiplication between this vector and a scale factor\n     * @param scale scalar quantity\n     * @returns a new vector equal to the multiplication between this and the scale factor\n     */\n    times(scale: number): Vector3\n    {\n        return this._clone()._scale(scale);\n    }\n\n    /**\n     * Check if this and v have the same coordinates\n     * @param v a vector\n     * @returns true if this and v have the same coordinates\n     */\n    equals(v: Vector3): boolean\n    {\n        return this._x === v._x && this._y === v._y && this._z === v._z;\n    }\n\n    /**\n     * Convert to string\n     * @returns a string\n     */\n    toString(): string\n    {\n        const x = this._x.toFixed(5);\n        const y = this._y.toFixed(5);\n        const z = this._z.toFixed(5);\n\n        return `Vector3(${x},${y},${z})`;\n    }\n\n    /**\n     * Set the coordinates of this vector\n     * @param x x-coordinate\n     * @param y y-coordinate\n     * @param z z-coordinate\n     * @returns this vector\n     * @internal\n     */\n    _set(x: number, y: number, z: number): Vector3\n    {\n        this._x = +x;\n        this._y = +y;\n        this._z = +z;\n\n        return this;\n    }\n\n    /**\n     * Copy v to this\n     * @param v a vector\n     * @returns this vector\n     * @internal\n     */\n    _copyFrom(v: Vector3): Vector3\n    {\n        this._x = v._x;\n        this._y = v._y;\n        this._z = v._z;\n\n        return this;\n    }\n\n    /**\n     * Normalize this vector\n     * @returns this vector, normalized\n     * @internal\n     */\n    _normalize(): Vector3\n    {\n        const length = this.length();\n\n        if(length < EPSILON) // zero?\n            return this;\n\n        this._x /= length;\n        this._y /= length;\n        this._z /= length;\n\n        return this;\n    }\n\n    /**\n     * Add v to this vector\n     * @param v a vector\n     * @returns this vector\n     * @internal\n     */\n    _add(v: Vector3): Vector3\n    {\n        this._x += v._x;\n        this._y += v._y;\n        this._z += v._z;\n\n        return this;\n    }\n\n    /**\n     * Subtract v from this vector\n     * @param v a vector\n     * @returns this vector\n     * @internal\n     */\n    _subtract(v: Vector3): Vector3\n    {\n        this._x -= v._x;\n        this._y -= v._y;\n        this._z -= v._z;\n\n        return this;\n    }\n\n    /**\n     * Scale this vector by a scalar\n     * @param s scalar\n     * @returns this vector\n     * @internal\n     */\n    _scale(s: number): Vector3\n    {\n        this._x *= s;\n        this._y *= s;\n        this._z *= s;\n\n        return this;\n    }\n\n    /**\n     * Compute the rotation q p q* in place, where q is a unit quaternion,\n     * q* is its conjugate and multiplicative inverse, and p is this vector\n     * @param q unit quaternion\n     * @returns this vector\n     * @internal\n     */\n    _applyRotationQuaternion(q: Quaternion): Vector3\n    {\n        // based on Quaternion._toRotationMatrix()\n        const x = q.x, y = q.y, z = q.z, w = q.w;\n        const vx = this._x, vy = this._y, vz = this._z;\n\n        const x2 = x*x, y2 = y*y, z2 = z*z;\n        const xy = 2*x*y, xz = 2*x*z, yz = 2*y*z;\n        const wx = 2*w*x, wy = 2*w*y, wz = 2*w*z;\n\n        this._x = (1-2*(y2+z2)) * vx + (xy-wz) * vy + (xz+wy) * vz;\n        this._y = (xy+wz) * vx + (1-2*(x2+z2)) * vy + (yz-wx) * vz;\n        this._z = (xz-wy) * vx + (yz+wx) * vy + (1-2*(x2+y2)) * vz;\n\n        return this;\n    }\n\n    /**\n     * Clone this vector\n     * @returns a clone of this vector\n     * @internal\n     */\n    _clone(): Vector3\n    {\n        return new Vector3(this._x, this._y, this._z);\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * pose-filter.ts\n * Smoothing filter for a pose\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { Settings } from '../core/settings';\nimport { Quaternion } from './quaternion';\nimport { Vector3 } from './vector3';\nimport { IllegalArgumentError } from '../utils/errors';\n\n/** Number of translation samples */\nconst TRANSLATION_SAMPLES = 5;\n\n/** Number of rotation samples */\nconst ROTATION_SAMPLES = 12;\n\n/** A vector representing \"no translation\" */\nconst NO_TRANSLATION = Vector3.Zero();\n\n/** A quaternion representing \"no rotation\" */\nconst NO_ROTATION = Quaternion.Identity();\n\n/** The zero quaternion */\nconst ZERO_QUATERNION = new Quaternion(0, 0, 0, 0);\n\n\n\n\n\n/**\n * Smoothing filter for a pose\n */\nexport class PoseFilter\n{\n    /** smooth rotation */\n    private _smoothRotation: Quaternion;\n\n    /** smooth translation */\n    private _smoothTranslation: Vector3;\n\n    /** samples of rotations */\n    private _rotationSample: Quaternion[];\n\n    /** samples of translations */\n    private _translationSample: Vector3[];\n\n    /** empty buffers? (i.e., no samples collected?) */\n    private _isEmpty: boolean;\n\n\n\n    /**\n     * Constructor\n     */\n    constructor()\n    {\n        this._smoothRotation = Quaternion.Identity();\n        this._smoothTranslation = Vector3.Zero();\n        this._rotationSample = Array.from({ length: ROTATION_SAMPLES }, () => Quaternion.Identity());\n        this._translationSample = Array.from({ length: TRANSLATION_SAMPLES }, () => Vector3.Zero());\n        this._isEmpty = true;\n    }\n\n    /**\n     * Reset the filter\n     */\n    reset(): void\n    {\n        this._rotationSample.forEach(q => q._copyFrom(NO_ROTATION));\n        this._translationSample.forEach(t => t._copyFrom(NO_TRANSLATION));\n        this._isEmpty = true;\n    }\n\n    /**\n     * Feed the filter with a sample\n     * @param sample 3x4 [ R | t ] matrix\n     * @returns true on success\n     */\n    feed(sample: SpeedyMatrix): boolean\n    {\n        const data = sample.read();\n\n        // sanity check\n        if(sample.rows != 3 || sample.columns != 4)\n            throw new IllegalArgumentError();\n\n        // discard invalid samples\n        if(Number.isNaN(data[0] * data[9])) // rotation, translation\n            return false;\n\n        // store sample\n        const q = this._rotationSample[ROTATION_SAMPLES - 1];\n        for(let i = ROTATION_SAMPLES - 1; i > 0; i--)\n            this._rotationSample[i] = this._rotationSample[i-1];\n        this._rotationSample[0] = q._fromRotationMatrix(sample.block(0, 2, 0, 2));\n\n        const t = this._translationSample[TRANSLATION_SAMPLES - 1];\n        for(let i = TRANSLATION_SAMPLES - 1; i > 0; i--)\n            this._translationSample[i] = this._translationSample[i-1];\n        this._translationSample[0] = t._set(data[9], data[10], data[11]);\n\n        // empty buffers?\n        if(this._isEmpty) {\n            this._rotationSample.forEach((q, i) => i > 0 && q._copyFrom(this._rotationSample[0]));\n            this._translationSample.forEach((t, i) => i > 0 && t._copyFrom(this._translationSample[0]));\n            this._isEmpty = false;\n        }\n\n        // done!\n        return true;\n    }\n\n    /**\n     * Run the filter\n     * @returns a 3x4 [ R | t ] matrix\n     */\n    output(): SpeedyMatrix\n    {\n        // how many samples should we use, at most?\n        const div = (Settings.powerPreference == 'low-power') ? 1.5 : 1; // low-power ~ half the fps\n        const T = Math.ceil(TRANSLATION_SAMPLES / div);\n        const R = Math.ceil(ROTATION_SAMPLES / div);\n\n        // clear the output of the filter\n        const t = this._smoothTranslation._copyFrom(NO_TRANSLATION);\n        const q = this._smoothRotation._copyFrom(ZERO_QUATERNION);\n\n        // average translations\n        for(let i = 0, d = 2 / (T * T + T); i < T; i++) {\n            const ti = this._translationSample[i];\n            const w = (T - i) * d;\n\n            // weighted avg: sum from i=0 to T-1 { (T-i) * t[i] } * (2/(T^2+T))\n            t._set(\n                t.x + ti.x * w,\n                t.y + ti.y * w,\n                t.z + ti.z * w\n            );\n        }\n\n        // average *nearby* rotations\n        // based on https://web.archive.org/web/20130514122622/http://wiki.unity3d.com/index.php/Averaging_Quaternions_and_Vectors\n        // reminder: a unit quaternion q may be expressed as\n        // cos t + u sin t, where 2t is a rotation angle and u is a rotation axis\n        for(let i = 0; i < R; i++) {\n            const qi = this._rotationSample[i];\n            const w = 1 / R; //(R - (i - i%2)) / R;\n\n            // since unit quaternions qi and -qi encode the same rotation\n            // (see quaternion.ts), let's enforce dot(qi, 1) = qi.w >= 0\n            if(qi.w < 0) {\n                // XXX since Quaternion._fromRotationMatrix() computes w >= 0,\n                // this will never happen. Leave this here for extra safety\n                // in case anything changes?\n                qi._set(\n                    -qi.x,\n                    -qi.y,\n                    -qi.z,\n                    -qi.w\n                );\n            }\n\n            q._set(\n                q.x + qi.x * w,\n                q.y + qi.y * w,\n                q.z + qi.z * w,\n                q.w + qi.w * w\n            );\n        }\n        //q._normalize();\n\n        // convert to matrix form and return\n        const entries = q._toRotationMatrix().read();\n        entries.push(t.x, t.y, t.z);\n        return Speedy.Matrix(3, 4, entries);\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * camera-model.ts\n * Camera model\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { SpeedyPoint2 } from 'speedy-vision/types/core/speedy-point';\nimport { SpeedyVector2 } from 'speedy-vision/types/core/speedy-vector';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { Nullable, Utils } from '../utils/utils';\nimport { Settings } from '../core/settings';\nimport { PoseFilter } from './pose-filter';\nimport { NumericalError } from '../utils/errors';\n\n/** A guess of the horizontal field-of-view of a typical camera, in degrees */\nconst HFOV_GUESS = 60; // https://developer.apple.com/library/archive/documentation/DeviceInformation/Reference/iOSDeviceCompatibility/Cameras/Cameras.html\n\n/** The default scale of the image plane. The scale affects the focal length */\nconst DEFAULT_SCALE = 2; // the length of the [-1,+1] interval\n\n/** Convert degrees to radians */\nconst DEG2RAD = 0.017453292519943295; // pi / 180\n\n/** Convert radians to degrees */\nconst RAD2DEG = 57.29577951308232; // 180 / pi\n\n/** Numerical tolerance */\nconst EPSILON = 1e-6;\n\n/** Index of the horizontal focal length in the camera intrinsics matrix (column-major format) */\nconst FX = 0;\n\n/** Index of the vertical focal length in the camera intrinsics matrix */\nconst FY = 4;\n\n/** Index of the horizontal position of the principal point in the camera intrinsics matrix */\nconst U0 = 6;\n\n/** Index of the vertical position of the principal point in the camera intrinsics matrix */\nconst V0 = 7;\n\n/** Number of iterations used to refine the estimated pose */\nconst POSE_REFINEMENT_ITERATIONS = 30;\n\n/** Maximum number of iterations used when refining the translation vector */\nconst TRANSLATION_REFINEMENT_ITERATIONS = 15;\n\n/** Tolerance used to exit early when refining the translation vector */\nconst TRANSLATION_REFINEMENT_TOLERANCE = DEFAULT_SCALE * 0.01;\n\n/** Size of the grid used to refine the translation vector */\nconst TRANSLATION_REFINEMENT_GRIDSIZE = 5; //3;\n\n\n\n/**\n * Camera model\n */\nexport class CameraModel\n{\n    /** size of the image plane */\n    private _imageSize: SpeedySize;\n\n    /** 3x4 camera matrix */\n    private _matrix: SpeedyMatrix;\n\n    /** a helper to switch the handedness of a coordinate system */\n    private _flipZ: SpeedyMatrix;\n\n    /** entries of the intrinsics matrix in column-major format */\n    private _intrinsics: number[];\n\n    /** entries of the extrinsics matrix in column-major format */\n    private _extrinsics: number[];\n\n    /** smoothing filter */\n    private _filter: PoseFilter;\n\n\n\n    /**\n     * Constructor\n     */\n    constructor()\n    {\n        this._imageSize = Speedy.Size(0, 0);\n        this._matrix = Speedy.Matrix.Eye(3, 4);\n        this._intrinsics = [1,0,0,0,1,0,0,0,1]; // 3x3 identity matrix\n        this._extrinsics = [1,0,0,0,1,0,0,0,1,0,0,0]; // 3x4 matrix [ R | t ] = [ I | 0 ] no rotation & no translation\n        this._filter = new PoseFilter();\n        this._flipZ = Speedy.Matrix(4, 4, [\n            1, 0, 0, 0,\n            0, 1, 0, 0,\n            0, 0,-1, 0,\n            0, 0, 0, 1\n        ]);\n    }\n\n    /**\n     * Initialize the model\n     * @param aspectRatio aspect ratio of the image plane\n     * @param scale optional scale factor of the image plane\n     */\n    init(aspectRatio: number, scale: number = DEFAULT_SCALE): void\n    {\n        // log\n        Utils.log(`Initializing the camera model...`);\n        Utils.assert(aspectRatio > 0 && scale > 1e-5);\n\n        // set the size of the image plane\n        // this rule is conceived so that min(w,h) = s and w/h = a\n        if(aspectRatio >= 1) {\n            this._imageSize.width = aspectRatio * scale;\n            this._imageSize.height = scale;\n        }\n        else {\n            this._imageSize.width = scale;\n            this._imageSize.height = scale / aspectRatio;\n        }\n\n        // reset the model\n        this.reset();\n    }\n\n    /**\n     * Release the model\n     */\n    release(): null\n    {\n        this.reset();\n        return null;\n    }\n\n    /**\n     * Update the camera model\n     * @param homographyNDC 3x3 perspective transform\n     * @returns a promise that resolves to a camera matrix\n     */\n    update(homographyNDC: SpeedyMatrix): SpeedyPromise<SpeedyMatrix>\n    {\n        Utils.assert(homographyNDC.rows == 3 && homographyNDC.columns == 3);\n\n        // convert to image space\n        const homography = this._convertToImageSpace(homographyNDC);\n\n        // read the entries of the homography\n        const h = homography.read();\n        const h11 = h[0], h12 = h[3], h13 = h[6],\n              h21 = h[1], h22 = h[4], h23 = h[7],\n              h31 = h[2], h32 = h[5], h33 = h[8];\n\n        // validate the homography (homography matrices aren't singular)\n        const det = h13 * (h21 * h32 - h22 * h31) - h23 * (h11 * h32 - h12 * h31) + h33 * (h11 * h22 - h12 * h21);\n        if(Math.abs(det) < EPSILON || Number.isNaN(det))\n            return Speedy.Promise.reject(new NumericalError(`Can't update the camera model using an invalid homography matrix`));\n\n        // estimate the pose\n        const pose = this._estimatePose(homography);\n        if(this._filter.feed(pose))\n            this._extrinsics = this._filter.output().read();\n\n        // compute the camera matrix\n        const Z = this._flipZ; // switch to a right handed system\n        const K = Speedy.Matrix(3, 3, this._intrinsics);\n        const E = Speedy.Matrix(3, 4, this._extrinsics);\n        this._matrix.setToSync(K.times(E).times(Z));\n\n        /*\n        // test\n        console.log(\"homography ------------\", homography.toString());\n        console.log(\"intrinsics ------------\", K.toString());\n        console.log(\"extrinsics ------------\", E.toString());\n        console.log(\"extrinsicsINV ---------\", Speedy.Matrix(this.computeViewMatrix().inverse()).toString());\n        console.log(\"matrix ----------------\", this._matrix.toString());\n        console.log(\"projectionMatrix ----- \", this.computeProjectionMatrix(0.1,100).toString());\n        */\n\n        // done!\n        return Speedy.Promise.resolve(this._matrix);\n    }\n\n    /**\n     * Reset the camera model\n     */\n    reset(): void\n    {\n        this._resetIntrinsics();\n        this._resetExtrinsics();\n    }\n\n    /**\n     * The 3x4 camera matrix\n     */\n    get matrix(): SpeedyMatrix\n    {\n        return this._matrix;\n    }\n\n    /**\n     * The size of the image plane\n     */\n    get imageSize(): SpeedySize\n    {\n        return this._imageSize;\n    }\n\n    /**\n     * The aspect ratio of the image\n     */\n    get aspectRatio(): number\n    {\n        return this._imageSize.width / this._imageSize.height;\n    }\n\n    /**\n     * Focal length in \"pixels\" (projection distance in the pinhole camera model)\n     * same as (focal length in mm) * (number of \"pixels\" per world unit in \"pixels\"/mm)\n     * \"pixels\" means image plane units\n     */\n    get focalLength(): number\n    {\n        return this._intrinsics[FX]; // fx == fy\n    }\n\n    /**\n     * Horizontal field-of-view, given in radians\n     */\n    get fovx(): number\n    {\n        const halfWidth = this._imageSize.width / 2;\n        return 2 * Math.atan(halfWidth / this._intrinsics[FX]);\n    }\n\n    /**\n     * Vertical field-of-view, given in radians\n     */\n    get fovy(): number\n    {\n        const halfHeight = this._imageSize.height / 2;\n        return 2 * Math.atan(halfHeight / this._intrinsics[FY]);\n    }\n\n    /**\n     * Camera intrinsics matrix\n     * @returns a 3x3 camera intrinsics matrix\n     */\n    intrinsicsMatrix(): SpeedyMatrix\n    {\n        return Speedy.Matrix(3, 3, this._intrinsics);\n    }\n\n    /**\n     * Compute the view matrix. This 4x4 matrix moves 3D points from\n     * world space to view space. We want the camera looking in the\n     * direction of the negative z-axis (WebGL-friendly)\n     * @returns a view matrix\n     */\n    computeViewMatrix(): SpeedyMatrix\n    {\n        const E = this._extrinsics;\n\n        // We augment the 3x4 extrinsics matrix E with the [ 0  0  0  1 ] row\n        // and get E+. Let Z be 4x4 flipZ, the identity matrix with the third\n        // column negated. The following matrix is View = Z * E+ * Z. We get\n        // the camera looking in the direction of the negative z-axis in a\n        // right handed system!\n        return Speedy.Matrix(4, 4, [\n            E[0], E[1],-E[2], 0, // r1\n            E[3], E[4],-E[5], 0, // r2\n           -E[6],-E[7],+E[8], 0, // r3\n            E[9], E[10],-E[11], 1 // t\n        ]);\n    }\n\n    /**\n     * Compute a perspective projection matrix for WebGL\n     * @param near distance of the near plane\n     * @param far distance of the far plane\n     */\n    computeProjectionMatrix(near: number, far: number): SpeedyMatrix\n    {\n        const fx = this._intrinsics[FX];\n        const fy = this._intrinsics[FY];\n        const halfWidth = this._imageSize.width / 2;\n        const halfHeight = this._imageSize.height / 2;\n\n        // we assume that the principal point is at the center of the image plane\n        const right = near * (halfWidth / fx);\n        const top = near * (halfHeight / fy);\n        //const top = right * (halfHeight / halfWidth); // same thing\n        const bottom = -top, left = -right; // symmetric frustum\n\n        // a derivation of this projection matrix can be found at\n        // https://www.songho.ca/opengl/gl_projectionmatrix.html\n        // http://learnwebgl.brown37.net/08_projections/projections_perspective.html\n        return Speedy.Matrix(4, 4, [\n            2 * near / (right - left), 0, 0, 0,\n            0, 2 * near / (top - bottom), 0, 0,\n            (right + left) / (right - left), (top + bottom) / (top - bottom), -(far + near) / (far - near), -1,\n            0, 0, -2 * far * near / (far - near), 0\n        ]);\n    }\n\n    /**\n     * Reset camera extrinsics\n     */\n    private _resetExtrinsics(): void\n    {\n        // set the rotation matrix to the identity\n        this._extrinsics.fill(0);\n        this._extrinsics[0] = this._extrinsics[4] = this._extrinsics[8] = 1;\n\n        // reset filter\n        this._filter.reset();\n    }\n\n    /**\n     * Reset camera intrinsics\n     */\n    private _resetIntrinsics(): void\n    {\n        const cameraWidth = Math.max(this._imageSize.width, this._imageSize.height); // portrait or landscape?\n\n        const u0 = 0; // principal point at the center of the image plane\n        const v0 = 0;\n        const fx = (cameraWidth / 2) / Math.tan(DEG2RAD * HFOV_GUESS / 2);\n        const fy = fx;\n\n        this._intrinsics[FX] = fx;\n        this._intrinsics[FY] = fy;\n        this._intrinsics[U0] = u0;\n        this._intrinsics[V0] = v0;\n    }\n\n    /**\n     * Convert a homography from NDC to image space\n     * @param homographyNDC\n     * @returns a new homography\n     */\n    private _convertToImageSpace(homographyNDC: SpeedyMatrix): SpeedyMatrix\n    {\n        const w = this._imageSize.width / 2;\n        const h = this._imageSize.height / 2;\n\n        // fromNDC converts points from NDC to image space\n        const fromNDC = Speedy.Matrix(3, 3, [\n            w, 0, 0,\n            0, h, 0,\n            0, 0, 1\n        ]);\n\n        /*\n        // make h33 = 1 (wanted?)\n        const data = homographyNDC.read();\n        const h33 = data[8];\n        const hom = homographyNDC.times(1/h33);\n        */\n\n        // convert homography\n        return Speedy.Matrix(fromNDC.times(homographyNDC));\n    }\n\n    /**\n     * Compute a normalized homography H^ = K^(-1) * H for an\n     * ideal pinhole with f = 1 and principal point = (0,0)\n     * @param homography homography H to be normalized\n     * @returns normalized homography H^\n     */\n    private _normalizeHomography(homography: SpeedyMatrix): SpeedyMatrix\n    {\n        const u0 = this._intrinsics[U0];\n        const v0 = this._intrinsics[V0];\n        const fx = this._intrinsics[FX];\n        const fy = this._intrinsics[FY];\n        const u0fx = u0 / fx;\n        const v0fy = v0 / fy;\n\n        const h = homography.read();\n        const h11 = h[0] / fx - u0fx * h[2], h12 = h[3] / fx - u0fx * h[5], h13 = h[6] / fx - u0fx * h[8];\n        const h21 = h[1] / fy - v0fy * h[2], h22 = h[4] / fy - v0fy * h[5], h23 = h[7] / fy - v0fy * h[8];\n        const h31 = h[2], h32 = h[5], h33 = h[8];\n\n        /*console.log([\n            h11, h21, h31,\n            h12, h22, h32,\n            h13, h23, h33,\n        ]);*/\n\n        return Speedy.Matrix(3, 3, [\n            h11, h21, h31,\n            h12, h22, h32,\n            h13, h23, h33,\n        ]);\n    }\n\n    /**\n     * Estimate [ r1 | r2 | t ], where r1, r2 are orthonormal and t is a translation vector\n     * @param normalizedHomography based on the ideal pinhole (where calibration K = I)\n     * @returns a 3x3 matrix\n     */\n    private _estimatePartialPose(normalizedHomography: SpeedyMatrix): SpeedyMatrix\n    {\n        const h = normalizedHomography.read();\n        const h11 = h[0], h12 = h[3], h13 = h[6];\n        const h21 = h[1], h22 = h[4], h23 = h[7];\n        const h31 = h[2], h32 = h[5], h33 = h[8];\n\n        const h1norm2 = h11 * h11 + h21 * h21 + h31 * h31;\n        const h2norm2 = h12 * h12 + h22 * h22 + h32 * h32;\n        const h1norm = Math.sqrt(h1norm2);\n        const h2norm = Math.sqrt(h2norm2);\n        //const hnorm = (h1norm + h2norm) / 2;\n        //const hnorm = Math.sqrt(h1norm * h2norm);\n        const hnorm = Math.max(h1norm, h2norm); // this seems to work. why?\n\n        // we expect h1norm to be approximately h2norm, but sometimes there is a lot of noise\n        // if h1norm is not approximately h2norm, it means that the first two columns of\n        // the normalized homography are not really encoding a rotation (up to a scale)\n\n        //console.log(\"h1,h2\",h1norm,h2norm);\n        //console.log(normalizedHomography.toString());\n\n        // compute a rough estimate for the scale factor\n        // select the sign so that t3 = tz > 0\n        const sign = h33 >= 0 ? 1 : -1;\n        let scale = sign / hnorm;\n\n        // sanity check\n        if(Number.isNaN(scale))\n            return Speedy.Matrix(3, 3, (new Array<number>(9)).fill(Number.NaN));\n\n        // recover the rotation\n        let r = new Array<number>(6);\n        r[0] = scale * h11;\n        r[1] = scale * h21;\n        r[2] = scale * h31;\n        r[3] = scale * h12;\n        r[4] = scale * h22;\n        r[5] = scale * h32;\n\n        // refine the rotation (r is initially noisy)\n        r = this._refineRotation(r);\n\n        /*\n\n        After refining the rotation vectors, let's adjust the scale factor as\n        follows:\n\n        We know that [ r1 | r2 | t ] is equal to the normalized homography H up\n        to a non-zero scale factor s, i.e., [ r1 | r2 | t ] = s H. Let's call M\n        the first two columns of H, i.e., M = [ h1 | h2 ], and R = [ r1 | r2 ].\n        It follows that R = s M, meaning that M'R = s M'M. The trace of 2x2 M'R\n        is such that tr(M'R) = tr(s M'M) = s tr(M'M), which means:\n\n        s = tr(M'R) / tr(M'M) = (r1'h1 + r2'h2) / (h1'h1 + h2'h2)\n\n        (also: s^2 = det(M'R) / det(M'M))\n\n        */\n\n        // adjust the scale factor\n        scale = r[0] * h11 + r[1] * h21 + r[2] * h31;\n        scale += r[3] * h12 + r[4] * h22 + r[5] * h32;\n        scale /= h1norm2 + h2norm2;\n\n        // recover the translation\n        let t = new Array<number>(3);\n        t[0] = scale * h13;\n        t[1] = scale * h23;\n        t[2] = scale * h33;\n\n        // done!\n        return Speedy.Matrix(3, 3, r.concat(t));\n    }\n\n    /**\n     * Make two non-zero and non-parallel input vectors, r1 and r2, orthonormal\n     * @param rot rotation vectors [ r1 | r2 ] in column-major format\n     * @returns a 3x2 matrix R such that R'R = I (column-major format)\n     */\n    private _refineRotation(rot: number[]): number[]\n    {\n        const [r11, r21, r31, r12, r22, r32] = rot;\n\n        /*\n\n        A little technique I figured out to correct the rotation vectors\n        ----------------------------------------------------------------\n\n        We are given two 3x1 column-vectors r1 and r2 as input in a 3x2 matrix\n        R = [ r1 | r2 ]. We would like that R'R = I, but that won't be the case\n        because vectors r1 and r2 are not perfectly orthonormal due to noise.\n\n        Let's first notice that R'R is symmetric. You can easily check that its\n        two eigenvalues are both real and positive (as long as r1, r2 != 0 and\n        r1 is not parallel to r2, but we never take such vectors as input).\n\n        R'R = [ r1'r1   r1'r2 ]  is of rank 2, positive-definite\n              [ r1'r2   r2'r2 ]\n\n        We proceed by computing an eigendecomposition Q D Q' of R'R, where Q is\n        chosen to be orthogonal and D is a diagonal matrix whose entries are\n        the eigenvalues of R'R.\n\n        Let LL' be the Cholesky decomposition of D. Such decomposition exists\n        and is trivially computed: just take the square roots of the entries of\n        D. Since L is diagonal, we have L = L'. Its inverse is also trivially\n        computed - call it Linv.\n\n        Now, define a 2x2 correction matrix C as follows:\n\n        C = Q * Linv * Q'\n\n        This matrix rotates the input vector, scales it by some amount, and\n        then rotates it back to where it was (i.e., Q'Q = Q Q' = I).\n\n        We compute RC in order to correct the rotation vectors. We take its\n        two columns as the corrected vectors.\n\n        In order to show that the two columns of RC are orthonormal, we can\n        show that (RC)'(RC) = I. Indeed, noticing that C is symmetric, let's\n        expand the expression:\n\n        (RC)'(RC) = C'R'R C = C R'R C = (Q Linv Q') (Q D Q') (Q Linv Q') =\n        Q Linv (Q'Q) D (Q'Q) Linv Q' = Q Linv D Linv Q' =\n        Q Linv (L L) Linv Q' = Q (Linv L) (L Linv) Q' = Q Q' = I\n\n        I have provided below a closed formula to correct the rotation vectors.\n\n        What C does to R is very interesting: it makes the singular values\n        become 1. If U S V' is a SVD of R, then R'R = V S^2 V'. The singular\n        values of R are the square roots of the eigenvalues of R'R. Letting\n        S = L and V = Q, it follows that RC = U S V' V Linv V' = U V'. This\n        means that RC is equivalent to the correction \"trick\" using the SVD\n        found in the computer vision literature (i.e., compute the SVD and\n        return U V'). That \"trick\" is known to return the rotation matrix that\n        minimizes the Frobenius norm of the difference between the input and\n        the output. Consequently, the technique I have just presented is also\n        optimal in that sense!\n\n        By the way, the input matrix R does not need to be 3x2.\n\n        */\n\n        // compute the entries of R'R\n        const r1tr1 = r11*r11 + r21*r21 + r31*r31;\n        const r2tr2 = r12*r12 + r22*r22 + r32*r32;\n        const r1tr2 = r11*r12 + r21*r22 + r31*r32;\n\n        // compute the two real eigenvalues of R'R\n        const delta = (r1tr1 - r2tr2) * (r1tr1 - r2tr2) + 4 * r1tr2 * r1tr2;\n        const sqrt = Math.sqrt(delta); // delta >= 0 always\n        const eigval1 = (r1tr1 + r2tr2 + sqrt) / 2;\n        const eigval2 = (r1tr1 + r2tr2 - sqrt) / 2;\n\n        // compute two unit eigenvectors qi = (xi,yi) of R'R\n        const alpha1 = (r2tr2 - eigval1) - r1tr2 * (1 + r1tr2) / (r1tr1 - eigval1);\n        const x1 = Math.sqrt((alpha1 * alpha1) / (1 + alpha1 * alpha1));\n        const y1 = x1 / alpha1;\n\n        const alpha2 = (r2tr2 - eigval2) - r1tr2 * (1 + r1tr2) / (r1tr1 - eigval2);\n        const x2 = Math.sqrt((alpha2 * alpha2) / (1 + alpha2 * alpha2));\n        const y2 = x2 / alpha2;\n\n        // compute the Cholesky decomposition LL' of the diagonal matrix D\n        // whose entries are the two eigenvalues of R'R and then invert L\n        const s1 = Math.sqrt(eigval1), s2 = Math.sqrt(eigval2); // singular values of R (pick s1 >= s2)\n\n        /*\n        const Linv = Speedy.Matrix(2, 2, [1/s1, 0, 0, 1/s2]); // L inverse\n\n        // compute the correction matrix C = Q * Linv * Q', where Q = [q1|q2]\n        // is orthogonal and Linv is computed as above\n        const Q = Speedy.Matrix(2, 2, [x1, y1, x2, y2]);\n        const Qt = Speedy.Matrix(2, 2, [x1, x2, y1, y2]);\n        const C = Q.times(Linv).times(Qt);\n\n        // correct the rotation vectors r1 and r2 using C\n        const R = Speedy.Matrix(3, 2, [r11, r21, r31, r12, r22, r32]);\n        return Speedy.Matrix(R.times(C)).read();\n        */\n\n        // find C = Q * Linv * Q' manually\n        // [ a  b ] is symmetric\n        // [ b  c ]\n        const a = x1*x1/s1 + x2*x2/s2;\n        const b = x1*y1/s1 + x2*y2/s2;\n        const c = y1*y1/s1 + y2*y2/s2;\n\n        // find RC manually\n        return [\n            a*r11 + b*r12,\n            a*r21 + b*r22,\n            a*r31 + b*r32,\n\n            b*r11 + c*r12,\n            b*r21 + c*r22,\n            b*r31 + c*r32\n        ];\n    }\n\n    /**\n     * Compute a refined translation vector\n     * @param normalizedHomography ideal pinhole K = I\n     * @param rot rotation vectors [ r1 | r2 ] in column-major format\n     * @param t0 initial estimate for the translation vector\n     * @returns 3x1 translation vector in column-major format\n     */\n    private _refineTranslation(normalizedHomography: SpeedyMatrix, rot: number[], t0: number[]): number[]\n    {\n        /*\n\n        Given a normalized homography H, the rotation vectors r1, r2, and a\n        translation vector t, we know that [ r1 | r2 | t ] = s H for a non-zero\n        scale factor s.\n\n        If we take a homogeneous vector u = [ x  y  w ]' (i.e., w = 1), then\n        [ r1 | r2 | t ] u is parallel to H u, which means that their cross\n        product is zero:\n\n        [ r1 | r2 | t ] u  x  H u  =  ( x r1 + y r2 + w t )  x  H u  =  0\n\n        The following code finds an optimal translation vector t based on the\n        above observation. H, r1, r2 are known.\n\n        */\n\n        const h = normalizedHomography.read();\n        const h11 = h[0], h12 = h[3], h13 = h[6];\n        const h21 = h[1], h22 = h[4], h23 = h[7];\n        const h31 = h[2], h32 = h[5], h33 = h[8];\n\n        const r11 = rot[0], r12 = rot[3];\n        const r21 = rot[1], r22 = rot[4];\n        const r31 = rot[2], r32 = rot[5];\n\n        // generate a grid of sample points [ xi  yi ]' in the image\n        //const x = [ 0, -1, +1, +1, -1 ];\n        //const y = [ 0, -1, -1, +1, +1 ];\n        const g = TRANSLATION_REFINEMENT_GRIDSIZE;\n        const x = new Array<number>(g*g);\n        const y = new Array<number>(g*g);\n        const halfWidth = this._imageSize.width / 2;\n        const halfHeight = this._imageSize.height / 2;\n\n        for(let k = 0, i = 0; i < g; i++) {\n            for(let j = 0; j < g; j++, k++) {\n                // in [-1,+1]\n                x[k] = (i/(g-1)) * 2 - 1;\n                y[k] = (j/(g-1)) * 2 - 1;\n\n                // in [-s/2,+s/2], where s = w,h\n                x[k] *= halfWidth;\n                y[k] *= halfHeight;\n            }\n        }\n        //console.log(x.toString(), y.toString());\n\n        // set auxiliary values: ai = H [ xi  yi  1 ]'\n        const n = x.length;\n        const a1 = new Array<number>(n);\n        const a2 = new Array<number>(n);\n        const a3 = new Array<number>(n);\n        for(let i = 0; i < n; i++) {\n            a1[i] = x[i] * h11 + y[i] * h12 + h13;\n            a2[i] = x[i] * h21 + y[i] * h22 + h23;\n            a3[i] = x[i] * h31 + y[i] * h32 + h33;\n        }\n\n        // we'll solve M t = v for t with linear least squares\n        // M: 3n x 3, v: 3n x 1, t: 3 x 1\n        const n3 = 3*n;\n        const m = new Array<number>(n3 * 3);\n        const v = new Array<number>(n3);\n        for(let i = 0, k = 0; k < n; i += 3, k++) {\n            m[i] = m[i+n3+1] = m[i+n3+n3+2] = 0;\n            m[i+n3] = -(m[i+1] = a3[k]);\n            m[i+2] = -(m[i+n3+n3] = a2[k]);\n            m[i+n3+n3+1] = -(m[i+n3+2] = a1[k]);\n            v[i] = a3[k] * (x[k] * r21 + y[k] * r22) - a2[k] * (x[k] * r31 + y[k] * r32);\n            v[i+1] = -a3[k] * (x[k] * r11 + y[k] * r12) + a1[k] * (x[k] * r31 + y[k] * r32);\n            v[i+2] = a2[k] * (x[k] * r11 + y[k] * r12) - a1[k] * (x[k] * r21 + y[k] * r22);\n        }\n\n        /*\n        // this works, but I want more lightweight\n        const M = Speedy.Matrix(n3, 3, m);\n        const v_ = Speedy.Matrix(n3, 1, v);\n        return Speedy.Matrix(M.ldiv(v_)).read();\n        */\n\n        /*\n\n        Gradient descent with optimal step size / learning rate\n        -------------------------------------------------------\n\n        Let's find the column-vector x that minimizes the error function\n        E(x) = r'r, where r = Ax - b, using gradient descent. This is linear\n        least squares. We want to find x easily, QUICKLY and iteratively.\n\n        The update rule of gradient descent is set to:\n\n        x := x - w * grad(E)\n\n        where w is the learning rate and grad(E) is the gradient of E(x):\n        \n        grad(E) = 2 A'r = 2 A'(Ax - b) = 2 A'A x - 2 A'b\n        \n        Let's adjust w to make x \"converge quickly\". Define function S(w) as:\n\n        S(w) = x - w * grad(E)    (step)\n\n        and another function F(w) as:\n\n        F(w) = E(S(w))\n\n        which is the error of the step. We minimize F by setting its derivative\n        to zero:\n\n        0 = dF = dF dS\n            dw   dS dw\n\n        What follows is a fair amount of algebra. Do the math and you'll find\n        the following optimal update rule:\n\n                     (c'c)\n        x := x  -  --------- c\n                   (Ac)'(Ac)\n\n        where c = A'r = A'(Ax - b)\n\n        */\n\n        // gradient descent: super lightweight implementation\n        const r = new Array<number>(3*n);\n        const c = new Array<number>(3);\n        const Mc = new Array<number>(3*n);\n\n        // initial guess\n        const t = new Array<number>(3);\n        t[0] = t0[0];\n        t[1] = t0[1];\n        t[2] = t0[2];\n\n        // iterate\n        for(let it = 0; it < TRANSLATION_REFINEMENT_ITERATIONS; it++) {\n            //console.log(\"it\",it+1);\n\n            // compute residual r = Mt - v\n            for(let i = 0; i < n3; i++) {\n                r[i] = 0;\n                for(let j = 0; j < 3; j++)\n                    r[i] += m[j*n3 + i] * t[j];\n                r[i] -= v[i];\n            }\n\n            // compute c = M'r\n            for(let i = 0; i < 3; i++) {\n                c[i] = 0;\n                for(let j = 0; j < n3; j++)\n                    c[i] += m[i*n3 + j] * r[j];\n            }\n\n            // compute Mc\n            for(let i = 0; i < n3; i++) {\n                Mc[i] = 0;\n                for(let j = 0; j < 3; j++)\n                    Mc[i] += m[j*n3 + i] * c[j];\n            }\n\n            // compute c'c\n            let num = 0;\n            for(let i = 0; i < 3; i++)\n                num += c[i] * c[i];\n            //console.log(\"c'c=\",num,\" at #\",it+1);\n            if(num < TRANSLATION_REFINEMENT_TOLERANCE)\n                break;\n\n            // compute (Mc)'(Mc)\n            let den = 0;\n            for(let i = 0; i < n3; i++)\n                den += Mc[i] * Mc[i];\n\n            // compute frc = c'c / (Mc)'(Mc)\n            const frc = num / den;\n            if(Number.isNaN(frc)) // this shouldn't happen\n                break;\n\n            // iterate: t = t - frc * c\n            for(let i = 0; i < 3; i++)\n                t[i] -= frc * c[i];\n\n        }\n\n        //console.log(\"OLD t:\\n\\n\",t0.join('\\n'));\n        //console.log(\"new t:\\n\\n\",t.join('\\n'));\n\n        // done!\n        return t;\n    }\n\n    /**\n     * Find a 3x3 rotation matrix R given two orthonormal vectors [ r1 | r2 ]\n     * @param partialRotation partial rotation matrix [ r1 | r2 ] in column-major format\n     * @returns a rotation matrix R in column-major format\n     */\n    private _computeFullRotation(partialRotation: number[]): number[]\n    {\n        const r11 = partialRotation[0], r12 = partialRotation[3];\n        const r21 = partialRotation[1], r22 = partialRotation[4];\n        const r31 = partialRotation[2], r32 = partialRotation[5];\n\n        // r3 = +- ( r1 x r2 )\n        let r13 = r21 * r32 - r31 * r22;\n        let r23 = r31 * r12 - r11 * r32;\n        let r33 = r11 * r22 - r21 * r12;\n\n        // let's make sure that det R = +1 (keep the orientation)\n        const det = r11 * (r22 * r33 - r23 * r32) - r21 * (r12 * r33 - r13 * r32) + r31 * (r12 * r23 - r13 * r22);\n        if(det < 0) {\n            r13 = -r13;\n            r23 = -r23;\n            r33 = -r33;\n        }\n\n        // done!\n        return [\n            r11, r21, r31,\n            r12, r22, r32,\n            r13, r23, r33\n        ];\n    }\n\n    /**\n     * Estimate the pose [ R | t ] given a homography in sensor space\n     * @param homography must be valid\n     * @returns 3x4 matrix\n     */\n    private _estimatePose(homography: SpeedyMatrix): SpeedyMatrix\n    {\n        const normalizedHomography = this._normalizeHomography(homography);\n        const partialPose = Speedy.Matrix.Eye(3);\n\n        // we want the estimated partial pose [ r1 | r2 | t ] to be as close\n        // as possible to the normalized homography, up to a scale factor;\n        // i.e., H * [ r1 | r2 | t ]^(-1) = s * I for a non-zero scalar s\n        // it won't be a perfect equality due to noise in the homography.\n        // remark: composition of homographies\n        const residual = Speedy.Matrix(normalizedHomography);\n        for(let k = 0; k < POSE_REFINEMENT_ITERATIONS; k++) {\n            // incrementally improve the partial pose\n            const rt = this._estimatePartialPose(residual); // rt should converge to the identity matrix\n            partialPose.setToSync(rt.times(partialPose));\n            residual.setToSync(residual.times(rt.inverse()));\n            //console.log(\"rt\",rt.toString());\n            //console.log(\"residual\",residual.toString());\n        }\n        //console.log('-----------');\n\n        // read the partial pose\n        const mat = partialPose.read();\n        const r0 = mat.slice(0, 6);\n        const t0 = mat.slice(6, 9);\n\n        // refine the translation vector and compute the full rotation matrix\n        const t = this._refineTranslation(normalizedHomography, r0, t0);\n        const r = this._computeFullRotation(r0);\n\n        // done!\n        return Speedy.Matrix(3, 4, r.concat(t));\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * pose.ts\n * A pose represents a position and an orientation in 3D space\n */\n\nimport { Transform } from './transform';\n\n\n\n/**\n * A pose represents a position and an orientation in 3D space\n */\nexport class Pose\n{\n    /** Internal transform */\n    private _transform: Transform;\n\n\n\n    /**\n     * Constructor\n     * @param transform usually a rigid transform in a 3D space (e.g., world space, viewer space or other)\n     */\n    constructor(transform: Transform)\n    {\n        this._transform = transform;\n    }\n\n    /**\n     * A transform describing the position and the orientation\n     * of the pose relative to the 3D space to which it belongs\n     */\n    get transform(): Transform\n    {\n        return this._transform;\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * transform.ts\n * 3D transforms\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { Nullable } from '../utils/utils';\nimport { IllegalArgumentError, IllegalOperationError } from '../utils/errors';\nimport { Vector3 } from './vector3';\nimport { Quaternion } from './quaternion';\n\n/** Small number */\nconst EPSILON = 1e-6;\n\n\n\n/**\n * A Transform represents a position, a rotation and a scale in 3D space\n */\nexport class Transform\n{\n    /** transformation matrix */\n    private readonly _matrix: SpeedyMatrix;\n\n    /** inverse transform, computed lazily */\n    private _inverse: Nullable<Transform>;\n\n    /** position component, computed lazily */\n    private _position: Vector3;\n\n    /** orientation component, computed lazily */\n    private _orientation: Quaternion;\n\n    /** scale component, computed lazily */\n    private _scale: Vector3;\n\n    /** whether or not this transformation has been decomposed */\n    private _isDecomposed: boolean;\n\n    /** whether or not we have extracted the position from the matrix */\n    private _isPositionComputed: boolean;\n\n    /** unit right vector of the local space, computed lazily */\n    private _right: Vector3;\n\n    /** unit up vector of the local space, computed lazily */\n    private _up: Vector3;\n\n    /** unit forward vector of the local space, computed lazily */\n    private _forward: Vector3;\n\n\n\n    /**\n     * Constructor\n     * @param matrix a 4x4 transformation matrix. You should ensure that its form is T * R * S (translation * rotation * scale).\n     */\n    constructor(matrix: SpeedyMatrix)\n    {\n        if(matrix.rows != 4 || matrix.columns != 4)\n            throw new IllegalArgumentError('A Transform expects a 4x4 transformation matrix');\n\n        this._matrix = matrix;\n        this._inverse = null;\n\n        this._position = Vector3.Zero();\n        this._orientation = Quaternion.Identity();\n        this._scale = new Vector3(1, 1, 1);\n\n        this._isDecomposed = false;\n        this._isPositionComputed = false;\n\n        this._right = Vector3.ZERO;\n        this._up = Vector3.ZERO;\n        this._forward = Vector3.ZERO;\n    }\n\n    /**\n     * The 4x4 transformation matrix\n     * This matrix is not meant to be changed. Changing it will not update the\n     * previously computed components of the transform!\n     */\n    get matrix(): SpeedyMatrix\n    {\n        return this._matrix;\n    }\n\n    /**\n     * The inverse transform\n     */\n    get inverse(): Transform\n    {\n        if(this._inverse === null)\n            this._inverse = new Transform(this._inverseMatrix());\n\n        return this._inverse;\n    }\n\n    /**\n     * The 3D position encoded by the transform\n     */\n    get position(): Vector3\n    {\n        if(!this._isPositionComputed)\n            this._computePosition();\n\n        return this._position;\n    }\n\n    /**\n     * A unit quaternion describing the rotational component of the transform\n     */\n    get orientation(): Quaternion\n    {\n        if(!this._isDecomposed)\n            this._decompose();\n\n        return this._orientation;\n    }\n\n    /**\n     * The scale encoded by the transform\n     */\n    get scale(): Vector3\n    {\n        if(!this._isDecomposed)\n            this._decompose();\n\n        return this._scale;\n    }\n\n    /**\n     * Unit right vector of the local space\n     */\n    get right(): Vector3\n    {\n        if(this._right === Vector3.ZERO)\n            this._right = this._scaleAndRotate(new Vector3(1, 0, 0))._normalize();\n\n        return this._right;\n    }\n\n    /**\n     * Unit up vector of the local space\n     */\n    get up(): Vector3\n    {\n        if(this._up === Vector3.ZERO)\n            this._up = this._scaleAndRotate(new Vector3(0, 1, 0))._normalize();\n\n        return this._up;\n    }\n\n    /**\n     * Unit forward vector of the local space\n     */\n    get forward(): Vector3\n    {\n        if(this._forward === Vector3.ZERO) {\n            // in a right-handed system, the unit forward vector is (0, 0, -1)\n            // in a left-handed system, it is (0, 0, 1)\n            this._forward = this._scaleAndRotate(new Vector3(0, 0, -1))._normalize();\n        }\n\n        return this._forward;\n    }\n\n    /**\n     * Use this transform to scale and rotate a vector\n     * The translation component of the transform is ignored\n     * @param v a vector\n     * @returns input vector v\n     */\n    private _scaleAndRotate(v: Vector3): Vector3\n    {\n        const m = this._matrix.read();\n        const h = Math.abs(m[15]) < EPSILON ? Number.NaN : 1 / m[15]; // usually h = 1\n        const vx = v.x, vy = v.y, vz = v.z;\n\n        const x = m[0] * vx + m[4] * vy + m[8] * vz;\n        const y = m[1] * vx + m[5] * vy + m[9] * vz;\n        const z = m[2] * vx + m[6] * vy + m[10] * vz;\n\n        return v._set(x * h, y * h, z * h);\n    }\n\n    /**\n     * Decompose this transform\n     */\n    private _decompose(): void\n    {\n        /*\n\n        The shape of a 4x4 transform T * R * S is\n\n        [  RS  t  ]\n        [  0'  1  ]\n\n        where S is a 3x3 diagonal matrix, R is a 3x3 rotation matrix, t is a\n        3x1 translation vector and 0' is a 1x3 zero vector.\n\n        How do we decompose it?\n\n        1) Decomposing the translation vector t is trivial\n\n        2) Decomposing matrices R (rotation) and S (scale) can be done by\n           noticing that (RS)'(RS) = (S'R')(RS) = S'(R'R) S = S'S is diagonal\n\n        3) Since R is a rotation matrix, we have det R = +1. This means that\n           det RS = det R * det S = det S. If det RS < 0, then we have a change\n           of handedness (i.e., a negative scale). We may flip the forward axis\n           (Z) and let the rotation matrix encode the rest of the transformation\n\n        4) Use 2) and 3) to find a suitable S\n\n        5) Compute R = (RS) * S^(-1)\n\n        */\n        const m = this._matrix.read();\n        const h = Math.abs(m[15]) < EPSILON ? Number.NaN : 1 / m[15]; // usually h = 1\n\n        // find t\n        const tx = m[12] * h;\n        const ty = m[13] * h;\n        const tz = m[14] * h;\n\n        // find RS\n        const rs11 = m[0] * h;\n        const rs21 = m[1] * h;\n        const rs31 = m[2] * h;\n        const rs12 = m[4] * h;\n        const rs22 = m[5] * h;\n        const rs32 = m[6] * h;\n        const rs13 = m[8] * h;\n        const rs23 = m[9] * h;\n        const rs33 = m[10] * h;\n\n        // do we have a change of handedness?\n        const det = rs13 * (rs21 * rs32 - rs22 * rs31) + rs33 * (rs11 * rs22 - rs12 * rs21) - rs23 * (rs11 * rs32 - rs12 * rs31);\n        const sign = +(det >= 0) - +(det < 0);\n\n        // if det = 0, RS is not invertible!\n\n        // find S\n        const sx = Math.sqrt(rs11 * rs11 + rs12 * rs12 + rs13 * rs13);\n        const sy = Math.sqrt(rs21 * rs21 + rs22 * rs22 + rs23 * rs23);\n        const sz = Math.sqrt(rs31 * rs31 + rs32 * rs32 + rs33 * rs33) * sign;\n\n        // zero scale?\n        if(sx < EPSILON || sy < EPSILON || sz * sign < EPSILON) {\n            this._position._set(tx, ty, tz);\n            this._scale._set(sx, sy, sz);\n            this._orientation._copyFrom(Quaternion.Identity());\n            this._isDecomposed = true;\n            this._isPositionComputed = true;\n            return;\n        }\n\n        // find S^(-1)\n        const zx = 1 / sx;\n        const zy = 1 / sy;\n        const zz = 1 / sz;\n\n        // find R\n        const r11 = rs11 * zx;\n        const r21 = rs21 * zx;\n        const r31 = rs31 * zx;\n        const r12 = rs12 * zy;\n        const r22 = rs22 * zy;\n        const r32 = rs32 * zy;\n        const r13 = rs13 * zz;\n        const r23 = rs23 * zz;\n        const r33 = rs33 * zz;\n\n        // set the components\n        this._position._set(tx, ty, tz);\n        this._scale._set(sx, sy, sz);\n        this._orientation._fromRotationMatrix(Speedy.Matrix(3, 3, [\n            r11, r21, r31,\n            r12, r22, r32,\n            r13, r23, r33\n        ]));\n\n        // done!\n        this._isDecomposed = true;\n        this._isPositionComputed = true;\n    }\n\n    /**\n     * A simpler decomposition routine.\n     * Sometimes we just need the position.\n     */\n    private _computePosition(): void\n    {\n        const m = this._matrix.read();\n        const h = Math.abs(m[15]) < EPSILON ? Number.NaN : 1 / m[15]; // usually h = 1\n\n        // find t\n        this._position._set(m[12] * h, m[13] * h, m[14] * h);\n\n        // done!\n        this._isPositionComputed = true;\n    }\n\n    /**\n     * Compute the inverse matrix of this transform\n     * @returns the inverse matrix\n     */\n    private _inverseMatrix(): SpeedyMatrix\n    {\n        // test\n        //console.log(Speedy.Matrix(this._matrix.inverse().times(this._matrix)).toString());\n\n        // this works, but this inverse is straightforward\n        return Speedy.Matrix(this._matrix.inverse());\n\n        /*\n\n        Simple analytic method\n        ----------------------\n\n        The inverse of a 4x4 transform T * R * S\n\n        [  RS  t  ]    is    [  ZR' -ZR't ]\n        [  0'  1  ]          [  0'    1   ]\n\n        where S is 3x3, R is 3x3, t is 3x1, 0' is 1x3 and Z is the inverse of S\n\n        R is a rotation matrix; S is a diagonal matrix\n\n        */\n\n        /*\n        // decompose the transform\n        if(!this._isDecomposed)\n            this._decompose();\n\n        // find t\n        const tx = this._position.x;\n        const ty = this._position.y;\n        const tz = this._position.z;\n\n        // find S (typically 1, but not very accurate)\n        const sx = this._scale.x;\n        const sy = this._scale.y;\n        const sz = this._scale.z;\n\n        // sanity check\n        if(Math.abs(sx) < EPSILON || Math.abs(sy) < EPSILON || Math.abs(sz) < EPSILON) {\n            //throw new IllegalOperationError('Not an invertible transform: ' + this._matrix.toString());\n            return Speedy.Matrix(4, 4, new Array(16).fill(Number.NaN)); // more friendly behavior\n        }\n\n        // find R\n        const r = this._rotation.read();\n        const r11 = r[0];\n        const r21 = r[1];\n        const r31 = r[2];\n        const r12 = r[3];\n        const r22 = r[4];\n        const r32 = r[5];\n        const r13 = r[6];\n        const r23 = r[7];\n        const r33 = r[8];\n\n        // find Z = S^(-1)\n        const zx = 1 / sx;\n        const zy = 1 / sy;\n        const zz = 1 / sz;\n\n        // compute Z R'\n        const zr11 = zx * r11;\n        const zr21 = zy * r12;\n        const zr31 = zz * r13;\n        const zr12 = zx * r21;\n        const zr22 = zy * r22;\n        const zr32 = zz * r23;\n        const zr13 = zx * r31;\n        const zr23 = zy * r32;\n        const zr33 = zz * r33;\n\n        // compute -Z R't\n        const zrt1 = -(tx * zr11 + ty * zr12 + tz * zr13);\n        const zrt2 = -(tx * zr21 + ty * zr22 + tz * zr23);\n        const zrt3 = -(tx * zr31 + ty * zr32 + tz * zr33);\n\n        // test\n        console.log('inverse', Speedy.Matrix(Speedy.Matrix(4, 4, [\n            zr11, zr21, zr31, 0,\n            zr12, zr22, zr32, 0,\n            zr13, zr23, zr33, 0,\n            zrt1, zrt2, zrt3, 1\n        ]).times(this._matrix)).toString());\n\n        console.log('rotation', Speedy.Matrix(\n            this._rotation.transpose().times(this._rotation)\n        ).toString());\n\n        console.log('scale', this._scale);\n\n        // done!\n        return Speedy.Matrix(4, 4, [\n            zr11, zr21, zr31, 0,\n            zr12, zr22, zr32, 0,\n            zr13, zr23, zr33, 0,\n            zrt1, zrt2, zrt3, 1\n        ]);\n        */\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * viewer-pose.ts\n * The pose of a virtual camera in 3D world space at a moment in time\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { Pose } from './pose';\nimport { Transform } from './transform';\nimport { CameraModel } from './camera-model';\n\n\n\n/**\n * The pose of a virtual camera in 3D world space at a moment in time\n */\nexport class ViewerPose extends Pose\n{\n    /** The view matrix */\n    private readonly _viewMatrix: SpeedyMatrix;\n\n\n\n    /**\n     * Constructor\n     * @param camera camera model\n     */\n    constructor(camera: CameraModel)\n    {\n        const viewMatrix = camera.computeViewMatrix();\n        const modelMatrix = Speedy.Matrix(viewMatrix.inverse());\n\n        const transform = new Transform(modelMatrix);\n        super(transform);\n\n        this._viewMatrix = viewMatrix;\n    }\n\n    /**\n     * This 4x4 matrix moves 3D points from world space to view space.\n     * We assume that the camera is looking in the direction of the\n     * negative z-axis (WebGL-friendly)\n     */\n    get viewMatrix(): SpeedyMatrix\n    {\n        return this._viewMatrix;\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * view.ts\n * A view of the 3D world at a moment in time,\n * featuring the means to project points into clip space\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { CameraModel } from './camera-model';\nimport { IllegalArgumentError } from '../utils/errors';\nimport { Nullable } from '../utils/utils';\n\n/** Default distance of the near plane to the optical center of the camera */\nconst DEFAULT_NEAR = 0.1;\n\n/** Default distance of the far plane to the optical center of the camera */\nconst DEFAULT_FAR = 10000 * DEFAULT_NEAR;\n\n\n/**\n * A view of the 3D world at a moment in time,\n * featuring the means to project points into clip space\n */\nexport interface View\n{\n    /** A 4x4 matrix that projects the viewer space into the clip space, i.e., [-1,1]^3 */\n    readonly projectionMatrix: SpeedyMatrix;\n\n    /** @internal The inverse of the projection matrix */\n    readonly _projectionMatrixInverse: SpeedyMatrix;\n}\n\n\n/**\n * A PerspectiveView is a View defining a symmetric frustum around the z-axis\n * (perspective projection)\n */\nexport class PerspectiveView implements View\n{\n    /** Camera model */\n    private readonly _camera: CameraModel;\n\n    /** Distance of the near plane to the optical center of the camera */\n    private readonly _near: number;\n\n    /** Distance of the far plane to the optical center of the camera*/\n    private readonly _far: number;\n\n    /** A 4x4 matrix that projects viewer space into clip space, i.e., [-1,1]^3 */\n    private readonly _projectionMatrix: SpeedyMatrix;\n\n    /** The inverse of the projection matrix, computed lazily */\n    private _inverseProjection: Nullable<SpeedyMatrix>;\n\n\n\n    /**\n     * Constructor\n     * @param camera camera model\n     * @param near distance of the near plane\n     * @param far distance of the far plane\n     */\n    constructor(camera: CameraModel, near: number = DEFAULT_NEAR, far: number = DEFAULT_FAR)\n    {\n        this._near = +near;\n        this._far = +far;\n\n        if(this._near >= this._far)\n            throw new IllegalArgumentError(`View expects near < far (found near = ${this._near} and far = ${this._far})`);\n        else if(this._near <= 0)\n            throw new IllegalArgumentError(`View expects a positive near (found ${this._near})`);\n\n        this._camera = camera;\n        this._projectionMatrix = camera.computeProjectionMatrix(this._near, this._far);\n        this._inverseProjection = null;\n    }\n\n    /**\n     * A 4x4 projection matrix for WebGL\n     */\n    get projectionMatrix(): SpeedyMatrix\n    {\n        return this._projectionMatrix;\n    }\n\n    /**\n     * The inverse of the projection matrix\n     * @internal\n     */\n    get _projectionMatrixInverse(): SpeedyMatrix\n    {\n        if(this._inverseProjection === null)\n            this._inverseProjection = Speedy.Matrix(this._projectionMatrix.inverse());\n\n        return this._inverseProjection;\n    }\n\n    /**\n     * Aspect ratio of the frustum\n     */\n    get aspect(): number\n    {\n        return this._camera.aspectRatio;\n    }\n\n    /**\n     * Horizontal field-of-view of the frustum, measured in radians\n     */\n    get fovx(): number\n    {\n        return this._camera.fovx;\n    }\n\n    /**\n     * Vertical field-of-view of the frustum, measured in radians\n     */\n    get fovy(): number\n    {\n        return this._camera.fovy;\n    }\n\n    /**\n     * Distance of the near plane\n     */\n    get near(): number\n    {\n        return this._near;\n    }\n\n    /**\n     * Distance of the far plane\n     */\n    get far(): number\n    {\n        return this._far;\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * ray.ts\n * Rays\n */\n\nimport { Vector3 } from './vector3';\n\n\n/**\n * A ray with origin and direction\n */\nexport class Ray\n{\n    /** origin of the ray, a point */\n    private _origin: Vector3;\n\n    /** direction, a unit vector */\n    private _direction: Vector3;\n\n\n\n    /**\n     * Constructor\n     * @param origin a point\n     * @param direction a unit vector\n     */\n    constructor(origin: Vector3, direction: Vector3)\n    {\n        this._origin = origin;\n        this._direction = direction;\n    }\n\n    /**\n     * The origin point of the ray\n     */\n    get origin(): Vector3\n    {\n        return this._origin;\n    }\n\n    /**\n     * The direction of the ray, a unit vector\n     */\n    get direction(): Vector3\n    {\n        return this._direction;\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * view.ts\n * A viewer represents a virtual camera in 3D world space\n */\n\nimport Speedy from 'speedy-vision';\nimport { CameraModel } from './camera-model';\nimport { Pose } from './pose';\nimport { ViewerPose } from './viewer-pose';\nimport { View, PerspectiveView } from './view';\nimport { Transform } from './transform';\nimport { Vector2 } from './vector2';\nimport { Vector3 } from './vector3';\nimport { Ray } from './ray';\n\n\n\n/**\n * A viewer represents a virtual camera in 3D world space\n */\nexport class Viewer\n{\n    /** the pose of the viewer in 3D world space */\n    private readonly _pose: ViewerPose;\n\n    /** the views of this viewer (1 for monoscopic rendering; 2 for stereoscopic) */\n    private readonly _views: View[];\n\n\n\n\n    /**\n     * Constructor\n     * @param camera camera model\n     */\n    constructor(camera: CameraModel)\n    {\n        this._pose = new ViewerPose(camera);\n        this._views = [ new PerspectiveView(camera) ];\n    }\n\n    /**\n     * The pose of this viewer\n     */\n    get pose(): ViewerPose\n    {\n        return this._pose;\n    }\n\n    /**\n     * The view of this viewer (only for monoscopic rendering)\n     */\n    get view(): View\n    {\n        /*\n        if(this._views.length > 1)\n            throw new IllegalOperationError('Use viewer.views for stereoscopic rendering');\n        */\n\n        return this._views[0];\n    }\n\n    /**\n     * The views of this viewer\n     */\n    /*\n    get views(): View[]\n    {\n        return this._views.concat([]);\n    }\n    */\n\n    /**\n     * Convert a pose from world space to viewer space\n     * @param pose a pose in world space\n     * @returns a pose in viewer space\n     */\n    convertToViewerSpace(pose: Pose): Pose\n    {\n        const modelMatrix = pose.transform.matrix;\n        const viewMatrix = this._pose.viewMatrix;\n        const modelViewMatrix = Speedy.Matrix(viewMatrix.times(modelMatrix));\n\n        const transform = new Transform(modelViewMatrix);\n        return new Pose(transform);\n    }\n\n    /**\n     * Cast a ray from a point in the image space associated with this Viewer\n     * @param position a point in image space, given in normalized units [-1,1]x[-1,1]\n     * @returns a ray in world space that corresponds to the given point\n     */\n    raycast(position: Vector2): Ray\n    {\n        const projectionMatrixInverse = this.view._projectionMatrixInverse;\n        const viewMatrixInverse = this._pose.transform.matrix;\n        const pointInClipSpace = Speedy.Matrix(4, 1, [\n            // Normalized Device Coordinates (NDC)\n            position.x,\n            position.y,\n            0, // (*)\n            1  // homogeneous coordinates\n        ]);\n\n        const pointInViewSpace = projectionMatrixInverse.times(pointInClipSpace);\n        const pointInWorldSpace = viewMatrixInverse.times(pointInViewSpace);\n        const p = Speedy.Matrix(pointInWorldSpace).read();\n\n        /*\n\n        (*) since we're just interested in the direction, any z coordinate in\n            clip space [-1,1] will give us a suitable point p in world space.\n\n        */\n\n        const origin = this._pose.transform.position;\n        const direction = new Vector3(p[0] / p[3], p[1] / p[3], p[2] / p[3])\n                          ._subtract(origin)._normalize();\n\n        return new Ray(origin, direction);\n    }\n\n    /**\n     * Compute a ray in the forward direction from the viewer\n     * @returns a new ray in world space\n     */\n    forwardRay(): Ray\n    {\n        const origin = this._pose.transform.position;\n        const direction = this._pose.transform.forward;\n\n        return new Ray(origin, direction);\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * tracking.ts\n * Tracking state of the Image Tracker\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyPoint2 } from 'speedy-vision/types/core/speedy-point';\nimport { SpeedyVector2 } from 'speedy-vision/types/core/speedy-vector';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { SpeedyMatrixExpr } from 'speedy-vision/types/core/speedy-matrix-expr';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { SpeedyPipeline, SpeedyPipelineOutput } from 'speedy-vision/types/core/pipeline/pipeline';\nimport { SpeedyPipelineNodeImageSource } from 'speedy-vision/types/core/pipeline/nodes/images/source';\nimport { SpeedyPipelineNodeImagePortalSource, SpeedyPipelineNodeImagePortalSink } from 'speedy-vision/types/core/pipeline/nodes/images/portal';\nimport { SpeedyPipelineNodeKeypointPortalSource, SpeedyPipelineNodeKeypointPortalSink } from 'speedy-vision/types/core/pipeline/nodes/keypoints/portal';\nimport { SpeedyPipelineNodeKeypointSource } from 'speedy-vision/types/core/pipeline/nodes/keypoints/source';\nimport { SpeedyPipelineNodeKeypointMultiplexer } from 'speedy-vision/types/core/pipeline/nodes/keypoints/multiplexer';\nimport { SpeedyPipelineNodeResize } from 'speedy-vision/types/core/pipeline/nodes/transforms/resize';\nimport { SpeedyPipelineNodePerspectiveWarp } from 'speedy-vision/types/core/pipeline/nodes/transforms/perspective-warp';\nimport { SpeedyPipelineNodeKeypointBorderClipper } from 'speedy-vision/types/core/pipeline/nodes/keypoints/border-clipper';\nimport { SpeedyPipelineNodeKeypointTransformer } from 'speedy-vision/types/core/pipeline/nodes/keypoints/transformer';\nimport { SpeedyKeypoint, SpeedyTrackedKeypoint, SpeedyMatchedKeypoint } from 'speedy-vision/types/core/speedy-keypoint';\nimport { ImageTracker, ImageTrackerOutput, ImageTrackerStateName, ImageTrackerResult, TrackableImage } from '../image-tracker';\nimport { ImageTrackerUtils, ImageTrackerKeypointPair } from '../image-tracker-utils';\nimport { ImageTrackerEvent } from '../image-tracker-event';\nimport { ImageTrackerState, ImageTrackerStateOutput } from './state';\nimport { Nullable, Utils } from '../../../utils/utils';\nimport { ReferenceImage, ReferenceImageWithMedia } from '../reference-image';\nimport { CameraModel } from '../../../geometry/camera-model';\nimport { Viewer } from '../../../geometry/viewer';\nimport { Pose } from '../../../geometry/pose';\nimport { Transform } from '../../../geometry/transform';\nimport { IllegalOperationError, IllegalArgumentError, TrackingError, NumericalError } from '../../../utils/errors';\nimport {\n    TRACK_RECTIFIED_SCALE, TRACK_CLIPPING_BORDER, TRACK_MIN_MATCHES, TRACK_LOST_TOLERANCE,\n    NIGHTVISION_GAIN, NIGHTVISION_OFFSET, NIGHTVISION_DECAY, TRACK_WITH_NIGHTVISION,\n    ORB_GAUSSIAN_KSIZE, ORB_GAUSSIAN_SIGMA,\n    SUBPIXEL_GAUSSIAN_KSIZE, SUBPIXEL_GAUSSIAN_SIGMA,\n    TRACK_HARRIS_QUALITY, TRACK_DETECTOR_CAPACITY, TRACK_MAX_KEYPOINTS,\n    TRACK_RANSAC_REPROJECTIONERROR_NDC, TRACK_MATCH_RATIO,\n    TRACK_FILTER_ALPHA, TRACK_FILTER_BETA,\n    TRACK_EXTRAPOLATION_ALPHA, TRACK_EXTRAPOLATION_BETA,\n    NIGHTVISION_QUALITY, SUBPIXEL_METHOD,\n} from '../settings';\nimport { Settings } from '../../../core/settings';\n\n/** Whether or not we want to accelerate GPU-CPU transfers. Using turbo costs a slight delay on the tracking */\nconst USE_TURBO = true;\n\n/** Number of PBOs; meaningful only when using turbo */\nconst NUMBER_OF_PBOS = 2;\n\n/** Motion model */\nconst NO_MOTION = Speedy.Matrix.Eye(3);\n\n\n\n/**\n * The tracking state of the Image Tracker tracks\n * keypoints of the image target and updates the\n * rectification matrix\n */\nexport class ImageTrackerTrackingState extends ImageTrackerState\n{\n    /** tracked image */\n    private _referenceImage: Nullable<ReferenceImageWithMedia>;\n\n    /** current homography (for warping) */\n    private _warpHomography: SpeedyMatrix;\n\n    /** current homography (for computing the pose) */\n    private _poseHomography: SpeedyMatrix;\n\n    /* previous warp homography */\n    private _prevHomography: SpeedyMatrix;\n\n    /** initial keypoints (i.e., the keypoints we found when we first started tracking) */\n    private _templateKeypoints: SpeedyKeypoint[];\n\n    /** the screen size when the tracking began */\n    private _initialScreenSize: SpeedySize;\n\n    /** last output of the tracker */\n    private _lastOutput: ImageTrackerOutput;\n\n    /** last output of the pipeline */\n    private _lastPipelineOutput: SpeedyPipelineOutput;\n\n    /** a helper for frame skipping */\n    private _skipCounter: number;\n\n    /** a helper */\n    private _counter: number;\n\n    /** the number of consecutive frames in which we have lost the tracking */\n    private _lostCounter: number;\n\n    /** camera model linked to the tracked image */\n    private _camera: CameraModel;\n\n    /** a camera model that is fixed at the origin */\n    private _fixedCamera: CameraModel;\n\n\n\n    /**\n     * Constructor\n     * @param imageTracker\n     */\n    constructor(imageTracker: ImageTracker)\n    {\n        super('tracking', imageTracker);\n\n        this._referenceImage = null;\n        this._warpHomography = Speedy.Matrix.Eye(3);\n        this._poseHomography = Speedy.Matrix.Eye(3);\n        this._prevHomography = Speedy.Matrix.Eye(3);\n        this._templateKeypoints = [];\n        this._initialScreenSize = Speedy.Size(1, 1);\n        this._lastOutput = {};\n        this._lastPipelineOutput = { keypoints: [] };\n        this._skipCounter = 0;\n        this._counter = 0;\n        this._lostCounter = 0;\n        this._camera = new CameraModel();\n        this._fixedCamera = new CameraModel();\n    }\n\n    /**\n     * Called as soon as this becomes the active state, just before update() runs for the first time\n     * @param settings\n     */\n    onEnterState(settings: Record<string,any>)\n    {\n        const homography = settings.homography as SpeedyMatrix; // NDC, from reference image to video\n        const referenceImage = settings.referenceImage as Nullable<ReferenceImageWithMedia>;\n        const templateKeypoints = settings.templateKeypoints as SpeedyKeypoint[];\n        const templateKeypointPortalSink = settings.templateKeypointPortalSink as SpeedyPipelineNodeKeypointPortalSink;\n        const initialScreenSize = settings.initialScreenSize as SpeedySize; // this.screenSize is not yet set\n        const keypointPortalSource = this._pipeline.node('keypointPortalSource') as SpeedyPipelineNodeKeypointPortalSource;\n\n        // this shouldn't happen\n        if(!referenceImage)\n            throw new IllegalOperationError(`Can't track a null reference image`);\n\n        // set attributes\n        this._referenceImage = referenceImage;\n        this._warpHomography.setToSync(homography);\n        this._poseHomography.setToSync(homography);\n        this._prevHomography.setToSync(homography);\n        this._templateKeypoints = templateKeypoints;\n        this._initialScreenSize = Speedy.Size(initialScreenSize.width, initialScreenSize.height);\n        this._lastOutput = {};\n        this._lastPipelineOutput = { keypoints: [] };\n        this._skipCounter = 0;\n        this._counter = 0;\n        this._lostCounter = 0;\n\n        // setup portals\n        keypointPortalSource.source = templateKeypointPortalSink;\n\n        // setup the cameras\n        const aspectRatio = initialScreenSize.width / initialScreenSize.height;\n        this._camera.init(aspectRatio);\n        this._fixedCamera.init(aspectRatio);\n\n        // emit event\n        const ev = new ImageTrackerEvent('targetfound', referenceImage);\n        this._imageTracker.dispatchEvent(ev);\n\n        // log\n        Utils.log(`Tracking image \"${referenceImage.name}\"...`);\n    }\n\n    /**\n     * Called when leaving the state\n     */\n    onLeaveState(): void\n    {\n        // log\n        Utils.log(`No longer tracking image \"${this._referenceImage!.name}\"!`);\n\n        // release the cameras\n        this._fixedCamera.release();\n        this._camera.release();\n\n        // emit event\n        const ev = new ImageTrackerEvent('targetlost', this._referenceImage!);\n        this._imageTracker.dispatchEvent(ev);\n    }\n\n    /**\n     * Called just before the GPU processing\n     * @returns promise\n     */\n    protected _beforeUpdate(): SpeedyPromise<void>\n    {\n        const imageRectifier = this._pipeline.node('imageRectifier') as SpeedyPipelineNodePerspectiveWarp;\n        const borderClipper = this._pipeline.node('borderClipper') as SpeedyPipelineNodeKeypointBorderClipper;\n        const keypointScaler = this._pipeline.node('keypointScaler') as SpeedyPipelineNodeKeypointTransformer;\n        const screenSize = this.screenSize;\n\n        /*\n        // pause media (test)\n        const source = this._pipeline.node('source') as SpeedyPipelineNodeImageSource;\n        const media = source.media as SpeedyMedia;\n        (media.source as HTMLVideoElement).pause();\n        */\n\n        // clip keypoints from the borders of the target image\n        borderClipper.imageSize = screenSize;\n        borderClipper.borderSize = Speedy.Vector2(\n            screenSize.width * TRACK_CLIPPING_BORDER,\n            screenSize.height * TRACK_CLIPPING_BORDER\n        );\n\n        // convert keypoints to NIS\n        keypointScaler.transform = ImageTrackerUtils.rasterToNIS(screenSize);\n\n        // rectify the image\n        const scale = TRACK_RECTIFIED_SCALE;\n        const aspectRatio = ImageTrackerUtils.bestFitAspectRatioNDC(screenSize, this._referenceImage!);\n        const shrink = ImageTrackerUtils.bestFitScaleNDC(aspectRatio, scale);\n        const undistort = this._warpHomography.inverse();\n        const toScreen = ImageTrackerUtils.NDCToRaster(screenSize);\n        const toNDC = ImageTrackerUtils.rasterToNDC(screenSize);\n\n        return imageRectifier.transform.setTo(\n            toScreen.times(shrink.times(undistort)).times(toNDC)\n        ).then(() => void 0);\n    }\n\n    /**\n     * GPU processing\n     * @returns promise with the pipeline results\n     */\n    protected _gpuUpdate(): SpeedyPromise<SpeedyPipelineOutput>\n    {\n        // Run the pipeline as usual\n        if(!USE_TURBO || Settings.powerPreference == 'low-power')// || Settings.powerPreference == 'high-performance')\n            return super._gpuUpdate();\n\n        // When using turbo, we reduce the GPU usage by skipping every other frame\n        if(0 == (this._skipCounter = 1 - this._skipCounter)) {\n            //const templateKeypoints = this._templateKeypoints;\n            const previousKeypoints = this._lastPipelineOutput.keypoints as SpeedyMatchedKeypoint[];\n            //const currentKeypoints = this._predictKeypoints(previousKeypoints, templateKeypoints);\n            const currentKeypoints = previousKeypoints; // this actually works\n\n            // idea: predict keypoints with optical flow?\n\n            this._lastPipelineOutput.keypoints = currentKeypoints;\n            return Speedy.Promise.resolve(this._lastPipelineOutput);\n        }\n\n        // Run the pipeline and store the results\n        return super._gpuUpdate().then(result => {\n            this._lastPipelineOutput = result;\n            return result;\n        });\n    }\n\n    /**\n     * Post processing that takes place just after the GPU processing\n     * @param result pipeline results\n     * @returns state output\n     */\n    protected _afterUpdate(result: SpeedyPipelineOutput): SpeedyPromise<ImageTrackerStateOutput>\n    {\n        const keypoints = result.keypoints as SpeedyMatchedKeypoint[];\n        const image = result.image as SpeedyMedia | undefined;\n        const referenceImage = this._referenceImage!;\n        const screenSize = this.screenSize;\n\n        // track the target\n        return Speedy.Promise.resolve()\n        .then(() => {\n\n            // if a change in screen size occurs, we need to recalibrate\n            // (perform a new pre-training)\n            if(!screenSize.equals(this._initialScreenSize))\n                throw new TrackingError('Detected a change in screen size');\n\n            // find matching pairs of keypoints\n            const allPairs = this._findMatchingPairs(this._templateKeypoints, keypoints);\n            const pairs = ImageTrackerUtils.refineMatchingPairs(allPairs);\n            if(pairs.length < TRACK_MIN_MATCHES)\n                throw new TrackingError('Not enough data points to continue the tracking');\n\n            // find motion model\n            const points = ImageTrackerUtils.compilePairsOfKeypointsNDC(pairs);\n            return this._find6DoFPerspectiveMotionNDC(points);\n\n        })\n        .then(warpMotion => {\n\n            const lowPower = (Settings.powerPreference == 'low-power');\n            const multiplier = /*!USE_TURBO ||*/ lowPower ? 2 : 1;\n\n            // apply filter\n            return ImageTrackerUtils.interpolateHomographies(\n                NO_MOTION,\n                Speedy.Matrix(warpMotion),\n                TRACK_FILTER_ALPHA * multiplier,\n                TRACK_FILTER_BETA\n            );\n\n        })\n        .then(warpMotion => {\n\n            // update warp homography\n            this._prevHomography.setToSync(this._warpHomography);\n            this._warpHomography.setToSync(warpMotion.times(this._warpHomography));\n            //return this._warpHomography;\n\n            // extrapolate to compensante a bit the delay introduced by the\n            // previous filter\n            return ImageTrackerUtils.interpolateHomographies(\n                this._prevHomography,\n                this._warpHomography,\n                TRACK_EXTRAPOLATION_ALPHA,\n                TRACK_EXTRAPOLATION_BETA,\n                //2.5,0.1\n            )\n\n            /*\n            const lowPower = (Settings.powerPreference == 'low-power');\n            const delay = NUMBER_OF_PBOS * (!lowPower ? 2 : 1);\n\n            // update warp homography\n            if(!USE_TURBO || this._counter % delay == 1) // skip the first frame (PBOs)\n                this._warpHomography.setToSync(warpMotion.times(this._warpHomography));\n\n            // update counter\n            this._counter = (this._counter + 1) % delay;\n\n            // apply filter\n            return ImageTrackerUtils.interpolateHomographies(\n                this._poseHomography,\n                this._warpHomography,\n                0.4,//TRACK_FILTER_ALPHA,\n                1,//TRACK_FILTER_BETA,\n                0.4,//TRACK_FILTER_TAU,\n                0.05,//TRACK_FILTER_OMEGA // keep it zero or close to zero\n            );\n            */\n\n        })\n        .then(filteredHomography => {\n\n            /*\n            // test\n            console.log(\"WARP \", this._warpHomography.toString());\n            console.log(\"POSE \", this._poseHomography.toString());\n            console.log(\"FILT \", filteredHomography.toString());\n            */\n\n            // update pose homography\n            this._poseHomography.setToSync(filteredHomography);\n            if(Number.isNaN(this._poseHomography.at(0,0)))\n                throw new NumericalError('Bad homography'); // normalize? 1 / h33\n\n            // We transform the keypoints of the reference image to NDC as a\n            // convenience. However, doing so distorts the aspect ratio. Here\n            // we undo the distortion.\n            //const scale = ImageTrackerUtils.inverseBestFitScaleNDC(referenceImage.aspectRatio); // not preferred; extrapolates the bounds of NDC\n            const scale = ImageTrackerUtils.bestFitScaleNDC(1 / referenceImage.aspectRatio); // preferred\n            const homography = Speedy.Matrix(this._poseHomography.times(scale));\n            //this._poseHomography = homography; // visualize the polyline becoming a square\n\n            // update camera model\n            return this._camera.update(homography);\n\n        })\n        .then(() => {\n\n            /*\n\n            Q: should the camera move relative to the target image, or should\n               the target image move relative to the camera?\n\n            A: the target image should move and the camera should stay fixed.\n               Movements of the target image in the video should not affect the\n               rendering of all virtual elements in world space. They should\n               only affect the rendering of virtual elements positioned at the\n               local space linked to the target (\"ar.root\").\n\n               (that's right, and movements of the real camera in physical space\n               shouldn't affect the world space either. Note: the real camera is\n               expected to be shaky. Example: a user holding a mobile phone.)\n\n            */\n\n            // the target moves and the camera stays fixed at the origin\n            const modelMatrix = this._camera.computeViewMatrix(); // p_view = V M p_model\n            const transform = new Transform(modelMatrix);\n            const pose = new Pose(transform);\n            const viewer = new Viewer(this._fixedCamera); // view matrix = I\n\n            /*\n            // this is the opposite reasoning: the camera moves and the target\n            // image stays fixed at the origin of world space\n            const modelMatrix = Speedy.Matrix.Eye(4);\n            const transform = new Transform(modelMatrix);\n            const pose = new Pose(transform);\n            const viewer = new Viewer(this._camera);\n            */\n\n            // the trackable object\n            const trackable: TrackableImage = {\n                pose: pose,\n                referenceImage: referenceImage,\n                tracker: this._imageTracker\n            };\n\n            // the result generated by the image tracker\n            const result = new ImageTrackerResult(\n                this._imageTracker,\n                [ trackable ],\n                viewer\n            );\n\n            // tracker output\n            const trackerOutput: ImageTrackerOutput = {\n                exports: result,\n                keypoints: keypoints,\n                //keypointsNIS: image !== undefined ? keypoints : undefined, // debug only\n                image: image,\n                polylineNDC: ImageTrackerUtils.findPolylineNDC(this._poseHomography),\n                camera: this._camera,\n            };\n\n            // save the last output\n            this._lastOutput = trackerOutput;\n\n            // we have successfully tracked the target in this frame\n            this._lostCounter = 0;\n\n            // done!\n            return {\n                nextState: 'tracking',\n                trackerOutput: trackerOutput\n            };\n\n        })\n        .catch(err => {\n\n            // give some tolerance to tracking errors\n            if(err instanceof TrackingError) {\n                if(++this._lostCounter <= TRACK_LOST_TOLERANCE) {\n                    return {\n                        nextState: 'tracking',\n                        trackerOutput: this._lastOutput\n                    };\n                }\n            }\n\n            // log\n            Utils.warning(`The target has been lost! ${err.toString()}`);\n\n            // go back to the scanning state\n            return {\n                nextState: 'scanning',\n                trackerOutput: { }\n            };\n\n        });\n    }\n\n    /**\n     * Find an affine motion model in NDC between pairs of keypoints in NDC\n     * given as a 2 x 2n [ src | dest ] matrix\n     * @param points compiled pairs of keypoints in NDC\n     * @returns a promise that resolves to a 3x3 warp in NDC that maps source to destination\n     */\n    private _findAffineMotionNDC(points: SpeedyMatrix): SpeedyPromise<SpeedyMatrixExpr>\n    {\n        /*\n\n        We can probably get more accurate motion estimates if we\n        work in 3D rather than in 2D. We're currently estimating an\n        affine motion in 2D NDC space, which does not account for\n        perspective distortions. What if we projected the keypoints\n        into 3D NDC space, estimated the camera motion (rotation and\n        translation) that best describes the observed observed motion\n        of the keypoints, and then projected things back to 2D NDC\n        space? Need to figure this out; we'll get a homography matrix.\n\n        Note: work with a 6 DoF perspective transform instead of 8.\n\n        Edit: now we have find6DoFHomography()\n\n        */\n\n        return ImageTrackerUtils.findAffineWarpNDC(points, {\n            method: 'pransac',\n            reprojectionError: TRACK_RANSAC_REPROJECTIONERROR_NDC,\n            numberOfHypotheses: 512*2,\n            bundleSize: 128,\n            mask: undefined // score is not needed\n        }).then(([ warp, score ]) => {\n\n            const scale = TRACK_RECTIFIED_SCALE;\n            const aspectRatio = ImageTrackerUtils.bestFitAspectRatioNDC(this.screenSize, this._referenceImage!);\n            const shrink = ImageTrackerUtils.bestFitScaleNDC(aspectRatio, scale);\n            const grow = ImageTrackerUtils.inverseBestFitScaleNDC(aspectRatio, scale);\n            const scaledWarp = grow.times(warp).times(shrink);\n\n            const distort = this._warpHomography;\n            const undistort = distort.inverse();\n            const correctedWarp = distort.times(scaledWarp).times(undistort);\n\n            return correctedWarp;\n\n        }).catch(err => {\n\n            throw new TrackingError(`Can't find an affine motion`, err);\n\n        });\n    }\n\n    /**\n     * Find a perspective motion model in NDC between pairs of keypoints in NDC\n     * given as a 2 x 2n [ src | dest ] matrix\n     * @param points compiled pairs of keypoints in NDC\n     * @returns a promise that resolves to a 3x3 warp in NDC that maps source to destination\n     */\n    private _findPerspectiveMotionNDC(points: SpeedyMatrix): SpeedyPromise<SpeedyMatrixExpr>\n    {\n        return ImageTrackerUtils.findPerspectiveWarpNDC(points, {\n            method: 'pransac',\n            reprojectionError: TRACK_RANSAC_REPROJECTIONERROR_NDC,\n            numberOfHypotheses: 512*2,\n            bundleSize: 128,//128*4,\n            mask: undefined // score is not needed\n        })\n        .then(([ warp, score ]) => {\n\n            const scale = TRACK_RECTIFIED_SCALE;\n            const aspectRatio = ImageTrackerUtils.bestFitAspectRatioNDC(this.screenSize, this._referenceImage!);\n            const shrink = ImageTrackerUtils.bestFitScaleNDC(aspectRatio, scale);\n            const grow = ImageTrackerUtils.inverseBestFitScaleNDC(aspectRatio, scale);\n            const scaledWarp = grow.times(warp).times(shrink);\n\n            const distort = this._poseHomography;\n            const undistort = distort.inverse();\n            const correctedWarp = distort.times(scaledWarp).times(undistort);\n\n            return correctedWarp;\n\n        }).catch(err => {\n\n            throw new TrackingError(`Can't find a perspective motion`, err);\n\n        });\n    }\n\n    /**\n     * Find a 6 DoF perspective motion model in NDC between pairs of keypoints in NDC\n     * given as a 2 x 2n [ src | dest ] matrix\n     * @param points compiled pairs of keypoints in NDC\n     * @returns a promise that resolves to a 3x3 warp in NDC that maps source to destination\n     */\n    private _find6DoFPerspectiveMotionNDC(points: SpeedyMatrix): SpeedyPromise<SpeedyMatrixExpr>\n    {\n        const K = this._camera.intrinsicsMatrix();\n\n        return ImageTrackerUtils.find6DoFHomographyNDC(K, points, {\n            reprojectionError: TRACK_RANSAC_REPROJECTIONERROR_NDC,\n            numberOfHypotheses: 100,\n            //mask: undefined // score is not needed\n        })\n        .then(([ warp, score ]) => {\n\n            const scale = TRACK_RECTIFIED_SCALE;\n            const aspectRatio = ImageTrackerUtils.bestFitAspectRatioNDC(this.screenSize, this._referenceImage!);\n            const shrink = ImageTrackerUtils.bestFitScaleNDC(aspectRatio, scale);\n            const grow = ImageTrackerUtils.inverseBestFitScaleNDC(aspectRatio, scale);\n            const scaledWarp = grow.times(warp).times(shrink);\n\n            //const distort = this._poseHomography;\n            const distort = this._warpHomography;\n            const undistort = distort.inverse();\n            const correctedWarp = distort.times(scaledWarp).times(undistort);\n\n            return correctedWarp;\n\n        }).catch(err => {\n\n            throw new TrackingError(`Can't find a perspective motion`, err);\n\n        });\n    }\n\n    /**\n     * Find matching pairs of two sets of keypoints matched via brute force\n     * @param srcKeypoints source (database)\n     * @param destKeypoints destination\n     * @returns an array of matching pairs [src, dest]\n     */\n    private _findMatchingPairs(srcKeypoints: SpeedyKeypoint[], destKeypoints: SpeedyMatchedKeypoint[]): ImageTrackerKeypointPair[]\n    {\n        const pairs: ImageTrackerKeypointPair[] = [];\n\n        for(let i = 0; i < destKeypoints.length; i++) {\n            const destKeypoint = destKeypoints[i];\n\n            if(destKeypoint.matches[0].index >= 0 && destKeypoint.matches[1].index >= 0) {\n                const d1 = destKeypoint.matches[0].distance;\n                const d2 = destKeypoint.matches[1].distance;\n\n                // the best match should be \"much better\" than the second best match,\n                // which means that they are \"distinct enough\"\n                if(d1 <= TRACK_MATCH_RATIO * d2) {\n                    const srcKeypoint = srcKeypoints[destKeypoint.matches[0].index];\n                    pairs.push([srcKeypoint, destKeypoint]);\n                }\n            }\n        }\n\n        return pairs;\n    }\n\n    /**\n     * Predict the keypoints without actually looking at the image\n     * @param curr keypoints at time t (will modify the contents)\n     * @param prev keypoints at time t-1 (not just t = 0)\n     * @returns keypoints at time t+1\n     */\n    /*\n    private _predictKeypoints(curr: SpeedyMatchedKeypoint[], prev: SpeedyKeypoint[]): SpeedyMatchedKeypoint[]\n    {\n        // the target image is likely to be moving roughly in\n        // the same manner as it was in the previous frame\n        const alpha = 0.8; //0.2;\n        const next: SpeedyMatchedKeypoint[] = [];\n        const n = curr.length;\n\n        for(let i = 0; i < n; i++) {\n            const cur = curr[i];\n\n            if(cur.matches[0].index < 0 || cur.matches[1].index < 0)\n                continue;\n            //else if(cur.matches[0].distance > TRACK_MATCH_RATIO * cur.matches[1].distance)\n            //    continue;\n\n            const prv = prev[cur.matches[0].index];\n            const dx = cur.position.x - prv.position.x;\n            const dy = cur.position.y - prv.position.y;\n\n            // a better mathematical model is needed\n            cur.position.x = prv.position.x + alpha * dx;\n            cur.position.y = prv.position.y + alpha * dy;\n            next.push(cur);\n        }\n\n        // done!\n        return next;\n    }\n    */\n\n    /**\n     * Create & setup the pipeline\n     * @returns pipeline\n     */\n    protected _createPipeline(): SpeedyPipeline\n    {\n        const pipeline = Speedy.Pipeline();\n\n        const source = Speedy.Image.Source('source');\n        const screen = Speedy.Transform.Resize('screen');\n        const greyscale = Speedy.Filter.Greyscale();\n        const imageRectifier = Speedy.Transform.PerspectiveWarp('imageRectifier');\n        const nightvision = Speedy.Filter.Nightvision();\n        const nightvisionMux = Speedy.Image.Multiplexer();\n        const blur = Speedy.Filter.GaussianBlur();\n        const detector = Speedy.Keypoint.Detector.Harris();\n        const descriptor = Speedy.Keypoint.Descriptor.ORB();\n        const matcher = Speedy.Keypoint.Matcher.BFKNN();\n        const subpixel = Speedy.Keypoint.SubpixelRefiner();\n        const denoiser = Speedy.Filter.GaussianBlur();\n        const borderClipper = Speedy.Keypoint.BorderClipper('borderClipper');\n        const clipper = Speedy.Keypoint.Clipper();\n        const keypointScaler = Speedy.Keypoint.Transformer('keypointScaler');\n        const keypointPortalSource = Speedy.Keypoint.Portal.Source('keypointPortalSource');\n        const keypointSink = Speedy.Keypoint.SinkOfMatchedKeypoints('keypoints');\n        //const imageSink = Speedy.Image.Sink('image');\n\n        source.media = null;\n        screen.size = Speedy.Size(0,0);\n        imageRectifier.transform = Speedy.Matrix.Eye(3);\n        nightvision.gain = NIGHTVISION_GAIN;\n        nightvision.offset = NIGHTVISION_OFFSET;\n        nightvision.decay = NIGHTVISION_DECAY;\n        nightvision.quality = NIGHTVISION_QUALITY;\n        nightvisionMux.port = TRACK_WITH_NIGHTVISION ? 1 : 0; // 1 = enable nightvision\n        blur.kernelSize = Speedy.Size(ORB_GAUSSIAN_KSIZE, ORB_GAUSSIAN_KSIZE);\n        blur.sigma = Speedy.Vector2(ORB_GAUSSIAN_SIGMA, ORB_GAUSSIAN_SIGMA);\n        denoiser.kernelSize = Speedy.Size(SUBPIXEL_GAUSSIAN_KSIZE, SUBPIXEL_GAUSSIAN_KSIZE);\n        denoiser.sigma = Speedy.Vector2(SUBPIXEL_GAUSSIAN_SIGMA, SUBPIXEL_GAUSSIAN_SIGMA);\n        detector.quality = TRACK_HARRIS_QUALITY;\n        detector.capacity = TRACK_DETECTOR_CAPACITY;\n        subpixel.method = SUBPIXEL_METHOD;\n        clipper.size = TRACK_MAX_KEYPOINTS;\n        borderClipper.imageSize = screen.size;\n        borderClipper.borderSize = Speedy.Vector2(0,0);\n        keypointScaler.transform = Speedy.Matrix.Eye(3);\n        matcher.k = 2;\n        keypointPortalSource.source = null;\n        keypointSink.turbo = USE_TURBO;\n\n        // prepare input\n        source.output().connectTo(screen.input());\n        screen.output().connectTo(greyscale.input());\n\n        // preprocess images\n        greyscale.output().connectTo(imageRectifier.input());\n        imageRectifier.output().connectTo(nightvisionMux.input('in0'));\n        imageRectifier.output().connectTo(nightvision.input());\n        nightvision.output().connectTo(nightvisionMux.input('in1'));\n\n        // keypoint detection & clipping\n        nightvisionMux.output().connectTo(detector.input());\n        detector.output().connectTo(borderClipper.input());\n        borderClipper.output().connectTo(clipper.input());\n\n        // keypoint refinement\n        imageRectifier.output().connectTo(denoiser.input());\n        denoiser.output().connectTo(subpixel.input('image'));\n        clipper.output().connectTo(subpixel.input('keypoints'));\n\n        // keypoint description\n        imageRectifier.output().connectTo(blur.input());\n        blur.output().connectTo(descriptor.input('image'));\n        subpixel.output().connectTo(descriptor.input('keypoints'));\n\n        // keypoint matching\n        keypointPortalSource.output().connectTo(matcher.input('database'));\n        descriptor.output().connectTo(matcher.input('keypoints'));\n\n        // prepare output\n        descriptor.output().connectTo(keypointScaler.input());\n        keypointScaler.output().connectTo(keypointSink.input());\n        matcher.output().connectTo(keypointSink.input('matches'));\n        //imageRectifier.output().connectTo(imageSink.input());\n\n        // done!\n        pipeline.init(\n            source, screen, greyscale,\n            imageRectifier, nightvision, nightvisionMux, blur,\n            detector, subpixel, borderClipper, clipper, denoiser,\n            descriptor, matcher,\n            keypointPortalSource, keypointScaler, keypointSink,\n            //imageSink\n        );\n\n        return pipeline;\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * image-tracker.ts\n * Image Tracker\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { SpeedyMatrix } from 'speedy-vision/types/core/speedy-matrix';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { SpeedyPipeline } from 'speedy-vision/types/core/pipeline/pipeline';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { SpeedyPipelineNode } from 'speedy-vision/types/core/pipeline/pipeline-node';\nimport { SpeedyPipelineNodeImageSource } from 'speedy-vision/types/core/pipeline/nodes/images/source';\nimport { SpeedyPipelineNodeResize } from 'speedy-vision/types/core/pipeline/nodes/transforms/resize';\nimport { SpeedyPipelineNodeFASTKeypointDetector } from 'speedy-vision/types/core/pipeline/nodes/keypoints/detectors/fast';\nimport { SpeedyKeypoint } from 'speedy-vision/types/core/speedy-keypoint';\nimport { VideoSource } from '../../sources/video-source';\nimport { CanvasSource } from '../../sources/canvas-source';\nimport { Tracker, TrackerOutput, TrackerResult, Trackable, TrackerType, TrackerResultType } from '../tracker';\nimport { Session } from '../../core/session';\nimport { IllegalOperationError, IllegalArgumentError } from '../../utils/errors';\nimport { Resolution } from '../../utils/resolution';\nimport { ReferenceImage, ReferenceImageWithMedia } from './reference-image';\nimport { ReferenceImageDatabase } from './reference-image-database';\nimport { ImageTrackerState } from './states/state';\nimport { ImageTrackerInitialState } from './states/initial';\nimport { ImageTrackerTrainingState } from './states/training';\nimport { ImageTrackerScanningState } from './states/scanning';\nimport { ImageTrackerPreTrackingAState } from './states/pre-tracking-a';\nimport { ImageTrackerPreTrackingBState } from './states/pre-tracking-b';\nimport { ImageTrackerTrackingState } from './states/tracking';\nimport { Nullable, Utils } from '../../utils/utils';\nimport { AREventTarget } from '../../utils/ar-events';\nimport { ImageTrackerEvent, ImageTrackerEventType } from './image-tracker-event';\nimport { SpeedyPoint2 } from 'speedy-vision/types/core/speedy-point';\nimport { Viewer } from '../../geometry/viewer';\nimport { Pose } from '../../geometry/pose';\nimport { CameraModel } from '../../geometry/camera-model';\n\n/** A trackable target */\nexport interface TrackableImage extends Trackable\n{\n    /** the pose of the target */\n    readonly pose: Pose;\n\n    /** the reference image linked to the target */\n    readonly referenceImage: ReferenceImage;\n}\n\n/** Image Tracker result to be consumed by the user */\nexport class ImageTrackerResult extends TrackerResult\n{\n    /** tracker */\n    readonly tracker: ImageTracker;\n\n    /** trackable targets */\n    readonly trackables: TrackableImage[];\n\n    /** 3D virtual camera */\n    readonly viewer: Viewer;\n\n    /**\n     * Constructor\n     * @param tracker\n     * @param trackables\n     * @param viewer\n     */\n    constructor(tracker: ImageTracker, trackables: TrackableImage[], viewer: Viewer)\n    {\n        super();\n        this.tracker = tracker;\n        this.trackables = trackables;\n        this.viewer = viewer;\n    }\n}\n\n/** Image Tracker output */\nexport interface ImageTrackerOutput extends TrackerOutput\n{\n    /** tracker result to be consumed by the user */\n    readonly exports?: ImageTrackerResult;\n\n    /** keypoints found in this framestep */\n    readonly keypoints?: SpeedyKeypoint[];\n\n    /** optional keypoints for visualizing & testing */\n    readonly keypointsNIS?: SpeedyKeypoint[];\n\n    /** optional polyline for visualizing & testing */\n    readonly polylineNDC?: SpeedyPoint2[];\n\n    /** optional camera model for visualizing & testing */\n    readonly camera?: CameraModel;\n}\n\n/** All possible states of an Image Tracker */\nexport type ImageTrackerStateName = 'initial' | 'training' | 'scanning' | 'pre-tracking-a' | 'pre-tracking-b' | 'tracking';\n\n/** Options for instantiating an ImageTracker */\nexport interface ImageTrackerOptions\n{\n    /** resolution of the tracker; it helps define the AR screen space */\n    resolution?: Resolution;\n}\n\n/** Default options for instantiating an ImageTracker */\nconst DEFAULT_OPTIONS: Readonly<ImageTrackerOptions> = {\n    resolution: 'sm'\n};\n\n/** Tracker type */\nconst TRACKER_TYPE: keyof TrackerType = 'image-tracker';\n\n\n\n\n\n\n/**\n * The ImageTracker tracks an image (one at a time)\n */\nexport class ImageTracker extends AREventTarget<ImageTrackerEvent> implements Tracker\n{\n    /** session */\n    private _session: Nullable<Session>;\n\n    /** source of data */\n    private _source: Nullable<VideoSource | CanvasSource>;\n\n    /** all states */\n    private readonly _state: Record<ImageTrackerStateName, ImageTrackerState>;\n\n    /** name of the active state */\n    private _activeStateName: ImageTrackerStateName;\n\n    /** last emitted output of the tracker */\n    private _lastOutput: ImageTrackerOutput;\n\n    /** reference image database */\n    private readonly _database: ReferenceImageDatabase;\n\n    /** the AR resolution size, used in GPU processing, defines the AR screen space */\n    private _resolution: Resolution;\n\n\n\n    /**\n     * Constructor\n     * @param options\n     */\n    constructor(options: ImageTrackerOptions)\n    {\n        super();\n\n        // the states\n        this._state = {\n            'initial': new ImageTrackerInitialState(this),\n            'training': new ImageTrackerTrainingState(this),\n            'scanning': new ImageTrackerScanningState(this),\n            'pre-tracking-a': new ImageTrackerPreTrackingAState(this),\n            'pre-tracking-b': new ImageTrackerPreTrackingBState(this),\n            'tracking': new ImageTrackerTrackingState(this),\n        };\n\n        // initial setup\n        this._session = null;\n        this._source = null;\n        this._activeStateName = 'initial';\n        this._lastOutput = { };\n        this._database = new ReferenceImageDatabase();\n\n        // user settings\n        options = Object.assign({}, DEFAULT_OPTIONS, options);\n        this._resolution = options.resolution!;\n    }\n\n    /**\n     * The type of the tracker\n     * @deprecated use is() instead\n     */\n    get type(): keyof TrackerType\n    {\n        return TRACKER_TYPE;\n    }\n\n    /**\n     * Check if this tracker is of a certain type\n     */\n    is<T extends keyof TrackerType>(type: T): this is TrackerType[T]\n    {\n        return type === TRACKER_TYPE;\n    }\n\n    /**\n     * Current state name\n     */\n    get state(): ImageTrackerStateName\n    {\n        return this._activeStateName;\n    }\n\n    /**\n     * Reference Image Database\n     * Must be configured before training the tracker\n     */\n    get database(): ReferenceImageDatabase\n    {\n        return this._database;\n    }\n\n    /**\n     * Resolution of the tracker\n     */\n    get resolution(): Resolution\n    {\n        return this._resolution;\n    }\n\n    /**\n     * Resolution of the tracker\n     * @readonly\n     */\n    set resolution(resolution: Resolution)\n    {\n        // this property is readonly, but this setter has been kept because\n        // it wasn't readonly in previous versions of the engine. FIXME\n    }\n\n    /**\n     * Size of the AR screen space, in pixels\n     * @internal\n     */\n    get screenSize(): SpeedySize\n    {\n        return this._state[this._activeStateName].screenSize;\n    }\n\n    /**\n     * Last emitted output\n     * @internal\n     */\n    get _output(): ImageTrackerOutput\n    {\n        return this._lastOutput;\n    }\n\n    /**\n     * Stats related to this tracker\n     * @internal\n     */\n    get _stats(): string\n    {\n        const screenSize = this.screenSize;\n\n        return `${screenSize.width}x${screenSize.height} ${this.state}`;\n    }\n\n    /**\n     * Initialize this tracker\n     * @param session\n     * @returns promise that resolves after the tracker has been initialized\n     * @internal\n     */\n    _init(session: Session): SpeedyPromise<void>\n    {\n        // store the session\n        this._session = session;\n\n        // find a suitable source of data\n        // XXX also let the user specify a source manually?\n        for(const source of session.sources) {\n            // prefer video sources\n            if(source._is('video-source')) {\n                this._source = source;\n                break;\n            }\n            else if(source._is('canvas-source'))\n                this._source = source;\n        }\n        if(this._source === null)\n            throw new IllegalOperationError('The image tracker requires a suitable source of data');\n\n        // initialize states\n        for(const state of Object.values(this._state))\n            state.init();\n\n        // done!\n        return Speedy.Promise.resolve();\n    }\n\n    /**\n     * Release this tracker\n     * @returns promise that resolves after the tracker has been released\n     * @internal\n     */\n    _release(): SpeedyPromise<void>\n    {\n        // release states\n        for(const state of Object.values(this._state))\n            state.release();\n\n        // unlink session\n        this._session = null;\n\n        // done!\n        return Speedy.Promise.resolve();\n    }\n\n    /**\n     * Update the tracker\n     * @returns promise\n     * @internal\n     */\n    _update(): SpeedyPromise<void>\n    {\n        // validate\n        if(this._session == null)\n            return Speedy.Promise.reject(new IllegalOperationError(`Uninitialized tracker`));\n\n        // compute the screen size for image processing purposes\n        // note: this may change over time...!\n        const media = this._source!._internalMedia;\n        const screenSize = this._computeScreenSize();\n\n        // run the active state\n        const activeState = this._state[this._activeStateName];\n        return activeState.update(media, screenSize).then(({ trackerOutput, nextState, nextStateSettings }) => {\n            // update the output of the tracker\n            this._lastOutput = trackerOutput;\n\n            // need to change the state?\n            if(this._activeStateName != nextState) {\n                activeState.onLeaveState();\n                this._activeStateName = nextState;\n                this._state[nextState].onEnterState(nextStateSettings || {});\n            }\n        });\n    }\n\n    /**\n     * Get reference image\n     * @param keypointIndex -1 if not found\n     * @returns reference image\n     * @internal\n     */\n    _referenceImageOfKeypoint(keypointIndex: number): Nullable<ReferenceImageWithMedia>\n    {\n        const training = this._state.training as ImageTrackerTrainingState;\n        return training.referenceImageOfKeypoint(keypointIndex);\n    }\n\n    /**\n     * Get reference image index\n     * @param keypointIndex -1 if not found\n     * @returns reference image index, or -1 if not found\n     * @internal\n     */\n    _referenceImageIndexOfKeypoint(keypointIndex: number): number\n    {\n        const training = this._state.training as ImageTrackerTrainingState;\n        return training.referenceImageIndexOfKeypoint(keypointIndex);\n    }\n\n    /**\n     * Get a keypoint of the trained set\n     * @param keypointIndex\n     * @returns a keypoint\n     * @internal\n     */\n    _referenceKeypoint(keypointIndex: number): Nullable<SpeedyKeypoint>\n    {\n        const training = this._state.training as ImageTrackerTrainingState;\n        return training.referenceKeypoint(keypointIndex);\n    }\n\n    /**\n     * Compute the current size of the AR screen space\n     * Note that this may change over time\n     * @returns size\n     */\n    private _computeScreenSize(): SpeedySize\n    {\n        const media = this._source!._internalMedia;\n        const aspectRatio = media.width / media.height;\n        const screenSize = Utils.resolution(this._resolution, aspectRatio);\n\n        return screenSize;\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * vector2.ts\n * 2D vectors\n */\n\nimport { Nullable } from '../utils/utils';\n\n/** Small number */\nconst EPSILON = 1e-6;\n\n/** Immutable zero vector */\nlet ZERO: Nullable<Vector2> = null;\n\n// public / non-internal methods do not change the contents of the vector\n\n\n\n/**\n * A vector in 2D space\n */\nexport class Vector2\n{\n    /** x coordinate */\n    private _x: number;\n\n    /** y coordinate */\n    private _y: number;\n\n\n\n\n\n    /**\n     * Constructor\n     */\n    constructor(x: number = 0, y: number = 0)\n    {\n        this._x = +x;\n        this._y = +y;\n    }\n\n    /**\n     * Instantiate a zero vector\n     * @returns a new zero vector\n     */\n    static Zero(): Vector2\n    {\n        return new Vector2(0, 0);\n    }\n\n    /**\n     * Immutable zero vector\n     * @returns an immutable zero vector\n     */\n    static get ZERO(): Vector2\n    {\n        return ZERO || (ZERO = Object.freeze(Vector2.Zero()) as Vector2);\n    }\n\n    /**\n     * The x coordinate of the vector\n     */\n    get x(): number\n    {\n        return this._x;\n    }\n\n    /**\n     * The y coordinate of the vector\n     */\n    get y(): number\n    {\n        return this._y;\n    }\n\n    /**\n     * The length of this vector\n     * @returns sqrt(x^2 + y^2)\n     */\n    length(): number\n    {\n        const x = this._x;\n        const y = this._y;\n\n        return Math.sqrt(x*x + y*y);\n    }\n\n    /**\n     * Compute the dot product of this and v\n     * @param v a vector\n     * @returns the dot product of the vectors\n     */\n    dot(v: Vector2): number\n    {\n        return this._x * v._x + this._y * v._y;\n    }\n\n    /**\n     * Compute the distance between points this and v\n     * @param v a vector / point\n     * @returns the distance between the points\n     */\n    distanceTo(v: Vector2): number\n    {\n        const dx = this._x - v._x;\n        const dy = this._y - v._y;\n\n        return Math.sqrt(dx*dx + dy*dy);\n    }\n\n    /**\n     * Compute the direction from this to v\n     * @param v a vector\n     * @returns a new unit vector pointing to v from this\n     */\n    directionTo(v: Vector2): Vector2\n    {\n        return v._clone()._subtract(this)._normalize();\n    }\n\n    /**\n     * Compute a unit vector with the same direction as this\n     * @returns a new unit vector with the same direction as this\n     */\n    normalized(): Vector2\n    {\n        return this._clone()._normalize();\n    }\n\n    /**\n     * Compute the sum between this vector and v\n     * @param v a vector\n     * @returns a new vector equal to the sum between this and v\n     */\n    plus(v: Vector2): Vector2\n    {\n        return this._clone()._add(v);\n    }\n\n    /**\n     * Compute the difference between this vector and v\n     * @param v a vector\n     * @returns a new vector equal to the difference this - v\n     */\n    minus(v: Vector2): Vector2\n    {\n        return this._clone()._subtract(v);\n    }\n\n    /**\n     * Compute the multiplication between this vector and a scale factor\n     * @param scale scalar quantity\n     * @returns a new vector equal to the multiplication between this and the scale factor\n     */\n    times(scale: number): Vector2\n    {\n        return this._clone()._scale(scale);\n    }\n\n    /**\n     * Check if this and v have the same coordinates\n     * @param v a vector\n     * @returns true if this and v have the same coordinates\n     */\n    equals(v: Vector2): boolean\n    {\n        return this._x === v._x && this._y === v._y;\n    }\n\n    /**\n     * Convert to string\n     * @returns a string\n     */\n    toString(): string\n    {\n        const x = this._x.toFixed(5);\n        const y = this._y.toFixed(5);\n\n        return `Vector2(${x},${y})`;\n    }\n\n    /**\n     * Set the coordinates of this vector\n     * @param x x-coordinate\n     * @param y y-coordinate\n     * @returns this vector\n     * @internal\n     */\n    _set(x: number, y: number): Vector2\n    {\n        this._x = +x;\n        this._y = +y;\n\n        return this;\n    }\n\n    /**\n     * Copy v to this vector\n     * @param v a vector\n     * @returns this vector\n     * @internal\n     */\n    _copyFrom(v: Vector2): Vector2\n    {\n        this._x = v._x;\n        this._y = v._y;\n\n        return this;\n    }\n\n    /**\n     * Normalize this vector\n     * @returns this vector, normalized\n     * @internal\n     */\n    _normalize(): Vector2\n    {\n        const length = this.length();\n\n        if(length < EPSILON) // zero?\n            return this;\n\n        this._x /= length;\n        this._y /= length;\n\n        return this;\n    }\n\n    /**\n     * Add v to this vector\n     * @param v a vector\n     * @returns this vector\n     * @internal\n     */\n    _add(v: Vector2): Vector2\n    {\n        this._x += v._x;\n        this._y += v._y;\n\n        return this;\n    }\n\n    /**\n     * Subtract v from this vector\n     * @param v a vector\n     * @returns this vector\n     * @internal\n     */\n    _subtract(v: Vector2): Vector2\n    {\n        this._x -= v._x;\n        this._y -= v._y;\n\n        return this;\n    }\n\n    /**\n     * Scale this vector by a scalar\n     * @param s scalar\n     * @returns this vector\n     * @internal\n     */\n    _scale(s: number): Vector2\n    {\n        this._x *= s;\n        this._y *= s;\n\n        return this;\n    }\n\n    /**\n     * Clone this vector\n     * @returns a clone of this vector\n     * @internal\n     */\n    _clone(): Vector2\n    {\n        return new Vector2(this._x, this._y);\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * pointer-tracker.ts\n * Tracker of pointer-based input\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { TrackerResult, TrackerOutput, Tracker, TrackerType } from '../tracker';\nimport { TrackablePointer, TrackablePointerPhase } from './trackable-pointer';\nimport { PointerSource } from '../../sources/pointer-source';\nimport { Vector2 } from '../../geometry/vector2';\nimport { Utils, Nullable } from '../../utils/utils';\nimport { IllegalOperationError, IllegalArgumentError } from '../../utils/errors';\nimport { Session } from '../../core/session';\nimport { Viewport } from '../../core/viewport';\n\n/**\n * A result of a PointerTracker. It's meant to be consumed by the user/application\n */\nexport class PointerTrackerResult extends TrackerResult\n{\n    /** the tracker that generated this result */\n    readonly tracker: PointerTracker;\n\n    /** the trackables */\n    readonly trackables: TrackablePointer[];\n\n    /**\n     * Constructor\n     * @param tracker\n     * @param trackables\n     */\n    constructor(tracker: PointerTracker, trackables: TrackablePointer[])\n    {\n        super();\n        this.tracker = tracker;\n        this.trackables = trackables;\n    }\n}\n\n/**\n * The output of a PointerTracker in a particular Frame of a Session\n */\nexport interface PointerTrackerOutput extends TrackerOutput\n{\n    /** tracker result to be consumed by the user */\n    readonly exports: PointerTrackerResult;\n}\n\n/**\n * The space in which pointers are located.\n *\n * - In \"normalized\" space, pointers are located in [-1,1]x[-1,1]. The origin\n *   of the space is at the center of the viewport. The x-axis points to the\n *   right and the y-axis points up. This is the default space.\n *\n *   - Point (0,0) is at the center of the viewport\n *   - The top-right corner of the viewport is at (+1,+1)\n *   - The bottom-left corner of the viewport is at (-1,-1)\n *\n * - The \"adjusted\" space is similar to the normalized space, except that it is\n *   scaled so that it matches the aspect ratio of the viewport.\n *\n *   Pointers in adjusted space are contained in normalized space, but unless\n *   the viewport is a square, one of their coordinates, x or y, will no longer\n *   range from -1 to +1. It will range from -s to +s, where s = min(a, 1/a).\n *   In this expression, a is the aspect ratio of the viewport and s is less\n *   than or equal to 1.\n *\n *   Selecting the adjusted space is useful for making sure that pointer speeds\n *   are equivalent in both axes and for preserving movement curves. Speeds are\n *   not equivalent and movement curves are not preserved by default because\n *   the normalized space is a square, whereas the viewport is a rectangle.\n *\n *   In summary, prefer the adjusted space when working with velocities and\n *   movement curves.\n */\nexport type PointerSpace = 'normalized' | 'adjusted';\n\n/**\n * Options for instantiating a PointerTracker\n */\nexport interface PointerTrackerOptions\n{\n    /** the space in which pointers will be located */\n    space?: PointerSpace;\n}\n\n/** Convert event type to trackable pointer phase */\nconst EVENTTYPE2PHASE: Record<string, TrackablePointerPhase> = {\n    'pointerdown': 'began',\n    'pointerup': 'ended',\n    'pointermove': 'moved',\n    'pointercancel': 'canceled',\n    'pointerleave': 'ended',\n    'pointerenter': 'began',\n};\n\n/** Default options for instantiating a PointerTracker */\nconst DEFAULT_OPTIONS: Readonly<Required<PointerTrackerOptions>> = {\n    space: 'normalized'\n};\n\n/** Tracker type */\nconst TRACKER_TYPE: keyof TrackerType = 'pointer-tracker';\n\n\n\n\n/**\n * A tracker of pointer-based input such as mouse, touch or pen\n */\nexport class PointerTracker implements Tracker\n{\n    /** the source of data */\n    private _source: Nullable<PointerSource>;\n\n    /** the viewport */\n    private _viewport: Nullable<Viewport>;\n\n    /** pointer space */\n    private _space: PointerSpace;\n\n    /** active pointers */\n    private _activePointers: Map<number, TrackablePointer>;\n\n    /** new pointers */\n    private _newPointers: Map<number, TrackablePointer>;\n\n    /** helper map for normalizing IDs */\n    private _idMap: Map<number, number>;\n\n    /** previous output */\n    private _previousOutput: PointerTrackerOutput;\n\n    /** time of the previous update */\n    private _previousUpdateTime: DOMHighResTimeStamp;\n\n    /** helper flag */\n    private _wantToReset: boolean;\n\n    /** auto-increment ID */\n    private _nextId: number;\n\n\n\n\n\n\n    /**\n     * Constructor\n     * @param options\n     */\n    constructor(options: PointerTrackerOptions)\n    {\n        const settings = this._buildSettings(options);\n\n        this._source = null;\n        this._viewport = null;\n        this._space = settings.space;\n        this._activePointers = new Map();\n        this._newPointers = new Map();\n        this._idMap = new Map();\n        this._nextId = 1;\n        this._previousOutput = this._generateOutput();\n        this._previousUpdateTime = Number.POSITIVE_INFINITY;\n        this._wantToReset = false;\n        this._resetInTheNextUpdate = this._resetInTheNextUpdate.bind(this);\n    }\n\n    /**\n     * Build a full and validated options object\n     * @param options\n     * @returns validated options with defaults\n     */\n    private _buildSettings(options: PointerTrackerOptions): Required<PointerTrackerOptions>\n    {\n        const settings: Required<PointerTrackerOptions> = Object.assign({}, DEFAULT_OPTIONS, options);\n\n        if(settings.space != 'normalized' && settings.space != 'adjusted')\n            throw new IllegalArgumentError(`Invalid pointer space: \"${settings.space}\"`);\n\n        return settings;\n    }\n\n    /**\n     * The type of the tracker\n     * @deprecated use is() instead\n     */\n    get type(): keyof TrackerType\n    {\n        return TRACKER_TYPE;\n    }\n\n    /**\n     * Check if this tracker is of a certain type\n     */\n    is<T extends keyof TrackerType>(type: T): this is TrackerType[T]\n    {\n        return type === TRACKER_TYPE;\n    }\n\n    /**\n     * Initialize the tracker\n     * @param session\n     * @returns a promise that is resolved as soon as the tracker is initialized\n     * @internal\n     */\n    _init(session: Session): SpeedyPromise<void>\n    {\n        Utils.log('Initializing PointerTracker...');\n\n        // set the viewport\n        this._viewport = session.viewport;\n\n        // find the pointer source\n        for(const source of session.sources) {\n            if(source._is('pointer-source')) {\n                this._source = source;\n                break;\n            }\n        }\n\n        if(this._source === null)\n            return Speedy.Promise.reject(new IllegalOperationError('A PointerTracker expects a PointerSource'));\n\n        // link the pointer source to the viewport\n        this._source._setViewport(this._viewport);\n\n        // reset trackables\n        document.addEventListener('visibilitychange', this._resetInTheNextUpdate);\n\n        // done!\n        return Speedy.Promise.resolve();\n    }\n\n    /**\n     * Release the tracker\n     * @returns a promise that is resolved as soon as the tracker is released\n     * @internal\n     */\n    _release(): SpeedyPromise<void>\n    {\n        this._source = null;\n        this._viewport = null;\n        this._activePointers.clear();\n        this._newPointers.clear();\n        this._idMap.clear();\n\n        document.removeEventListener('visibilitychange', this._resetInTheNextUpdate);\n\n        return Speedy.Promise.resolve();\n    }\n\n    /**\n     * Update the tracker (update cycle)\n     * @returns a promise that is resolved as soon as the tracker is updated\n     * @internal\n     */\n    _update(): SpeedyPromise<void>\n    {\n        const canvas = this._viewport!.canvas;\n        const rect = canvas.getBoundingClientRect(); // may be different in different frames!\n\n        // find the time between this and the previous update of this tracker\n        const deltaTime = this._updateTime();\n        const inverseDeltaTime = (deltaTime > 1e-5) ? 1 / deltaTime : 60; // 1/dt = 1 / (1/60) with 60 fps\n\n        // remove inactive trackables from the previous frame (update cycle)\n        const inactiveTrackables = this._findInactiveTrackables();\n        for(let i = inactiveTrackables.length - 1; i >= 0; i--)\n            this._activePointers.delete(inactiveTrackables[i].id);\n\n        // make all active trackables stationary\n        this._updateAllTrackables({\n            phase: 'stationary',\n            velocity: Vector2.ZERO,\n            deltaPosition: Vector2.ZERO\n        });\n\n        // want to reset?\n        if(this._wantToReset) {\n            this._reset();\n            this._wantToReset = false;\n        }\n\n        // consume events\n        let event: Nullable<PointerEvent>;\n        while((event = this._source!._consume()) !== null) {\n\n            // sanity check\n            if(event.target !== canvas)\n                return Speedy.Promise.reject(new IllegalOperationError('Invalid PointerEvent target ' + event.target));\n            else if(!EVENTTYPE2PHASE.hasOwnProperty(event.type))\n                return Speedy.Promise.reject(new IllegalOperationError('Invalid PointerEvent type ' + event.type));\n\n            // determine the ID\n            const id = this._normalizeId(event.pointerId, event.pointerType);\n\n            // determine the previous states, if any, of the trackable\n            const previous = this._activePointers.get(id); // state in the previous frame\n            const current = this._newPointers.get(id); // previous state in the current frame\n\n            // determine the phase\n            const phase = EVENTTYPE2PHASE[event.type];\n\n            // new trackables always begin with a pointerdown event,\n            // or with a pointerenter event having buttons pressed\n            // (example: a mousemove without a previous mousedown isn't tracked)\n            if(!(event.type == 'pointerdown' || (event.type == 'pointerenter' && event.buttons > 0))) {\n                if(!previous && !current)\n                    continue; // discard event\n            }\n            else if(previous) {\n                // discard a 'began' after another 'began'\n                continue;\n            }\n            else if(event.button != 0 && event.pointerType == 'mouse') {\n                // require left mouse click\n                continue;\n            }\n\n            // discard event if 'began' and 'ended' happened in the same frame\n            // (difficult to reproduce, but it can be done ;)\n            if(!previous) {\n                if(phase == 'ended' || phase == 'canceled') {\n                    this._newPointers.delete(id);\n                    continue;\n                }\n            }\n\n            // what if we receive 'began' after 'ended' in the same frame?\n            else if(phase == 'began' && current) {\n                if(current.phase == 'ended' || current.phase == 'canceled') {\n                    // ignore the 'began' and maintain the 'ended'\n                    // issue on Epiphany: pointerenter may come after a pointerup -> pointerleave sequence\n                    if(event.type == 'pointerenter')\n                        continue;\n\n                    // ignore the 'ended' and the 'began'\n                    this._newPointers.delete(id);\n                    continue;\n                }\n            }\n\n            // discard previously canceled pointers (e.g., with a visibilitychange event)\n            if(previous?.phase == 'canceled')\n                continue;\n\n            // more special rules\n            switch(event.type) {\n                case 'pointermove':\n                    if(event.buttons == 0 || current?.phase == 'began')\n                        continue;\n                    break;\n\n                case 'pointerenter':\n                    if(event.buttons == 0 || previous?.phase == 'began' || current?.phase == 'began')\n                        continue;\n                    break;\n\n                case 'pointercancel': // purge everything\n                    this._reset();\n                    this._newPointers.clear();\n                    continue;\n            }\n\n            // determine the current position in normalized space\n            const absX = event.pageX - (rect.left + window.scrollX);\n            const absY = event.pageY - (rect.top + window.scrollY);\n            const relX = 2 * absX / rect.width - 1; // convert to [-1,1]\n            const relY = -(2 * absY / rect.height - 1); // flip Y axis\n            const position = new Vector2(relX, relY);\n\n            // scale the normalized space so that it matches the aspect ratio of the viewport\n            if(this._space == 'adjusted') {\n                const a = this._viewport!.aspectRatio;\n\n                if(a >= 1) {\n                    // landscape\n                    position._set(relX, relY / a);\n                }\n                else {\n                    // portrait\n                    position._set(relX * a, relY);\n                }\n            }\n\n            // determine the position delta\n            const deltaPosition = !previous ? Vector2.ZERO :\n                                  position._clone()._subtract(previous.position);\n\n            // determine the initial position\n            const initialPosition = previous ? previous.initialPosition :\n                                    Object.freeze(position._clone()) as Vector2;\n\n            // determine the velocity\n            const velocity = deltaPosition._clone()._scale(inverseDeltaTime);\n\n            // determine the elapsed time since the tracking began\n            const duration = previous ? previous.duration + deltaTime : 0;\n\n            // determine how much this pointer has moved since its tracking began\n            const movementLength = previous ? previous.movementLength + deltaPosition.length() : 0;\n\n            // determine the duration of the movement\n            const movementDuration = !previous ? 0 : previous.movementDuration + (movementLength > previous.movementLength ? deltaTime : 0);\n\n            // determine whether or not this is the primary pointer for this type\n            const isPrimary = event.isPrimary;\n\n            // determine the type of the originating device\n            const kind = event.pointerType;\n\n            // we create new trackable instances on each frame;\n            // these will be exported and consumed by the user\n            this._newPointers.set(id, {\n                id, phase,\n                position, deltaPosition, initialPosition,\n                velocity, duration,\n                movementDuration, movementLength,\n                isPrimary, kind,\n                tracker: this\n            });\n\n        }\n\n        // update trackables\n        this._newPointers.forEach((trackable, id) => this._activePointers.set(id, trackable));\n        this._newPointers.clear();\n        this._advanceAllStationaryTrackables(deltaTime);\n\n        // discard unused IDs\n        if(this._activePointers.size == 0 && this._idMap.size > 0)\n            this._idMap.clear();\n\n        // generate output\n        this._previousOutput = this._generateOutput();\n\n        // test\n        //console.log(JSON.stringify(this._prevOutput.exports.trackables, null, 4));\n\n        // done!\n        return Speedy.Promise.resolve();\n    }\n\n    /**\n     * Output of the previous frame\n     * @internal\n     */\n    get _output(): PointerTrackerOutput\n    {\n        return this._previousOutput;\n    }\n\n    /**\n     * Stats info\n     * @internal\n     */\n    get _stats(): string\n    {\n        const n = this._activePointers.size;\n        const s = n != 1 ? 's' : '';\n\n        return n + ' pointer' + s;\n    }\n\n    /**\n     * The space in which pointers are located.\n     * You may set it when instantiating the tracker.\n     */\n    get space(): PointerSpace\n    {\n        return this._space;\n    }\n\n    /**\n     * Generate tracker output\n     * @returns a new PointerTrackerOutput object\n     */\n    private _generateOutput(): PointerTrackerOutput\n    {\n        const trackables: TrackablePointer[] = [];\n        this._activePointers.forEach(trackable => trackables.push(trackable));\n\n        const result = new PointerTrackerResult(this, this._sortTrackables(trackables));\n        return { exports: result };\n    }\n\n    /**\n     * Update all active pointers\n     * @param fields\n     */\n    private _updateAllTrackables(fields: Partial<TrackablePointer>): void\n    {\n        this._activePointers.forEach((trackable, id) => {\n            this._activePointers.set(id, Object.assign({}, trackable, fields));\n        });\n    }\n\n    /**\n     * Advance the elapsed time of all stationary pointers\n     * @param deltaTime\n     */\n    private _advanceAllStationaryTrackables(deltaTime: number): void\n    {\n        this._activePointers.forEach((trackable, id) => {\n            if(trackable.phase == 'stationary') {\n                (trackable as any).duration += deltaTime;\n                /*\n                this._activePointers.set(id, Object.assign({}, trackable, {\n                    duration: trackable.duration + deltaTime\n                }));\n                */\n            }\n        });\n    }\n\n    /**\n     * Normalize pointer IDs across browsers\n     * @param pointerId browser-provided pointer ID\n     * @param pointerType pointer type\n     * @returns a normalized pointer ID\n     */\n    private _normalizeId(pointerId: number, pointerType: string): number\n    {\n        // XXX different hardware devices acting simultaneously may produce\n        // events with the same pointerId - handling this seems overkill?\n        if(pointerType == 'mouse')\n            return 0;\n\n        if(!this._idMap.has(pointerId))\n            this._idMap.set(pointerId, this._nextId++);\n\n        return this._idMap.get(pointerId)!;\n    }\n\n    /**\n     * Cancel all active pointers and consume all events\n     * @param deltaTime\n     */\n    private _reset(): void\n    {\n        // cancel all active pointers\n        this._updateAllTrackables({\n            phase: 'canceled',\n            velocity: Vector2.ZERO,\n            deltaPosition: Vector2.ZERO\n        });\n\n        // consume all events\n        while(this._source!._consume() !== null);\n    }\n\n    /**\n     * Reset in the next update of the tracker\n     */\n    private _resetInTheNextUpdate(): void\n    {\n        this._wantToReset = true;\n    }\n\n    /**\n     * As a convenience, let's make sure that a primary pointer, if any exists,\n     * is at the beginning of the trackables array\n     * @param trackables\n     * @returns sorted trackables\n     */\n    private _sortTrackables(trackables: TrackablePointer[]): TrackablePointer[]\n    {\n        /*\n\n        Note: the browser may not report a new unique pointer (phase: \"began\")\n        as primary. This logic makes trackables[0] primary, or sort of primary.\n\n        Behavior on Chrome 130 on Android: when moving multiple touch points,\n        remove focus from the browser. Touch points will be canceled as\n        expected. When touching the screen again with a single finger, the\n        (only one) registered pointer will not be primary. That's undesirable.\n        Touching the screen again with multiple fingers (none will be primary),\n        and then releasing them, will restore the desired behavior.\n\n        */\n\n        // nothing to do\n        if(trackables.length <= 1 || trackables[0].isPrimary)\n            return trackables;\n\n        // find a primary pointer and swap\n        for(let j = 1; j < trackables.length; j++) {\n            if(trackables[j].isPrimary) {\n                const primary = trackables[j];\n                trackables[j] = trackables[0];\n                trackables[0] = primary;\n                break;\n            }\n        }\n\n        // done!\n        return trackables;\n    }\n\n    /**\n     * Find trackables to remove\n     * @returns a list of trackables to remove\n     */\n    private _findInactiveTrackables(): TrackablePointer[]\n    {\n        const trackables: TrackablePointer[] = [];\n\n        this._activePointers.forEach(trackable => {\n            if(trackable.phase == 'ended' || trackable.phase == 'canceled')\n                trackables.push(trackable);\n        });\n\n        return trackables;\n    }\n\n    /**\n     * Update the time\n     * @returns delta time in seconds\n     */\n    private _updateTime(): DOMHighResTimeStamp\n    {\n        const now = performance.now() * 0.001;\n\n        if(this._previousUpdateTime > now)\n            this._previousUpdateTime = now;\n\n        const prev = this._previousUpdateTime;\n        this._previousUpdateTime = now;\n\n        return now - prev;\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * tracker-factory.ts\n * Tracker factory\n */\n\nimport { ImageTracker, ImageTrackerOptions } from './image-tracker/image-tracker';\nimport { PointerTracker, PointerTrackerOptions } from './pointer-tracker/pointer-tracker';\n\n/**\n * Tracker factory\n */\nexport class TrackerFactory\n{\n    /**\n     * Create an Image Tracker\n     * @param options\n     */\n    static Image(options: ImageTrackerOptions = {}): ImageTracker\n    {\n        return new ImageTracker(options);\n    }\n\n    /**\n     * Create an Image Tracker with default settings\n     * @deprecated use Image() instead\n     */\n    static ImageTracker(): ImageTracker\n    {\n        return this.Image();\n    }\n\n    /**\n     * Create a Pointer Tracker\n     * @param options\n     */\n    static Pointer(options: PointerTrackerOptions = {}): PointerTracker\n    {\n        return new PointerTracker(options);\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * video-source.ts\n * HTMLVideoElement-based source of data\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { Utils, Nullable } from '../utils/utils';\nimport { IllegalOperationError, NotSupportedError, TimeoutError } from '../utils/errors';\nimport { Source, SourceType } from './source';\n\n/** A message to be displayed if a video can't autoplay and user interaction is required */\nconst ALERT_MESSAGE = 'Tap on the screen to start';\n\n/** Whether or not we have displayed the ALERT_MESSAGE */\nlet displayedAlertMessage = false;\n\n\n/**\n * HTMLVideoElement-based source of data\n */\nexport class VideoSource implements Source\n{\n    /** video element */\n    private _video: HTMLVideoElement;\n\n    /** media source */\n    protected _media: Nullable<SpeedyMedia>;\n\n\n\n    /**\n     * Constructor\n     */\n    constructor(video: HTMLVideoElement)\n    {\n        Utils.assert(video instanceof HTMLVideoElement, 'Expected a video element');\n\n        this._video = video;\n        this._media = null;\n    }\n\n    /**\n     * The underlying <video> element\n     */\n    get video(): HTMLVideoElement\n    {\n        return this._video;\n    }\n\n    /**\n     * Check if this source is of a certain type\n     * @internal\n     */\n    _is<T extends keyof SourceType>(type: T): this is SourceType[T]\n    {\n        return type === 'video-source';\n    }\n\n    /**\n     * Get media\n     * @internal\n     */\n    get _internalMedia(): SpeedyMedia\n    {\n        if(this._media == null)\n            throw new IllegalOperationError(`The media of the source of data isn't loaded`);\n\n        return this._media;\n    }\n\n    /**\n     * Stats related to this source of data\n     * @internal\n     */\n    get _stats(): string\n    {\n        const media = this._media;\n\n        if(media != null)\n            return `${media.width}x${media.height} video`;\n        else\n            return 'uninitialized video';\n    }\n\n    /**\n     * Initialize this source of data\n     * @returns a promise that resolves as soon as this source of data is initialized\n     * @internal\n     */\n    _init(): SpeedyPromise<void>\n    {\n        Utils.log(`Initializing video source...`);\n\n        // prepare the video before loading the SpeedyMedia!\n        return this._prepareVideo(this._video).then(video => {\n            Utils.log('The video is prepared');\n\n            return Speedy.load(video).then(media => {\n                Utils.log(`Source of data is a ${media.width}x${media.height} video`);\n                this._media = media;\n            });\n        });\n    }\n\n    /**\n     * Release this source of data\n     * @returns a promise that resolves as soon as this source of data is released\n     * @internal\n     */\n    _release(): SpeedyPromise<void>\n    {\n        if(this._media)\n            this._media.release();\n\n        this._media = null;\n        return Speedy.Promise.resolve();\n    }\n\n    /**\n     * Handle browser-specific quirks for <video> elements\n     * @param video a video element\n     * @returns a promise that resolves to the input video\n     */\n    private _prepareVideo(video: HTMLVideoElement): SpeedyPromise<HTMLVideoElement>\n    {\n        // WebKit <video> policies for iOS:\n        // https://webkit.org/blog/6784/new-video-policies-for-ios/\n\n        // required on iOS; nice to have in all browsers\n        video.setAttribute('playsinline', '');\n\n        // handle autoplay\n        return this._handleAutoPlay(video).finally(() => {\n\n            // handle WebKit quirks\n            if(Utils.isWebKit()) {\n\n                // on Epiphany 45, a hidden <video> shows up as a black screen when copied to a canvas\n                // on iOS 15.2-17.3, this hack doesn't seem necessary, but works okay\n                if(video.hidden) {\n                    video.hidden = false;\n                    video.style.setProperty('opacity', '0');\n                    video.style.setProperty('position', 'fixed'); // make sure that it's visible on-screen\n                    video.style.setProperty('left', '0');\n                    video.style.setProperty('top', '0');\n                    //video.style.setProperty('display', 'none'); // doesn't work. Same as video.hidden\n                    //video.style.setProperty('visibility', 'hidden'); // doesn't work either\n                }\n\n            }\n\n            // done\n            return video;\n\n        });\n    }\n\n    /**\n     * Handle browser-specific quirks for videos marked with autoplay\n     * @param video a <video> marked with autoplay\n     * @returns a promise that resolves to the input video\n     */\n    private _handleAutoPlay(video: HTMLVideoElement): SpeedyPromise<HTMLVideoElement>\n    {\n        // Autoplay guide: https://developer.mozilla.org/en-US/docs/Web/Media/Autoplay_guide\n        // Chrome policy: https://developer.chrome.com/blog/autoplay/\n        // WebKit policy: https://webkit.org/blog/7734/auto-play-policy-changes-for-macos/\n\n        // nothing to do?\n        if(!video.autoplay)\n            return Speedy.Promise.resolve(video);\n\n        // videos marked with autoplay should be muted\n        if(!video.muted) {\n            Utils.warning('Videos marked with autoplay should be muted', video);\n            video.muted = true;\n        }\n\n        // the browser may not honor the autoplay attribute if the video is not\n        // visible on-screen. So, let's try to play the video in any case.\n        return this._waitUntilPlayable(video).then(video => {\n\n            // try to play the video\n            const promise = video.play();\n\n            // handle older browsers\n            if(promise === undefined)\n                return video;\n\n            // resolve if successful\n            return new Speedy.Promise<HTMLVideoElement>((resolve, reject) => {\n                promise.then(() => resolve(video), error => {\n                    // can't play the video\n                    Utils.error(`Can't autoplay video!`, error, video);\n\n                    // autoplay is blocked for some reason\n                    if(error.name == 'NotAllowedError') {\n                        Utils.warning('Tip: allow manual playback');\n\n                        if(Utils.isIOS())\n                            Utils.warning('Is low power mode on?');\n\n                        // User interaction is required to play the video. We can\n                        // solve this here (easy and convenient to do) or at the\n                        // application layer (for a better user experience). If the\n                        // latter is preferred, just disable autoplay and play the\n                        // video programatically.\n                        if(video.hidden || !video.controls || video.parentNode === null) {\n\n                            // this is added for convenience\n                            document.body.addEventListener('pointerdown', () => video.play());\n\n                            // ask only once for user interaction\n                            if(!displayedAlertMessage) {\n                                alert(ALERT_MESSAGE);\n                                displayedAlertMessage = true;\n                            }\n\n                            // XXX what if the Session mode is inline? In this\n                            // case, this convenience code may be undesirable.\n                            // A workaround is to disable autoplay.\n\n                        }\n                        /*else {\n                            // play the video after the first interaction with the page\n                            const polling = setInterval(() => {\n                                video.play().then(() => clearInterval(polling));\n                            }, 500);\n                        }*/\n                    }\n\n                    // unsupported media source\n                    else if(error.name == 'NotSupportedError') {\n                        reject(new NotSupportedError('Unsupported video format', error));\n                        return;\n                    }\n\n                    // done\n                    resolve(video);\n                });\n            });\n        });\n    }\n\n    /**\n     * Wait for the input video to be playable\n     * @param video\n     * @returns a promise that resolves to the input video when it can be played\n     */\n    private _waitUntilPlayable(video: HTMLVideoElement): SpeedyPromise<HTMLVideoElement>\n    {\n        const TIMEOUT = 15000, INTERVAL = 500;\n\n        if(video.readyState >= 3)\n            return Speedy.Promise.resolve(video);\n\n        return new Speedy.Promise<HTMLVideoElement>((resolve, reject) => {\n            let ms = 0, t = setInterval(() => {\n\n                //if(video.readyState >= 4) { // canplaythrough (may timeout on slow connections)\n                if(video.readyState >= 3) {\n                    clearInterval(t);\n                    resolve(video);\n                }\n                else if((ms += INTERVAL) >= TIMEOUT) {\n                    clearInterval(t);\n                    reject(new TimeoutError('The video took too long to load'));\n                }\n\n            }, INTERVAL);\n        });\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * canvas-source.ts\n * HTMLCanvasElement-based source of data\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyMedia } from 'speedy-vision/types/core/speedy-media';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { Utils, Nullable } from '../utils/utils';\nimport { IllegalOperationError } from '../utils/errors';\nimport { Source, SourceType } from './source';\n\n/**\n * HTMLCanvasElement-based source of data\n */\nexport class CanvasSource implements Source\n{\n    /** canvas element */\n    private _canvas: HTMLCanvasElement;\n\n    /** media source */\n    protected _media: Nullable<SpeedyMedia>;\n\n\n\n    /**\n     * Constructor\n     */\n    constructor(canvas: HTMLCanvasElement)\n    {\n        Utils.assert(canvas instanceof HTMLCanvasElement, 'Expected a canvas element');\n\n        this._canvas = canvas;\n        this._media = null;\n    }\n\n    /**\n     * The underlying <canvas> element\n     */\n    get canvas(): HTMLCanvasElement\n    {\n        return this._canvas;\n    }\n\n    /**\n     * Check if this source is of a certain type\n     * @internal\n     */\n    _is<T extends keyof SourceType>(type: T): this is SourceType[T]\n    {\n        return type === 'canvas-source';\n    }\n\n    /**\n     * Get media\n     * @internal\n     */\n    get _internalMedia(): SpeedyMedia\n    {\n        if(this._media == null)\n            throw new IllegalOperationError(`The media of the source of data isn't loaded`);\n\n        return this._media;\n    }\n\n    /**\n     * Stats related to this source of data\n     * @internal\n     */\n    get _stats(): string\n    {\n        const media = this._media;\n\n        if(media != null)\n            return `${media.width}x${media.height} canvas`;\n        else\n            return 'uninitialized canvas';\n    }\n\n    /**\n     * Initialize this source of data\n     * @returns a promise that resolves as soon as this source of data is initialized\n     * @internal\n     */\n    _init(): SpeedyPromise<void>\n    {\n        return Speedy.load(this._canvas).then(media => {\n            Utils.log(`Source of data is a ${media.width}x${media.height} canvas`);\n            this._media = media;\n        });\n    }\n\n    /**\n     * Release this source of data\n     * @returns a promise that resolves as soon as this source of data is released\n     * @internal\n     */\n    _release(): SpeedyPromise<void>\n    {\n        if(this._media)\n            this._media.release();\n\n        this._media = null;\n        return Speedy.Promise.resolve();\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * camera-source.ts\n * Webcam-based source of data\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { Utils } from '../utils/utils';\nimport { Resolution } from '../utils/resolution';\nimport { NotSupportedError, AccessDeniedError, IllegalOperationError, IllegalArgumentError } from '../utils/errors';\nimport { VideoSource } from './video-source';\n\n\n/**\n * Options for spawning a Webcam-based source of data\n */\nexport interface CameraSourceOptions\n{\n    /** resolution type for the captured images */\n    resolution?: Resolution;\n\n    /** a hint for the desired aspect ratio */\n    aspectRatio?: number;\n\n    /** additional video constraints to be passed to navigator.mediaDevices.getUserMedia() */\n    constraints?: MediaTrackConstraints;\n}\n\n/** Default options for camera sources */\nconst DEFAULT_CAMERA_OPTIONS: Readonly<Required<CameraSourceOptions>> = {\n    /*\n\n    we use well-known standards in landscape mode to ensure broad compatibility\n    the spec encourages User Agents to make landscape the primary orientation\n    https://w3c.github.io/mediacapture-main/#dfn-primary-orientation\n\n    */\n    resolution: '360p',\n    aspectRatio: 16/9,\n    constraints: { facingMode: 'environment' },\n};\n\n\n\n/**\n * Webcam-based source of data\n */\nexport class CameraSource extends VideoSource\n{\n    /** Options of the constructor */\n    private _options: Required<CameraSourceOptions>;\n\n\n\n    /**\n     * Constructor\n     * @param options\n     */\n    constructor(options: CameraSourceOptions)\n    {\n        const video = document.createElement('video');\n\n        super(video);\n        this._options = Object.assign({}, DEFAULT_CAMERA_OPTIONS, options);\n    }\n\n    /**\n     * Camera resolution\n     */\n    get resolution(): Resolution\n    {\n        return this._options.resolution;\n    }\n\n    /**\n     * Initialize this source of data\n     * @returns a promise that resolves as soon as this source of data is initialized\n     * @internal\n     */\n    _init(): SpeedyPromise<void>\n    {\n        const options = this._options;\n\n        Utils.log('Accessing the webcam...');\n\n        // validate\n        if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia)\n            throw new NotSupportedError('Unsupported browser: no navigator.mediaDevices.getUserMedia()');\n\n        // for best compatibility, always request landscape resolutions,\n        // even when mobile devices are expected to be in portrait mode\n        if(options.aspectRatio < 1) {\n            if(options.aspectRatio > 0)\n                Utils.warning(`CameraSource: an aspectRatio of ${options.aspectRatio} was requested. Prefer standard landscape settings instead`);\n            else\n                throw new IllegalArgumentError(`Invalid aspect ratio: ${options.aspectRatio}`);\n        }\n\n        // set up media constraints\n        const idealSize = Utils.resolution(options.resolution, options.aspectRatio);\n        const userConstraints = options.constraints;\n        const ourConstraints: MediaTrackConstraints = {\n            width: { ideal: idealSize.width },\n            height: { ideal: idealSize.height }\n        };\n        const constraints: MediaStreamConstraints = {\n            audio: false,\n            video: Object.assign({}, ourConstraints, userConstraints)\n        };\n\n        // load camera stream\n        return new Speedy.Promise<void>((resolve, reject) => {\n            navigator.mediaDevices.getUserMedia(constraints)\n            .then(stream => {\n                const video = this.video;\n                video.onloadedmetadata = () => {\n                    const promise = video.play();\n                    const success = 'Access to the webcam has been granted.';\n\n                    // handle older browsers\n                    if(promise === undefined) {\n                        Utils.log(success);\n                        resolve();\n                        return;\n                    }\n\n                    // handle promise\n                    promise.then(() => {\n                        Utils.log(success);\n                        resolve();\n                    }).catch(error => {\n                        reject(new IllegalOperationError(\n                            'Webcam error!',\n                            error\n                        ));\n                    });\n                };\n\n                video.setAttribute('muted', '');\n                video.muted = true; // browser quirks?\n\n                video.setAttribute('playsinline', '');\n                video.playsInline = true;\n\n                video.setAttribute('autoplay', '');\n                video.autoplay = true;\n\n                video.srcObject = stream;\n            })\n            .catch(error => {\n                if(typeof OverconstrainedError !== 'undefined' && error instanceof OverconstrainedError) {\n                    reject(new NotSupportedError(\n                        'Unsupported camera constraints: ' + JSON.stringify(constraints),\n                        error\n                    ));\n                }\n                else {\n                    reject(new AccessDeniedError(\n                        'Please give access to the webcam and reload the page.',\n                        error\n                    ));\n                }\n            });\n        })\n        .then(() => super._init()); // this will handle browser quirks\n    }\n\n    /**\n     * Release this source of data\n     * @returns a promise that resolves as soon as this source of data is released\n     * @internal\n     */\n    _release(): SpeedyPromise<void>\n    {\n        const video = this.video;\n\n        // stop the camera feed\n        const stream = video.srcObject as MediaStream;\n        const tracks = stream.getTracks();\n        tracks.forEach(track => track.stop());\n\n        // release references\n        video.onloadedmetadata = null;\n        video.srcObject = null;\n\n        // release the media\n        return super._release();\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * pointer-source.ts\n * Source of data of pointer-based input: mouse, touch, pen...\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { Source, SourceType } from './source';\nimport { Viewport } from '../core/viewport'\nimport { Utils, Nullable } from '../utils/utils';\n\n\n/**\n * Source of data of pointer-based input: mouse, touch, pen...\n */\nexport class PointerSource implements Source\n{\n    /** a queue of incoming pointer events */\n    private _queue: PointerEvent[];\n\n    /** the viewport linked to this source of data */\n    private _viewport: Nullable<Viewport>;\n\n\n\n    /**\n     * Constructor\n     */\n    constructor()\n    {\n        this._queue = [];\n        this._viewport = null;\n        this._onPointerEvent = this._onPointerEvent.bind(this);\n        this._cancelEvent = this._cancelEvent.bind(this);\n    }\n\n    /**\n     * Check if this source is of a certain type\n     * @internal\n     */\n    _is<T extends keyof SourceType>(type: T): this is SourceType[T]\n    {\n        return type === 'pointer-source';\n    }\n\n    /**\n     * Consume a pointer event\n     * @returns the next pointer event to be consumed, or null if there are none\n     * @internal\n     */\n    _consume(): PointerEvent | null\n    {\n        // producer-consumer mechanism\n        return this._queue.shift() || null;\n    }\n\n    /**\n     * Stats related to this source of data\n     * @internal\n     */\n    get _stats(): string\n    {\n        return 'pointer input';\n    }\n\n    /**\n     * Initialize this source of data\n     * @returns a promise that resolves as soon as this source of data is initialized\n     * @internal\n     */\n    _init(): SpeedyPromise<void>\n    {\n        Utils.log('Initializing PointerSource...');\n\n        // nothing to do yet; we need the viewport\n        return Speedy.Promise.resolve();\n    }\n\n    /**\n     * Release this source of data\n     * @returns a promise that resolves as soon as this source of data is released\n     * @internal\n     */\n    _release(): SpeedyPromise<void>\n    {\n        this._setViewport(null);\n        return Speedy.Promise.resolve();\n    }\n\n    /**\n     * Link a viewport to this source of data\n     * @param viewport possibly null\n     * @internal\n     */\n    _setViewport(viewport: Viewport | null): void\n    {\n        // unlink previous viewport, if any\n        if(this._viewport !== null) {\n            this._viewport.hud.container.style.removeProperty('pointer-events');\n            this._viewport._subContainer.style.removeProperty('pointer-events');\n            this._viewport.container.style.removeProperty('pointer-events');\n            this._viewport.canvas.style.removeProperty('pointer-events');\n            this._removeEventListeners(this._viewport.canvas);\n        }\n\n        // link new viewport, if any\n        if((this._viewport = viewport) !== null) {\n            this._addEventListeners(this._viewport.canvas);\n            this._viewport.canvas.style.pointerEvents = 'auto';\n            this._viewport.container.style.pointerEvents = 'none';\n            this._viewport._subContainer.style.pointerEvents = 'none';\n            this._viewport.hud.container.style.pointerEvents = 'none';\n\n            // Make HUD elements accept pointer events\n            for(const element of this._viewport.hud.container.children as any as HTMLElement[]) {\n                if(element.style.getPropertyValue('pointer-events') == '')\n                    element.style.pointerEvents = 'auto';\n            }\n        }\n    }\n\n    /**\n     * Event handler\n     * @param event\n     */\n    private _onPointerEvent(event: PointerEvent): void\n    {\n        this._queue.push(event);\n        event.preventDefault();\n    }\n\n    /**\n     * Cancel event\n     * @param event\n     */\n    private _cancelEvent(event: Event): void\n    {\n        if(event.cancelable)\n            event.preventDefault();\n    }\n\n    /**\n     * Add event listeners\n     * @param canvas\n     */\n    private _addEventListeners(canvas: HTMLCanvasElement): void\n    {\n        canvas.addEventListener('pointerdown', this._onPointerEvent);\n        canvas.addEventListener('pointerup', this._onPointerEvent);\n        canvas.addEventListener('pointermove', this._onPointerEvent);\n        canvas.addEventListener('pointercancel', this._onPointerEvent);\n        canvas.addEventListener('pointerleave', this._onPointerEvent);\n        canvas.addEventListener('pointerenter', this._onPointerEvent);\n        canvas.addEventListener('touchstart', this._cancelEvent, { passive: false });\n    }\n\n    /**\n     * Remove event listeners\n     * @param canvas\n     */\n    private _removeEventListeners(canvas: HTMLCanvasElement): void\n    {\n        canvas.removeEventListener('touchstart', this._cancelEvent);\n        canvas.removeEventListener('pointerenter', this._onPointerEvent);\n        canvas.removeEventListener('pointerleave', this._onPointerEvent);\n        canvas.removeEventListener('pointercancel', this._onPointerEvent);\n        canvas.removeEventListener('pointermove', this._onPointerEvent);\n        canvas.removeEventListener('pointerup', this._onPointerEvent);\n        canvas.removeEventListener('pointerdown', this._onPointerEvent);\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * source-factory.ts\n * Factory of sources of data\n */\n\nimport { VideoSource } from './video-source';\nimport { CanvasSource } from './canvas-source';\nimport { CameraSource, CameraSourceOptions } from './camera-source';\nimport { PointerSource } from './pointer-source';\n\n\n/**\n * Factory of sources of data\n */\nexport class SourceFactory\n{\n    /**\n     * Create a <video>-based source of data\n     * @param video video element\n     * @returns a video source\n     */\n    static Video(video: HTMLVideoElement): VideoSource\n    {\n        return new VideoSource(video);\n    }\n\n    /**\n     * Create a <canvas>-based source of data\n     * @param canvas canvas element\n     * @returns a canvas source\n     */\n    static Canvas(canvas: HTMLCanvasElement): CanvasSource\n    {\n        return new CanvasSource(canvas);\n    }\n\n    /**\n     * Create a Webcam-based source of data\n     * @param options optional options object\n     * @returns a camera source\n     */\n    static Camera(options: CameraSourceOptions = {}): CameraSource\n    {\n        return new CameraSource(options);\n    }\n\n    /**\n     * Create a source of pointer-based input\n     * @returns a pointer source\n    */\n    static Pointer(): PointerSource\n    {\n        return new PointerSource();\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * stats-panel.ts\n * Stats panel used for development purposes\n */\n\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { Settings, PowerPreference } from '../core/settings';\nimport { Viewport } from '../core/viewport';\nimport { Tracker } from '../trackers/tracker';\nimport { Source } from '../sources/source';\nimport { Nullable } from '../utils/utils';\nimport { AR } from '../main';\n\n\n/** Update interval, in ms */\nconst UPDATE_INTERVAL = 500;\n\n/** Icons for different power profiles */\nconst POWER_ICON: { readonly [P in PowerPreference]: string } = Object.freeze({\n    'default': '',\n    'low-power': '&#x1F50B',\n    'high-performance': '&#x26A1'\n});\n\n/** Button icons (atlas) */\nconst BUTTON_ICONS = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAYAAAB3AH1ZAAAAVUlEQVRIS2NkGGDAOMD2M4w6YDQE8IbAfyBgBAJSEipIDy712MzCaTiyQdRwBC4zsDoAmy8ocQQ+vRgOIDUI8UUPMVFIUvySkhaIVTvqgNEQGPAQAABSNiARgz5LggAAAABJRU5ErkJggg==';\n\n\n\n/**\n * Stats panel used for development purposes\n */\nexport class StatsPanel\n{\n    /** A container for the panel */\n    private readonly _container: HTMLDivElement;\n\n    /** Time of last update, in milliseconds */\n    private _lastUpdate: DOMHighResTimeStamp;\n\n\n\n\n    /**\n     * Constructor\n     */\n    constructor()\n    {\n        this._container = this._createContainer();\n        this._lastUpdate = 0;\n    }\n\n    /**\n     * Initialize the panel\n     * @param parent parent node\n     * @param isVisible\n     */\n    init(parent: Node, isVisible: boolean): void\n    {\n        parent.appendChild(this._container);\n        this._container.hidden = !isVisible;\n    }\n\n    /**\n     * Release the panel\n     */\n    release(): void\n    {\n        this._container.remove();\n    }\n\n    /**\n     * A method to be called in the update loop\n     * @param time current time in ms\n     * @param sources the sources of media linked to the session\n     * @param trackers the trackers attached to the session\n     * @param viewport the viewport\n     * @param gpu GPU cycles per second\n     * @param fps frames per second\n     */\n    update(time: DOMHighResTimeStamp, sources: Source[], trackers: Tracker[], viewport: Viewport, gpu: number, fps: number): void\n    {\n        if(time >= this._lastUpdate + UPDATE_INTERVAL) {\n            this._lastUpdate = time;\n            this._update(sources, trackers, viewport, fps, gpu);\n        }\n    }\n\n    /**\n     * Update the contents of the panel\n     * @param sources the sources of media linked to the session\n     * @param trackers the trackers attached to the session\n     * @param viewport the viewport\n     * @param fps frames per second\n     * @param gpu GPU cycles per second\n     */\n    private _update(sources: Source[], trackers: Tracker[], viewport: Viewport, fps: number, gpu: number): void\n    {\n        // all sanitized\n        const lfps = this._label('_ar_fps');\n        if(lfps !== null) {\n            lfps.style.color = this._color(fps);\n            lfps.innerText = String(fps);\n        }\n\n        const lgpu = this._label('_ar_gpu');\n        if(lgpu !== null) {\n            lgpu.style.color = this._color(gpu);\n            lgpu.innerText = String(gpu);\n        }\n\n        const lpower = this._label('_ar_power');\n        if(lpower !== null)\n            lpower.innerHTML = POWER_ICON[Settings.powerPreference];\n\n        const lin = this._label('_ar_in');\n        if(lin !== null) {\n            const sourceStats = sources.map(source => source._stats).join(', ');\n            lin.innerText = sourceStats;\n        }\n\n        const lout = this._label('_ar_out');\n        if(lout !== null) {\n            const trackerStats = trackers.map(tracker => tracker._stats).join(', ');\n            lout.innerText = trackerStats;\n        }\n\n        const lview = this._label('_ar_view');\n        if(lview !== null) {\n            const size = viewport.virtualSize;\n            lview.innerText = `${size.width}x${size.height} rendering`;\n        }\n    }\n\n    /**\n     * Get a label of the panel\n     * @param className\n     * @returns the HTML element, or null if it doesn't exist\n     */\n    private _label(className: string): Nullable<HTMLElement>\n    {\n        return this._container.getElementsByClassName(className).item(0) as Nullable<HTMLElement>;\n    }\n\n    /**\n     * Associate a color to a frequency number\n     * @param f frequency given in cycles per second\n     * @returns colorized number (HTML)\n     */\n    private _color(f: number): string\n    {\n        const GREEN = '#0f0', YELLOW = '#ff0', RED = '#f33';\n        const color3 = f >= 50 ? GREEN : (f >= 30 ? YELLOW : RED);\n        const color2 = f >= 30 ? GREEN : RED;\n        const color = Settings.powerPreference != 'low-power' ? color3 : color2;\n\n        return color;\n    }\n\n    /**\n     * Create the container for the panel\n     * @returns a container\n     */\n    private _createContainer(): HTMLDivElement\n    {\n        const container = document.createElement('div');\n\n        container.style.position = 'absolute';\n        container.style.left = container.style.top = '0px';\n        container.style.padding = '0px';\n\n        container.appendChild(this._createTitle());\n        container.appendChild(this._createContent());\n\n        return container;\n    }\n\n    /**\n     * Create a title\n     * @returns a title\n     */\n    private _createTitle(): HTMLElement\n    {\n        const title = document.createElement('div');\n        const button = document.createElement('button');\n\n        title.style.display = 'flex';\n        title.style.backgroundColor = '#7e56c2';\n        title.style.color = 'white';\n        title.style.fontFamily = 'monospace';\n        title.style.fontSize = '14px';\n        title.style.fontWeight = 'bold';\n        title.style.paddingRight = '4px';\n        title.innerText = 'encantar.js ' + AR.version;\n\n        button.style.width = '18px';\n        button.style.height = '18px';\n        button.style.marginRight = '4px';\n        button.style.backgroundColor = '#7e56c2';\n        button.style.backgroundImage = 'url(' + BUTTON_ICONS + ')';\n        button.style.backgroundRepeat = 'no-repeat';\n        button.style.backgroundPosition = '0 0';\n        button.style.borderWidth = '2px';\n        button.style.borderColor = '#b588fb #46346a #46346a #b588fb';\n        title.insertBefore(button, title.firstChild);\n\n        button.addEventListener('click', () => {\n            const container = title.parentNode;\n            const details = container && container.querySelector<HTMLElement>('._ar_details');\n\n            if(!details)\n                return;\n\n            details.hidden = !details.hidden;\n            button.style.backgroundPosition = details.hidden ? '0 0 ' : '-16px 0';\n        });\n\n        return title;\n    }\n\n    /**\n     * Create a content container\n     * @returns a content container\n     */\n    private _createContent(): HTMLElement\n    {\n        const content = document.createElement('div');\n        const details = document.createElement('div');\n\n        content.style.backgroundColor = 'rgba(0,0,0,0.5)';\n        content.style.color = 'white';\n        content.style.fontFamily = 'monospace';\n        content.style.fontSize = '14px';\n        content.style.padding = '2px';\n        content.style.whiteSpace = 'pre-line';\n\n        details.classList.add('_ar_details');\n        details.hidden = true;\n\n        // all sanitized\n        const append = (div: HTMLDivElement, html: string): void => div.insertAdjacentHTML('beforeend', html);\n\n        append(content, 'FPS: <span class=\"_ar_fps\"></span> | ');\n        append(content, 'GPU: <span class=\"_ar_gpu\"></span> ');\n        append(content, '<span class=\"_ar_power\"></span>');\n\n        append(details, 'IN: <span class=\"_ar_in\"></span><br>');\n        append(details, 'OUT: <span class=\"_ar_out\"></span><br>');\n        append(details, 'VIEW: <span class=\"_ar_view\"></span>');\n\n        // done!\n        content.appendChild(details);\n        return content;\n    }\n}", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * fullscreen-button.ts\n * A built-in fullscreen button introduced as a convenience\n */\n\nimport { Viewport, ViewportEvent } from '../core/viewport';\n\n/** Button icon to be displayed when the fullscreen mode is disabled */\nconst BUTTON_ICON_OFF = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAbUlEQVRYR+2WOQ4AIAgE5f+PVhobDZANBZAsraAwXMoqFil+f9GBj8BW8dIiKt45at/XgShStHgvmfdekwAdIIEyAmh1Z/U5ikmABPoRsLZWtt+5DUlgHgGr6qM1Pf9XnO131L7fJEQjyOqXEzjP1YAhNmUTrgAAAABJRU5ErkJggg==';\n\n/** Button icon to be displayed when the fullscreen mode is enabled */\nconst BUTTON_ICON_ON = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAZElEQVRYR+2WwRIAEAhE9f8fTQ5OhtkLxbzOyc5rJSvBYcH3FwTIBKpHb5d57Nqm5o0aCIBAPgLDxSunq69APT8RCBdwezTLHjglDAEQgEC+QZR2EqqbjprHRgSB9wjwHX9LoAHP1YAhXF4Z/QAAAABJRU5ErkJggg==';\n\n/** Button size, in pixels */\nconst BUTTON_SIZE = 64;\n\n/** Button margin, in pixels */\nconst BUTTON_MARGIN = 24;\n\n\n\n/**\n * Built-in fullscreen button\n */\nexport class FullscreenButton\n{\n    /** The viewport associated to this panel */\n    private readonly _viewport: Viewport;\n\n    /** The HTML element of the button */\n    private readonly _button: HTMLButtonElement;\n\n\n\n\n    /**\n     * Constructor\n     * @param viewport Viewport\n     */\n    constructor(viewport: Viewport)\n    {\n        this._viewport = viewport;\n        this._button = this._createButton();\n        this._handleFullscreenEvent = this._handleFullscreenEvent.bind(this);\n    }\n\n    /**\n     * Initialize\n     * @param parent parent node\n     * @param isVisible\n     */\n    init(parent: Node, isVisible: boolean): void\n    {\n        parent.appendChild(this._button);\n        this._button.hidden = !isVisible;\n        this._viewport.addEventListener('fullscreenchange', this._handleFullscreenEvent);\n    }\n\n    /**\n     * Release\n     */\n    release(): void\n    {\n        this._viewport.removeEventListener('fullscreenchange', this._handleFullscreenEvent);\n        this._button.remove();\n    }\n\n    /**\n     * Create the <button> element\n     */\n    private _createButton(): HTMLButtonElement\n    {\n        const button = document.createElement('button');\n\n        button.style.position = 'absolute';\n        button.style.bottom = BUTTON_MARGIN + 'px';\n        button.style.right = BUTTON_MARGIN + 'px';\n        button.style.width = BUTTON_SIZE + 'px';\n        button.style.height = BUTTON_SIZE + 'px';\n\n        button.style.opacity = '0.5';\n        button.style.cursor = 'pointer';\n        button.style.outline = 'none';\n        (button.style as any)['-webkit-tap-highlight-color'] = 'transparent';\n        button.draggable = false;\n\n        button.style.backgroundColor = 'transparent';\n        button.style.backgroundImage = 'url(' + BUTTON_ICON_OFF + ')';\n        button.style.backgroundSize = 'cover';\n        button.style.imageRendering = 'pixelated';\n        button.style.borderColor = 'white';\n        button.style.borderStyle = 'solid';\n        button.style.borderWidth = '2px';\n        button.style.borderRadius = '8px';\n\n        const highlight = () => {\n            button.style.backgroundColor = '#ffd500';\n            button.style.borderColor = '#ffd500';\n            button.style.opacity = '1.0';\n        };\n\n        const dehighlight = () => {\n            button.style.backgroundColor = 'transparent';\n            button.style.borderColor = 'white';\n            button.style.opacity = '0.5';\n        };\n\n        button.addEventListener('pointerdown', highlight);\n        button.addEventListener('pointerup', dehighlight);\n        button.addEventListener('pointerleave', dehighlight);\n\n        button.addEventListener('click', () => {\n            if(!this._viewport.fullscreen) {\n                this._viewport.requestFullscreen().catch(err => {\n                    alert(`Can't enable the fullscreen mode. ` + err.toString());\n                });\n            }\n            else {\n                this._viewport.exitFullscreen();\n            }\n        });\n\n        return button;\n    }\n\n    /**\n     * Handle a fullscreenchange event\n     */\n    private _handleFullscreenEvent(event: ViewportEvent): void\n    {\n        const img = this._viewport.fullscreen ? BUTTON_ICON_ON : BUTTON_ICON_OFF;\n        this._button.style.backgroundImage = 'url(' + img + ')';\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * reminder-dialog.ts\n * Reminder dialog\n */\n\n/*\n\nYou disable the reminder by making a purchase. If you're working directly with\nthe source code, you can disable it by setting the environment variable AR_FLAGS\nto 1 before invoking the bundler, or simply by hacking the code below.\n\nWhen disabling the reminder, keep in mind that purchases are used to support\nthis indie project. If you're reading this text, you're likely a tech-savvy\nindividual who understands that software development isn't free of cost.\n\nI know that the reminder may be a bit annoying for some people, but it's important\nfor the sustainability of the project, and I've kept it gentle. In contrast, ads\non mobile apps are quite aggressive. I prefer to keep it gentle.\n\nIf you have not yet purchased it, think things over, and then decide consciously.\n\nThank you for supporting open-source Augmented Reality.\n\n*/\n\nimport { Nullable } from '../utils/utils';\ndeclare const __AR_VERSION__: string;\ndeclare const __AR_FLAGS__: string;\n\n/** Title */\nconst TITLE = 'Purchase your copy of encantar.js!';\n\n/** Message */\nconst MESSAGE = `encantar.js is an open, fast, easy-to-use, and broadly compatible Augmented Reality solution that works in any modern browser and web server. It has no vendor lock-in, DRM, artificial scarcity, or gatekeeping. Your projects are yours to keep and deploy.\n\nBringing open Augmented Reality to you isn't free of cost. The depth and breadth of this work are huge, requiring considerable time and skill. I'm a developer working independently on this software from the ground up. Your purchase will support me directly.\n\nThis software respects you and puts you in control \u2014 values often overlooked in the tech industry. Do you value your freedom? Will you contribute to making open-source sustainable? With a one-time purchase, you'll become a backer of open-source AR \u2014 and together, we'll make technology empower us all.`;\n\n/** Text of the primary action button */\nconst PRIMARY_ACTION = 'Buy now';\n\n/** Text of the secondary action button */\nconst SECONDARY_ACTION = 'Try it';\n\n/** The URL of the call-to-action */\nconst TARGET_URL = 'https://alemart.github.io/encantar-js/buy';\n\n/** Seconds in a day */\nconst ONE_DAY = 86400;\n\n/** Timeout of a reminder, in seconds */\nconst REMINDER_TIMEOUT = ONE_DAY;\n\n/** LocalStorage key */\nconst REMINDER_KEY = 'encantar-reminder-' + __AR_VERSION__;\n\n/** Compile-time flags */\nconst AR_FLAGS = Number(__AR_FLAGS__);\n\n\n\n\n/**\n * Reminder dialog\n */\nexport class ReminderDialog\n{\n    /** A dialog element */\n    private readonly _dialog: Nullable<HTMLDialogElement>;\n\n\n\n    /**\n     * Constructor\n     */\n    constructor()\n    {\n        this._dialog = this._createDialog();\n    }\n\n    /**\n     * Initialize\n     * @param parent parent node\n     */\n    init(parent: Node): void\n    {\n        if(this._dialog !== null) {\n            parent.appendChild(this._dialog);\n            setTimeout(() => this._show(), 500);\n        }\n    }\n\n    /**\n     * Release\n     */\n    release(): void\n    {\n        if(this._dialog !== null)\n            this._dialog.remove();\n    }\n\n    /**\n     * Show the reminder\n     * @returns true on success\n     */\n    private _show(): boolean\n    {\n        if(this._dialog === null)\n            return false;\n\n        this._dialog.showModal();\n        return true;\n    }\n\n    /**\n     * Close the reminder\n     * @returns true on success\n     */\n    private _close(): boolean\n    {\n        if(this._dialog === null || !this._dialog.open)\n            return false;\n\n        const now = Math.floor(Date.now() * 0.001);\n        localStorage.setItem(REMINDER_KEY, String(now));\n\n        this._dialog.close();\n        return true;\n    }\n\n    /**\n     * Whether or not the reminder should be displayed at this time\n     * @returns a boolean\n     */\n    private _isEnabled(): boolean\n    {\n        // Reminder disabled - thanks for supporting open-source AR!\n        if(AR_FLAGS & 1)\n            return false;\n\n        // Check the time\n        const now = Math.floor(Date.now() * 0.001);\n        const lastReminder = Number(localStorage.getItem(REMINDER_KEY) ?? '0');\n        return now >= lastReminder + REMINDER_TIMEOUT || lastReminder >= now;\n    }\n\n    /**\n     * Create the dialog element\n     * @returns the dialog element\n     */\n    private _createDialog(): Nullable<HTMLDialogElement>\n    {\n        const TRANSPARENT_COLOR = 'transparent';\n        const BACKGROUND_COLOR = 'whitesmoke';\n        const PRIMARY_COLOR = '#6366f1';\n        const SECONDARY_COLOR = BACKGROUND_COLOR;\n        const PRIMARY_HIGHLIGHTED_COLOR = 'gold';\n        const SECONDARY_HIGHLIGHTED_COLOR = 'black';\n        const FONT_FAMILY = 'sans-serif';\n        const TEXT_COLOR = '#333';\n        const TEXT_SIZE = '16px';\n        const TITLE_COLOR = PRIMARY_COLOR;\n        const TITLE_SIZE = '20px'; // check portrait mode\n\n        // is the reminder disabled?\n        if(!this._isEnabled())\n            return null;\n\n        // we require <dialog>\n        if(typeof HTMLDialogElement === 'undefined')\n            return null;\n\n        const dialog = document.createElement('dialog');\n        const content = document.createElement('div');\n        const title = document.createElement('h1');\n        const message = document.createElement('p');\n        const buttonWrapper = document.createElement('div');\n        const primaryButton = document.createElement('button');\n        const secondaryButton = document.createElement('button');\n        const closeButton = document.createElement('button');\n\n        dialog.style.width = '95%';\n        dialog.style.minWidth = '300px';\n        dialog.style.borderRadius = '8px';\n        dialog.style.border = 'none';\n        dialog.style.backgroundColor = BACKGROUND_COLOR;\n        dialog.style.padding = '0';\n        dialog.style.boxShadow = '4px 4px 20px rgba(0,0,0,0.75)';\n        dialog.style.userSelect = 'none';\n        dialog.addEventListener('click', e => dialog === e.target && dialog.close()); // clicked outside the content div\n\n        content.style.textAlign = 'center';\n        content.style.fontSize = TEXT_SIZE;\n        content.style.fontFamily = FONT_FAMILY;\n        content.style.color = TEXT_COLOR;\n        content.style.padding = '20px';\n        content.style.margin = '0';\n        dialog.appendChild(content);\n\n        title.style.fontSize = TITLE_SIZE;\n        title.style.color = TITLE_COLOR;\n        title.style.margin = '0';\n        title.style.fontWeight = 'bold';\n        title.innerText = TITLE;\n        content.appendChild(title);\n\n        message.innerText = MESSAGE;\n        message.style.padding = '8px 0';\n        message.style.textAlign = 'justify';\n        content.appendChild(message);\n\n        buttonWrapper.style.display = 'flex';\n        buttonWrapper.style.justifyContent = 'space-evenly';\n        content.appendChild(buttonWrapper);\n\n        const highlight = (el: HTMLElement, bg: string, fg: string, border: string) => (() => {\n            el.style.backgroundColor = bg;\n            el.style.color = fg;\n            el.style.border = '2px solid ' + border;\n        });\n\n        primaryButton.style.cursor = 'pointer';\n        primaryButton.style.fontSize = TEXT_SIZE;\n        primaryButton.style.fontWeight = 'bold';\n        primaryButton.style.fontFamily = FONT_FAMILY;\n        primaryButton.style.color = SECONDARY_COLOR;\n        primaryButton.style.backgroundColor = PRIMARY_COLOR;\n        primaryButton.style.border = '2px solid ' + PRIMARY_COLOR;\n        primaryButton.style.padding = '12px 24px';\n        primaryButton.style.outline = 'none';\n        primaryButton.style.minWidth = '120px';\n        (primaryButton.style as any)['-webkit-tap-highlight-color'] = TRANSPARENT_COLOR;\n        primaryButton.innerText = PRIMARY_ACTION;\n        primaryButton.setAttribute('autofocus', '');\n        primaryButton.addEventListener('click', () => { location.href = TARGET_URL; this._close(); });\n        primaryButton.addEventListener('pointerdown', highlight(primaryButton, PRIMARY_HIGHLIGHTED_COLOR, SECONDARY_HIGHLIGHTED_COLOR, PRIMARY_HIGHLIGHTED_COLOR));\n        primaryButton.addEventListener('pointerup', highlight(primaryButton, PRIMARY_COLOR, SECONDARY_COLOR, PRIMARY_COLOR));\n        primaryButton.addEventListener('pointerleave', highlight(primaryButton, PRIMARY_COLOR, SECONDARY_COLOR, PRIMARY_COLOR));\n        buttonWrapper.appendChild(primaryButton);\n\n        secondaryButton.style.cursor = 'pointer';\n        secondaryButton.style.fontSize = TEXT_SIZE;\n        secondaryButton.style.fontWeight = 'bold';\n        secondaryButton.style.fontFamily = FONT_FAMILY;\n        secondaryButton.style.color = PRIMARY_COLOR;\n        secondaryButton.style.backgroundColor = SECONDARY_COLOR;\n        secondaryButton.style.border = '2px solid ' + PRIMARY_COLOR;\n        secondaryButton.style.padding = '12px 24px';\n        secondaryButton.style.marginLeft = '12px';\n        secondaryButton.style.outline = 'none';\n        secondaryButton.style.minWidth = '120px';\n        (primaryButton.style as any)['-webkit-tap-highlight-color'] = TRANSPARENT_COLOR;\n        (secondaryButton.style as any)['-webkit-tap-highlight-color'] = TRANSPARENT_COLOR;\n        secondaryButton.innerText = SECONDARY_ACTION;\n        secondaryButton.addEventListener('click', () => this._close());\n        secondaryButton.addEventListener('pointerdown', highlight(secondaryButton, PRIMARY_HIGHLIGHTED_COLOR, SECONDARY_HIGHLIGHTED_COLOR, PRIMARY_HIGHLIGHTED_COLOR));\n        secondaryButton.addEventListener('pointerup', highlight(secondaryButton, SECONDARY_COLOR, PRIMARY_COLOR, PRIMARY_COLOR));\n        secondaryButton.addEventListener('pointerleave', highlight(secondaryButton, SECONDARY_COLOR, PRIMARY_COLOR, PRIMARY_COLOR));\n        buttonWrapper.appendChild(secondaryButton);\n\n        closeButton.style.cursor = 'pointer';\n        closeButton.style.fontSize = TEXT_SIZE;\n        closeButton.style.fontFamily = FONT_FAMILY;\n        closeButton.style.color = TEXT_COLOR;\n        closeButton.style.opacity = '0.5';\n        closeButton.style.position = 'absolute';\n        closeButton.style.top = '8px';\n        closeButton.style.right = '8px';\n        closeButton.style.border = 'none';\n        closeButton.style.padding = '8px';\n        closeButton.style.backgroundColor = TRANSPARENT_COLOR;\n        closeButton.style.outline = 'none';\n        (closeButton.style as any)['-webkit-tap-highlight-color'] = TRANSPARENT_COLOR;\n        closeButton.innerHTML = '&#x2715;';\n        closeButton.addEventListener('click', () => this._close());\n        content.appendChild(closeButton);\n\n        return dialog;\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * hud.ts\n * Heads Up Display\n */\n\nimport { Viewport } from './viewport';\nimport { StatsPanel } from '../ui/stats-panel';\nimport { FullscreenButton } from '../ui/fullscreen-button';\nimport { ReminderDialog } from '../ui/reminder-dialog';\nimport { Nullable, Utils } from '../utils/utils';\n\n/** HUD container */\nexport type HUDContainer = HTMLDivElement;\n\n/**\n * Heads Up Display: an overlay displayed in front of the augmented scene\n */\nexport class HUD\n{\n    /** Container */\n    private _container: HUDContainer;\n\n    /** Whether or not we have created our own container */\n    private _isOwnContainer: boolean;\n\n    /** Container for the internal components */\n    private _internalContainer: ShadowRoot;\n\n    /** Stats panel */\n    #statsPanel: StatsPanel;\n\n    /** Fullscreen button */\n    #fullscreenButton: FullscreenButton;\n\n    /** Reminder dialog */\n    #reminderDialog: ReminderDialog;\n\n\n\n\n    /**\n     * Constructor\n     * @param viewport viewport\n     * @param parent parent of the hud container\n     * @param hudContainer an existing hud container (optional)\n     */\n    constructor(viewport: Viewport, parent: HTMLElement, hudContainer: Nullable<HUDContainer> = null)\n    {\n        this._container = hudContainer || this._createContainer(parent);\n        this._isOwnContainer = (hudContainer == null);\n\n        // move the HUD container to the parent node\n        if(this._container.parentElement !== parent) {\n            this._container.remove();\n            parent.insertAdjacentElement('afterbegin', this._container);\n        }\n\n        // the HUD should be hidden initially\n        if(!this._container.hidden) {\n            Utils.warning(`The container of the HUD should have the hidden attribute`);\n            this._container.hidden = true;\n        }\n\n        // create a shadow tree for the internal components\n        this._internalContainer = parent.attachShadow({ mode: 'closed' });\n        this._internalContainer.appendChild(document.createElement('slot'));\n\n        // create internal components\n        this.#statsPanel = new StatsPanel();\n        this.#fullscreenButton = new FullscreenButton(viewport);\n        this.#reminderDialog = new ReminderDialog();\n    }\n\n    /**\n     * The container of the HUD\n     */\n    get container(): HUDContainer\n    {\n        return this._container;\n    }\n\n    /**\n     * Whether or not the HUD is visible\n     * @deprecated what's the purpose of this being public?\n     */\n    get visible(): boolean\n    {\n        return this._visible;\n    }\n\n    /**\n     * Whether or not the HUD is visible\n     * @deprecated what's the purpose of this being public?\n     */\n    set visible(visible: boolean)\n    {\n        // this setter does nothing since 0.4.3\n    }\n\n    /**\n     * Stats panel\n     * @internal\n     */\n    get _statsPanel(): StatsPanel\n    {\n        return this.#statsPanel; // same name\n    }\n\n    /**\n     * Initialize the HUD\n     * @param zIndex the z-index of the container\n     * @param wantStatsPanel\n     * @param wantFullscreenButton\n     * @internal\n     */\n    _init(zIndex: number, wantStatsPanel: boolean, wantFullscreenButton: boolean): void\n    {\n        const parent = this._internalContainer;\n        this.#statsPanel.init(parent, wantStatsPanel);\n        this.#fullscreenButton.init(parent, wantFullscreenButton);\n        this.#reminderDialog.init(parent);\n\n        for(const element of parent.children as any as HTMLElement[]) {\n            if(element.style.getPropertyValue('pointer-events') == '')\n                element.style.pointerEvents = 'auto'; // accept pointer input\n            if(element.style.getPropertyValue('z-index') == '')\n                element.style.zIndex = '1000000';\n        }\n\n        const container = this._container;\n        container.style.position = 'absolute';\n        container.style.left = container.style.top = '0px';\n        container.style.right = container.style.bottom = '0px';\n        container.style.padding = container.style.margin = '0px';\n        container.style.zIndex = String(zIndex);\n        container.style.userSelect = 'none';\n\n        this._visible = true;\n    }\n\n    /**\n     * Release the HUD\n     * @internal\n     */\n    _release(): void\n    {\n        this._visible = false;\n\n        this.#reminderDialog.release();\n        this.#fullscreenButton.release();\n        this.#statsPanel.release();\n\n        if(this._isOwnContainer) {\n            this._isOwnContainer = false;\n            this._container.remove();\n        }\n    }\n\n    /**\n     * Create a HUD container as an immediate child of the input node\n     * @param parent parent container\n     * @returns HUD container\n     */\n    private _createContainer(parent: HTMLElement): HUDContainer\n    {\n        const node = document.createElement('div');\n\n        node.hidden = true;\n        parent.insertAdjacentElement('afterbegin', node);\n\n        return node;\n    }\n\n    /**\n     * Whether or not the HUD is visible\n     */\n    private get _visible(): boolean\n    {\n        return !this._container.hidden;\n    }\n\n    /**\n     * Whether or not the HUD is visible\n     */\n    private set _visible(visible: boolean)\n    {\n        this._container.hidden = !visible;\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * viewport.ts\n * Viewport\n */\n\nimport { AR } from '../main';\nimport Speedy from 'speedy-vision';\nimport { SpeedySize } from 'speedy-vision/types/core/speedy-size';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { SessionMode } from './session';\nimport { HUD, HUDContainer } from './hud';\nimport { Vector2 } from '../geometry/vector2';\nimport { Resolution } from '../utils/resolution';\nimport { Nullable } from '../utils/utils';\nimport { Utils } from '../utils/utils';\nimport { AREvent, AREventTarget } from '../utils/ar-events';\nimport { IllegalArgumentError, IllegalOperationError, NotSupportedError, AccessDeniedError } from '../utils/errors';\n\n\n\n\n/** Viewport container */\nexport type ViewportContainer = HTMLDivElement;\n\n/** We admit that the size of the drawing buffer of the background canvas of the viewport may change over time */\ntype ViewportSizeGetter = () => SpeedySize;\n\n/** All possible event types emitted by a Viewport */\ntype ViewportEventType = 'resize' | 'fullscreenchange';\n\n/** An event emitted by a Viewport */\nexport class ViewportEvent extends AREvent<ViewportEventType> { }\n\n/** Viewport style (immersive mode) */\nexport type ViewportStyle = 'best-fit' | 'stretch' | 'crop' | 'inline';\n\n\n\n\n/**\n * Viewport constructor settings\n */\nexport interface ViewportSettings\n{\n    /** Viewport container */\n    container: Nullable<ViewportContainer>;\n\n    /** HUD container */\n    hudContainer?: Nullable<HUDContainer>;\n\n    /** Resolution of the canvas on which the virtual scene will be drawn */\n    resolution?: Resolution;\n\n    /** Viewport style */\n    style?: ViewportStyle;\n\n    /** An existing <canvas> on which the virtual scene will be drawn */\n    canvas?: Nullable<HTMLCanvasElement>;\n\n    /** Whether or not to include the built-in fullscreen button */\n    fullscreenUI?: boolean;\n}\n\n/** Default viewport constructor settings */\nconst DEFAULT_VIEWPORT_SETTINGS: Readonly<Required<ViewportSettings>> = {\n    container: null,\n    hudContainer: null,\n    resolution: 'lg',\n    style: 'best-fit',\n    canvas: null,\n    fullscreenUI: true,\n};\n\n\n\n\n/** Base z-index of the children of the viewport container */\nconst BASE_ZINDEX = 0;\n\n/** Z-index of the background canvas */\nconst BACKGROUND_ZINDEX = BASE_ZINDEX + 0;\n\n/** Z-index of the foreground canvas */\nconst FOREGROUND_ZINDEX = BASE_ZINDEX + 1;\n\n/** Z-index of the HUD */\nconst HUD_ZINDEX = BASE_ZINDEX + 2;\n\n/** Time in ms used to throttle the resize callback of the window */\nconst RESIZE_THROTTLE_DELAY = 100;\n\n/** Duration in ms of the polling after a change of orientation */\nconst ORIENTATION_POLLING_DURATION = 500; // 500 ms for iOS\n\n/** Number of cycles of the polling */\nconst ORIENTATION_POLLING_CYCLES = 5; // the more cycles, the quicker a cycle is\n\n\n\n\n/**\n * Helper class to work with the containers of the viewport\n */\nclass ViewportContainers\n{\n    /** The viewport container */\n    private readonly _container: ViewportContainer;\n\n    /** A direct child of the viewport container */\n    private readonly _subContainer: HTMLDivElement;\n\n\n\n\n    /**\n     * Constructor\n     * @param container viewport container\n     */\n    constructor(container: Nullable<ViewportContainer>)\n    {\n        // validate\n        if(container == null)\n            throw new IllegalArgumentError('Unspecified viewport container');\n        else if(!(container instanceof HTMLElement))\n            throw new IllegalArgumentError('Invalid viewport container');\n\n        // store the viewport container\n        this._container = container;\n\n        // create the sub-container\n        this._subContainer = document.createElement('div') as HTMLDivElement;\n        container.appendChild(this._subContainer);\n    }\n\n    /**\n     * The viewport container\n     */\n    get container(): ViewportContainer\n    {\n        return this._container;\n    }\n\n    /**\n     * The sub-container\n     */\n    get subContainer(): HTMLDivElement\n    {\n        return this._subContainer;\n    }\n\n    /**\n     * Initialize\n     */\n    init(): void\n    {\n        this._container.style.touchAction = 'none';\n        this._container.style.backgroundColor = 'black';\n    }\n\n    /**\n     * Release\n     */\n    release(): void\n    {\n        this._container.style.removeProperty('background-color');\n        this._container.style.removeProperty('touch-action');\n    }\n}\n\n\n\n\n/**\n * Helper class to work with the canvases of the viewport\n */\nclass ViewportCanvases\n{\n    /** A canvas used to render the physical scene */\n    private readonly _backgroundCanvas: HTMLCanvasElement;\n\n    /** A canvas used to render the virtual scene */\n    private readonly _foregroundCanvas: HTMLCanvasElement;\n\n    /** Original CSS of the foreground canvas */\n    private readonly _originalCSSTextOfForegroundCanvas: string;\n\n\n\n    /**\n     * Constructor\n     * @param parent container for the canvases\n     * @param initialSize initial size of the canvases\n     * @param fgCanvas optional existing foreground canvas\n     */\n    constructor(parent: HTMLElement, initialSize: SpeedySize, fgCanvas: Nullable<HTMLCanvasElement> = null)\n    {\n        if(fgCanvas !== null && !(fgCanvas instanceof HTMLCanvasElement))\n            throw new IllegalArgumentError('Not a canvas: ' + fgCanvas);\n\n        this._originalCSSTextOfForegroundCanvas = fgCanvas ? fgCanvas.style.cssText : '';\n\n        this._foregroundCanvas = this._styleCanvas(\n            fgCanvas || this._createCanvas(initialSize),\n            FOREGROUND_ZINDEX\n        );\n\n        this._foregroundCanvas.style.background = 'transparent';\n\n        this._backgroundCanvas = this._styleCanvas(\n            this._createCanvas(initialSize),\n            BACKGROUND_ZINDEX\n        );\n\n        this._backgroundCanvas.hidden = true;\n        this._foregroundCanvas.hidden = true;\n\n        const engineInfo = 'encantar.js ' + AR.version;\n        this._backgroundCanvas.dataset.arEngine = engineInfo;\n        this._foregroundCanvas.dataset.arEngine = engineInfo;\n\n        parent.appendChild(this._backgroundCanvas);\n        parent.appendChild(this._foregroundCanvas);\n    }\n\n    /**\n     * The background canvas\n     */\n    get backgroundCanvas(): HTMLCanvasElement\n    {\n        return this._backgroundCanvas;\n    }\n\n    /**\n     * The foreground canvas\n     */\n    get foregroundCanvas(): HTMLCanvasElement\n    {\n        return this._foregroundCanvas;\n    }\n\n    /**\n     * Initialize\n     */\n    init(): void\n    {\n        this._backgroundCanvas.hidden = false;\n        this._foregroundCanvas.hidden = false;\n    }\n\n    /**\n     * Release\n     */\n    release(): void\n    {\n        this._backgroundCanvas.hidden = true;\n        this._foregroundCanvas.hidden = true;\n\n        this._backgroundCanvas.style.cssText = '';\n        this._foregroundCanvas.style.cssText = this._originalCSSTextOfForegroundCanvas;\n    }\n\n    /**\n     * Create a canvas\n     * @param size size of the drawing buffer\n     * @returns a new canvas\n     */\n    private _createCanvas(size: SpeedySize): HTMLCanvasElement\n    {\n        const canvas = document.createElement('canvas') as HTMLCanvasElement;\n\n        canvas.width = size.width;\n        canvas.height = size.height;\n\n        return canvas;\n    }\n\n    /**\n     * Add suitable CSS rules to a canvas\n     * @param canvas\n     * @param zIndex\n     * @returns canvas\n     */\n    private _styleCanvas(canvas: HTMLCanvasElement, zIndex: number): HTMLCanvasElement\n    {\n        canvas.style.position = 'absolute';\n        canvas.style.left = '0px';\n        canvas.style.top = '0px';\n        canvas.style.width = '100%';\n        canvas.style.height = '100%';\n        canvas.style.zIndex = String(zIndex);\n        canvas.style.objectFit = 'unset';\n\n        return canvas;\n    }\n}\n\n\n\n\n/**\n * Fullscreen utilities\n */\nclass ViewportFullscreenHelper\n{\n    /** The viewport */\n    private readonly _viewport: Viewport;\n\n    /** The container to be put in fullscreen */\n    private readonly _container: HTMLElement;\n\n    /** Event handler */\n    private _boundEventHandler: EventListener;\n\n\n\n    /**\n     * Constructor\n     * @param viewport Viewport\n     */\n    constructor(viewport: Viewport)\n    {\n        this._viewport = viewport;\n        this._container = viewport.container;\n        this._boundEventHandler = this._triggerEvent.bind(this);\n    }\n\n    /**\n     * Initialize\n     */\n    init(): void\n    {\n        this._container.addEventListener('fullscreenchange', this._boundEventHandler);\n    }\n\n    /**\n     * Release\n     */\n    release(): void\n    {\n        this._container.removeEventListener('fullscreenchange', this._boundEventHandler);\n    }\n\n    /**\n     * Make a request to the user agent so that the viewport container is\n     * displayed in fullscreen mode. The container must be a compatible element[1]\n     * and the user must interact with the page in order to comply with browser\n     * policies[2]. In case of error, the returned promise is rejected.\n     * [1] https://developer.mozilla.org/en-US/docs/Web/API/Element/requestFullscreen#compatible_elements\n     * [2] https://developer.mozilla.org/en-US/docs/Web/API/Element/requestFullscreen#security\n     * @returns promise\n     */\n    request(): SpeedyPromise<void>\n    {\n        const container = this._container;\n\n        // fallback for older WebKit versions\n        if(container.requestFullscreen === undefined) {\n            if((container as any).webkitRequestFullscreen === undefined)\n                return Speedy.Promise.reject(new NotSupportedError());\n            else if(!(document as any).webkitFullscreenEnabled)\n                return Speedy.Promise.reject(new AccessDeniedError());\n\n            // webkitRequestFullscreen() does not return a value\n            (container as any).webkitRequestFullscreen();\n\n            return new Speedy.Promise<void>((resolve, reject) => {\n                setTimeout(() => {\n                    if(container === (document as any).webkitFullscreenElement) {\n                        Utils.log('Entering fullscreen mode...');\n                        resolve();\n                    }\n                    else\n                        reject(new TypeError());\n                }, 100);\n            });\n        }\n\n        // check if the fullscreen mode is available\n        if(!document.fullscreenEnabled)\n            return Speedy.Promise.reject(new AccessDeniedError());\n\n        // request fullscreen\n        return new Speedy.Promise<void>((resolve, reject) => {\n            container.requestFullscreen({\n                navigationUI: 'hide'\n            }).then(() => {\n                Utils.log('Entering fullscreen mode...');\n                resolve();\n            }, reject);\n        });\n    }\n\n    /**\n     * Exit fullscreen mode\n     * @returns promise\n     */\n    exit(): SpeedyPromise<void>\n    {\n        // fallback for older WebKit versions\n        if(document.exitFullscreen === undefined) {\n            const doc = document as any;\n\n            if(doc.webkitExitFullscreen === undefined)\n                return Speedy.Promise.reject(new NotSupportedError());\n            else if(doc.webkitFullscreenElement === null)\n                return Speedy.Promise.reject(new IllegalOperationError('Not in fullscreen mode'));\n\n            // webkitExitFullscreen() does not return a value\n            doc.webkitExitFullscreen();\n\n            return new Speedy.Promise<void>((resolve, reject) => {\n                setTimeout(() => {\n                    if(doc.webkitFullscreenElement === null) {\n                        Utils.log('Exiting fullscreen mode...');\n                        resolve();\n                    }\n                    else\n                        reject(new TypeError());\n                }, 100);\n            });\n        }\n\n        // error if not in fullscreen mode\n        if(document.fullscreenElement === null)\n            return Speedy.Promise.reject(new IllegalOperationError('Not in fullscreen mode'));\n\n        // exit fullscreen\n        return new Speedy.Promise<void>((resolve, reject) => {\n            document.exitFullscreen().then(() => {\n                Utils.log('Exiting fullscreen mode...');\n                resolve();\n            }, reject);\n        });\n    }\n\n    /**\n     * Is the fullscreen mode available in this platform?\n     * @returns true if the fullscreen mode is available in this platform\n     */\n    isAvailable(): boolean\n    {\n        return document.fullscreenEnabled ||\n               !!((document as any).webkitFullscreenEnabled);\n    }\n\n    /**\n     * Is the container currently being displayed in fullscreen mode?\n     * @returns true if the container is currently being displayed in fullscreen mode\n     */\n    isActivated(): boolean\n    {\n        if(document.fullscreenElement !== undefined)\n            return document.fullscreenElement === this._container;\n        else if((document as any).webkitFullscreenElement !== undefined)\n            return (document as any).webkitFullscreenElement === this._container;\n        else\n            return false;\n    }\n\n    /**\n     * Trigger a fullscreenchange event\n     */\n    _triggerEvent(): void\n    {\n        const event = new ViewportEvent('fullscreenchange');\n        this._viewport.dispatchEvent(event);\n    }\n}\n\n\n\n\n/**\n * Utility for taking snapshots of the AR scene\n */\nexport class ViewportSnapshotter\n{\n    /** reference to the viewport */\n    private readonly _viewport: Viewport;\n\n    /** lazily instantiated canvas */\n    private _canvas: Nullable<HTMLCanvasElement | OffscreenCanvas>;\n\n\n\n\n\n    /**\n     * Constructor\n     */\n    constructor(viewport: Viewport)\n    {\n        this._viewport = viewport;\n        this._canvas = null;\n    }\n\n    /**\n     * Take a snapshot of the AR scene\n     * @param resolution optional resolution type. If unspecified, the resolution of the viewport will be used\n     * @returns a promise to an ImageBitmap. Tip: for efficient usage, transfer the bitmap or close it when you're done\n     */\n    takeSnapshot(resolution?: Resolution): SpeedyPromise<ImageBitmap>\n    {\n        const viewport = this._viewport;\n        const size = Utils.resolution(resolution ?? viewport.resolution, viewport.aspectRatio);\n        const canvas = this._canvas ?? (this._canvas = this._createCanvas(size.width, size.height));\n        const ctx = canvas.getContext('2d') as CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D;\n\n        canvas.width = size.width;\n        canvas.height = size.height;\n        ctx.imageSmoothingQuality = 'high';\n\n        ctx.drawImage(viewport._backgroundCanvas, 0, 0, canvas.width, canvas.height);\n        ctx.drawImage(viewport.canvas, 0, 0, canvas.width, canvas.height);\n\n        return new Speedy.Promise<ImageBitmap>((resolve, reject) => {\n            if('transferToImageBitmap' in canvas) {\n                // OffscreenCanvas\n                try {\n                    const bmp = canvas.transferToImageBitmap();\n                    resolve(bmp);\n                }\n                catch(error) {\n                    reject(error as Error);\n                }\n            }\n            else {\n                // <canvas>\n                createImageBitmap(canvas).then(resolve, reject);\n            }\n        });\n    }\n\n    /**\n     * Create a canvas with the specified size\n     * @param width in pixels\n     * @param height in pixels\n     * @returns a new canvas (or offscreen canvas if it's supported)\n     */\n    private _createCanvas(width: number, height: number): HTMLCanvasElement | OffscreenCanvas\n    {\n        if(typeof OffscreenCanvas !== 'undefined')\n            return new OffscreenCanvas(width, height);\n\n        const canvas = document.createElement('canvas');\n        canvas.width = width;\n        canvas.height = height;\n        return canvas;\n    }\n}\n\n\n\n\n/**\n * Helper class to resize the viewport\n */\nclass ViewportResizer\n{\n    /** the viewport to be resized */\n    private readonly _viewport: Viewport;\n\n    /** a timer used for throttling */\n    private _throttleTimer: Nullable<ReturnType<typeof setTimeout>>;\n\n    /** resize strategy */\n    private _resizeStrategy: ViewportResizeStrategy;\n\n\n\n\n    /**\n     * Constructor\n     * @param viewport the viewport to be resized\n     */\n    constructor(viewport: Viewport)\n    {\n        this._viewport = viewport;\n        this._throttleTimer = null;\n        this._onViewportResize = this._onViewportResize.bind(this);\n        this._onWindowResize = this._onWindowResize.bind(this);\n        this._onOrientationChange = this._onOrientationChange.bind(this);\n        this._resizeStrategy = new InlineResizeStrategy();\n\n        // initial setup\n        // (the size is yet unknown)\n        this._viewport.addEventListener('resize', this._onViewportResize);\n        this._triggerResizeEvent();\n    }\n\n    /**\n     * Initialize\n     */\n    init(): void\n    {\n        // Configure the resize listener. We want the viewport to adjust itself\n        // if the phone/screen is resized or changes orientation\n        window.addEventListener('resize', this._onWindowResize);\n\n        // handle changes of orientation\n        if(typeof screen.orientation === 'object')\n            screen.orientation.addEventListener('change', this._onOrientationChange);\n        else\n            window.addEventListener('orientationchange', this._onOrientationChange); // deprecated\n\n        // trigger a resize to setup the sizes / the CSS\n        this._triggerResizeEvent();\n    }\n\n    /**\n     * Release\n     */\n    release(): void\n    {\n        if(typeof screen.orientation === 'object')\n            screen.orientation.removeEventListener('change', this._onOrientationChange);\n        else\n            window.removeEventListener('orientationchange', this._onOrientationChange);\n\n        window.removeEventListener('resize', this._onWindowResize);\n\n        this._viewport.removeEventListener('resize', this._onViewportResize);\n        this._resizeStrategy.clear(this._viewport);\n    }\n\n    /**\n     * Change the resize strategy\n     * @param strategy new strategy\n     */\n    setStrategy(strategy: ViewportResizeStrategy): void\n    {\n        this._resizeStrategy.clear(this._viewport);\n        this._resizeStrategy = strategy;\n        this._triggerResizeEvent();\n    }\n\n    /**\n     * Change the resize strategy\n     * @param strategyName name of the new strategy\n     */\n    setStrategyByName(strategyName: ViewportStyle): void\n    {\n        switch(strategyName) {\n            case 'best-fit':\n                this.setStrategy(new BestFitResizeStrategy());\n                break;\n\n            case 'stretch':\n                this.setStrategy(new StretchResizeStrategy());\n                break;\n\n            case 'crop':\n                this.setStrategy(new CropResizeStrategy());\n                break;\n\n            case 'inline':\n                this.setStrategy(new InlineResizeStrategy());\n                break;\n\n            default:\n                throw new IllegalArgumentError('Invalid viewport style: ' + strategyName);\n        }\n    }\n\n    /**\n     * Trigger a resize event\n     */\n    private _triggerResizeEvent(): void\n    {\n        const event = new ViewportEvent('resize');\n        this._viewport.dispatchEvent(event);\n    }\n\n    /**\n     * Called when the window receives a 'resize' event\n     */\n    private _onWindowResize(): void\n    {\n        // throttle the resize callback\n        if(this._throttleTimer !== null)\n            clearTimeout(this._throttleTimer);\n\n        this._throttleTimer = setTimeout(() => {\n            this._throttleTimer = null;\n            this._triggerResizeEvent();\n        }, RESIZE_THROTTLE_DELAY);\n    }\n\n    /**\n     * Called when a change of device orientation is detected\n     */\n    private async _onOrientationChange(): Promise<void>\n    {\n        /*\n\n        When changing the orientation of a mobile device, sometimes there will\n        be a mismatch between the viewport and the screen: one will be in\n        landscape mode and the other in portrait mode.\n\n        Ultimately, the size of the viewport is dependent on the size of the\n        underlying media (typically a camera feed). When the device is rotated,\n        the browser should rotate the camera feed automatically[1]. In addition,\n        it will trigger a resize event on the window, which will, in time,\n        resize the viewport. If the order of events is such that the viewport\n        is resized before the camera feed is rotated, then we will observe a\n        distorted video.\n\n        Let's correct the issue by first detecting the situation and then by\n        triggering a new resize event.\n\n        [1] at the time of this writing, when testing on Android devices, I see\n            that Chrome does it. Firefox 139 does it in one device but doesn't\n            do it in another (it's a browser bug - see below). Safari/iOS does\n            it (tested on the cloud).\n\n            https://bugzilla.mozilla.org/show_bug.cgi?id=1802849\n\n        */\n\n        const canvas = this._viewport._backgroundCanvas;\n\n        // this is polling\n        for(let i = 0; i < ORIENTATION_POLLING_CYCLES; i++) {\n\n            await Utils.wait(ORIENTATION_POLLING_DURATION / ORIENTATION_POLLING_CYCLES);\n\n            // After the camera feed is rotated, this._viewport.aspectRatio will\n            // be correct, but the canvas will not reflect that if, instants ago,\n            // it was resized using the previous aspect ratio of the media.\n            const a = canvas.width / canvas.height;\n            const b = this._aspectRatioOfScreen();\n\n            // if there is a mismatch between the aspect ratios, then the last\n            // resize of the viewport took place with the previous aspect ratio\n            // of the media. This means that canvas is now incorrectly sized,\n            // and that the previous viewport resize event was ineffective.\n            if((a-1) * (b-1) < 0) { //if((a < 1 && b > 1) || (a > 1 && b < 1))\n                this._triggerResizeEvent();\n                //break; // keep listening; see [2]\n            }\n\n            // Note: when using a canvas or a video file as a source of data,\n            // its aspect ratio is not expected to change. We will trigger\n            // additional resize events on mobile in this case. Unlikely to be\n            // an issue.\n\n        }\n\n        /*\n\n        [2] is this order of events possible when changing the orientation?\n\n        1. orientationchange event is fired and handled\n        2. resize event is fired and handled\n        3. camera feed is rotated\n\n        If so, increasing the throttling will likely make the camera feed be\n        rotated first, but then the user will more easily notice the delay.\n        Increasing the polling time is a simple alternative that makes this\n        callback be executed after the video rotation, which is what we want.\n        About listening to video resize: the Viewport doesn't know about it\n        and has no access to the source of data. The Session does, however.\n\n        */\n    }\n\n    /**\n     * Called when the viewport receives a 'resize' event\n     * @param event\n     */\n    private _onViewportResize(event: ViewportEvent): void\n    {\n        const viewport = this._viewport;\n\n        // Resize the drawing buffer of the foreground canvas, so that it\n        // matches the desired resolution, as well as the aspect ratio of the\n        // background canvas\n        const foregroundCanvas = viewport.canvas;\n        const virtualSize = viewport.virtualSize;\n        foregroundCanvas.width = virtualSize.width;\n        foregroundCanvas.height = virtualSize.height;\n\n        // Resize the drawing buffer of the background canvas\n        const backgroundCanvas = viewport._backgroundCanvas;\n        const realSize = viewport._realSize;\n        backgroundCanvas.width = realSize.width;\n        backgroundCanvas.height = realSize.height;\n\n        // Call strategy\n        this._resizeStrategy.resize(viewport);\n    }\n\n    /**\n     * The current aspect ratio of the screen\n     * @returns a value greater than 1 if the device is in landscape mode\n     */\n    private _aspectRatioOfScreen(): number\n    {\n        // When changing the orientation of a mobile device, screen.width and\n        // screen.height are flipped on Chrome and on Firefox, but not on Safari\n        //return screen.width / screen.height;\n\n        // These are the width and the height of the screen in landscape mode\n        const width = Math.max(screen.width, screen.height);\n        const height = Math.min(screen.width, screen.height);\n\n        // use screen.orientation if possible\n        if(typeof screen.orientation === 'object') {\n            if(screen.orientation.type.startsWith('landscape'))\n                return width / height;\n            else\n                return height / width;\n        }\n\n        // fallback for older iOS\n        // https://developer.apple.com/documentation/webkitjs/domwindow/1632568-orientation\n        if(typeof window.orientation === 'number') {\n            if(Math.abs(window.orientation) == 90)\n                return width / height;\n            else\n                return height / width;\n        }\n\n        // general fallback\n        // note: before evaluating clientWidth & clientHeight, a setTimeout(fn,\n        // t >= 100?) is necessary immediately after a change of orientation.\n        // mobile devices should not fall in this case, so no worries.\n        if(document.documentElement.clientWidth > document.documentElement.clientHeight)\n            return width / height;\n        else\n            return height / width;\n    }\n}\n\n\n\n\n/**\n * Resize strategies\n */\nabstract class ViewportResizeStrategy\n{\n    /**\n     * Resize the viewport\n     * @param viewport\n     */\n    abstract resize(viewport: Viewport): void;\n\n    /**\n     * Clear CSS rules\n     * @param viewport\n     */\n    clear(viewport: Viewport): void\n    {\n        viewport.container.style.cssText = '';\n        viewport._subContainer.style.cssText = '';\n    }\n}\n\n/**\n * Inline viewport: it follows the typical flow of a web page\n */\nclass InlineResizeStrategy extends ViewportResizeStrategy\n{\n    /**\n     * Resize the viewport\n     * @param viewport\n     */\n    resize(viewport: Viewport): void\n    {\n        const container = viewport.container;\n        const subContainer = viewport._subContainer;\n        const virtualSize = viewport.virtualSize;\n\n        container.style.display = 'inline-block'; // fixes a potential issue of the viewport not showing up\n        container.style.position = 'relative';\n        container.style.left = '0px';\n        container.style.top = '0px';\n        container.style.width = virtualSize.width + 'px';\n        container.style.height = virtualSize.height + 'px';\n\n        subContainer.style.position = 'absolute';\n        subContainer.style.left = '0px';\n        subContainer.style.top = '0px';\n        subContainer.style.width = '100%';\n        subContainer.style.height = '100%';\n    }\n}\n\n/**\n * Immersive viewport: it occupies the entire page\n */\nabstract class ImmersiveResizeStrategy extends ViewportResizeStrategy\n{\n    /**\n     * Resize the viewport\n     * @param viewport\n     */\n    resize(viewport: Viewport): void\n    {\n        const CONTAINER_ZINDEX = 1000000000;\n        const container = viewport.container;\n\n        container.style.position = 'fixed';\n        container.style.left = '0px';\n        container.style.top = '0px';\n        container.style.width = '100vw';\n        container.style.height = '100vh';\n        container.style.zIndex = String(CONTAINER_ZINDEX);\n    }\n}\n\n/**\n * Immersive viewport with best-fit style: it preserves the aspect ratio of the\n * media. This is also known as letterboxing or pillarboxing\n */\nclass BestFitResizeStrategy extends ImmersiveResizeStrategy\n{\n    /**\n     * Resize the viewport\n     * @param viewport\n     */\n    resize(viewport: Viewport): void\n    {\n        const subContainer = viewport._subContainer;\n        const windowAspectRatio = window.innerWidth / window.innerHeight;\n        const viewportAspectRatio = viewport.aspectRatio;\n        let width = 1, height = 1, left = '0px', top = '0px';\n\n        if(viewportAspectRatio <= windowAspectRatio) {\n            height = window.innerHeight;\n            width = Math.round(height * viewportAspectRatio);\n            width -= width % 2;\n            left = `calc(50% - ${width >>> 1}px)`;\n        }\n        else {\n            width = window.innerWidth;\n            height = Math.round(width / viewportAspectRatio);\n            height -= height % 2;\n            top = `calc(50% - ${height >>> 1}px)`;\n        }\n\n        subContainer.style.position = 'absolute';\n        subContainer.style.left = left;\n        subContainer.style.top = top;\n        subContainer.style.width = width + 'px';\n        subContainer.style.height = height + 'px';\n\n        super.resize(viewport);\n    }\n}\n\n/**\n * Immersive viewport with stretch style: it fully fills the viewport with the\n * media, possibly distorting it\n */\nclass StretchResizeStrategy extends ImmersiveResizeStrategy\n{\n    /**\n     * Resize the viewport\n     * @param viewport\n     */\n    resize(viewport: Viewport): void\n    {\n        const subContainer = viewport._subContainer;\n\n        subContainer.style.position = 'absolute';\n        subContainer.style.left = '0px';\n        subContainer.style.top = '0px';\n        subContainer.style.width = window.innerWidth + 'px';\n        subContainer.style.height = window.innerHeight + 'px';\n\n        super.resize(viewport);\n    }\n}\n\n/**\n * Immersive viewport with crop style: it fully fills the viewport with the\n * media, possibly cropping and scaling it to maintain its aspect ratio\n */\nclass CropResizeStrategy extends ImmersiveResizeStrategy\n{\n    /**\n     * Resize the viewport\n     * @param viewport\n     */\n    resize(viewport: Viewport): void\n    {\n        const subContainer = viewport._subContainer;\n        const backgroundCanvas = viewport._backgroundCanvas;\n        const foregroundCanvas = viewport.canvas;\n\n        subContainer.style.position = 'absolute';\n        subContainer.style.left = '0px';\n        subContainer.style.top = '0px';\n        subContainer.style.width = window.innerWidth + 'px';\n        subContainer.style.height = window.innerHeight + 'px';\n\n        backgroundCanvas.style.objectFit = 'cover';\n        foregroundCanvas.style.objectFit = 'cover';\n\n        super.resize(viewport);\n    }\n\n    /**\n     * Clear CSS rules\n     * @param viewport\n     */\n    clear(viewport: Viewport): void\n    {\n        const backgroundCanvas = viewport._backgroundCanvas;\n        const foregroundCanvas = viewport.canvas;\n\n        backgroundCanvas.style.objectFit = 'unset';\n        foregroundCanvas.style.objectFit = 'unset';\n\n        super.clear(viewport);\n    }\n}\n\n\n\n\n/**\n * Viewport\n */\nexport class Viewport extends AREventTarget<ViewportEvent>\n{\n    /** Viewport resolution (controls the size of the drawing buffer of the foreground canvas) */\n    private readonly _resolution: Resolution;\n\n    /** Viewport settings */\n    private readonly _settings: Readonly<Required<ViewportSettings>>\n\n    /** The containers */\n    private readonly _containers: ViewportContainers;\n\n    /** An overlay displayed in front of the augmented scene */\n    private readonly _hud: HUD;\n\n    /** Viewport style */\n    private _style: ViewportStyle;\n\n    /** The canvases of the viewport */\n    private readonly _canvases: ViewportCanvases;\n\n    /** Resize helper */\n    private readonly _resizer: ViewportResizer;\n\n    /** The current size of the underlying SpeedyMedia */\n    private _mediaSize: ViewportSizeGetter;\n\n    /** Fullscreen utilities */\n    private readonly _fullscreen: ViewportFullscreenHelper;\n\n    /** Snapshotter */\n    private readonly _snapshotter: ViewportSnapshotter;\n\n\n\n\n\n    /**\n     * Constructor\n     * @param viewportSettings\n     */\n    constructor(viewportSettings: ViewportSettings)\n    {\n        super();\n\n        const settings = Object.assign({}, DEFAULT_VIEWPORT_SETTINGS, viewportSettings);\n        this._settings = Object.freeze(settings);\n\n        const guessedAspectRatio = window.innerWidth / window.innerHeight;\n        const initialSize = Utils.resolution(settings.resolution, guessedAspectRatio);\n        this._mediaSize = () => initialSize;\n\n        this._resolution = settings.resolution;\n        this._style = settings.style;\n\n        this._containers = new ViewportContainers(settings.container);\n        this._hud = new HUD(this, this._subContainer, settings.hudContainer);\n        this._canvases = new ViewportCanvases(this._subContainer, initialSize, settings.canvas);\n\n        this._resizer = new ViewportResizer(this);\n        this._resizer.setStrategyByName(this._style);\n\n        this._fullscreen = new ViewportFullscreenHelper(this);\n        this._snapshotter = new ViewportSnapshotter(this);\n    }\n\n    /**\n     * Viewport container\n     */\n    get container(): ViewportContainer\n    {\n        return this._containers.container;\n    }\n\n    /**\n     * Viewport style\n     */\n    get style(): ViewportStyle\n    {\n        return this._style;\n    }\n\n    /**\n     * HUD\n     */\n    get hud(): HUD\n    {\n        return this._hud;\n    }\n\n    /**\n     * Resolution of the virtual scene\n     */\n    get resolution(): Resolution\n    {\n        return this._resolution;\n    }\n\n    /**\n     * Size in pixels of the drawing buffer of the canvas\n     * on which the virtual scene will be drawn\n     */\n    get virtualSize(): SpeedySize\n    {\n        return Utils.resolution(this._resolution, this.aspectRatio);\n    }\n\n    /**\n     * Aspect ratio of the viewport\n     */\n    get aspectRatio(): number\n    {\n        const size = this._realSize;\n        return size.width / size.height;\n    }\n\n    /**\n     * Is the viewport currently being displayed in fullscreen mode?\n     */\n    get fullscreen(): boolean\n    {\n        return this._fullscreen.isActivated();\n    }\n\n    /**\n     * Is the fullscreen mode available in this platform?\n     */\n    get fullscreenAvailable(): boolean\n    {\n        return this._fullscreen.isAvailable();\n    }\n\n    /**\n     * The canvas on which the virtual scene will be drawn\n     */\n    get canvas(): HTMLCanvasElement\n    {\n        return this._canvases.foregroundCanvas;\n    }\n\n    /**\n     * The canvas on which the physical scene will be drawn\n     * @internal\n     */\n    get _backgroundCanvas(): HTMLCanvasElement\n    {\n        return this._canvases.backgroundCanvas;\n    }\n\n    /**\n     * Size of the drawing buffer of the background canvas, in pixels\n     * @internal\n     */\n    get _realSize(): SpeedySize\n    {\n        return this._mediaSize();\n    }\n\n    /**\n     * Sub-container of the viewport container\n     * @internal\n     */\n    get _subContainer(): HTMLDivElement\n    {\n        return this._containers.subContainer;\n    }\n\n    /**\n     * Request fullscreen mode\n     * @returns promise\n     */\n    requestFullscreen(): SpeedyPromise<void>\n    {\n        return this._fullscreen.request();\n    }\n\n    /**\n     * Exit fullscreen mode\n     * @returns promise\n     */\n    exitFullscreen(): SpeedyPromise<void>\n    {\n        return this._fullscreen.exit();\n    }\n\n    /**\n     * Convert a position given in space units to a corresponding pixel\n     * position in canvas space. Units in normalized space range from -1 to +1.\n     * The center of the canvas is at (0,0). The top right corner is at (1,1).\n     * The bottom left corner is at (-1,-1).\n     * @param position in space units\n     * @param space either \"normalized\" (default) or \"adjusted\"; @see PointerSpace\n     * @returns an equivalent pixel position in canvas space\n     */\n    convertToPixels(position: Vector2, space: \"normalized\" | \"adjusted\" = 'normalized'): Vector2\n    {\n        const canvas = this.canvas;\n        let px = position.x, py = position.y;\n\n        if(space == 'adjusted') {\n            // convert from adjusted to normalized space\n            const a = canvas.width / canvas.height;\n\n            if(a >= 1)\n                py *= a;\n            else\n                px /= a;\n        }\n        else if(space != 'normalized')\n            throw new IllegalArgumentError(`Invalid space: \"${space}\"`);\n\n        // convert from normalized to canvas space\n        const x = 0.5 * (1 + px) * canvas.width;\n        const y = 0.5 * (1 - py) * canvas.height;\n\n        // done!\n        return new Vector2(x, y);\n    }\n\n    /**\n     * Convert a pixel position given in canvas space to a corresponding\n     * position in space units. This is the inverse of convertToPixels().\n     * @param position in canvas space\n     * @space either \"normalized\" (default) or \"adjusted\"; see @PointerSpace\n     * @returns an equivalent position in space units\n     */\n    convertFromPixels(position: Vector2, space: \"normalized\" | \"adjusted\" = 'normalized'): Vector2\n    {\n        const canvas = this.canvas;\n\n        // convert from canvas to normalized space\n        let x = 2 * position.x / canvas.width - 1;\n        let y = -2 * position.y / canvas.height + 1;\n\n        if(space == 'adjusted') {\n            // convert from normalized to adjusted space\n            const a = canvas.width / canvas.height;\n\n            if(a >= 1)\n                y /= a;\n            else\n                x *= a;\n        }\n        else if(space != 'normalized')\n            throw new IllegalArgumentError(`Invalid space: \"${space}\"`);\n\n        // done!\n        return new Vector2(x, y);\n    }\n\n    /**\n     * Take a snapshot of the AR scene\n     * @param resolution optional resolution type. If unspecified, the resolution of the viewport will be used\n     * @returns a promise to an ImageBitmap. Tip: for efficient usage, transfer the bitmap or close it when you're done\n     */\n    takeSnapshot(resolution?: Resolution): SpeedyPromise<ImageBitmap>\n    {\n        return this._snapshotter.takeSnapshot(resolution);\n    }\n\n    /**\n     * Initialize the viewport (when the session starts)\n     * @param getMediaSize\n     * @param sessionMode\n     * @param wantStatsPanel\n     * @internal\n     */\n    _init(getMediaSize: ViewportSizeGetter, sessionMode: SessionMode, wantStatsPanel: boolean): void\n    {\n        // validate if the viewport style matches the session mode\n        if(sessionMode == 'immersive') {\n            if(this._style != 'best-fit' && this._style != 'stretch' && this._style != 'crop') {\n                Utils.warning(`Invalid viewport style \\\"${this._style}\\\" for the \\\"${sessionMode}\\\" mode`);\n                this._style = 'best-fit';\n                this._resizer.setStrategyByName(this._style);\n            }\n        }\n        else if(sessionMode == 'inline') {\n            if(this._style != 'inline') {\n                Utils.warning(`Invalid viewport style \\\"${this._style}\\\" for the \\\"${sessionMode}\\\" mode`);\n                this._style = 'inline';\n                this._resizer.setStrategyByName(this._style);\n            }\n        }\n\n        // set the media size getter\n        this._mediaSize = getMediaSize;\n\n        // initialize the components\n        this._containers.init();\n        this._canvases.init();\n        this._resizer.init();\n        this._fullscreen.init();\n\n        // initialize the HUD\n        const wantFullscreenButton = this.fullscreenAvailable && this._settings.fullscreenUI;\n        this._hud._init(HUD_ZINDEX, wantStatsPanel, wantFullscreenButton);\n    }\n\n    /**\n     * Release the viewport (when the session ends)\n     * @internal\n     */\n    _release(): void\n    {\n        this._hud._release();\n        this._fullscreen.release();\n        this._resizer.release();\n        this._canvases.release();\n        this._containers.release();\n    }\n}\n", "/*\n * encantar.js\n * GPU-accelerated Augmented Reality for the web\n * Copyright (C) 2022-2026 Alexandre Martins <alemartf(at)gmail.com>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * main.ts\n * Entry point\n */\n\nimport Speedy from 'speedy-vision';\nimport { SpeedyPromise } from 'speedy-vision/types/core/speedy-promise';\nimport { Settings } from './core/settings';\nimport { Session, SessionOptions } from './core/session';\nimport { TrackerFactory } from './trackers/tracker-factory';\nimport { SourceFactory } from './sources/source-factory';\nimport { Viewport, ViewportSettings } from './core/viewport';\nimport { Vector2 } from './geometry/vector2';\nimport { Vector3 } from './geometry/vector3';\nimport { Utils } from './utils/utils';\n\ndeclare const __AR_VERSION__: string;\ndeclare const __AR_WEBSITE__: string;\n\n/**\n * GPU-accelerated Augmented Reality for the web\n */\nexport class AR\n{\n    /**\n     * Start a new session\n     * @param options\n     * @returns a promise that resolves to a new session\n     */\n    static startSession(options?: SessionOptions): SpeedyPromise<Session>\n    {\n        return Session.instantiate(options);\n    }\n\n    /**\n     * Checks if the engine can be run in the browser the client is using\n     * @returns true if the engine is compatible with the browser\n     */\n    static isSupported(): boolean\n    {\n        return Session.isSupported();\n    }\n\n    /**\n     * Engine version\n     */\n    static get version(): string\n    {\n        return __AR_VERSION__;\n    }\n\n    /**\n     * Speedy Vision\n     */\n    static get Speedy(): typeof Speedy\n    {\n        return Speedy;\n    }\n\n    /**\n     * Trackers\n     */\n    static get Tracker(): typeof TrackerFactory\n    {\n        return TrackerFactory;\n    }\n\n    /**\n     * Sources of data\n     */\n    static get Source(): typeof SourceFactory\n    {\n        return SourceFactory;\n    }\n\n    /**\n     * Create a viewport\n     * @param settings\n     * @returns a new viewport with the specified settings\n     */\n    static Viewport(settings: ViewportSettings): Viewport\n    {\n        return new Viewport(settings);\n    }\n\n    /**\n     * Create a new 2D vector\n     * @param x x-coordinate\n     * @param y y-coordinate\n     * @returns a new 2D vector with the provided coordinates\n     */\n    static Vector2(x: number, y: number): Vector2\n    {\n        return new Vector2(x, y);\n    }\n\n    /**\n     * Create a new 3D vector\n     * @param x x-coordinate\n     * @param y y-coordinate\n     * @param z z-coordinate\n     * @returns a new 3D vector with the provided coordinates\n     */\n    static Vector3(x: number, y: number, z: number): Vector3\n    {\n        return new Vector3(x, y, z);\n    }\n\n    /**\n     * Global Settings\n     */\n    static get Settings(): typeof Settings\n    {\n        return Settings;\n    }\n}\n\n// Freeze the namespace\nObject.freeze(AR);\n\n// Add Speedy Vision to global scope\n((window: any) => window.Speedy = window.Speedy || Speedy)(window);\n\n// Display a notice\nUtils.log(\n    `encantar.js version ${AR.version}. ` +\n    `GPU-accelerated Augmented Reality for the web by Alexandre Martins. ` +\n    __AR_WEBSITE__\n);", "import { AR } from \"./main.ts\";\nmodule.exports = AR;"],
  "mappings": ";;;;;;;;;+5BAAA,IAAAA,GAAAC,GAAA,CAAAC,GAAAC,KAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IASC,SAA0CC,EAAMC,EAAS,CACtD,OAAOH,IAAY,UAAY,OAAOC,IAAW,SACnDA,GAAO,QAAUE,EAAQ,EAClB,OAAO,QAAW,YAAc,OAAO,IAC9C,OAAO,CAAC,EAAGA,CAAO,EACX,OAAOH,IAAY,SAC1BA,GAAQ,OAAYG,EAAQ,EAE5BD,EAAK,OAAYC,EAAQ,CAC3B,GAAG,KAAM,KACQ,IAAM,CACb,IAAIC,EAAuB,CAE/B,KACC,CAACC,EAAyBC,EAAqBC,IAAwB,CAE9E,aACqBA,EAAoB,EAAED,EAAqB,CACzC,EAAG,IAAqBE,CAC1B,CAAC,EACD,IAAIC,EAAiDF,EAAoB,IAAI,EACzEG,EAA8CH,EAAoB,IAAI,EACtEI,EAA4CJ,EAAoB,IAAI,EACpEK,EAA6CL,EAAoB,IAAI,EAmC9F,IAAIM,EAH6B,MAM7BC,EAAc,UAKlB,MAAMN,UAAiBC,EAAsE,CAAE,CAK7F,WAAW,iBAAkB,CAC3B,OAAOC,EAA4D,EAAE,eACvE,CAMA,WAAW,gBAAgBK,EAAO,CAChCL,EAA4D,EAAE,gBAAkBK,CAClF,CAMA,WAAW,gBAAiB,CAC1B,OAAOF,CACT,CAMA,WAAW,eAAeE,EAAO,CAC/B,GAAIA,IAAU,OAASA,IAAU,OAAQ,MAAM,IAAIH,EAAuE,GAAG,8BAA8BG,CAAK,GAAG,EACnKF,EAAiBE,CACnB,CAMA,WAAW,SAAU,CACnB,OAAOD,CACT,CAMA,WAAW,QAAQE,EAAM,CACvB,GAAIA,IAAS,WAAaA,IAAS,QAAUA,IAAS,aAAc,MAAM,IAAIJ,EAAuE,GAAG,0BAA0BI,CAAI,GAAG,EAAWA,IAAS,cAAcL,EAAuD,EAAE,IAAI,sBAAuB,4DAA4D,EAC3WG,EAAcE,CAChB,CACF,CAEM,EAEA,KACC,CAACX,EAAyBC,EAAqBC,IAAwB,CAE9E,aACqBA,EAAoB,EAAED,EAAqB,CACzC,EAAG,IAAqBW,CAC1B,CAAC,EACD,IAAIC,EAAmDX,EAAoB,IAAI,EAC3EY,EAA4CZ,EAAoB,IAAI,EACpEa,EAA6Cb,EAAoB,IAAI,EAkC9F,IAAMc,EAAuB,OAAO,OAAO,CACzC,QAAW,YACb,CAAC,EAOD,MAAMJ,CAAiB,CAOrB,YAAYK,EAAMC,EAASC,EAAO,CAChCL,EAAuD,EAAE,OAAOG,EAAO,GAAKC,EAAU,CAAC,EACvFJ,EAAuD,EAAE,OAAOK,IAAUP,EAAiB,aAAa,EAGxG,KAAK,MAAQK,EAAO,EAGpB,KAAK,SAAWC,EAAU,EAG1B,KAAK,OAASC,CAChB,CAMA,IAAI,MAAO,CACT,OAAO,KAAK,KACd,CAMA,IAAI,SAAU,CACZ,OAAO,KAAK,QACd,CAMA,IAAI,OAAQ,CACV,OAAO,KAAK,MACd,CAMA,WAAW,eAAgB,CACzB,MAAO,SACT,CAMA,WAAW,aAAc,CACvB,OAAOH,CACT,CAOA,KAAKI,EAAM,CACT,OAAO,IAAIC,EAAoB,KAAMD,CAAI,CAC3C,CAOA,MAAMA,EAAM,CACV,OAAO,IAAIE,EAAyB,KAAMF,CAAI,CAChD,CAOA,MAAMA,EAAM,CACV,OAAI,OAAOA,GAAS,SAAiB,IAAIG,EAAsB,KAAMH,CAAI,EAAc,IAAII,EAAyB,KAAMJ,CAAI,CAChI,CAMA,WAAY,CACV,OAAO,IAAIK,EAA0B,IAAI,CAC3C,CAMA,SAAU,CACR,OAAO,IAAIC,EAAuB,IAAI,CACxC,CAOA,SAASN,EAAM,CACb,OAAO,IAAIO,EAAyB,KAAMP,CAAI,CAChD,CAOA,KAAKA,EAAM,CACT,OAAO,IAAIQ,EAAqB,KAAMR,CAAI,CAC5C,CAMA,UAAW,CACT,MAAO,yBAAyB,KAAK,IAAI,aAAa,KAAK,OAAO,GACpE,CASA,UAAUS,EAAMC,EAAQ,CACtB,MAAM,IAAIf,EAAsE,EAClF,CACF,CACA,GAAM,CACJ,aAAAgB,CACF,EAAI7B,EAAoB,IAAI,EAK5B,MAAM8B,UAA6BpB,CAAiB,CAOlD,YAAYK,EAAMC,EAASC,EAAO,CAChC,MAAMF,EAAMC,EAASC,CAAK,EAG1B,KAAK,YAAcY,EAAa,MAAM,KAAK,KAAM,KAAK,QAAS,KAAK,KAAK,CAC3E,CACF,CAKA,MAAME,UAAuCD,CAAqB,CAOhE,YAAYf,EAAMC,EAASgB,EAAS,CAClC,MAAMjB,EAAMC,EAASgB,EAAQ,KAAK,EAGlC,KAAK,SAAWA,CAClB,CAQA,UAAUL,EAAMC,EAAQ,CACtB,IAAMI,EAAU,KAAK,SAAS,UAAUL,EAAMC,CAAM,EAC9CK,EAAS,KAAK,YAGdC,EAAYvB,EAAyE,EAAE,cAAcgB,EAAMC,EAAQK,CAAM,EACzHE,GAAaxB,EAAyE,EAAE,cAAcgB,EAAMC,EAAQI,CAAO,EAGjI,OAAArB,EAAyE,EAAE,YAAYgB,EAAMC,EAAQO,GAAYH,CAAO,EAGxH,KAAK,SAASL,EAAMC,EAAQM,EAAWC,EAAU,EAGjDxB,EAAyE,EAAE,cAAcgB,EAAMC,EAAQM,EAAWD,CAAM,EAGxHtB,EAAyE,EAAE,gBAAgBgB,EAAMC,EAAQO,EAAU,EACnHxB,EAAyE,EAAE,gBAAgBgB,EAAMC,EAAQM,CAAS,EAG3GD,CACT,CAUA,SAASN,EAAMC,EAAQM,EAAWC,EAAY,CAC5C,MAAM,IAAItB,EAAsE,EAClF,CACF,CAKA,MAAMuB,UAAwCN,CAAqB,CAQjE,YAAYf,EAAMC,EAASqB,EAAMC,EAAO,CACtC1B,EAAuD,EAAE,OAAOyB,EAAK,QAAUC,EAAM,KAAK,EAC1F,MAAMvB,EAAMC,EAASqB,EAAK,KAAK,EAG/B,KAAK,MAAQA,EAGb,KAAK,OAASC,CAChB,CAQA,UAAUX,EAAMC,EAAQ,CACtB,IAAMS,EAAO,KAAK,MAAM,UAAUV,EAAMC,CAAM,EACxCU,EAAQ,KAAK,OAAO,UAAUX,EAAMC,CAAM,EAC1CK,EAAS,KAAK,YAGdC,GAAYvB,EAAyE,EAAE,cAAcgB,EAAMC,EAAQK,CAAM,EACzHM,GAAU5B,EAAyE,EAAE,cAAcgB,EAAMC,EAAQS,CAAI,EACrHG,GAAW7B,EAAyE,EAAE,cAAcgB,EAAMC,EAAQU,CAAK,EAG7H,OAAA3B,EAAyE,EAAE,YAAYgB,EAAMC,EAAQW,GAASF,CAAI,EAClH1B,EAAyE,EAAE,YAAYgB,EAAMC,EAAQY,GAAUF,CAAK,EAGpH,KAAK,SAASX,EAAMC,EAAQM,GAAWK,GAASC,EAAQ,EAGxD7B,EAAyE,EAAE,cAAcgB,EAAMC,EAAQM,GAAWD,CAAM,EAGxHtB,EAAyE,EAAE,gBAAgBgB,EAAMC,EAAQY,EAAQ,EACjH7B,EAAyE,EAAE,gBAAgBgB,EAAMC,EAAQW,EAAO,EAChH5B,EAAyE,EAAE,gBAAgBgB,EAAMC,EAAQM,EAAS,EAG3GD,CACT,CAWA,SAASN,EAAMC,EAAQM,EAAWK,EAASC,EAAU,CACnD,MAAM,IAAI3B,EAAsE,EAClF,CACF,CAKA,MAAMU,UAAkCQ,CAA+B,CAKrE,YAAYC,EAAS,CACnB,MAAMA,EAAQ,QAASA,EAAQ,KAAMA,CAAO,CAC9C,CASA,SAASL,EAAMC,EAAQM,EAAWC,EAAY,CAC5CR,EAAK,QAAQ,gBAAgBO,EAAWC,CAAU,CACpD,CACF,CAKA,MAAMX,UAA+BO,CAA+B,CAKlE,YAAYC,EAAS,CACnBpB,EAAuD,EAAE,OAAOoB,EAAQ,OAASA,EAAQ,OAAO,EAChG,MAAMA,EAAQ,KAAMA,EAAQ,QAASA,CAAO,EAG5C,KAAK,MAAQA,EAAQ,IACvB,CASA,SAASL,EAAMC,EAAQM,EAAWC,EAAY,CAC5C,OAAQ,KAAK,MAAO,CAClB,IAAK,GACH,MACF,IAAK,GACHR,EAAK,QAAQ,eAAeO,EAAWC,CAAU,EACjD,MACF,IAAK,GACHR,EAAK,QAAQ,eAAeO,EAAWC,CAAU,EACjD,MACF,IAAK,GACHR,EAAK,QAAQ,eAAeO,EAAWC,CAAU,EACjD,MACF,QACER,EAAK,QAAQ,iBAAiBO,EAAWC,CAAU,EACnD,KACJ,CACF,CACF,CAKA,MAAMd,UAA8BU,CAA+B,CAMjE,YAAYC,EAASS,EAAQ,CAC3B,MAAMT,EAAQ,KAAMA,EAAQ,QAASA,CAAO,EAG5C,KAAK,QAAU,CAACS,CAClB,CASA,SAASd,EAAMC,EAAQM,EAAWC,EAAY,CAC5CR,EAAK,QAAQ,YAAYO,EAAWC,EAAY,KAAK,OAAO,CAC9D,CACF,CAKA,MAAMhB,UAA4BiB,CAAgC,CAMhE,YAAYC,EAAMC,EAAO,CACvB1B,EAAuD,EAAE,OAAOyB,EAAK,OAASC,EAAM,MAAQD,EAAK,UAAYC,EAAM,OAAO,EAC1H,MAAMD,EAAK,KAAMA,EAAK,QAASA,EAAMC,CAAK,CAC5C,CAUA,SAASX,EAAMC,EAAQM,EAAWK,EAASC,EAAU,CACnDb,EAAK,QAAQ,UAAUO,EAAWK,EAASC,CAAQ,CACrD,CACF,CAKA,MAAMpB,UAAiCgB,CAAgC,CAMrE,YAAYC,EAAMC,EAAO,CACvB1B,EAAuD,EAAE,OAAOyB,EAAK,OAASC,EAAM,MAAQD,EAAK,UAAYC,EAAM,OAAO,EAC1H,MAAMD,EAAK,KAAMA,EAAK,QAASA,EAAMC,CAAK,CAC5C,CAUA,SAASX,EAAMC,EAAQM,EAAWK,EAASC,EAAU,CACnDb,EAAK,QAAQ,eAAeO,EAAWK,EAASC,CAAQ,CAC1D,CACF,CAKA,MAAMlB,UAAiCc,CAAgC,CAMrE,YAAYC,EAAMC,EAAO,CACvB1B,EAAuD,EAAE,OAAOyB,EAAK,UAAYC,EAAM,IAAI,EAC3F,MAAMD,EAAK,KAAMC,EAAM,QAASD,EAAMC,CAAK,CAC7C,CAUA,SAASX,EAAMC,EAAQM,EAAWK,EAASC,EAAU,CACnDb,EAAK,QAAQ,eAAeO,EAAWK,EAASC,CAAQ,CAC1D,CACF,CAKA,MAAMf,UAAiCW,CAAgC,CAMrE,YAAYC,EAAMC,EAAO,CACvB1B,EAAuD,EAAE,OAAOyB,EAAK,OAASC,EAAM,MAAQD,EAAK,UAAYC,EAAM,OAAO,EAC1H,MAAMA,EAAM,KAAMA,EAAM,QAASD,EAAMC,CAAK,CAC9C,CAUA,SAASX,EAAMC,EAAQM,EAAWK,EAASC,EAAU,CACnDb,EAAK,QAAQ,eAAeO,EAAWK,EAASC,CAAQ,CAC1D,CACF,CAKA,MAAMd,UAA6BU,CAAgC,CAMjE,YAAYC,EAAMC,EAAO,CACvB,IAAMI,EAAIL,EAAK,KACbM,EAAIN,EAAK,QAGXzB,EAAuD,EAAE,OAAO8B,GAAKC,GAAKL,EAAM,OAASI,GAAKJ,EAAM,UAAY,CAAC,EACjH,MAAMK,EAAG,EAAGN,EAAMC,CAAK,CACzB,CAUA,SAASX,EAAMC,EAAQM,EAAWK,EAASC,EAAU,CACnDb,EAAK,QAAQ,aAAaO,EAAWK,EAASC,EAAU,CAAC,CAC3D,CACF,CAEM,EAEA,KACC,CAAC1C,EAAyBC,EAAqBC,IAAwB,CAE9E,aACqBA,EAAoB,EAAED,EAAqB,CACzC,EAAG,IAAqB6C,CAC1B,CAAC,EACD,IAAIC,EAA+C7C,EAAoB,IAAI,EACvE8C,EAA6C9C,EAAoB,IAAI,EACrEI,EAA4CJ,EAAoB,IAAI,EACpE+C,EAA8C/C,EAAoB,IAAI,EAgD/F,IAAMgD,EAAchD,EAAoB,IAAI,EAGxCiD,EAAY,KAGZC,EAAU,KAGRC,GAAWC,IAAQ,CACvB,GAAI,CACF,OAAQA,EACR,MAAO,IAAI,WAAWA,EAAI,MAAM,EAChC,MAAO,IAAI,WAAWA,EAAI,MAAM,EAChC,OAAQ,IAAI,YAAYA,EAAI,MAAM,EAClC,QAAS,IAAI,aAAaA,EAAI,MAAM,EACpC,QAAS,IAAI,aAAaA,EAAI,MAAM,CACtC,CACF,IAAI,OAAO,YAAgB,IAAc,IAAI,WAAW,IAAI,EAE5D,IAAI,YAAY,OAAO,CACrB,QAAS,GAET,QAAS,GACX,CAAC,CAAC,EAKF,MAAMR,CAAiB,CAKrB,OAAO,OAAQ,CAEb,OAAI,OAAO,YAAgB,IAAoBC,EAAkE,EAAE,OAAO,IAAIC,EAAoE,GAAG,mEAAmE,CAAC,EAGpQC,EAA4C,cAG1C,IAAIF,EAAkE,EAAE,CAACQ,EAASC,IAAW,CAClGV,EAAiB,OAAOS,EAASC,CAAM,CACzC,CAAC,EALsET,EAAkE,EAAE,OAAO,IAAIC,EAAoE,GAAG,6DAA6D,CAAC,CAM7R,CAMA,WAAW,QAAS,CAClB,GAAI,CAACG,GAAa,CAACC,EAAS,MAAM,IAAIJ,EAAmE,GAAG,gDAAgD,EAC5J,MAAO,CACL,KAAMG,EACN,OAAQE,EACR,OAAQD,CACV,CACF,CAOA,OAAO,QAAQtB,EAAQ,CACrB,IAAM2B,EAAM,IAAIC,EAAwB5B,CAAM,EAC9C,OAAO,OAAO,oBAAoB4B,EAAwB,SAAS,EAAE,OAAOC,GAAY,OAAOF,EAAIE,CAAQ,GAAM,YAAcA,IAAa,aAAa,EAAE,OAAO,CAACC,EAASC,KAAgBD,EAAQC,CAAU,EAAIJ,EAAII,CAAU,EAAGD,GAAU,OAAO,OAAO,IAAI,CAAC,CAClQ,CASA,OAAO,cAAc/B,EAAMC,EAAQgC,EAAQ,CACzC,IAAMC,EAAUlC,EAAK,QAAQ,OAAOiC,EAAO,KAAK,UAAU,EAE1D,OADejC,EAAK,QAAQ,aAAaiC,EAAO,KAAMA,EAAO,QAASA,EAAO,MAAOA,EAAO,MAAOA,EAAO,MAAM,OAAQC,CAAO,CAEhI,CASA,OAAO,gBAAgBlC,EAAMC,EAAQkC,EAAQ,CAC3C,IAAMD,EAAUlC,EAAK,QAAQ,WAAWmC,CAAM,EAC9C,OAAAnC,EAAK,QAAQ,KAAKmC,CAAM,EACxBnC,EAAK,QAAQ,KAAKkC,CAAO,EAClB,CACT,CAUA,OAAO,YAAYlC,EAAMC,EAAQkC,EAAQF,EAAQ,CAM/CxD,EAAuD,EAAE,OAEzDwD,EAAO,KAAK,aAAejC,EAAK,QAAQ,eAAemC,CAAM,CAAC,EAC9D,IAAMD,EAAUlC,EAAK,QAAQ,WAAWmC,CAAM,EAC9C,OAAAlC,EAAO,GAAG,QAAQ,IAAIgC,EAAO,KAAMC,EAAU,aAAa,iBAAiB,EACpEC,CACT,CAUA,OAAO,cAAcnC,EAAMC,EAAQkC,EAAQF,EAAQ,CAMjDxD,EAAuD,EAAE,OAEzDwD,EAAO,KAAK,aAAejC,EAAK,QAAQ,eAAemC,CAAM,CAAC,EAC9D,IAAMC,EAAOpC,EAAK,QAAQ,WAAWmC,CAAM,EAAI,aAAa,kBAC5D,QAASE,EAASJ,EAAO,KAAK,OAAS,EAAGI,GAAU,EAAGA,IAAUJ,EAAO,KAAKI,CAAM,EAAIpC,EAAO,GAAG,QAAQmC,EAAOC,CAAM,EACtH,OAAOF,CACT,CAQA,OAAO,OAAOT,EAASC,EAAQW,EAAU,IAAM,CACzChB,IAAc,MAAQC,IAAY,KAAMG,EAAQ,CAClD,KAAMJ,EACN,OAAQE,EACR,OAAQD,CACV,CAAC,EAAWe,GAAW,EAAGX,EAAO,IAAIR,EAA+D,GAAG,0BAA0B,CAAC,EAAO,WAAWF,EAAiB,OAAQ,EAAGS,EAASC,EAAQW,EAAU,CAAC,CAC9M,CACF,CAKA,MAAMT,CAAwB,CAK5B,YAAY5B,EAAQ,CAKlB,OAHoB,OAAO,oBAAoB,KAAK,YAAY,SAAS,EAAE,OAAO6B,GAAY,OAAO,KAAKA,CAAQ,GAAM,UAAU,EAAE,OAAOA,GAAYA,IAAa,aAAa,EAGrK,QAAQE,GAAc,CAChC,KAAKA,CAAU,EAAI,KAAKA,CAAU,EAAE,KAAK,IAAI,CAC/C,CAAC,EAGD,KAAK,OAAS/B,EAGd,KAAK,QAAU,IAAIsC,EAAatC,CAAM,EAG/B,OAAO,OAAO,IAAI,CAC3B,CAMA,MAAMuC,EAAK,CACT/D,EAAuD,EAAE,IAAI,KAAK,QAAQ,IAAI+D,CAAG,CAAC,CACpF,CAMA,MAAMA,EAAK,CACT,MAAM,IAAIrB,EAAmE,GAAG,KAAK,QAAQ,IAAIqB,CAAG,CAAC,CACvG,CAQA,SAAS3D,EAAO4D,EAAOC,EAAK,CAC1B,KAAK,OAAO,GAAG,MAAM,KAAK7D,EAAO4D,EAAOC,CAAG,CAC7C,CAQA,WAAWC,EAAQF,EAAOC,EAAK,CAC7B,KAAK,OAAO,GAAG,MAAM,WAAWC,EAAQF,EAAOC,CAAG,CACpD,CACF,CAKA,MAAMH,CAAa,CAKjB,YAAYtC,EAAQ,CAElB,KAAK,SAAW,IAAI,YAAY,OAAO,EAGvC,KAAK,QAAUA,CACjB,CAOA,IAAIuC,EAAK,CACP,IAAMI,EAAO,KAAK,QAAQ,GAAG,MACvBC,EAAO,KAAK,QAAQ,GAAG,MAAM,WAC/BC,EAAIN,EACR,KAAOM,EAAID,GAAcD,EAAKE,CAAC,IAAZ,GAAe,EAAEA,EACpC,OAAO,KAAK,SAAS,OAAOF,EAAK,SAASJ,EAAKM,CAAC,CAAC,CACnD,CACF,EAMC,SAAkB7C,EAAQ,CACzB,IAAM8C,EAAeC,GAAQ,WAAW,KAAK,KAAKA,CAAI,EAAGC,GAAKA,EAAE,WAAW,CAAC,CAAC,EAGzE,OAAO,YAAgB,KAG3B/B,EAAkE,EAAE,QAAQG,CAAW,EAAE,KAAK2B,GAAQD,EAAaC,CAAI,CAAC,EAAE,KAAKE,GAAS,YAAY,YAAYA,EAAO,CACrK,IAAK,OAAO,OAAO,CACjB,OAAQjD,EAAO,GAAG,MACpB,EAAGgB,EAAiB,QAAQhB,CAAM,CAAC,CACrC,CAAC,CAAC,EAAE,KAAKD,GAAQ,CACfsB,EAAYtB,EAAK,SACjBuB,EAAUvB,EAAK,OACfA,EAAK,SAAS,QAAQ,MAAM,KAAK,IAAI,EAAI,KAAQ,UAAU,EAE3DvB,EAAuD,EAAE,IAAI,4CAA4C,CAC3G,CAAC,EAAE,MAAM0E,GAAO,CACd,MAAM,IAAIhC,EAAmE,GAAG,wCAAwCgC,CAAG,GAAIA,CAAG,CACpI,CAAC,CACH,GAAG3B,CAAO,CAEJ,EAEA,KACC,CAACrD,EAAyBC,EAAqBC,IAAwB,CAE9E,aACAA,EAAoB,EAAED,CAAmB,EACpBC,EAAoB,EAAED,EAAqB,CACzC,aAAc,IAAqB8B,CACrC,CAAC,EACD,IAAIkD,EAAmD/E,EAAoB,IAAI,EAC3EgF,EAAmDhF,EAAoB,IAAI,EAC3EiF,EAA+CjF,EAAoB,IAAI,EACvEkF,EAA4ClF,EAAoB,IAAI,EAoC7F,MAAM6B,UAAqBkD,EAAyE,CAAE,CAWpG,YAAYhE,EAAMC,EAASmE,EAAOC,EAAOT,EAAM,CAC7C,MAAM5D,EAAMC,EAAS+D,EAAyE,EAAE,aAAa,EAC7GG,EAAuD,EAAE,OAAOP,EAAK,cAAgBI,EAAyE,EAAE,YAAY,KAAK,KAAK,CAAC,EACvLG,EAAuD,EAAE,OAAOC,EAAQ,GAAKC,GAASD,CAAK,EAC3FD,EAAuD,EAAE,OAAOP,EAAK,OAAS5D,EAAOC,IAAY,GAEjG2D,EAAK,SAAW,EAAIQ,GAASpE,EAAO,GAAKqE,GAASpE,EAAU,EAC5D,EAGA,KAAK,OAASmE,EAAQ,EAGtB,KAAK,OAASC,EAAQ,EAGtB,KAAK,MAAQT,CACf,CAUA,OAAO,OAAO5D,EAAMC,EAASqE,EAASpE,EAAQ8D,EAAyE,EAAE,cAAe,CACtI,OAAAG,EAAuD,EAAE,OAAOnE,EAAOC,EAAU,EAAG,uCAAuC,EAC3HkE,EAAuD,EAAE,OAAOnE,EAAOC,IAAYqE,EAAQ,OAAQ,iCAAiCtE,EAAOC,CAAO,uBAAuBqE,EAAQ,MAAM,EAAE,EACzLH,EAAuD,EAAE,OAAO,OAAO,UAAU,eAAe,KAAKH,EAAyE,EAAE,YAAa9D,CAAK,EAAG,mBAAmBA,CAAK,GAAG,EACzN,IAAIY,EAAad,EAAMC,EAAS,EAAGD,EAAM,QAAQ,UAAUgE,EAAyE,EAAE,YAAY9D,CAAK,EAAG,CAACoE,CAAO,CAAC,CAAC,CAC7K,CASA,OAAO,MAAMtE,EAAMC,EAAUD,EAAME,EAAQ8D,EAAyE,EAAE,cAAe,CACnI,OAAAG,EAAuD,EAAE,OAAOnE,EAAOC,EAAU,EAAG,uCAAuC,EAC3HkE,EAAuD,EAAE,OAAO,OAAO,UAAU,eAAe,KAAKH,EAAyE,EAAE,YAAa9D,CAAK,EAAG,mBAAmBA,CAAK,GAAG,EACzN,IAAIY,EAAad,EAAMC,EAAS,EAAGD,EAAM,QAAQ,UAAUgE,EAAyE,EAAE,YAAY9D,CAAK,EAAG,CAACF,EAAOC,CAAO,CAAC,CAAC,CACpL,CASA,OAAO,KAAKD,EAAMC,EAAUD,EAAME,EAAQ8D,EAAyE,EAAE,cAAe,CAClI,OAAAG,EAAuD,EAAE,OAAOnE,EAAOC,EAAU,EAAG,uCAAuC,EAC3HkE,EAAuD,EAAE,OAAO,OAAO,UAAU,eAAe,KAAKH,EAAyE,EAAE,YAAa9D,CAAK,EAAG,mBAAmBA,CAAK,GAAG,EACzN,IAAIY,EAAad,EAAMC,EAAS,EAAGD,EAAM,QAAQ,UAAUgE,EAAyE,EAAE,YAAY9D,CAAK,EAAG,CAACF,EAAOC,CAAO,CAAC,EAAE,KAAK,CAAC,CAAC,CAC5L,CASA,OAAO,IAAID,EAAMC,EAAUD,EAAME,EAAQ8D,EAAyE,EAAE,cAAe,CACjIG,EAAuD,EAAE,OAAOnE,EAAOC,EAAU,EAAG,uCAAuC,EAC3HkE,EAAuD,EAAE,OAAO,OAAO,UAAU,eAAe,KAAKH,EAAyE,EAAE,YAAa9D,CAAK,EAAG,mBAAmBA,CAAK,GAAG,EAChO,IAAM0D,EAAO,QAAQ,UAAUI,EAAyE,EAAE,YAAY9D,CAAK,EAAG,CAACF,EAAOC,CAAO,CAAC,EAC9I,QAASsE,EAAI,KAAK,IAAIvE,EAAMC,CAAO,EAAI,EAAGsE,GAAK,EAAGA,IAAKX,EAAKW,EAAIvE,EAAOuE,CAAC,EAAI,EAC5E,OAAO,IAAIzD,EAAad,EAAMC,EAAS,EAAGD,EAAM4D,CAAI,CACtD,CAOA,OAAO,KAAKzD,EAAM,CAChB,OAAOW,EAAa,MAAMX,EAAK,KAAMA,EAAK,QAASA,EAAK,KAAK,EAAE,UAAUA,CAAI,CAC/E,CAOA,OAAO,OAAQ,CACb,OAAO8D,EAAyE,EAAE,MAAM,EAAE,KAAK,GAAE,EAAS,CAC5G,CAMA,IAAI,MAAO,CACT,OAAO,KAAK,KACd,CAMA,IAAI,OAAQ,CACV,OAAO,KAAK,MACd,CAMA,IAAI,OAAQ,CACV,OAAO,KAAK,MACd,CAUA,MAAMO,EAAUC,EAASC,EAAaC,EAAY,CAChDR,EAAuD,EAAE,OAAOK,GAAYC,GAAWC,GAAeC,EAAY,qBAAqBH,CAAQ,IAAIC,CAAO,IAAIC,CAAW,IAAIC,CAAU,GAAG,EAG1LH,EAAW,KAAK,IAAIA,EAAU,CAAC,EAC/BC,EAAU,KAAK,IAAIA,EAAS,KAAK,MAAQ,CAAC,EAC1CC,EAAc,KAAK,IAAIA,EAAa,CAAC,EACrCC,EAAa,KAAK,IAAIA,EAAY,KAAK,SAAW,CAAC,EAGnD,IAAM3E,EAAOyE,EAAUD,EAAW,EAC5BvE,EAAU0E,EAAaD,EAAc,EAGrCN,EAAQ,KAAK,OACjBC,EAAQ,KAAK,OACTO,EAAQJ,EAAWJ,EAAQM,EAAcL,EACzCf,EAAM,EAAImB,EAAUL,EAAQO,EAAaN,EAG/C,OAAO,IAAIvD,EAAad,EAAMC,EAASmE,EAAOC,EAAO,KAAK,MAAM,SAASO,EAAOtB,CAAG,CAAC,CACtF,CAOA,IAAIuB,EAAO,CACT,OAAO,KAAK,MAAMA,EAAOA,EAAO,EAAG,KAAK,SAAW,CAAC,CACtD,CAOA,OAAOA,EAAO,CACZ,OAAO,KAAK,MAAM,EAAG,KAAK,MAAQ,EAAGA,EAAOA,CAAK,CACnD,CAMA,UAAW,CACT,IAAMC,EAAW,KAAK,IAAI,KAAK,MAAO,KAAK,QAAQ,EAG7C9E,EAAO8E,EACP7E,EAAU,EAGV8E,EAAW,KAAK,OAAS,KAAK,OAC9BH,EAAQ,EACRtB,EAAM,GAAKwB,EAAW,GAAKC,EAGjC,OAAO,IAAIjE,EAAad,EAAMC,EAAS8E,EAAUA,EAAU,KAAK,MAAM,SAASH,EAAOtB,CAAG,CAAC,CAC5F,CAQA,GAAG0B,EAAKC,EAAQ,CACd,OAAID,GAAO,GAAKA,EAAM,KAAK,OAASC,GAAU,GAAKA,EAAS,KAAK,SAAiB,KAAK,MAAM,KAAK,OAASD,EAAM,KAAK,OAASC,CAAM,EAAc,OAAO,GAC5J,CAMA,MAAO,CACL,IAAMX,EAAU,IAAI,MAAM,KAAK,MAAQ,KAAK,QAAQ,EAC9CF,EAAQ,KAAK,OACjBC,EAAQ,KAAK,OACXa,EAAI,EACR,QAASD,EAAS,EAAGA,EAAS,KAAK,SAAUA,IAC3C,QAASD,EAAM,EAAGA,EAAM,KAAK,MAAOA,IAAOV,EAAQY,GAAG,EAAI,KAAK,MAAMF,EAAMZ,EAAQa,EAASZ,CAAK,EAEnG,OAAOC,CACT,CAMA,UAAW,CAET,IAAMtE,EAAO,KAAK,KAChBC,EAAU,KAAK,QACXqE,EAAU,KAAK,KAAK,EACpBa,EAA+B,IAAI,MAAMnF,CAAI,EACnD,QAASkF,EAAI,EAAGA,EAAIlF,EAAMkF,IAAK,CAC7BC,EAAID,CAAC,EAAI,IAAI,MAAMjF,CAAO,EAC1B,QAASsE,EAAI,EAAGA,EAAItE,EAASsE,IAAKY,EAAID,CAAC,EAAEX,CAAC,EAAID,EAAQC,EAAIvE,EAAOkF,CAAC,CACpE,CACA,IAAME,EAAMC,GAAKA,EAAE,QAAQ,CAAQ,EAC7BC,EAAMH,EAAI,IAAIH,GAAO,OAASA,EAAI,IAAII,CAAG,EAAE,KAAK,IAAI,CAAC,EAAE,KAAK;AAAA,CAAK,EAEvE,MADY,qBAAqBpF,CAAI,aAAaC,CAAO;AAAA,EAAaqF,CAAG;AAAA,GAE3E,CAOA,MAAMnF,EAAM,CACV,OAAO8D,EAAyE,EAAE,MAAM,EAAE,KAAKsB,GAEtF,KAAK,UAAUpF,CAAI,CAC3B,CACH,CAOA,UAAUA,EAAM,CACd,GAAM,CACJ,KAAAS,EACA,OAAAC,CACF,EAAIoD,EAAyE,EAAE,OAGzE/C,EAASf,EAAK,UAAUS,EAAMC,CAAM,EAe1CsD,EAAuD,EAAE,OAAO,KAAK,QAAUjD,EAAO,OAAS,KAAK,WAAaA,EAAO,UAAY,KAAK,QAAUA,EAAO,MAAO,6BAA6B,KAAK,IAAI,MAAM,KAAK,OAAO,IAAI,KAAK,KAAK,yBAAyBA,EAAO,IAAI,MAAMA,EAAO,OAAO,IAAIA,EAAO,KAAK,SAAS,EAGxT,IAAMkD,EAAQ,KAAK,OACjBC,EAAQ,KAAK,OACbmB,EAAStE,EAAO,OAChBuE,EAASvE,EAAO,OAClB,GAAIkD,IAAUoB,GAAUnB,IAAUoB,GAAU,KAAK,MAAM,SAAWvE,EAAO,MAAM,OAE7E,KAAK,MAAM,IAAIA,EAAO,KAAK,MAG3B,SAAS+D,EAAS,KAAK,SAAW,EAAGA,GAAU,EAAGA,IAChD,QAASD,EAAM,KAAK,MAAQ,EAAGA,GAAO,EAAGA,IAAO,KAAK,MAAMA,EAAMZ,EAAQa,EAASZ,CAAK,EAAInD,EAAO,MAAM8D,EAAMQ,EAASP,EAASQ,CAAM,EAK1I,OAAO,IACT,CAOA,KAAKhG,EAAO,CACV,YAAK,SAASA,CAAK,EACZyE,EAAkE,EAAE,QAAQ,IAAI,CACzF,CAOA,SAASzE,EAAO,CAEd,GADAA,EAAQ,CAACA,EACL,KAAK,MAAQ,KAAK,WAAa,KAAK,MAAM,OAC5C,YAAK,MAAM,KAAKA,CAAK,EACd,KAET,QAASwF,EAAS,EAAGA,EAAS,KAAK,SAAUA,IAC3C,QAASD,EAAM,EAAGA,EAAM,KAAK,MAAOA,IAClC,KAAK,MAAMA,EAAM,KAAK,OAASC,EAAS,KAAK,MAAM,EAAIxF,EAG3D,OAAO,IACT,CAQA,UAAUmB,EAAMC,EAAQ,CACtB,OAAO,IACT,CACF,CAEM,EAEA,KACC,CAAC9B,EAAyBC,EAAqBC,IAAwB,CAE9E,aACqBA,EAAoB,EAAED,EAAqB,CACzC,EAAG,IAAqB0G,CAC1B,CAAC,EACD,IAAIC,EAA6C1G,EAAoB,IAAI,EA4B9F,MAAMyG,CAAgB,CAOpB,aAAc,CAEZ,MAAM,IAAIC,EAAsE,GAAG,kCAAkC,CACvH,CACF,CAEM,EAEA,KACC,CAAC5G,EAAyBC,EAAqBC,IAAwB,CAE9E,aACqBA,EAAoB,EAAED,EAAqB,CACzC,EAAG,IAAqB4G,CAC1B,CAAC,EAsBtB,IAAMC,EAAU,EACVC,EAAY,EACZC,EAAW,EACXC,EAAgB,EAChBC,EAAO,OAAO,eAAmB,KAAe,gBAEtD,OAAO,QAAY,KAAe,QAAQ,WAE1CC,GAAK,QAAQ,QAAQ,EAAE,KAAK,IAAMA,EAAE,CAAC,GAQrC,MAAMN,CAAc,CAKlB,YAAYO,EAAU,CACpB,KAAK,OAASN,EACd,KAAK,OAAS,OACd,KAAK,eAAiB,KACtB,KAAK,aAAe,KACpB,KAAK,UAAY,EACjB,KAAK,CAAC,EAAI,KACV,KAAK,QAAU,OACf,KAAK,OAAS,EACd,KAAK,SAAW,KAAK,SAAS,KAAK,IAAI,EACvC,KAAK,QAAU,KAAK,QAAQ,KAAK,IAAI,EACrC,KAAK,SAAW,KAAK,SAAS,KAAK,IAAI,EACvC,KAAK,kBAAoB,KAAK,kBAAkB,KAAK,IAAI,EACzDM,EAAS,KAAK,SAAU,KAAK,OAAO,CACtC,CASA,KAAKC,EAAeC,EAAc,KAAM,CACtC,IAAMC,EAAQ,IAAIV,EAAc,KAAK,IAAI,EACzC,OAAAU,EAAM,eAAiB,OAAOF,GAAkB,YAAcA,EAC9DE,EAAM,aAAe,OAAOD,GAAgB,YAAcA,EAC1DC,EAAM,QAAU,KAChB,KAAK,KAAK,WAAW,EAAIA,EACzB,KAAK,QAAU,CAACN,EAChB,KAAK,QAAQ,EACNM,CACT,CAQA,MAAMD,EAAa,CACjB,OAAO,KAAK,KAAK,KAAMA,CAAW,CACpC,CAQA,QAAQE,EAAW,CACjB,IAAMC,EAAKC,IACTF,EAAU,EACHE,GAET,OAAO,KAAK,KAAKD,EAAIA,CAAE,CACzB,CAOA,aAAc,CACZ,IAAIE,EAAK,KAIT,IADA,KAAK,QAAUV,EACRU,EAAG,UAAY,QACpBA,EAAKA,EAAG,QACRA,EAAG,QAAUV,EAIf,OAAAU,EAAG,QAAQ,EAGJ,IACT,CAMA,UAAW,CACT,OAAQ,KAAK,OAAQ,CACnB,KAAKb,EACH,MAAO,8BACT,KAAKC,EACH,MAAO,+BAA+B,KAAK,MAAM,KACnD,KAAKC,EACH,MAAO,8BAA8B,KAAK,MAAM,KAClD,QACE,MAAO,EACX,CACF,CAMA,IAAK,OAAO,WAAW,GAAI,CACzB,MAAO,eACT,CAQA,OAAO,QAAQtG,EAAO,CACpB,IAAMkH,EAAU,IAAIf,EAAc,KAAK,KAAK,EAC5C,OAAI,OAAOnG,GAAU,UAAYA,IAAU,MAAQ,SAAUA,GAAS,OAAOA,GAAU,YAAc,SAAUA,EAE7GkH,EAAQ,SAASlH,CAAK,GAGtBkH,EAAQ,OAASlH,EACjBkH,EAAQ,OAASb,GAEZa,CACT,CAQA,OAAO,OAAOC,EAAQ,CACpB,IAAMD,EAAU,IAAIf,EAAc,KAAK,KAAK,EAC5C,OAAAe,EAAQ,OAASC,EACjBD,EAAQ,OAASZ,EACVY,CACT,CAcA,OAAO,IAAIE,EAAU,CACnB,OAAO,IAAIjB,EAAc,CAACtD,EAASC,IAAW,CAC5C,IAAMuE,EAAQ,CAAC,EAGf,QAAWC,KAAWF,EAAUC,EAAM,KAAKC,CAAO,EAGlD,IAAMC,EAASF,EAAM,OACrB,GAAIE,GAAU,EAAG,CACf1E,EAAQ,CAAC,CAAC,EACV,MACF,CAGA,IAAIY,EAAU8D,EACRC,EAAS,IAAI,MAAMD,CAAM,EACzBE,EAAiBhC,GAAKuB,GAAO,CACjCQ,EAAO/B,CAAC,EAAIuB,EACH,EAAEvD,GAAP,GAAgBZ,EAAQ2E,CAAM,CACpC,EACA,QAAS/B,EAAI,EAAGA,EAAI8B,EAAQ9B,IAAK,CAC/B,IAAM6B,EAAUD,EAAM5B,CAAC,EACnB6B,EAAQ,YAAcnB,EAAc,WAAamB,EAAQ,YAAc,QAAQ,UAAWA,EAAQ,KAAKG,EAAehC,CAAC,EAAG3C,CAAM,EAAOqD,EAAc,QAAQmB,CAAO,EAAE,KAAKG,EAAehC,CAAC,EAAG3C,CAAM,CAC1M,CACF,CAAC,CACH,CAUA,OAAO,KAAKsE,EAAU,CACpB,OAAO,IAAIjB,EAAc,CAACtD,EAASC,IAAW,CAC5C,IAAMuE,EAAQ,CAAC,EAGf,QAAWC,KAAWF,EAAUC,EAAM,KAAKC,CAAO,EAMlD,IAAMC,EAASF,EAAM,OACrB,QAAS5B,EAAI,EAAGA,EAAI8B,EAAQ9B,IAAK,CAC/B,IAAM6B,EAAUD,EAAM5B,CAAC,EACnB6B,EAAQ,YAAcnB,EAAc,WAAamB,EAAQ,YAAc,QAAQ,UAAWA,EAAQ,KAAKzE,EAASC,CAAM,EAAOqD,EAAc,QAAQmB,CAAO,EAAE,KAAKzE,EAASC,CAAM,CACtL,CACF,CAAC,CACH,CAMA,SAAS9C,EAAO,CACd,KAAK,UAAUqG,EAAWrG,CAAK,CACjC,CAMA,QAAQmH,EAAQ,CACd,KAAK,UAAUb,EAAUa,CAAM,CACjC,CAOA,UAAUO,EAAO1H,EAAO,CAElB,KAAK,QAAUoG,IAGnB,KAAK,OAASsB,EACd,KAAK,OAAS1H,EACd,KAAK,QAAQ,EACf,CASA,SAAU,CAER,GAAI,KAAK,QAAUoG,EAGnB,IAAI,KAAK,OAASG,EAAe,CAC/B,KAAK,WAAW,EAChB,MACF,CAGAC,EAAK,KAAK,iBAAiB,EAC7B,CAKA,mBAAoB,CAGZ,KAAK,OAASD,GAAgB,KAAK,WAAW,CACtD,CAOA,YAAa,CACX,IAAMoB,EAAW,KAAK,UAChBD,EAAQ,KAAK,OACnB,GAAIA,IAAUrB,EACZ,QAASZ,EAAI,EAAGA,EAAIkC,EAAUlC,IAAK,CACjC,IAAMoB,EAAQ,KAAKpB,CAAC,EACdiB,EAAWG,EAAM,eACvB,GAAI,CACEH,EACEA,IAAaG,EAAM,OACrBA,EAAM,SAASH,EAAS,KAAK,MAAM,CAAC,EACpCG,EAAM,eAAiBA,EAAM,MAE1BA,EAAM,SAAS,KAAK,MAAM,CACnC,OAASe,EAAG,CACVf,EAAM,QAAQe,CAAC,CACjB,CACF,SACSF,IAAUpB,EACnB,QAASb,EAAI,EAAGA,EAAIkC,EAAUlC,IAAK,CACjC,IAAMoB,EAAQ,KAAKpB,CAAC,EACdiB,EAAWG,EAAM,aACvB,GAAI,CACEH,EACEA,IAAaG,EAAM,OACrBA,EAAM,SAASH,EAAS,KAAK,MAAM,CAAC,EACpCG,EAAM,aAAeA,EAAM,MAExBA,EAAM,QAAQ,KAAK,MAAM,CAClC,OAASe,EAAG,CACVf,EAAM,QAAQe,CAAC,CACjB,CACF,CAEJ,CAOA,SAAShC,EAAG,CACV,GAAI,OAAOA,GAAM,UAAY,OAAOA,GAAM,YAAcA,IAAM,KAAM,CAElE,KAAK,SAASA,CAAC,EACf,MACF,CACA,GAAIA,IAAM,KAAM,MAAM,IAAI,UAE1B,GAAIA,EAAE,YAAcO,EAAc,WAAaP,EAAE,YAAc,QAAQ,UAAW,CAChFA,EAAE,KAAK,KAAK,SAAU,KAAK,OAAO,EAClC,MACF,CACA,GAAI,CACF,IAAMiC,EAAOjC,EAAE,KACf,GAAI,OAAOiC,GAAS,WAAY,CAC9B,IAAIhF,EAAU,KAAK,SACjBC,EAAS,KAAK,QAChB,GAAI,CACF+E,EAAK,KAAKjC,EAAGkC,GAAK,CAChBjF,EAAQiF,CAAC,EACTjF,EAAUC,EAAS,KAAK,IAC1B,EAAGiF,GAAK,CACNjF,EAAOiF,CAAC,EACRlF,EAAUC,EAAS,KAAK,IAC1B,CAAC,CACH,OAAS8E,EAAG,CACN/E,IAAY,KAAK,MAAQC,IAAW,KAAK,MAAM,KAAK,QAAQ8E,CAAC,CACnE,CACF,MACE,KAAK,SAAShC,CAAC,CAEnB,OAASgC,EAAG,CACV,KAAK,QAAQA,CAAC,CAChB,CACF,CAKA,MAAO,CAAC,CAKR,OAAO,OAAQ,CAAC,CAClB,CAUM,EAEA,KACC,CAACtI,EAAyBC,EAAqBC,IAAwB,CAE9E,aAGAA,EAAoB,EAAED,EAAqB,CACzC,GAAI,IAAqByI,GACzB,GAAI,IAAqBC,EAC3B,CAAC,EAKD,IAAIC,EAAY1I,EAAoB,IAAI,EAEpC2I,EAAQ3I,EAAoB,IAAI,EAEhC4I,EAAQ5I,EAAoB,IAAI,EAEhC6I,EAAS7I,EAAoB,IAAI,EAErC,SAAS8I,GAAc,CAAEA,EAAc,SAAUV,EAAGG,GAAG,CAAE,OAAO,IAAIQ,GAAYX,EAAG,OAAQG,EAAC,CAAG,EAAG,IAAIH,GAAI,OAAO,UAAWG,EAAI,IAAI,QAAW,SAASQ,GAAYX,EAAGY,GAAGvE,GAAG,CAAE,IAAIwE,GAAI,OAAOb,EAAGY,EAAC,EAAG,OAAOT,EAAE,IAAIU,GAAGxE,IAAK8D,EAAE,IAAIH,CAAC,CAAC,EAAGc,EAAgBD,GAAGF,GAAY,SAAS,CAAG,CAAE,SAASI,GAAYf,EAAGY,GAAG,CAAE,IAAIvE,GAAI8D,EAAE,IAAIS,EAAC,EAAG,OAAO,OAAO,KAAKvE,EAAC,EAAE,OAAO,SAAU8D,GAAGS,GAAG,CAAE,IAAIC,GAAIxE,GAAEuE,EAAC,EAAG,GAAgB,OAAOC,IAAnB,SAAsBV,GAAES,EAAC,EAAIZ,EAAEa,EAAC,MAAO,CAAE,QAAShD,GAAI,EAAcmC,EAAEa,GAAEhD,EAAC,CAAC,IAAjB,QAAsBA,GAAI,EAAIgD,GAAE,QAAShD,KAAKsC,GAAES,EAAC,EAAIZ,EAAEa,GAAEhD,EAAC,CAAC,CAAG,CAAE,OAAOsC,EAAG,EAAG,OAAO,OAAO,IAAI,CAAC,CAAG,CAAE,OAAOa,EAAUL,GAAa,MAAM,EAAGA,GAAY,UAAU,KAAO,SAAUR,EAAG,CAAE,IAAIS,GAAIZ,GAAE,KAAK,KAAK,KAAMG,CAAC,EAAG,GAAIS,GAAG,CAAEA,GAAE,OAASG,GAAYH,GAAG,IAAI,EAAG,IAAIvE,GAAIuE,GAAE,QAASvE,KAAMA,GAAE,OAAS0E,GAAY1E,GAAG,IAAI,EAAI,CAAE,OAAOuE,EAAG,EAAGD,GAAY,UAAU,OAAO,OAAO,EAAI,SAAUC,EAAGvE,GAAG,CAAE,GAAgB,OAAOA,IAAnB,SAAsB,CAAE,IAAIwE,GAAIV,EAAE,IAAI,IAAI,EAAG,OAAOH,GAAE,OAAO,OAAO,EAAE,KAAK,KAAMY,EAAGvE,GAAE,QAAQ,eAAgB,SAAU2D,GAAGG,GAAG,CAAE,IAAIS,GAAIC,GAAEV,EAAC,EAAG,MAAO,KAAO,MAAM,QAAQS,EAAC,EAAIA,GAAE,KAAK,GAAG,EAAIA,GAAI,CAAC,CAAC,CAAG,CAAE,GAAkB,OAAOvE,IAArB,WAAwB,CAAE,IAAIwB,GAAI,KAAM,OAAOmC,GAAE,OAAO,OAAO,EAAE,KAAK,KAAMY,EAAG,UAAY,CAAE,IAAIZ,GAAI,UAAW,OAAmB,OAAOA,GAAEA,GAAE,OAAS,CAAC,GAAjC,WAAuCA,GAAI,CAAC,EAAE,MAAM,KAAKA,EAAC,GAAG,KAAKe,GAAYf,GAAGnC,EAAC,CAAC,EAAGxB,GAAE,MAAM,KAAM2D,EAAC,CAAG,CAAC,CAAG,CAAE,OAAOA,GAAE,OAAO,OAAO,EAAE,KAAK,KAAMY,EAAGvE,EAAC,CAAG,EAAGqE,EAAY,MAAM,KAAM,SAAS,CAAG,CACt0C,SAASM,EAAUJ,GAAGZ,EAAG,CAAE,GAAkB,OAAOA,GAArB,YAAmCA,IAAT,KAAY,MAAM,IAAI,UAAU,oDAAoD,EAAGY,GAAE,UAAY,OAAO,OAAOZ,GAAKA,EAAE,UAAW,CAAE,YAAa,CAAE,MAAOY,GAAG,SAAU,GAAI,aAAc,EAAG,CAAE,CAAC,EAAG,OAAO,eAAeA,GAAG,YAAa,CAAE,SAAU,EAAG,CAAC,EAAGZ,GAAKc,EAAgBF,GAAGZ,CAAC,CAAG,CACnV,SAASc,EAAgBF,GAAGZ,EAAG,CAAE,OAAOc,EAAkB,OAAO,eAAiB,OAAO,eAAe,KAAK,EAAI,SAAUF,GAAGZ,GAAG,CAAE,OAAOY,GAAE,UAAYZ,GAAGY,EAAG,EAAGE,EAAgBF,GAAGZ,CAAC,CAAG,CA+BxL,IAAMiB,EAAUrJ,EAAoB,IAAI,EAClCsJ,EACN,OAAO,KAAKD,CAAO,EAAE,OAAOE,IAAO,OAAOF,EAAQE,EAAG,GAAK,QAAQ,EAAE,OAAO,CAAChG,GAAKgG,KAAShG,GAAIgG,CAAG,EAAIF,EAAQE,CAAG,EAAGhG,IAAM,CAAC,CAAC,EAGrHiG,EAAiB,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,CAAC,EAAGF,CAAc,EAAG,CAAC,EAAG,CAExF,wBAA2B,EAE3B,eAAkB,EAIlB,mBAAsBV,EAA0B,GAAG,IACnD,qBAAwBA,EAA0B,GAAG,MACrD,oBAAuBA,EAA0B,GAAG,KACpD,qBAAwBA,EAA0B,GAAG,KACvD,CAAC,CAAC,EAGIa,EAAoB,CAACC,GAAUC,IAAe,OAAO,OAAO,CAChE,MAAS,8BAA8B,KAAKD,EAAQ,EAAI,EAExD,UAAa,QAAQ,KAAKC,CAAU,EAAI,EAExC,eAAkB,kBAAkB,KAAKA,CAAU,EAAI,CACzD,CAAC,EAGKC,EAAgB,CAAC,oBAAqB,WAAW,EACjDC,EAAe,8BACfC,EAAgB,WAChBC,EAAc,CAAcjB,EAAY,gJAAiJ,CAC7L,QAAS,CACX,CAAC,EAAgBA,EAAY,0JAA2J,CACtL,QAAS,CACX,CAAC,CAAC,EAKF,MAAMkB,CAAmB,CASvB,OAAO,aAAaC,EAASC,GAAOC,GAAS,KAAMC,EAAS,KAAM,CAMhE,IAAMvB,GAAS,CAAC,EACVwB,GAAYC,EAAkBL,CAAO,EACrCM,GAAgBC,EAAwBP,EAASC,GAAOC,GAAQC,CAAM,EAC5E,OAAOK,EAAYF,GAAc,QAAQX,EAAc,CAAC,EAAG,EAAE,EAAE,QAAQA,EAAc,CAAC,EAAG,EAAE,EAAE,QAAQE,EAAe,CAACxD,GAAGoE,KAAS,OAEjIL,GAAU,IAAIK,EAAI,EAAI,OAAOL,GAAU,IAAIK,EAAI,CAAC,GAAK7B,GAAO,KAAK,sBAAsB6B,EAAI,EAAE,EAAG,EAAE,CAAC,EAAE,QAAQb,EAAc,CAACvD,GAAGqE,KAG/HX,EAAmB,aAAaC,EAASW,EAAaD,EAAQ,CAAC,CAAC,EAAGV,CAAO,EAAIpB,GAAO,IAAIgC,IAAO;AAAA,SAAYA,EAAG;AAAA,CAAI,EAAE,KAAK,EAAE,CAC9H,CACF,CAUA,SAASL,EAAwBP,GAASC,EAAOC,GAAS,KAAMC,GAAS,KAAM,CAC7E,IAAMU,EAAQ,CAAC,EACXX,KAAW,MAAMW,EAAM,KAAKX,EAAM,EACtC,OAAW,CAACZ,GAAK/I,EAAK,IAAKyJ,GAASa,EAAM,KAAK,WAAWvB,EAAG,IAAI,OAAO/I,EAAK,CAAC,EAAE,EAChF,OAAAsK,EAAM,KAAKZ,CAAK,EACZE,KAAW,MAAMU,EAAM,KAAKV,EAAM,EAC/BU,EAAM,KAAK;AAAA,CAAI,CACxB,CAQA,SAASR,EAAkBL,GAAS,CAClCtB,EAAiB,EAAE,OAAOD,EAAwB,EAAE,cAAc,CAAC,EACnE,IAAMqC,EAAwD,IAAI,IAC5DC,GAAkB,OAAO,OAAO,OAAO,OAAO,IAAI,EAAGxB,EAAgBC,EAAkBd,EAAiB,EAAE,eAAe,EAAGD,EAAwB,EAAE,SAAS,QAAQ,CAAC,EAG9K,QAAWa,MAAOyB,GAEhBD,EAAY,IAAIxB,GAAKyB,GAAgBzB,EAAG,CAAC,EAI3C,OAAW,CAACA,GAAK/I,CAAK,IAAKyJ,GAASc,EAAY,IAAIxB,GAAK/I,CAAK,EAG9D,OAAOuK,CACT,CAOA,SAASH,EAAaD,GAAU,CAC9B,GAAI,OAAOA,EAAQ,EAAE,MAAM,wBAAwB,EAAG,OAAO3K,EAAoB,IAAI,EAAE,KAAO2K,EAAQ,EACtG,MAAM,IAAI9B,EAA8B,GAAG,yCAAyC8B,EAAQ,GAAG,CACjG,CAQA,SAASF,EAAYQ,GAAMhB,EAAS,CAYlC,IAAM1C,GAAK2D,EAAO,KAAKjB,CAAO,EACxBtH,GAAIoH,EAAY,OACtB,QAAS9D,EAAI,EAAGA,EAAItD,GAAGsD,IAAKgF,GAAOA,GAAK,QAAQlB,EAAY9D,CAAC,EAAGsB,EAAE,EAClE,OAAO0D,EACT,CAcA,SAASC,EAAOC,GAAOC,EAAMnH,GAASG,GAAOiH,EAAKhH,GAAKiH,GAAMC,GAAU,CACrE,IAAMtB,GAAoD,KAGpDuB,GAAW,OAAO,SAAS,CAACpH,EAAK,GAAK6F,GAAQ,IAAI7F,EAAK,EACvDqH,GAAS,OAAO,SAAS,CAACpH,EAAG,GAAK4F,GAAQ,IAAI5F,EAAG,EACvD,GAAI,CAACmH,IAAY,CAACC,GAAQ,CACxB,GAAIxB,GAAQ,KAAO,EAAG,MAAM,IAAIpB,EAAuB,GAAG,4CAA4CzE,EAAK,SAASC,EAAG;AAAA;AAAA,EAAe8G,EAAK,EAAE,EAAO,OAAOA,EAC7J,CAGA,IAAIO,GAASzB,GAAQ,IAAI7F,EAAK,EAAI6F,GAAQ,IAAI7F,EAAK,EAAI,SAASA,EAAK,EACjEuH,GAAO1B,GAAQ,IAAI5F,EAAG,EAAI4F,GAAQ,IAAI5F,EAAG,EAAI,SAASA,EAAG,EACzDuH,GAAQN,GAAK,QAAU,EAAI,EAAI,SAASA,EAAI,EAChD3C,EAAiB,EAAE,OAAO+C,IAAUC,IAAQC,GAAQ,CAAC,EAoBrD,IAAIC,GAHaN,GAAS,MAAM,aAAa,IAAM,KAGrB;AAAA,EAA2B;AAAA,EAGzDM,IAAgB,GAAGT,CAAI,IAAInH,EAAO;AAAA,EAGlC0H,IAAQN,GAAO,KAAO,EAAI,EAC1B,QAASpF,GAAIyF,GAAQzF,GAAI0F,GAAM1F,IAAK2F,GAAOC,IAAgB;AAAA,EAAM5H,EAAO,MAAMgC,EAAC;AAAA,EAAMsF,EAAQ;AAAA;AAAA,EAG7F,OAAAM,IAAgB;AAAA,EAITA,EACT,CA0BA,IAAMC,EAAqB,OAAO,OAAO,CACvC,SAAU,aACV,SAAU,YACZ,CAAC,EACKC,EAA8B,OAAO,OAAO,CAChD,SAAU,EAEV,SAAU,CACZ,CAAC,EACKC,GAA+B;AAAA;AAAA;AAAA;AAAA,mBAIlBD,EAA4B,QAAQ,aAAaD,EAAmB,QAAQ;AAAA,mBAC5EC,EAA4B,QAAQ,aAAaD,EAAmB,QAAQ;AAAA;AAAA;AAAA;AAAA,sCAK1EA,EAAmB,QAAQ,6BACnCA,EAAmB,QAAQ;AAAA;AAAA;AAAA,EAElCG,GAAwB,qBACxBC,GAA+B;AAAA;AAAA;AAAA,EAC/BC,GAAiC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAuBjCC,GAAgB,OAAO,EAW7B,MAAMC,EAAkB,CAStB,YAAYC,EAAcC,GAActC,GAASuC,EAAUC,GAAU,CAEnE,GAAIH,IAAiBF,GAAe,MAAM,IAAIvD,EAAkC,GAGhF,KAAK,WAAa,CAAC,GAAG0D,EAAY,EAGlC,KAAK,SAAW,IAAI,IAAItC,EAAO,EAG/B,KAAK,gBAAkBD,EAAmB,aAAa,KAAK,SAAUwC,EAAUL,EAA8B,EAG9G,KAAK,cAAgBnC,EAAmB,aAAa,KAAK,SAAUyC,GAAUT,GAA8BE,EAA4B,EAGxI,KAAK,UAAY,KAAK,oBAAoB,KAAK,gBAAkB;AAAA,EAAO,KAAK,aAAa,EAG1F,KAAK,mBAAmB,KAAK,WAAY,KAAK,SAAS,CACzD,CAMA,IAAI,gBAAiB,CACnB,OAAO,KAAK,eACd,CAMA,IAAI,cAAe,CACjB,OAAO,KAAK,aACd,CAMA,IAAI,YAAa,CACf,OAAOJ,CACT,CAMA,IAAI,sBAAuB,CACzB,OAAOC,CACT,CAOA,IAAI,WAAY,CACd,MAAO,CAAC,EAAE,OAAO,KAAK,UAAU,CAClC,CAMA,IAAI,UAAW,CACb,OAAO,MAAM,KAAK,KAAK,UAAU,KAAK,CAAC,CACzC,CAOA,YAAYrB,EAAM,CAChB,GAAI,CAAC,KAAK,UAAU,IAAIA,CAAI,EAAG,MAAM,IAAI7B,EAAiC,GAAG,mCAAmC6B,CAAI,GAAG,EACvH,OAAO,KAAK,UAAU,IAAIA,CAAI,CAChC,CAOA,gBAAgBA,EAAM,CACpB,GAAI,CAAC,KAAK,SAAS,IAAIA,CAAI,EAAG,MAAM,IAAI7B,EAAiC,GAAG,8CAA8C6B,CAAI,GAAG,EACjI,OAAO,KAAK,SAAS,IAAIA,CAAI,CAC/B,CAQA,oBAAoBgC,EAAoB,CACtC,IAAMC,GAAwBD,EACxBE,GAAQ,gEACRC,EAAuD,IAAI,IAC7D1B,GACJ,MAAQA,GAAQyB,GAAM,KAAKD,EAAqB,KAAO,MAAM,CAC3D,IAAMvB,GAAOD,GAAM,CAAC,EACd2B,GAAQ3B,GAAM,CAAC,EAAE,MAAM,GAAG,EAAE,IAAIT,IAAQA,GAAK,KAAK,CAAC,EAAE,OAAOA,IAAQA,EAAI,EAE9E,QAAWA,MAAQoC,GACjB,GAAIpC,GAAK,SAAS,GAAG,EAAG,CAEtB,GAAI,EAAES,GAAQT,GAAK,MAAM,0BAA0B,GAAI,MAAM,IAAI7B,EAAuB,GAAG,yCAAyC6B,EAAI,iBAAiB,EAGzJ,GAAM,CAACqC,GAAOvI,EAAI,EAAI,CAAC2G,GAAM,CAAC,EAAG,OAAOA,GAAM,CAAC,CAAC,CAAC,EAGjD,QAASlF,GAAI,EAAGA,GAAIzB,GAAMyB,KAAK4G,EAAS,IAAI,GAAGE,EAAK,IAAI9G,EAAC,IAAKmF,EAAI,CACpE,SAEM,CAACyB,EAAS,IAAInC,EAAI,GAAKmC,EAAS,IAAInC,EAAI,IAAMU,GAAMyB,EAAS,IAAInC,GAAMU,EAAI,MAAO,OAAM,IAAIvC,EAAkC,GAAG,4BAA4B6B,EAAI,iBAAiB,CAG5L,CACA,OAAOmC,CACT,CASA,mBAAmBN,EAAcM,GAAU,CACzC,QAAWG,MAAWT,EACpB,GAAI,CAACM,GAAS,IAAIG,EAAO,GACnB,CAACH,GAAS,IAAIG,GAAU,KAAK,EAAG,MAAM,IAAInE,EAAiC,GAAG,aAAamE,EAAO,uCAAuC,CAGnJ,CACF,CAKA,MAAMC,WAAgCZ,EAAkB,CAStD,YAAYC,EAAcC,GAActC,GAASuC,EAAUC,GAAWR,GAAuB,CAC3F,MAAMK,EAAcC,GAActC,GAASuC,EAAUC,EAAQ,EAG7D,KAAK,qBAAuB,OAAOD,CAAQ,EAG3C,KAAK,qBAAuB,OAAOC,EAAQ,CAC7C,CACF,CAKA,MAAMS,UAA8Bb,EAAkB,CASpD,YAAYC,EAAcC,GAActC,GAASkD,EAAYC,GAAa,GAAI,CAE5E,GAAK,OAAOD,CAAU,EAAE,MAAM,0BAA0B,GAAsG,GAAIC,IAAc,IAAM,CAAC,OAAOA,EAAU,EAAE,MAAM,8BAA8B,EAAG,MAAM,IAAIvE,EAA8B,GAAG,kCAAkCuE,EAAU,GAAG,MAAhR,OAAM,IAAIvE,EAA8B,GAAG,oCAAoCsE,CAAU,GAAG,EAGvJ,IAAMX,GAAWxM,EAAoB,IAAI,EAAE,KAAO,OAAOmN,CAAU,CAAC,EAC9DV,GAAWW,IAAc,GAAKpN,EAAoB,IAAI,EAAE,KAAO,OAAOoN,EAAU,CAAC,EAAInB,GAG3F,MAAMK,EAAcC,GAActC,GAASuC,GAAUC,EAAQ,EAG7D,KAAK,YAAc,OAAOU,CAAU,EAGpC,KAAK,YAAc,OAAOC,EAAU,CACtC,CAMA,IAAI,gBAAiB,CAGnB,OAAO,KAAK,WAAW,YAAc,KAAK,YAAa,MAAM,cAAc,CAC7E,CAMA,IAAI,cAAe,CAGjB,OAAO,KAAK,WAAW,aAAe,KAAK,aAAe,GAAK,KAAK,YAAc,gBAAkB,KAAK,aAAc,MAAM,YAAY,CAC3I,CAQA,WAAWC,EAAQC,GAAK,CACtB3E,EAAiB,EAAE,OAAO0E,EAAO,WAAW,IAAI,GAAK,CAACA,EAAO,SAAS;AAAA,CAAI,CAAC,EAC3E,IAAM/H,GAAIgI,GAAI,QAAQ;AAAA,CAAI,EACpBC,EAAmBD,GAAI,OAAO,EAAGhI,EAAC,EAClCkI,GAAOF,GAAI,OAAOhI,EAAC,EACzB,OAAAqD,EAAiB,EAAE,OAAO4E,EAAiB,WAAW,WAAW,CAAC,EACrDA,EAAmB;AAAA,EAAOF,EACzBG,EAChB,CACF,CAMA,MAAMC,CAAyB,CAK7B,YAAYnB,EAAc,CACxB,GAAIA,IAAiBF,GAAe,MAAM,IAAIvD,EAAkC,GAGhF,KAAK,WAAa,CAAC,EAGnB,KAAK,SAAW,IAAI,GACtB,CAQA,iBAAiB6E,EAAM,CAErB,GAAI,KAAK,WAAW,OAAS,EAAG,MAAM,IAAI7E,EAAkC,GAAG,kCAAkC,EAGjH,QAASvD,GAAI,EAAGA,GAAIoI,EAAK,OAAQpI,KAAK,KAAK,WAAW,KAAK,OAAOoI,EAAKpI,EAAC,CAAC,CAAC,EAG1E,OAAO,IACT,CAOA,YAAY2E,EAAS,CAEnB,GAAI,KAAK,SAAS,KAAO,EAAG,MAAM,IAAIpB,EAAkC,GAAG,0DAA0D,EAGrI,IAAM8E,GAAO,OAAO,KAAK1D,CAAO,EAChC,QAAWV,MAAOoE,GAAM,CACtB,IAAMnN,EAAQ,OAAOyJ,EAAQV,EAAG,CAAC,EACjC,KAAK,SAAS,IAAIA,GAAK/I,CAAK,CAC9B,CAGA,OAAO,IACT,CAMA,OAAQ,CACN,MAAM,IAAIqI,EAAgC,EAC5C,CACF,CAKA,MAAM+E,WAAuCH,CAAyB,CAOpE,YAAYnB,EAAcE,GAAUC,GAAU,CAC5C,MAAMH,CAAY,EAGlB,KAAK,UAAY,OAAOE,EAAQ,EAGhC,KAAK,UAAYC,KAAa,OAAY,OAAOA,EAAQ,EAAI,MAC/D,CAMA,OAAQ,CACN,OAAO,IAAIQ,GAAwBb,GAAe,KAAK,WAAY,KAAK,SAAU,KAAK,UAAW,KAAK,SAAS,CAClH,CACF,CAKA,MAAMyB,WAAqCJ,CAAyB,CAOlE,YAAYnB,EAAca,GAAYC,GAAY,CAChD,MAAMd,CAAY,EAGlB,KAAK,YAAc,OAAOa,EAAU,EAGpC,KAAK,YAAcC,KAAe,OAAY,OAAOA,EAAU,EAAI,MACrE,CAMA,OAAQ,CACN,OAAO,IAAIF,EAAsBd,GAAe,KAAK,WAAY,KAAK,SAAU,KAAK,YAAa,KAAK,WAAW,CACpH,CACF,CAQA,SAAS3D,GAAaqF,GAAUC,EAAa,OAAW,CACtD,OAAO,IAAIF,GAA6BzB,GAAe0B,GAAUC,CAAU,CAC7E,CAQA,SAASvF,GAAawF,GAAQC,EAAW,OAAW,CAClD,OAAO,IAAIL,GAA+BxB,GAAe4B,GAAQC,CAAQ,CAC3E,CAEM,EAEA,KACC,CAACnO,EAAyBC,EAAqBC,IAAwB,CAE9E,aACAA,EAAoB,EAAED,CAAmB,EACpBC,EAAoB,EAAED,EAAqB,CACzC,OAAQ,IAAqBmO,EAC7B,MAAO,IAAqBC,EAC5B,MAAO,IAAqBC,CAC9B,CAAC,EACD,IAAIC,EAAmDrO,EAAoB,IAAI,EAC3EY,EAA4CZ,EAAoB,IAAI,EACpEa,EAA6Cb,EAAoB,IAAI,EAgC9F,SAASkO,EAAOI,EAAQC,EAAwB,EAAK,CACnD,IAAMC,EAAW,IAAI,aAAaF,EAAO,IAAIlI,GAAK,CAACA,EAAI,CAACmI,CAAqB,CAAC,EACxEE,EAAQ,KAAK,KAAKD,EAAS,MAAM,EAAI,EACrCE,EAAID,GAAS,EAGnB,GAAIA,EAAQ,GAAKA,EAAQ,GAAK,EAAG,MAAM,IAAI5N,EAAuE,GAAG,2DAA2D4N,CAAK,EAAE,EAAO,GAAIA,EAAQA,GAASD,EAAS,OAAQ,MAAM,IAAI3N,EAAuE,GAAG,oCAAoC2N,EAAS,MAAM,8BAA8B,EAGzY,IAAMG,EAAgBD,GAAK,EAAI,qBAAuB,oBAShDV,EAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WANczG,GAAM3G,EAAuD,EAAE,UAAUA,EAAuD,EAAE,eAAe8N,CAAC,EAAG9N,EAAuD,EAAE,eAAe8N,CAAC,CAAC,EAAE,IAAIE,GAAOrH,EAAGiH,GAAUI,EAAI,CAAC,EAAIF,GAAKD,GAASG,EAAI,CAAC,EAAIF,EAAE,EAAGE,EAAI,CAAC,EAAGA,EAAI,CAAC,CAAC,CAAC,EAAE,KAAK;AAAA,CAAI,GAChU,CAACC,EAAGC,EAAIC,IAAO;AAAA,oBAClBJ,CAAa,iBAAiB,CAACI,EAAK,CAAC,KAAK,CAACD,EAAK,CAAC,cAAc,CAACD,CAAC;AAAA,KAY1C,CAAC;AAAA;AAAA;AAAA;AAAA,MAO1C,SAAUR,EAAqE,IAAIL,CAAM,EAAE,cAAc,OAAO,CAClH,CAQA,SAASG,EAAMG,EAAQC,EAAwB,EAAK,CAClD,OAAOS,EAAO,IAAKV,EAAQC,CAAqB,CAClD,CAQA,SAASH,EAAME,EAAQC,EAAwB,EAAK,CAClD,OAAOS,EAAO,IAAKV,EAAQC,CAAqB,CAClD,CASA,SAASS,EAAOC,EAAMX,EAAQC,EAAwB,EAAK,CACzD,IAAMC,EAAW,IAAI,aAAaF,EAAO,IAAIlI,GAAK,CAACA,EAAI,CAACmI,CAAqB,CAAC,EACxEE,EAAQD,EAAS,OACjBE,EAAID,GAAS,EAGnB,GAAIA,EAAQ,GAAKA,EAAQ,GAAK,EAAG,MAAM,IAAI5N,EAAuE,GAAG,2DAA2D4N,CAAK,EAAE,EAAO,GAAIQ,GAAQ,KAAOA,GAAQ,IAAK,MAAM,IAAIpO,EAAuE,GAAG,+CAA+CoO,CAAI,GAAG,EAGxW,IAAMN,EAAgBD,GAAK,EAAI,qBAAuB,oBAWhDV,EAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WARczG,GAAM3G,EAAuD,EAAE,eAAe8N,CAAC,EAAE,OAAO,CAACQ,EAAKN,IAAQM,EAAM3H,EAAGiH,EAASI,EAAMF,CAAC,EAAGE,CAAG,EAAG,EAAE,GAClJ,CAACC,EAAG5I,IAAMgJ,GAAQ,IAAM;AAAA,mBAC5BN,CAAa,iBAAiB,CAAC1I,EAAI,CAAC,iBAAiB,CAAC4I,CAAC;AAAA,MAClE;AAAA,mBACWF,CAAa,oBAAoB,CAAC1I,EAAI,CAAC,cAAc,CAAC4I,CAAC;AAAA,KAY/B,CAAC;AAAA;AAAA;AAAA;AAAA,MAO1C,SAAUR,EAAqE,IAAIL,CAAM,EAAE,cAAc,OAAO,CAClH,CAEM,EAEA,KACC,CAAClO,EAAyBC,EAAqBC,IAAwB,CAE9E,aACqBA,EAAoB,EAAED,EAAqB,CACzC,EAAG,IAAqBoP,CAC1B,CAAC,EACD,IAAIC,EAA4CpP,EAAoB,IAAI,EACpEqP,EAA8CrP,EAAoB,IAAI,EACtEsP,EAAiDtP,EAAoB,IAAI,EACzEuP,EAAoDvP,EAAoB,IAAI,EAC5EK,EAA6CL,EAAoB,IAAI,EA+B9F,IAAMwP,EAAgB,OAAO,EACvBC,EAA2B,UAa3BC,EAAe,GACnBC,EAAgB,GAGdC,EAAW,KAGXC,EAAkBJ,EAKtB,MAAMN,UAAiBG,EAAiE,CAAE,CAMxF,YAAY/F,EAAK,CACf6F,EAAuD,EAAE,OAAO7F,IAAQiG,CAAa,EACrF,MAAM,EAGN,KAAK,2BAA6B,GAGlC,KAAK,QAAU,KAAK,cAAc,KAAK,cAAc,KAAK,IAAI,CAAC,EAG/D,KAAK,IAAM,KAAK,eAAe,KAAK,OAAO,EAG3C,KAAK,QAAU,GAGf,KAAK,UAAY,GAGjB,KAAK,gBAAgB,EAGjBH,EAA4D,EAAE,UAAY,cAAc,KAAK,eAAe,CAClH,CAMA,WAAW,UAAW,CACpB,OAAOO,IAAaA,EAAW,IAAIT,EAASK,CAAa,EAC3D,CAOA,IAAI,IAAK,CACP,OAAO,KAAK,GACd,CAMA,IAAI,QAAS,CACX,OAAO,KAAK,OACd,CAMA,IAAI,UAAW,CACb,OAAO,KAAK,SACd,CAMA,IAAI,QAAS,CACX,OAAO,KAAK,OACd,CAOA,cAAcM,EAAc,CAC1B,IAAMC,EAASX,EAAuD,EAAE,aAAaM,EAAcC,CAAa,EAChH,OAAAI,EAAO,iBAAiB,mBAAoBC,GAAM,CAChDZ,EAAuD,EAAE,QAAQ,qBAAqB,EACtF,WAAWU,EAAc,CAAC,EAC1BE,EAAG,eAAe,CACpB,EAAG,EAAK,EAODD,CACT,CAOA,eAAeA,EAAQ,CAIrB,GAHAX,EAAuD,EAAE,IAAI,cAAcS,CAAe,8BAA8B,EAGpH,OAAO,uBAA2B,IAAa,MAAM,IAAIxP,EAAoE,GAAG,8DAA8D,EAClM,IAAM4P,EAAKF,EAAO,WAAW,SAAU,CACrC,mBAAoB,GACpB,sBAAuB,GACvB,gBAAiBF,EACjB,MAAO,GAEP,UAAW,GACX,MAAO,GACP,QAAS,GACT,eAAgB,EAClB,CAAC,EACD,GAAI,CAACI,EAAI,MAAM,IAAI5P,EAAoE,GAAG,mEAAmE,EAC7J,OAAO4P,CACT,CAKA,eAAgB,CAET,KAAK,6BAGVb,EAAuD,EAAE,QAAQ,0BAA0B,EAG3F,KAAK,QAAQ,OAAO,EACpB,KAAK,QAAU,KAAK,cAAc,KAAK,cAAc,KAAK,IAAI,CAAC,EAG/D,KAAK,IAAM,KAAK,eAAe,KAAK,OAAO,EAG3C,KAAK,gBAAgB,EAIrB,KAAK,QAAQ,EACf,CAKA,iBAAkB,CAIhB,IAAMa,EAAK,KAAK,IACZC,EAAY,KACZ,UAAU,UAAU,SAAS,SAAS,GACxC,KAAK,QAAU,GACf,KAAK,UAAYD,EAAG,aAAaA,EAAG,QAAQ,IAC1BC,EAAYD,EAAG,aAAa,2BAA2B,IAAhE,MACT,KAAK,QAAUA,EAAG,aAAaC,EAAU,qBAAqB,EAC9D,KAAK,UAAYD,EAAG,aAAaC,EAAU,uBAAuB,IAElE,KAAK,QAAU,GACf,KAAK,UAAY,GAErB,CAKA,gBAAiB,CACfd,EAAuD,EAAE,IAAI,aAAeA,EAAuD,EAAE,eAAe,CAAC,EACrJA,EAAuD,EAAE,IAAI,cAAgB,KAAK,MAAM,EACxFA,EAAuD,EAAE,IAAI,gBAAkB,KAAK,QAAQ,CAC9F,CAOA,aAAc,CACZ,IAAMa,EAAK,KAAK,IAGVE,EAAMF,EAAG,aAAa,oBAAoB,EAChD,GAAI,CAACE,EAAK,MAAM,IAAI9P,EAAoE,GAAG,6CAA6C,EAGxI,OAAI4P,EAAG,cAAc,IAGrB,KAAK,2BAA6B,GAGlCE,EAAI,YAAY,GAGTA,CACT,CAOA,sBAAsBC,EAAmB,EAAG,CAC1C,IAAMC,EAAK,KAAK,IAAID,EAAkB,CAAC,EAAI,IACrCD,EAAM,KAAK,YAAY,EAC7B,OAAO,IAAIZ,EAAuE,EAAElM,GAAW,CAC7F,WAAW,IAAM,CAEf,KAAK,2BAA6B,GAClC,KAAK,cAAc,EACnB,WAAW,IAAMA,EAAQ8M,CAAG,EAAG,CAAC,CAClC,EAAGE,CAAE,CACP,CAAC,CACH,CAMA,WAAW,iBAAkB,CAC3B,OAAOR,CACT,CAMA,WAAW,gBAAgBrP,EAAO,CAEhC,GAAI,EAAEA,IAAU,WAAaA,IAAU,aAAeA,IAAU,oBAAqB,MAAM,IAAIH,EAAuE,GAAG,6BAA6BG,CAAK,GAAG,GAG1MoP,GAAY,MAAQC,IAAoBrP,KAC1CqP,EAAkBrP,EAGIoP,GAAS,sBAAsB,EAEzD,CAMA,OAAO,eAAgB,CACrB,OAAOA,GAAY,IACrB,CACF,CAEM,EAEA,KACC,CAAC9P,EAAyBC,EAAqBC,IAAwB,CAE9E,aACqBA,EAAoB,EAAED,EAAqB,CACzC,GAAI,IAAqBuQ,EACzB,GAAI,IAAqBC,EACzB,GAAI,IAAqBC,EACzB,GAAI,IAAqBC,EACzB,GAAI,IAAqBC,EACzB,GAAI,IAAqBC,EACzB,GAAI,IAAqBC,EACzB,GAAI,IAAqBC,EACzB,EAAG,IAAqBC,EACxB,GAAI,IAAqBC,EACzB,GAAI,IAAqBC,EACzB,GAAI,IAAqBC,EACzB,GAAI,IAAqBC,EACzB,GAAI,IAAqBC,CAC3B,CAAC,EA4BtB,MAAMA,UAAoB,KAAM,CAM9B,YAAYC,EAASC,EAAQ,KAAM,CACjC,MAAM,CAACD,EAASC,EAAQA,EAAM,SAAS,EAAI,oBAAoB,EAAE,KAAK;AAAA,IAAO,CAAC,EAG9E,KAAK,OAASA,CAChB,CAMA,IAAI,MAAO,CACT,OAAO,KAAK,YAAY,IAC1B,CAMA,IAAI,KAAK/K,EAAG,CAEZ,CAOA,IAAI,OAAQ,CACV,OAAO,KAAK,MACd,CACF,CAMA,MAAMgK,UAA0Ba,CAAY,CAM1C,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,0BAA0BD,CAAO,GAAIC,CAAK,CAClD,CACF,CAMA,MAAMC,UAA4BH,CAAY,CAM5C,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,2BAA2BD,CAAO,GAAIC,CAAK,CACnD,CACF,CAKA,MAAMH,UAAgBC,CAAY,CAMhC,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,gBAAgBD,CAAO,GAAIC,CAAK,CACxC,CAOA,OAAO,KAAKpB,EAAI,CACd,IAAMsB,EAAmB,CAAC,WAAY,eAAgB,gBAAiB,oBAAqB,gCAAiC,gBAAiB,oBAAoB,EAC5JC,EAAUvB,EAAG,SAAS,EACtBmB,EAAUG,EAAiB,KAAKE,GAASxB,EAAGwB,CAAK,GAAKD,CAAO,GAAK,UACxE,OAAO,IAAIN,EAAQE,CAAO,CAC5B,CACF,CAMA,MAAMR,UAA4BO,CAAY,CAM5C,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,+BAA+BD,CAAO,GAAIC,CAAK,CACvD,CACF,CAMA,MAAMJ,UAA6BE,CAAY,CAM7C,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,qBAAqBD,CAAO,GAAIC,CAAK,CAC7C,CACF,CAOA,MAAMd,UAA8BY,CAAY,CAM9C,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,sBAAsBD,CAAO,GAAIC,CAAK,CAC9C,CACF,CAKA,MAAMP,UAAyBK,CAAY,CAMzC,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,kBAAkBD,CAAO,GAAIC,CAAK,CAC1C,CACF,CAKA,MAAMR,UAA0BM,CAAY,CAM1C,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,mBAAmBD,CAAO,GAAIC,CAAK,CAC3C,CACF,CAKA,MAAMb,UAA+BW,CAAY,CAM/C,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,wBAAwBD,CAAO,GAAIC,CAAK,CAChD,CACF,CAKA,MAAMZ,UAAqBU,CAAY,CAMrC,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,kBAAkBD,CAAO,GAAIC,CAAK,CAC1C,CACF,CAKA,MAAMN,UAAmBI,CAAY,CAMnC,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,gBAAgBD,CAAO,GAAIC,CAAK,CACxC,CACF,CAKA,MAAML,UAAuBG,CAAY,CAMvC,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,qBAAqBD,CAAO,GAAIC,CAAK,CAC7C,CACF,CAKA,MAAMV,UAA0BQ,CAAY,CAM1C,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,kBAAkBD,CAAO,GAAIC,CAAK,CAC1C,CACF,CAKA,MAAMX,UAAyBS,CAAY,CAMzC,YAAYC,EAAU,GAAIC,EAAQ,KAAM,CACtC,MAAM,sBAAsBD,CAAO,GAAIC,CAAK,CAC9C,CACF,CAEM,EAEA,KACC,CAACvR,EAAyBC,EAAqBC,IAAwB,CAE9E,aACAA,EAAoB,EAAED,CAAmB,EACpBC,EAAoB,EAAED,EAAqB,CACzC,yBAA0B,IAAqB2R,EAC/C,SAAU,IAAqBC,EAC/B,eAAgB,IAAqBC,EACrC,cAAe,IAAqBC,EACpC,yBAA0B,IAAqBC,EAC/C,uBAAwB,IAAqBC,EAC7C,iBAAkB,IAAqBC,EACvC,iBAAkB,IAAqBC,EACvC,mBAAoB,IAAqBC,EACzC,gBAAiB,IAAqBC,EACtC,oBAAqB,IAAqBC,EAC1C,qBAAsB,IAAqBC,EAC3C,mBAAoB,IAAqBC,EACzC,mBAAoB,IAAqBC,EACzC,kBAAmB,IAAqBC,EACxC,mBAAoB,IAAqBC,EACzC,kBAAmB,IAAqBC,CAC1C,CAAC,EA2BtB,IAAMD,EAAqB,EAGrBV,EAAyB,EAGzBW,EAAoB,GAAKX,EAOzBJ,EAAW,EAGXC,EAAiB,GAAKD,EAOtBW,GAAsB,GAAK,GAAKX,GAAY,EAO5Ca,EAAoB,EAGpBD,EAAqB,EAGrBF,EAAuB,KAGvBX,EAA2B,KAG3BI,EAA2B,EAG3BM,EAAsB,GAAKN,EAG3BE,EAAmB,IAAMF,EAA2B,GAGpDG,GAAoB,GAAKD,GAAoB,EAG7CG,GAAmB,GAAKH,GAAoB,EAG5CE,GAAsB,GAAK,GAAKF,GAAoB,EAOpDH,EAAgB,UAAY,CAChC,OAAkB,IAAI,YAAY,IAAI,WAAW,CAAC,IAAM,GAAI,CAAC,EAAE,MAAM,EAAE,CAAC,IAAjE,KACT,EAAE,CAEI,EAEA,KACC,CAAC/R,EAAyBC,EAAqBC,IAAwB,CAE9E,aACqBA,EAAoB,EAAED,EAAqB,CACzC,EAAG,IAAqB4S,CAC1B,CAAC,EA0BtB,MAAMA,CAAW,CAIf,aAAc,CAEZ,KAAK,aAAe,CAAC,EAGrB,KAAK,SAAW,CAAC,EAGjB,KAAK,MAAQ,CAAC,CAChB,CAQA,UAAUpL,EAAIqL,KAAYlF,EAAM,CAC9B,KAAK,aAAa,KAAKnG,CAAE,EACzB,KAAK,SAAS,KAAKqL,CAAO,EAC1B,KAAK,MAAM,KAAKlF,CAAI,CACtB,CAOA,YAAYnG,EAAIqL,EAAS,CACvB,QAAStN,EAAI,KAAK,aAAa,OAAS,EAAGA,GAAK,EAAGA,IACjD,GAAI,KAAK,aAAaA,CAAC,IAAMiC,GAAM,KAAK,SAASjC,CAAC,IAAMsN,EAAS,CAC/D,KAAK,aAAa,OAAOtN,EAAG,CAAC,EAC7B,KAAK,SAAS,OAAOA,EAAG,CAAC,EACzB,KAAK,MAAM,OAAOA,EAAG,CAAC,EACtB,KACF,CAEJ,CAMA,SAAU,CACR,QAASW,EAAI,EAAGA,EAAI,KAAK,aAAa,OAAQA,IAAK,KAAK,aAAaA,CAAC,EAAE,MAAM,KAAK,SAASA,CAAC,EAAG,KAAK,MAAMA,CAAC,CAAC,CAC/G,CACF,CAEM,EAEA,KACC,CAACnG,EAAyBC,EAAqBC,IAAwB,CAE9E,aACqBA,EAAoB,EAAED,EAAqB,CACzC,GAAI,IAAqB8S,EACzB,GAAI,IAAqBC,EACzB,GAAI,IAAqBC,EACzB,GAAI,IAAqBC,CAC3B,CAAC,EA0BtB,IAAMA,EAAY,OAAO,OAAO,CAC9B,MAAO,OAAO,OAAO,EACrB,MAAO,OAAO,OAAO,EACrB,OAAQ,OAAO,QAAQ,EACvB,gBAAiB,OAAO,iBAAiB,EACzC,OAAQ,OAAO,QAAQ,EACvB,KAAM,OAAO,MAAM,CACrB,CAAC,EAMKH,EAAc,OAAO,OAAO,CAChC,KAAM,OAAO,MAAM,EACnB,KAAM,OAAO,MAAM,CACrB,CAAC,EAMKC,EAAiB,OAAO,OAAO,CACnC,IAAK,EACL,MAAO,EACP,KAAM,EACN,MAAO,EACP,IAAK,EACP,CAAC,EAKKC,EAAmB,OAAO,OAAO,CACrC,CAACD,EAAe,GAAG,EAAG,EACtB,CAACA,EAAe,KAAK,EAAG,EACxB,CAACA,EAAe,IAAI,EAAG,EACvB,CAACA,EAAe,KAAK,EAAG,CAC1B,CAAC,CAEK,EAEA,KACC,CAAChT,EAAyBC,EAAqBC,IAAwB,CAE9E,aACqBA,EAAoB,EAAED,EAAqB,CACzC,EAAG,IAAqBkT,CAC1B,CAAC,EACD,IAAIC,EAAuClT,EAAoB,IAAI,EAC/DmT,EAAoDnT,EAAoB,IAAI,EAC5EoT,EAA8CpT,EAAoB,IAAI,EA6B/F,MAAMiT,CAAM,CAMV,OAAO,QAAQI,KAAS3F,EAAM,CAExB0F,EAA4D,EAAE,UAAY,QAAQ,QAAQ,KAAK,mBAAqBC,EAAM,GAAG3F,CAAI,CACvI,CAOA,OAAO,IAAI2F,KAAS3F,EAAM,CACpB0F,EAA4D,EAAE,UAAY,QAAQ,QAAQ,IAAI,mBAAqBC,EAAM,GAAG3F,CAAI,CACtI,CAQA,OAAO,OAAOxM,EAAMmS,EAAO,GAAI,CAC7B,GAAI,CAACnS,EAAM,MAAM,IAAIgS,EAA2D,GAAGG,CAAI,CACzF,CAOA,OAAO,kBAAkBC,EAAK,CAC5B,IAAMrI,EAAOqI,EAAI,SAAS,EACpB1G,EAAQ3B,EAAK,WAAW,UAAU,EAAI,6BAA+BA,EAAK,WAAW,GAAG,EAAI,oBAAsB,cAClHE,EAAQ,IAAI,OAAOyB,CAAK,EAAE,KAAK3B,CAAI,EACzC,GAAIE,IAAU,KAEZ,OADaA,EAAM,CAAC,EAAE,QAAQ,eAAgB,EAAE,EACpC,MAAM,GAAG,EAAE,IAAI6B,GAAWA,EAAQ,QAAQ,OAAQ,EAAE,EAAE,KAAK,CACvE,EAAE,OAAOA,GAAWA,CACpB,EACK,MAAM,IAAIkG,EAAuD,GAAG,sCAAsCjI,CAAI,EAAE,CACzH,CAQA,OAAO,0BAA0B1H,EAAK,CACpC,GAAIA,EAAK,CACP,IAAMgQ,EAAQ,OAAO,eAAehQ,CAAG,EACvC,OAAO,OAAO,OAAO,OAAO,OAAO,CAAC,EAAG0P,EAAM,0BAA0BM,CAAK,CAAC,EAAG,OAAO,0BAA0BhQ,CAAG,CAAC,CACvH,KAAO,QAAO,OAAO,OAAO,IAAI,CAClC,CAQA,OAAO,aAAaiQ,EAAOC,EAAQ,CACjC,IAAM1D,EAAS,SAAS,cAAc,QAAQ,EAC9C,OAAAA,EAAO,MAAQyD,EACfzD,EAAO,OAAS0D,EACT1D,CACT,CAUA,OAAO,eAAe2D,EAAOC,EAAa,EAAGC,EAAa,GAAM,CAwB9D,GAPID,GAAc,IAChBA,EAAa,KAAK,KAAK,EAAMD,CAAK,EAAI,EACtCC,GAAc,EAAIA,EAAa,GAIjCA,GAAc,EACVA,EAAa,GAAKA,EAAa,GAAK,EAAG,MAAM,IAAIT,EAAiE,GAAG,gDAAgDS,CAAU,MAAM,EAAO,GAAID,GAAS,EAAK,MAAM,IAAIR,EAAiE,GAAG,0CAA0CQ,CAAK,EAAE,EAIjV,IAAMpF,EAAS,IAAI,MAAMqF,CAAU,EAG7BjF,EAAIiF,GAAc,EAClBE,EAAI,CAACH,EAAQ,mBACbhR,EAAI,SACJoR,EAAK,WACLC,EAAK,YACLC,EAAK,YACLC,EAAK,aACLC,EAAK,YAGPC,EAAM,EACV,QAAS7O,EAAI,EAAGA,EAAIqO,EAAYrO,IAAK,CACnC,IAAI8O,GAAM9O,EAAIoJ,EAAI,IAAOmF,EACrBQ,GAAM/O,EAAIoJ,EAAI,IAAOmF,EACrBS,EAAK,EACPC,EAAK,EACHH,EAAK,IACPE,EAAK,GACLF,EAAK,CAACA,GAEJC,EAAK,IACPE,EAAK,GACLF,EAAK,CAACA,GAER,IAAMG,GAAK,GAAO,EAAM9R,EAAI0R,GACtBK,GAAK,GAAO,EAAM/R,EAAI2R,GACtBK,OAASR,EAAKM,GAAKP,GAAMO,GAAKR,GAAMQ,GAAKT,GAAMS,GAAKV,GAAMU,GAC1DG,OAAST,EAAKO,GAAKR,GAAMQ,GAAKT,GAAMS,GAAKV,GAAMU,GAAKX,GAAMW,GAC1DG,GAAK,EAAMF,GAAK,KAAK,IAAI,CAACN,EAAKA,CAAE,EACjCS,GAAK,EAAMF,GAAK,KAAK,IAAI,CAACN,EAAKA,CAAE,EACjCS,GAAOR,EAAKM,GACZG,EAAOR,EAAKM,GACZG,GAAMF,GAAOC,IAAS,EAAMlB,GAClCvF,EAAOhJ,CAAC,EAAI0P,EACZb,GAAOa,CACT,CAGA,GAAIpB,EACF,QAAStO,EAAI,EAAGA,EAAIqO,EAAYrO,IAAKgJ,EAAOhJ,CAAC,GAAK6O,EAIpD,OAAO7F,CACT,CAQA,OAAO,SAAS2G,EAAIC,EAAKD,EAAI,CAC3B,IAAME,EAAQF,EAAG,OACjBhC,EAAM,OAAOgC,EAAG,QAAUA,EAAG,MAAM,EACnChC,EAAM,OAAOkC,GAAS,GAAKA,EAAQ,GAAK,CAAC,EAGzC,IAAIC,EAAW,IAAI,MAAMD,EAAQA,CAAK,EACpCtG,EAAI,EACN,QAASwG,EAAM,EAAGA,EAAMF,EAAOE,IAC7B,QAAStP,EAAM,EAAGA,EAAMoP,EAAOpP,IAAOqP,EAASvG,GAAG,EAAIoG,EAAGlP,CAAG,EAAImP,EAAGG,CAAG,EAExE,OAAOD,CACT,CAQA,OAAO,UAAUE,EAAGC,EAAG,CACrB,MAAO,CAAC,EAAE,OAAO,GAAGD,EAAE,IAAIA,GAAKC,EAAE,IAAIA,GAAK,CAACD,EAAGC,CAAC,CAAC,CAAC,CAAC,CACpD,CAOA,OAAO,eAAe5S,EAAG,CACvB,IAAKA,GAAK,GAAK,EAAG,MAAM,IAAIuQ,EAAiE,GAAG,0CAA0C,EAC1I,MAAO,CAAC,GAAG,MAAM,EAAIvQ,EAAI,CAAC,EAAE,KAAK,CAAC,EAAE,IAAIyD,GAAKA,EAAIzD,CAAC,CACpD,CAOA,OAAO,MAAMA,EAAG,CACd,IAAKA,GAAK,IAAM,EAAG,MAAM,IAAIuQ,EAAiE,GAAG,sCAAsC,EACvI,MAAO,CAAC,GAAG,MAAMvQ,CAAC,EAAE,KAAK,CAAC,CAC5B,CAQA,OAAO,QAAQ6S,EAAK,CAClB,IAAMC,EAAMD,EAAI,OACV,EAAIC,EAAM,EAGhB,QAASxP,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,IAAMX,EAAIW,GAAK,KAAK,OAAO,GAAKwP,EAAMxP,GAAK,GAE3C,GAAIA,IAAMX,EAAG,CACX,IAAM0D,EAAIwM,EAAIvP,CAAC,EACfuP,EAAIvP,CAAC,EAAIuP,EAAIlQ,CAAC,EACdkQ,EAAIlQ,CAAC,EAAI0D,CACX,CACF,CACA,OAAOwM,CACT,CAQA,OAAO,QAAQzI,EAAO,CAIpB,IAAM2I,EAAO,CAAC,EACd,QAASzP,EAAI,EAAGtD,EAAIoK,EAAM,OAAQ9G,EAAItD,EAAGsD,IAAK,CAC5C,IAAM0P,EAAQ5I,EAAM9G,CAAC,EACrB,GAAI,MAAM,QAAQ0P,CAAK,EACrB,QAASrQ,EAAI,EAAG5C,EAAIiT,EAAM,OAAQrQ,EAAI5C,EAAG4C,IAAKoQ,EAAK,KAAKC,EAAMrQ,CAAC,CAAC,OAC3DoQ,EAAK,KAAKC,CAAK,CACxB,CACA,OAAOD,CACT,CAQA,OAAO,cAAcE,EAAQ,CAI3B,IAAMC,GAAKD,EAAS,QAAW,GACzBxN,GAAKwN,EAAS,QAAW,GACzBlT,EAAIkT,EAAS,KACbE,EAAO,EAAI,EAAID,EAErB,GAAIzN,GAAK,EAAG,OAAO1F,GAAK,EAAIoT,EAAO,EAAMA,EAAOpT,EAAI,qBAC/C,GAAI0F,GAAK,GAAI,OAAO1F,GAAK,EAAIoT,EAAO,OAAO,kBAAoB,OAAO,IAC3E,IAAM7O,EAAImB,GAAK,GAAK,GAAKA,EAAI,GAAK,GAAO,GAAK,GAAKA,GACnD,OAAO0N,EAAO7O,GAAK,EAAMvE,EAAI,YAC/B,CAOA,OAAO,oBAAoBqT,EAAc,CACvC,MAAO,GACP,MAAO,EACT,EAAG,CAED,GADA9C,EAAM,IAAI,yBAAyB,EAC/B,CAAC,UAAU,cAAgB,CAAC,UAAU,aAAa,aAAc,MAAM,IAAIC,EAA8D,GAAG,qDAAqD,EACrM,OAAO,IAAIC,EAAuE,EAAE,CAAC9P,EAASC,IAAW,CACvG,UAAU,aAAa,aAAayS,CAAW,EAAE,KAAKC,GAAU,CAC9D,IAAMC,EAAQ,SAAS,cAAc,OAAO,EAC5CA,EAAM,iBAAmB,IAAM,CAC7BA,EAAM,KAAK,EACXhD,EAAM,IAAI,iCAAiCgD,EAAM,UAAU,MAAMA,EAAM,WAAW,EAAE,EACpF5S,EAAQ4S,CAAK,CACf,EACAA,EAAM,aAAa,cAAe,EAAE,EACpCA,EAAM,aAAa,WAAY,EAAE,GAC7BF,EAAY,QAAU,IAASA,EAAY,QAAU,SAAWE,EAAM,aAAa,QAAS,EAAE,EAClGA,EAAM,UAAYD,CACpB,CAAC,EAAE,MAAMlR,GAAO,CACVA,EAAI,OAAS,kBACfxB,EAAO,IAAI4P,EAA8D,GAAG,wDAAyDpO,CAAG,CAAC,EAChIA,EAAI,OAAS,wBAA0BA,EAAI,OAAS,gBAC7DxB,EAAO,IAAI4P,EAA8D,GAAG,2DAA2D,KAAK,UAAU6C,CAAW,CAAC,IAAKjR,CAAG,CAAC,EAE3KxB,EAAO,IAAI4P,EAAwD,GAAG,2BAA4BpO,CAAG,CAAC,CAE1G,CAAC,CACH,CAAC,CACH,CAOA,OAAO,iBAAiBD,EAAO,CAC7B,IAAMqR,EAAQ,IAAI,WAAWrR,CAAK,EAElC,OADc,MAAM,KAAKqR,EAAOX,GAAKA,EAAE,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAAC,EACvD,KAAK,GAAG,CACvB,CAMA,OAAO,gBAAiB,CAItB,OAAI,OAAO,UAAU,eAAkB,SAG9B,UAAU,cAAc,SAK1B,UAAU,QACnB,CACF,CAEM,EAEA,KACC,CAAC7V,EAAQyW,EAA0BnW,IAAwB,CAElE,IAAIoW,EAAM,CACT,gBAAiB,KACjB,iBAAkB,KAClB,qBAAsB,KACtB,iBAAkB,KAClB,gBAAiB,KACjB,eAAgB,IAChB,8BAA+B,KAC/B,0BAA2B,KAC3B,mBAAoB,KACpB,cAAe,IACf,kBAAmB,KACnB,kBAAmB,KACnB,kBAAmB,IACpB,EAGA,SAASC,EAAeC,EAAK,CAC5B,IAAIC,EAAKC,EAAsBF,CAAG,EAClC,OAAOtW,EAAoBuW,CAAE,CAC9B,CACA,SAASC,EAAsBF,EAAK,CACnC,GAAG,CAACtW,EAAoB,EAAEoW,EAAKE,CAAG,EAAG,CACpC,IAAIlO,EAAI,IAAI,MAAM,uBAAyBkO,EAAM,GAAG,EACpD,MAAAlO,EAAE,KAAO,mBACHA,CACP,CACA,OAAOgO,EAAIE,CAAG,CACf,CACAD,EAAe,KAAO,UAA8B,CACnD,OAAO,OAAO,KAAKD,CAAG,CACvB,EACAC,EAAe,QAAUG,EACzB9W,EAAO,QAAU2W,EACjBA,EAAe,GAAK,IAEd,EAEA,KACC,CAAC3W,EAAQyW,EAA0BnW,IAAwB,CAElE,IAAIoW,EAAM,CACT,wBAAyB,KACzB,2BAA4B,KAC5B,+BAAgC,KAChC,+BAAgC,KAChC,6BAA8B,KAC9B,6BAA8B,KAC9B,iCAAkC,KAClC,0BAA2B,KAC3B,wBAAyB,KACzB,yBAA0B,KAC1B,6BAA8B,KAC9B,yBAA0B,KAC1B,wBAAyB,KACzB,uBAAwB,IACxB,sCAAuC,KACvC,kCAAmC,KACnC,2BAA4B,KAC5B,sBAAuB,IACvB,0BAA2B,KAC3B,0BAA2B,KAC3B,0BAA2B,KAC3B,wCAAyC,KACzC,kCAAmC,KACnC,oCAAqC,KACrC,0BAA2B,KAC3B,+BAAgC,KAChC,wBAAyB,KACzB,mCAAoC,IACpC,gDAAiD,KACjD,2CAA4C,IAC5C,6CAA8C,KAC9C,8CAA+C,KAC/C,oCAAqC,KACrC,yCAA0C,KAC1C,wBAAyB,KACzB,2BAA4B,KAC5B,2CAA4C,KAC5C,iCAAkC,KAClC,0BAA2B,KAC3B,4BAA6B,KAC7B,gCAAiC,KACjC,6BAA8B,KAC9B,sBAAuB,KACvB,uCAAwC,KACxC,0CAA2C,KAC3C,2BAA4B,KAC5B,iCAAkC,KAClC,gCAAiC,KACjC,gCAAiC,KACjC,sCAAuC,KACvC,kCAAmC,KACnC,mCAAoC,KACpC,gCAAiC,KACjC,iCAAkC,KAClC,2BAA4B,KAC5B,kCAAmC,KACnC,uCAAwC,KACxC,iCAAkC,KAClC,wCAAyC,KACzC,qCAAsC,KACtC,oCAAqC,IACrC,8BAA+B,KAC/B,4BAA6B,KAC7B,iCAAkC,KAClC,2BAA4B,KAC5B,qCAAsC,KACtC,+BAAgC,KAChC,2BAA4B,IAC5B,oBAAqB,KACrB,+BAAgC,KAChC,oBAAqB,KACrB,yBAA0B,KAC1B,6BAA8B,KAC9B,iCAAkC,KAClC,oCAAqC,IACtC,EAGA,SAASC,EAAeC,EAAK,CAC5B,IAAIC,EAAKC,EAAsBF,CAAG,EAClC,OAAOtW,EAAoBuW,CAAE,CAC9B,CACA,SAASC,EAAsBF,EAAK,CACnC,GAAG,CAACtW,EAAoB,EAAEoW,EAAKE,CAAG,EAAG,CACpC,IAAIlO,EAAI,IAAI,MAAM,uBAAyBkO,EAAM,GAAG,EACpD,MAAAlO,EAAE,KAAO,mBACHA,CACP,CACA,OAAOgO,EAAIE,CAAG,CACf,CACAD,EAAe,KAAO,UAA8B,CACnD,OAAO,OAAO,KAAKD,CAAG,CACvB,EACAC,EAAe,QAAUG,EACzB9W,EAAO,QAAU2W,EACjBA,EAAe,GAAK,IAEd,EAEA,KACE3W,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,IACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,IACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,IACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,IACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,IACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,IACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAEX,EAEA,KACEA,GAAW,CAEnBA,EAAO,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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",
  "names": ["require_speedy_vision", "__commonJSMin", "exports", "module", "root", "factory", "__webpack_modules__", "__unused_webpack_module", "__webpack_exports__", "__webpack_require__", "Settings", "_speedy_namespace__WEBPACK_IMPORTED_MODULE_0__", "_gpu_speedy_gl__WEBPACK_IMPORTED_MODULE_1__", "_utils_utils__WEBPACK_IMPORTED_MODULE_2__", "_utils_errors__WEBPACK_IMPORTED_MODULE_3__", "gpuPollingMode", "loggingMode", "value", "mode", "SpeedyMatrixExpr", "_speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_0__", "_utils_utils__WEBPACK_IMPORTED_MODULE_1__", "_utils_errors__WEBPACK_IMPORTED_MODULE_2__", "DTYPE_TO_BUFFER_TYPE", "rows", "columns", "dtype", "expr", "SpeedyMatrixAddExpr", "SpeedyMatrixSubtractExpr", "SpeedyMatrixScaleExpr", "SpeedyMatrixMultiplyExpr", "SpeedyMatrixTransposeExpr", "SpeedyMatrixInvertExpr", "SpeedyMatrixCompMultExpr", "SpeedyMatrixLdivExpr", "wasm", "memory", "SpeedyMatrix", "SpeedyMatrixTempExpr", "SpeedyMatrixUnaryOperationExpr", "operand", "result", "resultptr", "operandptr", "SpeedyMatrixBinaryOperationExpr", "left", "right", "leftptr", "rightptr", "scalar", "m", "n", "SpeedyMatrixWASM", "_speedy_promise__WEBPACK_IMPORTED_MODULE_0__", "_utils_errors__WEBPACK_IMPORTED_MODULE_1__", "_utils_globals__WEBPACK_IMPORTED_MODULE_3__", "WASM_BINARY", "_instance", "_module", "_memory", "mem", "resolve", "reject", "obj", "SpeedyMatrixWASMImports", "property", "imports", "methodName", "matrix", "dataptr", "matptr", "base", "offset", "counter", "CStringUtils", "ptr", "start", "end", "target", "byte", "size", "p", "base64decode", "data", "v", "bytes", "err", "_speedy_matrix_expr__WEBPACK_IMPORTED_MODULE_0__", "_speedy_matrix_wasm__WEBPACK_IMPORTED_MODULE_1__", "_speedy_promise__WEBPACK_IMPORTED_MODULE_2__", "_utils_utils__WEBPACK_IMPORTED_MODULE_3__", "step0", "step1", "entries", "j", "firstRow", "lastRow", "firstColumn", "lastColumn", "begin", "index", "diagsize", "diagstep", "row", "column", "i", "mat", "fix", "x", "fmt", "_", "rstep0", "rstep1", "SpeedyNamespace", "_utils_errors__WEBPACK_IMPORTED_MODULE_0__", "SpeedyPromise", "PENDING", "FULFILLED", "REJECTED", "SUSPEND_ASYNC", "asap", "f", "callback", "onFulfillment", "onRejection", "child", "onFinally", "fn", "val", "my", "promise", "reason", "iterable", "input", "element", "length", "output", "partialResolve", "state", "children", "e", "then", "y", "r", "createShader", "importShader", "speedy_gl", "utils", "types", "errors", "_wrapRegExp", "BabelRegExp", "t", "o", "_setPrototypeOf", "buildGroups", "_inherits", "globals", "numericGlobals", "key", "basicConstants", "platformConstants", "platform", "glRenderer", "commentsRegex", "includeRegex", "constantRegex", "unrollRegex", "ShaderPreprocessor", "defines", "infix", "prefix", "suffix", "constants", "generateConstants", "annotatedGLSL", "generateUnprocessedGLSL", "unrollLoops", "name", "filename", "readfileSync", "msg", "parts", "myConstants", "globalConstants", "code", "unroll", "match", "type", "cmp", "step", "loopcode", "hasStart", "hasEnd", "istart", "iend", "istep", "unrolledCode", "DEFAULT_ATTRIBUTES", "DEFAULT_ATTRIBUTES_LOCATION", "DEFAULT_VERTEX_SHADER_PREFIX", "DEFAULT_VERTEX_SHADER", "DEFAULT_VERTEX_SHADER_SUFFIX", "DEFAULT_FRAGMENT_SHADER_PREFIX", "PRIVATE_TOKEN", "ShaderDeclaration", "privateToken", "argumentList", "fsSource", "vsSource", "preprocessedSource", "sourceWithoutComments", "regex", "uniforms", "names", "array", "argname", "MemoryShaderDeclaration", "FileShaderDeclaration", "fsFilepath", "vsFilepath", "header", "src", "versionDirective", "body", "ShaderDeclarationBuilder", "args", "keys", "MemoryShaderDeclarationBuilder", "FileShaderDeclarationBuilder", "filepath", "vsfilepath", "source", "vssource", "conv2D", "convX", "convY", "_shader_declaration__WEBPACK_IMPORTED_MODULE_0__", "kernel", "normalizationConstant", "kernel32", "kSize", "N", "pixelAtOffset", "cur", "k", "dy", "dx", "conv1D", "axis", "acc", "SpeedyGL", "_utils_utils__WEBPACK_IMPORTED_MODULE_0__", "_core_settings__WEBPACK_IMPORTED_MODULE_1__", "_utils_observable__WEBPACK_IMPORTED_MODULE_4__", "_core_speedy_promise__WEBPACK_IMPORTED_MODULE_2__", "SINGLETON_KEY", "DEFAULT_POWER_PREFERENCE", "CANVAS_WIDTH", "CANVAS_HEIGHT", "instance", "powerPreference", "reinitialize", "canvas", "ev", "gl", "debugInfo", "ext", "secondsToRestore", "ms", "NotSupportedError", "IllegalOperationError", "ResourceNotLoadedError", "TimeoutError", "WebAssemblyError", "AccessDeniedError", "AbstractMethodError", "FileNotFoundError", "OutOfMemoryError", "ParseError", "AssertionError", "IllegalArgumentError", "GLError", "SpeedyError", "message", "cause", "NotImplementedError", "recognizedErrors", "glError", "error", "DEFAULT_ENCODER_CAPACITY", "FIX_BITS", "FIX_RESOLUTION", "LITTLE_ENDIAN", "LOG2_MAX_DESCRIPTOR_SIZE", "LOG2_PYRAMID_MAX_SCALE", "MATCH_INDEX_BITS", "MATCH_INDEX_MASK", "MATCH_MAX_DISTANCE", "MATCH_MAX_INDEX", "MAX_DESCRIPTOR_SIZE", "MAX_ENCODER_CAPACITY", "MAX_TEXTURE_LENGTH", "MIN_ENCODER_LENGTH", "MIN_KEYPOINT_SIZE", "PYRAMID_MAX_LEVELS", "PYRAMID_MAX_SCALE", "Observable", "thisptr", "ImageFormat", "PixelComponent", "ColorComponentId", "MediaType", "Utils", "_errors__WEBPACK_IMPORTED_MODULE_0__", "_core_speedy_promise__WEBPACK_IMPORTED_MODULE_1__", "_core_settings__WEBPACK_IMPORTED_MODULE_2__", "text", "fun", "proto", "width", "height", "sigma", "kernelSize", "normalized", "c", "a1", "a2", "a3", "a4", "a5", "sum", "xa", "xb", "sa", "sb", "ta", "tb", "pa", "pb", "ya", "yb", "erfa", "erfb", "fp", "ka", "kb", "ksize", "kernel2d", "col", "a", "b", "arr", "len", "flat", "entry", "uint16", "s", "sign", "constraints", "stream", "video", "uint8", "__unused_webpack_exports", "map", "webpackContext", "req", "id", "webpackContextResolve", "__webpack_module_cache__", "moduleId", "cachedModule", "definition", "prop", "Speedy", "settings", "speedy_promise", "callbacks", "ASAP_KEY", "event", "argArray", "params", "utils_errors", "DEFAULT_NUMBER_OF_BUFFERS", "runOnNextFrame", "SpeedyTextureReader", "numberOfBuffers", "gpu", "texture", "fbo", "sizeofBuffer", "useBufferedDownloads", "pixelBuffer", "producerIndex", "pbo", "consumerIndex", "newBuffer", "outputBuffer", "sync", "flags", "pollInterval", "remainingAttempts", "poll", "status", "SpeedyTexture", "format", "internalFormat", "dataType", "filter", "wrap", "mipmap", "numMipmaps", "level", "w", "h", "pixels", "lod", "SpeedyDrawableTexture", "pot", "expectedWidth", "expectedHeight", "g", "textureReader", "shader_declaration", "UNIFORM_SETTERS", "SpeedyProgram", "shaderdecl", "options", "ProgramGeometry", "location", "UniformVariable", "indexedVariable", "argnames", "texSize", "texNo", "uniform", "blockName", "UBOHelper", "vertexShaderSource", "fragmentShaderSource", "program", "vertexShader", "fragmentShader", "spaces", "formattedSource", "line", "no", "setValue", "tex", "ubo", "blockIndex", "variable", "cache", "nameList", "PROGRAM_HELPERS", "SpeedyProgramGroup", "builder", "copy", "copyKeypoints", "copy2DVectors", "flipY", "fill", "fillComponents", "copyComponents", "scanMinMax2D", "sobelDerivatives", "SpeedyProgramGroupUtils", "convolution", "rgb2grey", "filters_convolution", "convolutionX", "convolutionY", "median", "normalizeGreyscale", "normalizeColored", "nightvision", "nightvisionGreyscale", "ksize2sigma", "gaussian", "box", "SpeedyProgramGroupFilters", "speedy_namespace", "DESCRIPTORDB_BYTESPERPIXEL", "DESCRIPTORDB_MAXLOG2STRIDE", "SpeedyDescriptorDB", "descriptors", "descriptorSize", "numberOfDescriptors", "pixelsPerDescriptor", "stride", "capacity", "byteOffset", "descriptor", "MEGABYTE", "totalSize", "LSH_DEFAULT_NUMBER_OF_TABLES", "LSH_DEFAULT_HASH_SIZE", "LSH_ACCEPTABLE_NUMBER_OF_TABLES", "LSH_ACCEPTABLE_HASH_SIZES", "LSH_ACCEPTABLE_DESCRIPTOR_SIZES", "generateLSHProfiles", "findTableCapacity", "LSH_SEQUENCE_MAXLEN", "LSH_SEQUENCE_COUNT", "partitionedSort", "seq", "padSequences", "LSH_SEQUENCES", "LSH_BYTESPERPIXEL", "nextPot", "SpeedyLSH", "lshTables", "descriptorDB", "tableCount", "hashSize", "probability", "descriptorCount", "lshProfiles", "d", "profile", "sequences", "profileName", "tableCapacity", "bucketsPerTable", "bucketSize", "numberOfPixels", "textureWidth", "textureHeight", "exceedingPercentage", "buffer", "permutation", "numberOfDiscardedDescriptorsPerTable", "descriptorIndex", "hashes", "table", "hash", "bucketByteOffset", "entryByteOffset", "numberOfDiscardedDescriptors", "bit", "cumulativePoisson", "lambda", "exp", "fat", "pow", "bucketCapacity", "l", "pm", "fast9_16", "harris", "win", "harrisScoreFindMax", "harrisScoreCutoff", "subpixelQuadratic1d", "subpixelTaylor2d", "subpixelBilinear", "subpixelBicubic", "refineScaleLoG", "refineScaleFAST916", "allocateDescriptors", "allocateExtra", "transferToExtra", "orbDescriptor", "orbOrientation", "nonMaxSuppression", "multiscaleNonMaxSuppression", "nonmaxSpace", "nonmaxScale", "nonmaxScaleSimple", "laplacian", "lk", "transferFlow", "bfMatcherInitCandidates", "bfMatcherInitFilters", "bfMatcherTransfer", "bfMatcher32", "bfMatcher64", "lshKnnInitCandidates", "lshKnnInitFilters", "lshKnn", "lshKnnTransfer", "sortCreatePermutation", "sortMergePermutation", "sortApplyPermutation", "mixKeypointsPreInit", "mixKeypointsInit", "mixKeypointsSort", "mixKeypointsView", "mixKeypointsApply", "initLookupTable", "sortLookupTable", "viewLookupTable", "encodeKeypoints", "encodeKeypointSkipOffsets", "encodeKeypointLongSkipOffsets", "encodeKeypointPositions", "encodeKeypointProperties", "encodeNullKeypoints", "transferOrientation", "uploadKeypoints", "applyHomography", "clipBorder", "distanceFilter", "hammingDistanceFilter32", "hammingDistanceFilter64", "shuffle", "clip", "SpeedyProgramGroupKeypoints", "upsample2", "downsample2", "SpeedyProgramGroupPyramids", "warpPerspective", "resizeNearest", "resizeBilinear", "additiveMix", "SpeedyProgramGroupTransforms", "SpeedyProgramCenter", "group", "DEFAULT_CAPACITY", "BUCKET", "TextureBucket", "next", "SpeedyTexturePool", "bucket", "SpeedyMediaSource", "token", "wrappedObject", "SpeedyImageMediaSource", "SpeedyVideoMediaSource", "SpeedyCanvasMediaSource", "SpeedyOffscreenCanvasMediaSource", "SpeedyBitmapMediaSource", "SpeedyDataMediaSource", "eventName", "timeout", "timer", "clear", "handleError", "handleSuccess", "info", "newNode", "image", "newCanvas", "offscreenCanvas", "newBitmap", "bitmap", "imageDataCopy", "imageData", "observable", "SpeedyGPU", "outputTexture", "SpeedySize", "anotherSize", "speedy_media_PRIVATE_TOKEN", "SpeedyMedia", "mediaSource", "log", "media", "clone", "SpeedyPlatform", "SpeedyVector2", "SpeedyPoint2", "speedy_matrix_expr", "speedy_matrix_wasm", "speedy_matrix", "SpeedyMatrixFactory", "Q", "R", "A", "Qptr", "Rptr", "Aptr", "solution", "method", "bptr", "xptr", "homography", "dest", "homptr", "srcptr", "destptr", "mask", "reprojectionError", "numberOfHypotheses", "bundleSize", "maskptr", "transform", "SpeedyPipelineMessageType", "SpeedyPipelineMessage", "createMessage", "SpeedyPipelineMessageWithNothing", "SpeedyPipelineMessageWithImage", "formatName", "SpeedyPipelineMessageWithKeypoints", "encodedKeypoints", "extraSize", "encoderLength", "SpeedyPipelineMessageWith2DVectors", "vectors", "SpeedyPipelineMessageWithLSHTables", "lsh", "SpeedyPipelineMessageWithKeypointMatches", "encodedMatches", "matchesPerKeypoint", "MESSAGE_CLASS", "always", "SpeedyPipelinePortSpec", "expectedMessageType", "messageConstraint", "spec", "DEFAULT_INPUT_PORT_NAME", "DEFAULT_OUTPUT_PORT_NAME", "ACCEPTABLE_PORT_NAME", "EMPTY_MESSAGE", "SpeedyPipelinePort", "node", "port", "SpeedyPipelineOutputPort", "SpeedyPipelineInputPort", "nodeName", "SpeedyPipelinePortBuilder", "portClass", "portName", "constraint", "InputPort", "OutputPort", "generateRandomName", "createInputPortDictionary", "createOutputPortDictionary", "InputPortDictionary", "ports", "dict", "OutputPortDictionary", "_texView", "SpeedyPipelineNode", "texCount", "portBuilders", "inputPorts", "outputPorts", "runTask", "nodes", "SpeedyPipelineSourceNode", "SpeedyPipelineSinkNode", "MATCH_NOT_FOUND", "SpeedyKeypointMatch", "distance", "isValid", "SpeedyKeypoint", "rotation", "score", "SpeedyTrackedKeypoint", "flow", "SpeedyMatchedKeypoint", "matches", "referenceCount", "SpeedyPipeline", "sinks", "template", "sink", "results", "idx", "sequence", "outlinks", "stack", "trash", "sorted", "done", "outnodes", "to", "inputs", "from", "links", "UPLOAD_BUFFER_SIZE", "SpeedyPipelineNodeImageSource", "DEFAULT_MEDIA_TYPE", "SpeedyPipelineNodeImageSink", "bitmapOrData", "dataArray", "INPUT_PORT", "SpeedyPipelineNodeImageMultiplexer", "SpeedyPipelineNodeImageBuffer", "previousFormat", "page", "previousInputTexture", "MAX_LEVELS", "MAX_TEXTURES", "SpeedyPipelineNodeImagePyramid", "pyramids", "mipLevels", "mip", "numLevels", "halfWidth", "halfHeight", "tmp", "SpeedyPipelineNodeImageMixer", "in0", "in1", "image0", "image1", "format0", "format1", "alpha", "beta", "gamma", "SpeedyPipelineNodeImagePortalSink", "SpeedyPipelineNodeImagePortalSource", "SpeedyPipelineImagePortalFactory", "SpeedyPipelineImageFactory", "SpeedyPipelineNodeGreyscale", "filters", "DEFAULT_KERNEL", "DEFAULT_SIGMA", "CONVOLUTION_X", "CONVOLUTION_Y", "SpeedyPipelineNodeGaussianBlur", "kw", "kh", "kernX", "kernY", "BOX_FILTER", "simple_blur_CONVOLUTION_X", "simple_blur_CONVOLUTION_Y", "SpeedyPipelineNodeSimpleBlur", "MEDIAN", "SpeedyPipelineNodeMedianBlur", "med", "CONVOLUTION", "SpeedyPipelineNodeConvolution", "conv", "SpeedyPipelineNodeNightvision", "gain", "decay", "quality", "illuminationMap", "SpeedyPipelineNodeNormalize", "minValue", "maxValue", "minmax", "pixelComponent", "numIterations", "SpeedyPipelineFilterFactory", "SINGULAR_MATRIX", "SpeedyPipelineNodePerspectiveWarp", "inverseHomography", "isValidHomography", "eps", "a11", "a21", "a31", "a12", "a22", "a32", "a13", "a23", "a33", "b1", "b2", "b3", "det", "SpeedyPipelineNodeResize", "scale", "newWidth", "newHeight", "SpeedyPipelineTransformFactory", "MAX_CAPACITY", "detector_DEFAULT_CAPACITY", "DEFAULT_SCALE_FACTOR", "NUMBER_OF_RGBA16_TEXTURES", "NUMBER_OF_INTERNAL_TEXTURES", "ENCODER_PASSES", "LONG_SKIP_OFFSET_PASSES", "SpeedyPipelineNodeKeypointDetector", "pname", "param", "oldval", "corners", "encoderCapacity", "maxSize", "keypoints", "lookupTable", "imageSize", "specialTexture", "offsets", "encodedKps", "pixelsPerKeypoint", "SpeedyPipelineNodeMultiscaleKeypointDetector", "levels", "scaleFactor", "UBO_MAX_BYTES", "BUFFER_SIZE", "SIZEOF_VEC4", "SpeedyPipelineNodeKeypointSource", "maxKeypoints", "numKeypoints", "numPasses", "startIndex", "endIndex", "bufferSize", "internalBuffer", "keypoint", "hasPos", "SpeedyKeypointDescriptor", "sink_nextPot", "ZERO_BYTES", "SpeedyPipelineNodeAbstractKeypointSink", "encoderWidth", "encoderHeight", "copiedTexture", "bytesPerKeypoint", "piOver255", "includeDiscarded", "descriptorBytes", "extraBytes", "z", "e2", "inputEncodedKeypoints", "inputDescriptorSize", "inputExtraSize", "outputDescriptorSize", "outputExtraSize", "inputEncoderLength", "outputEncoderCapacity", "outputEncoderLength", "SpeedyPipelineNodeKeypointSink", "SpeedyPipelineNodeTrackedKeypointSink", "newDescriptorSize", "newExtraSize", "encodedKeypointsWithExtraSpace", "newEncoderLength", "newEncodedKeypoints", "fx", "fy", "SpeedyPipelineNodeMatchedKeypointSink", "matchIndex", "u32", "LOG2_STRIDE", "MAX_SIZE", "SpeedyPipelineNodeKeypointClipper", "clipValue", "newCapacity", "blockSize", "dblLog2BlockSize", "SpeedyPipelineNodeKeypointBorderClipper", "borderSize", "imageWidth", "imageHeight", "borderLeft", "borderRight", "borderTop", "borderBottom", "mixEncoderLength", "clippedKeypoints", "sortedKeypoints", "SpeedyPipelineNodeKeypointBuffer", "previousDescriptorSize", "previousExtraSize", "previousEncoderLength", "SpeedyPipelineNodeKeypointMixer", "kps0", "kps1", "cap0", "cap1", "mixedKeypoints", "SpeedyPipelineNodeKeypointShuffler", "permutationMaxLength", "permutationLength", "bufsize", "q", "multiplexer_INPUT_PORT", "SpeedyPipelineNodeKeypointMultiplexer", "SpeedyPipelineNodeKeypointTransformer", "METHOD2PROGRAM", "SpeedyPipelineNodeKeypointSubpixelRefiner", "maxIterations", "epsilon", "offsetEncoderLength", "refinedKeypoints", "DEFAULT_THRESHOLD", "SpeedyPipelineNodeFASTKeypointDetector", "threshold", "lodStep", "HARRIS", "SpeedyPipelineNodeHarrisKeypointDetector", "windowSize", "intFactor", "derivatives", "maxScore", "SpeedyPipelineNodeKeypointDescriptor", "DESCRIPTOR_SIZE", "SpeedyPipelineNodeORBKeypointDescriptor", "orientationEncoderLength", "encodedOrientations", "orientedKeypoints", "describedKeypoints", "DEFAULT_WINDOW_SIZE", "DEFAULT_DEPTH", "DEFAULT_NUMBER_OF_ITERATIONS", "DEFAULT_DISCARD_THRESHOLD", "DEFAULT_EPSILON", "LK_PROGRAM", "SpeedyPipelineNodeLKKeypointTracker", "SUPPORTED_WINDOWS", "previousImage", "nextImage", "previousKeypoints", "wsize", "numberOfIterations", "discardThreshold", "lkEncoderLength", "nextKeypoints", "SpeedyPipelineNodeStaticLSHTables", "numberOfTables", "DEFAULT_K", "DEFAULT_QUALITY", "NUMBER_OF_BIT_SWAPS", "LSH_KNN", "fd", "fh", "fl", "SpeedyPipelineNodeLSHKNNKeypointMatcher", "tables", "tablesStride", "descriptorDBStride", "candidatesA", "candidatesB", "candidatesC", "transferA", "transferB", "matcherLength", "kthMatcherLength", "candidates", "tableIndex", "PROGRAM_NAME", "SpeedyPipelineNodeBruteForceKNNKeypointMatcher", "database", "encodedFiltersA", "encodedMatchesA", "encodedMatchesB", "bfMatcher", "dbCapacity", "numberOfKeypointsPerPass", "numberOfPasses", "partialMatcherLength", "encodedFilters", "encodedPartialMatches", "passId", "SpeedyPipelineNodeKeypointDistanceFilter", "set0", "set1", "hamming_distance_filter_PROGRAM_NAME", "SpeedyPipelineNodeKeypointHammingDistanceFilter", "SpeedyPipelineNodeKeypointPortalSink", "SpeedyPipelineNodeKeypointPortalSource", "SpeedyPipelineKeypointDetectorFactory", "SpeedyPipelineKeypointDescriptorFactory", "SpeedyPipelineKeypointTrackerFactory", "SpeedyPipelineKeypointMatcherFactory", "SpeedyPipelineKeypointPortalFactory", "SpeedyPipelineKeypointFactory", "vector2_sink_nextPot", "SpeedyPipelineNodeVector2Sink", "hi", "lo", "SpeedyPipelineVector2Factory", "UPDATE_INTERVAL", "FPSCounter", "now", "deltaTime", "matrixFactory", "vector2Factory", "sourceElement", "widthOrConstraints", "ARError", "IllegalArgumentError", "IllegalOperationError", "NotSupportedError", "AccessDeniedError", "TimeoutError", "AssertionError", "NumericalError", "TrackingError", "DetectionError", "TrainingError", "init_errors", "__esmMin", "message", "cause", "extendedMessage", "computeResolution", "resolution", "aspectRatio", "referenceHeight", "parseHeight", "width", "height", "IllegalArgumentError", "Speedy", "ALIAS_TO_HEIGHT", "r", "import_speedy_vision", "init_resolution", "__esmMin", "init_errors", "import_speedy_vision", "Utils", "init_utils", "__esmMin", "init_errors", "init_resolution", "_Utils", "message", "args", "expr", "errorMessage", "AssertionError", "n", "IllegalArgumentError", "_", "i", "arr", "j", "tmp", "milliseconds", "Speedy", "resolve", "promises", "prev", "curr", "resolution", "aspectRatio", "computeResolution", "AREvent", "AREventTarget", "init_ar_events", "__esmMin", "type", "callback", "event", "Stats", "init_stats", "__esmMin", "now", "SCAN_RANSAC_REPROJECTIONERROR_NDC", "SCAN_LSH_TABLES", "SCAN_LSH_HASHSIZE", "SCAN_WITH_NIGHTVISION", "NIGHTVISION_GAIN", "NIGHTVISION_OFFSET", "NIGHTVISION_DECAY", "NIGHTVISION_QUALITY", "ORB_GAUSSIAN_KSIZE", "ORB_GAUSSIAN_SIGMA", "SUBPIXEL_GAUSSIAN_KSIZE", "SUBPIXEL_GAUSSIAN_SIGMA", "SUBPIXEL_METHOD", "PRE_TRACK_MIN_MATCHES", "PRE_TRACK_MATCH_RATIO", "PRE_TRACK_RANSAC_REPROJECTIONERROR_NIS", "PRE_TRACK_RANSAC_REPROJECTIONERROR_NDC", "PRE_TRACK_FILTER_ALPHA", "PRE_TRACK_FILTER_BETA", "PRE_TRACK_MAX_ITERATIONS", "TRACK_MIN_MATCHES", "TRACK_MAX_KEYPOINTS", "TRACK_DETECTOR_CAPACITY", "TRACK_HARRIS_QUALITY", "TRACK_WITH_NIGHTVISION", "TRACK_RECTIFIED_BORDER", "TRACK_CLIPPING_BORDER", "TRACK_RECTIFIED_SCALE", "TRACK_RANSAC_REPROJECTIONERROR_NIS", "TRACK_RANSAC_REPROJECTIONERROR_NDC", "TRACK_GRID_GRANULARITY", "TRACK_MATCH_RATIO", "TRACK_LOST_TOLERANCE", "TRACK_FILTER_ALPHA", "TRACK_FILTER_BETA", "TRACK_EXTRAPOLATION_ALPHA", "TRACK_EXTRAPOLATION_BETA", "init_settings", "__esmMin", "Gizmos", "ImageTrackerGizmos", "init_gizmos", "__esmMin", "init_settings", "visible", "viewport", "trackers", "i", "tracker", "output", "ctx", "viewportSize", "keypointsNIS", "polylineNDC", "camera", "keypoints", "size", "goodMatches", "badMatches", "keypoint", "n", "color", "sx", "sy", "x", "y", "r", "polyline", "lineWidth", "w", "h", "j", "length", "iw", "ih", "p", "l", "o", "z", "axis", "ox", "oy", "q", "Frame", "init_frame", "__esmMin", "session", "results", "TrackerResult", "init_tracker", "__esmMin", "trackerType", "TimeManager", "init_time_manager", "__esmMin", "timestamp", "scale", "asap", "fn", "params", "callbacks", "args", "ASAP_KEY", "init_asap", "__esmMin", "event", "argArray", "import_speedy_vision", "SessionEvent", "DEFAULT_OPTIONS", "EmptyTrackerResult", "_Session", "Session", "init_session", "__esmMin", "init_main", "init_utils", "init_ar_events", "init_errors", "init_settings", "init_stats", "init_gizmos", "init_frame", "init_tracker", "init_time_manager", "init_asap", "AREvent", "TrackerResult", "tracker", "AREventTarget", "sources", "mode", "viewport", "stats", "gizmos", "Stats", "TimeManager", "Gizmos", "IllegalArgumentError", "Utils", "ios", "safari", "matches", "version", "x", "y", "v", "Speedy", "options", "trackers", "NotSupportedError", "IllegalOperationError", "AR", "message", "AccessDeniedError", "i", "source", "session", "err", "event", "callback", "handle", "ctx", "media", "stretch", "canvas", "width", "height", "image", "scheduleNextFrame", "Settings", "asap", "repeat", "update", "cause", "skip", "toggle", "render", "timestamp", "enableFrameSkipping", "highPerformance", "time", "skipUserMedia", "results", "frame", "Frame", "rafQueue", "import_speedy_vision", "Settings", "init_settings", "__esmMin", "init_session", "init_errors", "init_utils", "value", "Session", "IllegalOperationError", "IllegalArgumentError", "Speedy", "Utils", "ReferenceImageWithMedia", "init_reference_image", "__esmMin", "referenceImage", "media", "name", "import_speedy_vision", "DEFAULT_CAPACITY", "ReferenceImageDatabase", "init_reference_image_database", "__esmMin", "init_reference_image", "init_utils", "init_errors", "value", "capacity", "IllegalArgumentError", "referenceImages", "referenceImagesWithMedia", "referenceImageWithMedia", "referenceImage", "name", "IllegalOperationError", "Utils", "Speedy", "media", "ReferenceImageWithMedia", "promises", "import_speedy_vision", "ImageTrackerState", "init_state", "__esmMin", "init_errors", "name", "imageTracker", "screen", "IllegalOperationError", "media", "screenSize", "source", "result", "settings", "Speedy", "import_speedy_vision", "ImageTrackerInitialState", "init_initial", "__esmMin", "init_state", "init_settings", "init_utils", "ImageTrackerState", "imageTracker", "Utils", "Speedy", "result", "pipeline", "source", "screen", "greyscale", "imageRectifier", "nightvision", "nightvisionMux", "detector", "descriptor", "blur", "clipper", "borderClipper", "denoiser", "subpixel", "matcher", "keypointRectifier", "keypointPortalSink", "keypointPortalSource", "muxOfReferenceKeypoints", "bufferOfReferenceKeypoints", "muxOfBufferOfReferenceKeypoints", "keypointSink", "NIGHTVISION_QUALITY", "SUBPIXEL_METHOD", "solvePlanarPnP", "referencePoints", "observedPoints", "cameraIntrinsics", "IllegalArgumentError", "n", "MAX_POINTS", "K", "fx", "fy", "cx", "cy", "Kinv", "z0", "getZ0", "P", "Q", "i", "j", "pi", "p", "qi", "q", "mul", "u", "scale", "v", "normalize", "uhat", "ui", "sub", "uc", "USE_NORMAL_VECTOR", "normal", "findNormalVector", "INVALID_POSE", "nv0", "dot", "sjs0", "k", "ratios", "findRatios", "vhat", "vi", "sis0", "vstar", "vc", "xx", "yy", "xy", "yx", "zx", "zy", "ucj", "vcj", "xx2", "yy2", "xy2", "yx2", "zx2", "zy2", "delta", "eigenval", "A", "b", "eigenvec", "inverse", "invA", "qx", "qy", "qz", "qw", "qlen", "quaternion", "h", "findFarthestPointIndex", "shs0", "vhv0", "s02", "distance2", "s0", "quat2mat", "R", "centroid", "t", "Ruhat", "pose", "Speedy", "solvePlanarPnPRansac", "options", "settings", "DEFAULT_RANSAC_OPTIONS", "numberOfHypotheses", "threshold", "acceptablePercentageOfInliers", "outputMask", "mat3", "E", "mat3x4", "mask", "src", "dest", "permutation", "Utils", "mp", "mq", "bestError", "bestPose", "reorderPoints4", "homography", "buildHomography", "error", "computeReprojectionError", "count", "newPose", "newError", "find6DoFHomography", "DEFAULT_FIND6DOFHOMOGRAPHY_OPTIONS", "refinementQuality", "reprojectionError", "hom", "entries", "intermediate", "adjustment", "A4", "M", "rt", "H", "h11", "h21", "h31", "h12", "h22", "h32", "h13", "h23", "h33", "ih11", "ih21", "ih31", "ih12", "ih22", "ih32", "ih13", "ih23", "ih33", "invH", "thr2", "totalError", "px", "py", "pz", "hpx", "hpy", "hpz", "ux", "uy", "vx", "vy", "dx", "dy", "error2", "ihqx", "ihqy", "ihqz", "iux", "iuy", "ivx", "ivy", "idx", "idy", "ierror2", "pivot", "u0", "maxdist", "dist", "vec3", "v0", "vj", "ri", "rj", "nvec", "cross", "uj", "uk", "vk", "wi", "wj", "wk", "det2", "EPSILON", "ai", "aj", "bm", "_b", "_A", "_invA", "_x", "targetWidthInMeters", "DEFAULT_TARGET_WIDTH_IN_METERS", "sensorWidthInMeters", "DEFAULT_SENSOR_WIDTH_IN_METERS", "f", "a", "mat", "rows", "cols", "isSequence", "mat4", "vec4", "C", "B", "rowsA", "colsA", "rowsB", "colsB", "rowsC", "colsC", "s", "m0", "m1", "m2", "m3", "m4", "m5", "m6", "m7", "m8", "det", "idet", "w", "len2", "len", "dz", "x", "y", "z", "x2", "y2", "z2", "xz", "yz", "wx", "wy", "wz", "import_speedy_vision", "init_pnp", "__esmMin", "init_utils", "init_errors", "import_speedy_vision", "ImageTrackerUtils", "init_image_tracker_utils", "__esmMin", "init_utils", "init_errors", "init_settings", "init_pnp", "size", "sx", "sy", "Speedy", "w", "h", "aspectRatio", "scale", "screenSize", "referenceImage", "screenAspectRatio", "pairs", "IllegalArgumentError", "data", "i", "j", "k", "src", "dest", "alpha", "beta", "tau", "omega", "d", "q", "p", "ha", "hb", "x", "y", "hax", "hay", "haz", "hbx", "hby", "hbz", "dx", "dy", "tx", "ty", "sin", "cos", "max", "min", "ax", "ay", "bx", "by", "dot", "signedArea", "la2", "lb2", "lalb", "gamma", "f", "t", "_t", "_omega", "cameraIntrinsics", "points", "options", "n", "mask", "find6DoFHomography", "homography", "a00", "NumericalError", "m", "inliers", "score", "model", "_", "uv", "polyline", "u", "v", "destKeypoints", "indices", "result", "keypoints", "gridCells", "TRACK_GRID_GRANULARITY", "numberOfCells", "grid", "xg", "Utils", "xmin", "xmax", "ymin", "ymax", "xlen", "ylen", "import_speedy_vision", "ImageTrackerTrainingState", "init_training", "__esmMin", "init_image_tracker_utils", "init_state", "init_utils", "init_errors", "init_settings", "ImageTrackerState", "imageTracker", "settings", "database", "TrainingError", "Utils", "referenceImage", "source", "screen", "keypointScaler", "resolution", "scale", "aspectRatioOfTrainingImage", "ImageTrackerUtils", "Speedy", "result", "keypoints", "image", "trackerOutput", "i", "pipeline", "greyscale", "blur", "nightvision", "nightvisionMux", "pyramid", "detector", "descriptor", "subpixel", "blurredPyramid", "denoiser", "clipper", "keypointSink", "ORB_GAUSSIAN_KSIZE", "ORB_GAUSSIAN_SIGMA", "NIGHTVISION_GAIN", "NIGHTVISION_OFFSET", "NIGHTVISION_DECAY", "NIGHTVISION_QUALITY", "SCAN_WITH_NIGHTVISION", "SUBPIXEL_METHOD", "SUBPIXEL_GAUSSIAN_KSIZE", "SUBPIXEL_GAUSSIAN_SIGMA", "keypointIndex", "imageIndex", "n", "import_speedy_vision", "PORT_CAMERA", "PORT_MEMORY", "ImageTrackerScanningState", "init_scanning", "__esmMin", "init_image_tracker_utils", "init_state", "init_utils", "init_errors", "init_settings", "ImageTrackerState", "imageTracker", "Speedy", "settings", "imagePortalMux", "lshTables", "database", "keypointScaler", "screenSize", "ImageTrackerUtils", "result", "keypoints", "image", "trackerOutput", "matchedKeypoints", "pairs", "points", "homography", "score", "polylineNDC", "snapshot", "referenceImage", "DetectionError", "err", "Utils", "matchedKeypointsPerImageIndex", "j", "keypoint", "d1", "d2", "idx", "imageIndex", "SCAN_RANSAC_REPROJECTIONERROR_NDC", "i", "matchedKeypoint", "referenceKeypoint", "pipeline", "source", "screen", "greyscale", "blur", "nightvision", "nightvisionMux", "pyramid", "detector", "descriptor", "clipper", "knn", "keypointSink", "imagePortalSink", "imagePortalSource", "imagePortalBuffer", "imagePortalCopy", "ORB_GAUSSIAN_KSIZE", "ORB_GAUSSIAN_SIGMA", "NIGHTVISION_GAIN", "NIGHTVISION_OFFSET", "NIGHTVISION_DECAY", "NIGHTVISION_QUALITY", "SCAN_WITH_NIGHTVISION", "SCAN_LSH_TABLES", "SCAN_LSH_HASHSIZE", "import_speedy_vision", "ImageTrackerPreTrackingAState", "init_pre_tracking_a", "__esmMin", "init_image_tracker_utils", "init_state", "init_utils", "init_settings", "ImageTrackerState", "imageTracker", "Speedy", "settings", "homography", "referenceImage", "snapshot", "screenSize", "source", "imageRectifier", "keypointScaler", "borderClipper", "TRACK_CLIPPING_BORDER", "ImageTrackerUtils", "scale", "TRACK_RECTIFIED_SCALE", "aspectRatio", "shrink", "toScreen", "toNDC", "result", "keypointPortalSink", "keypoints", "image", "trackerOutput", "PRE_TRACK_MIN_MATCHES", "Utils", "pipeline", "screen", "greyscale", "nightvision", "nightvisionMux", "detector", "descriptor", "blur", "clipper", "denoiser", "subpixel", "keypointSink", "NIGHTVISION_GAIN", "NIGHTVISION_OFFSET", "NIGHTVISION_DECAY", "NIGHTVISION_QUALITY", "TRACK_WITH_NIGHTVISION", "ORB_GAUSSIAN_KSIZE", "ORB_GAUSSIAN_SIGMA", "SUBPIXEL_GAUSSIAN_KSIZE", "SUBPIXEL_GAUSSIAN_SIGMA", "TRACK_HARRIS_QUALITY", "TRACK_DETECTOR_CAPACITY", "SUBPIXEL_METHOD", "TRACK_MAX_KEYPOINTS", "import_speedy_vision", "PORT_PORTAL", "PORT_CAMERA", "ImageTrackerPreTrackingBState", "init_pre_tracking_b", "__esmMin", "init_image_tracker_utils", "init_state", "init_utils", "init_errors", "init_settings", "ImageTrackerState", "imageTracker", "Speedy", "settings", "homography", "referenceImage", "snapshot", "referenceKeypointPortalSink", "sourceMux", "sourceBuffer", "screenSize", "imageRectifier", "keypointScaler", "borderClipper", "imagePortalSource", "referenceKeypointPortalSource", "TRACK_CLIPPING_BORDER", "ImageTrackerUtils", "scale", "TRACK_RECTIFIED_SCALE", "aspectRatio", "shrink", "undistort", "toScreen", "toNDC", "result", "referenceKeypoints", "keypoints", "image", "keypointPortalSink", "trackerOutput", "pairs", "PRE_TRACK_MIN_MATCHES", "TrackingError", "points", "warp", "PRE_TRACK_FILTER_ALPHA", "PRE_TRACK_FILTER_BETA", "filteredHomography", "_", "PRE_TRACK_MAX_ITERATIONS", "err", "Utils", "PRE_TRACK_RANSAC_REPROJECTIONERROR_NDC", "score", "scaledWarp", "distort", "srcKeypoints", "destKeypoints", "i", "destKeypoint", "d1", "d2", "PRE_TRACK_MATCH_RATIO", "srcKeypoint", "pipeline", "source", "screen", "greyscale", "nightvision", "nightvisionMux", "detector", "descriptor", "blur", "clipper", "denoiser", "subpixel", "matcher", "keypointSink", "referenceKeypointSink", "NIGHTVISION_GAIN", "NIGHTVISION_OFFSET", "NIGHTVISION_DECAY", "NIGHTVISION_QUALITY", "TRACK_WITH_NIGHTVISION", "ORB_GAUSSIAN_KSIZE", "ORB_GAUSSIAN_SIGMA", "SUBPIXEL_GAUSSIAN_KSIZE", "SUBPIXEL_GAUSSIAN_SIGMA", "TRACK_HARRIS_QUALITY", "TRACK_DETECTOR_CAPACITY", "SUBPIXEL_METHOD", "TRACK_MAX_KEYPOINTS", "ImageTrackerEvent", "init_image_tracker_event", "__esmMin", "init_ar_events", "AREvent", "type", "referenceImage", "import_speedy_vision", "EPSILON", "Quaternion", "init_quaternion", "__esmMin", "init_errors", "_Quaternion", "x", "y", "z", "w", "axis", "angle", "sin", "cos", "r", "q", "length", "Speedy", "x2", "y2", "z2", "xy", "xz", "yz", "wx", "wy", "wz", "m", "IllegalArgumentError", "data", "m11", "m21", "m31", "m12", "m22", "m32", "m13", "m23", "m33", "tr", "sx", "sy", "sz", "EPSILON", "ZERO", "Vector3", "init_vector3", "__esmMin", "_Vector3", "x", "y", "z", "v", "dx", "dy", "dz", "scale", "length", "s", "q", "w", "vx", "vy", "vz", "x2", "y2", "z2", "xy", "xz", "yz", "wx", "wy", "wz", "import_speedy_vision", "TRANSLATION_SAMPLES", "ROTATION_SAMPLES", "NO_TRANSLATION", "NO_ROTATION", "ZERO_QUATERNION", "PoseFilter", "init_pose_filter", "__esmMin", "init_settings", "init_quaternion", "init_vector3", "init_errors", "Vector3", "Quaternion", "q", "sample", "data", "IllegalArgumentError", "i", "t", "div", "Settings", "T", "R", "d", "ti", "w", "qi", "entries", "Speedy", "import_speedy_vision", "HFOV_GUESS", "DEFAULT_SCALE", "DEG2RAD", "EPSILON", "FX", "FY", "U0", "V0", "POSE_REFINEMENT_ITERATIONS", "TRANSLATION_REFINEMENT_ITERATIONS", "TRANSLATION_REFINEMENT_TOLERANCE", "TRANSLATION_REFINEMENT_GRIDSIZE", "CameraModel", "init_camera_model", "__esmMin", "init_utils", "init_pose_filter", "init_errors", "Speedy", "PoseFilter", "aspectRatio", "scale", "Utils", "homographyNDC", "homography", "h", "h11", "h12", "h13", "h21", "h22", "h23", "h31", "h32", "h33", "det", "NumericalError", "pose", "Z", "K", "E", "halfWidth", "halfHeight", "near", "far", "fx", "fy", "right", "top", "bottom", "left", "cameraWidth", "u0", "v0", "w", "fromNDC", "u0fx", "v0fy", "normalizedHomography", "h1norm2", "h2norm2", "h1norm", "h2norm", "hnorm", "r", "t", "rot", "r11", "r21", "r31", "r12", "r22", "r32", "r1tr1", "r2tr2", "r1tr2", "delta", "sqrt", "eigval1", "eigval2", "alpha1", "x1", "y1", "alpha2", "x2", "y2", "s1", "s2", "a", "b", "c", "t0", "g", "x", "y", "k", "i", "j", "n", "a1", "a2", "a3", "n3", "m", "v", "Mc", "it", "num", "den", "frc", "partialRotation", "r13", "r23", "r33", "partialPose", "residual", "rt", "mat", "r0", "Pose", "init_pose", "__esmMin", "transform", "import_speedy_vision", "EPSILON", "Transform", "init_transform", "__esmMin", "init_errors", "init_vector3", "init_quaternion", "_Transform", "matrix", "IllegalArgumentError", "Vector3", "Quaternion", "v", "m", "h", "vx", "vy", "vz", "x", "y", "z", "tx", "ty", "tz", "rs11", "rs21", "rs31", "rs12", "rs22", "rs32", "rs13", "rs23", "rs33", "det", "sign", "sx", "sy", "sz", "zx", "zy", "zz", "r11", "r21", "r31", "r12", "r22", "r32", "r13", "r23", "r33", "Speedy", "import_speedy_vision", "ViewerPose", "init_viewer_pose", "__esmMin", "init_pose", "init_transform", "Pose", "camera", "viewMatrix", "modelMatrix", "Speedy", "transform", "Transform", "import_speedy_vision", "DEFAULT_NEAR", "DEFAULT_FAR", "PerspectiveView", "init_view", "__esmMin", "init_errors", "camera", "near", "far", "IllegalArgumentError", "Speedy", "Ray", "init_ray", "__esmMin", "origin", "direction", "import_speedy_vision", "Viewer", "init_viewer", "__esmMin", "init_pose", "init_viewer_pose", "init_view", "init_transform", "init_vector3", "init_ray", "camera", "ViewerPose", "PerspectiveView", "pose", "modelMatrix", "viewMatrix", "modelViewMatrix", "Speedy", "transform", "Transform", "Pose", "position", "projectionMatrixInverse", "viewMatrixInverse", "pointInClipSpace", "pointInViewSpace", "pointInWorldSpace", "p", "origin", "direction", "Vector3", "Ray", "import_speedy_vision", "USE_TURBO", "NO_MOTION", "ImageTrackerTrackingState", "init_tracking", "__esmMin", "init_image_tracker", "init_image_tracker_utils", "init_image_tracker_event", "init_state", "init_utils", "init_camera_model", "init_viewer", "init_pose", "init_transform", "init_errors", "init_settings", "Speedy", "ImageTrackerState", "imageTracker", "CameraModel", "settings", "homography", "referenceImage", "templateKeypoints", "templateKeypointPortalSink", "initialScreenSize", "keypointPortalSource", "IllegalOperationError", "aspectRatio", "ev", "ImageTrackerEvent", "Utils", "imageRectifier", "borderClipper", "keypointScaler", "screenSize", "TRACK_CLIPPING_BORDER", "ImageTrackerUtils", "scale", "TRACK_RECTIFIED_SCALE", "shrink", "undistort", "toScreen", "toNDC", "Settings", "currentKeypoints", "result", "keypoints", "image", "TrackingError", "allPairs", "pairs", "TRACK_MIN_MATCHES", "points", "warpMotion", "multiplier", "TRACK_FILTER_ALPHA", "TRACK_FILTER_BETA", "TRACK_EXTRAPOLATION_ALPHA", "TRACK_EXTRAPOLATION_BETA", "filteredHomography", "NumericalError", "modelMatrix", "transform", "Transform", "pose", "Pose", "viewer", "Viewer", "trackable", "trackerOutput", "ImageTrackerResult", "err", "TRACK_LOST_TOLERANCE", "TRACK_RANSAC_REPROJECTIONERROR_NDC", "warp", "score", "scaledWarp", "distort", "K", "srcKeypoints", "destKeypoints", "i", "destKeypoint", "d1", "d2", "TRACK_MATCH_RATIO", "srcKeypoint", "pipeline", "source", "screen", "greyscale", "nightvision", "nightvisionMux", "blur", "detector", "descriptor", "matcher", "subpixel", "denoiser", "clipper", "keypointSink", "NIGHTVISION_GAIN", "NIGHTVISION_OFFSET", "NIGHTVISION_DECAY", "NIGHTVISION_QUALITY", "TRACK_WITH_NIGHTVISION", "ORB_GAUSSIAN_KSIZE", "ORB_GAUSSIAN_SIGMA", "SUBPIXEL_GAUSSIAN_KSIZE", "SUBPIXEL_GAUSSIAN_SIGMA", "TRACK_HARRIS_QUALITY", "TRACK_DETECTOR_CAPACITY", "SUBPIXEL_METHOD", "TRACK_MAX_KEYPOINTS", "import_speedy_vision", "ImageTrackerResult", "DEFAULT_OPTIONS", "TRACKER_TYPE", "ImageTracker", "init_image_tracker", "__esmMin", "init_tracker", "init_errors", "init_reference_image_database", "init_initial", "init_training", "init_scanning", "init_pre_tracking_a", "init_pre_tracking_b", "init_tracking", "init_utils", "init_ar_events", "TrackerResult", "tracker", "trackables", "viewer", "AREventTarget", "options", "ImageTrackerInitialState", "ImageTrackerTrainingState", "ImageTrackerScanningState", "ImageTrackerPreTrackingAState", "ImageTrackerPreTrackingBState", "ImageTrackerTrackingState", "ReferenceImageDatabase", "type", "resolution", "screenSize", "session", "source", "IllegalOperationError", "state", "Speedy", "media", "activeState", "trackerOutput", "nextState", "nextStateSettings", "keypointIndex", "aspectRatio", "Utils", "EPSILON", "ZERO", "Vector2", "init_vector2", "__esmMin", "_Vector2", "x", "y", "v", "dx", "dy", "scale", "length", "s", "import_speedy_vision", "PointerTrackerResult", "EVENTTYPE2PHASE", "DEFAULT_OPTIONS", "TRACKER_TYPE", "PointerTracker", "init_pointer_tracker", "__esmMin", "init_tracker", "init_vector2", "init_utils", "init_errors", "TrackerResult", "tracker", "trackables", "options", "settings", "IllegalArgumentError", "type", "session", "Utils", "source", "Speedy", "IllegalOperationError", "canvas", "rect", "deltaTime", "inverseDeltaTime", "inactiveTrackables", "i", "Vector2", "event", "id", "previous", "current", "phase", "absX", "absY", "relX", "relY", "position", "a", "deltaPosition", "initialPosition", "velocity", "duration", "movementLength", "movementDuration", "isPrimary", "kind", "trackable", "n", "s", "fields", "pointerId", "pointerType", "j", "primary", "now", "prev", "TrackerFactory", "init_tracker_factory", "__esmMin", "init_image_tracker", "init_pointer_tracker", "options", "ImageTracker", "PointerTracker", "import_speedy_vision", "ALERT_MESSAGE", "displayedAlertMessage", "VideoSource", "init_video_source", "__esmMin", "init_utils", "init_errors", "video", "Utils", "type", "IllegalOperationError", "media", "Speedy", "promise", "resolve", "reject", "error", "NotSupportedError", "ms", "t", "TimeoutError", "import_speedy_vision", "CanvasSource", "init_canvas_source", "__esmMin", "init_utils", "init_errors", "canvas", "Utils", "type", "IllegalOperationError", "media", "Speedy", "import_speedy_vision", "DEFAULT_CAMERA_OPTIONS", "CameraSource", "init_camera_source", "__esmMin", "init_utils", "init_errors", "init_video_source", "VideoSource", "options", "video", "Utils", "NotSupportedError", "IllegalArgumentError", "idealSize", "userConstraints", "ourConstraints", "constraints", "Speedy", "resolve", "reject", "stream", "promise", "success", "error", "IllegalOperationError", "AccessDeniedError", "track", "import_speedy_vision", "PointerSource", "init_pointer_source", "__esmMin", "init_utils", "type", "Utils", "Speedy", "viewport", "element", "event", "canvas", "SourceFactory", "init_source_factory", "__esmMin", "init_video_source", "init_canvas_source", "init_camera_source", "init_pointer_source", "video", "VideoSource", "canvas", "CanvasSource", "options", "CameraSource", "PointerSource", "UPDATE_INTERVAL", "POWER_ICON", "BUTTON_ICONS", "StatsPanel", "init_stats_panel", "__esmMin", "init_settings", "init_main", "parent", "isVisible", "time", "sources", "trackers", "viewport", "gpu", "fps", "lfps", "lgpu", "lpower", "Settings", "lin", "sourceStats", "source", "lout", "trackerStats", "tracker", "lview", "size", "className", "f", "GREEN", "YELLOW", "RED", "color3", "color2", "container", "title", "button", "AR", "details", "content", "append", "div", "html", "BUTTON_ICON_OFF", "BUTTON_ICON_ON", "BUTTON_SIZE", "BUTTON_MARGIN", "FullscreenButton", "init_fullscreen_button", "__esmMin", "viewport", "parent", "isVisible", "button", "highlight", "dehighlight", "err", "event", "img", "TITLE", "MESSAGE", "PRIMARY_ACTION", "SECONDARY_ACTION", "TARGET_URL", "ONE_DAY", "REMINDER_TIMEOUT", "REMINDER_KEY", "AR_FLAGS", "ReminderDialog", "init_reminder_dialog", "__esmMin", "parent", "now", "lastReminder", "TRANSPARENT_COLOR", "BACKGROUND_COLOR", "PRIMARY_COLOR", "SECONDARY_COLOR", "PRIMARY_HIGHLIGHTED_COLOR", "SECONDARY_HIGHLIGHTED_COLOR", "FONT_FAMILY", "TEXT_COLOR", "TEXT_SIZE", "TITLE_COLOR", "TITLE_SIZE", "dialog", "content", "title", "message", "buttonWrapper", "primaryButton", "secondaryButton", "closeButton", "e", "highlight", "el", "bg", "fg", "border", "_statsPanel", "_fullscreenButton", "_reminderDialog", "HUD", "init_hud", "__esmMin", "init_stats_panel", "init_fullscreen_button", "init_reminder_dialog", "init_utils", "viewport", "parent", "hudContainer", "__privateAdd", "Utils", "__privateSet", "StatsPanel", "FullscreenButton", "ReminderDialog", "visible", "__privateGet", "zIndex", "wantStatsPanel", "wantFullscreenButton", "element", "container", "node", "import_speedy_vision", "ViewportEvent", "DEFAULT_VIEWPORT_SETTINGS", "BASE_ZINDEX", "BACKGROUND_ZINDEX", "FOREGROUND_ZINDEX", "HUD_ZINDEX", "RESIZE_THROTTLE_DELAY", "ORIENTATION_POLLING_DURATION", "ORIENTATION_POLLING_CYCLES", "ViewportContainers", "ViewportCanvases", "ViewportFullscreenHelper", "ViewportSnapshotter", "ViewportResizer", "ViewportResizeStrategy", "InlineResizeStrategy", "ImmersiveResizeStrategy", "BestFitResizeStrategy", "StretchResizeStrategy", "CropResizeStrategy", "Viewport", "init_viewport", "__esmMin", "init_main", "init_hud", "init_vector2", "init_utils", "init_ar_events", "init_errors", "AREvent", "container", "IllegalArgumentError", "parent", "initialSize", "fgCanvas", "engineInfo", "AR", "size", "canvas", "zIndex", "viewport", "Speedy", "NotSupportedError", "resolve", "reject", "Utils", "AccessDeniedError", "doc", "IllegalOperationError", "event", "resolution", "ctx", "bmp", "error", "width", "height", "strategy", "strategyName", "i", "a", "b", "foregroundCanvas", "virtualSize", "backgroundCanvas", "realSize", "subContainer", "windowAspectRatio", "viewportAspectRatio", "left", "top", "AREventTarget", "viewportSettings", "settings", "guessedAspectRatio", "HUD", "position", "space", "px", "py", "x", "y", "Vector2", "getMediaSize", "sessionMode", "wantStatsPanel", "wantFullscreenButton", "import_speedy_vision", "AR", "init_main", "__esmMin", "init_settings", "init_session", "init_tracker_factory", "init_source_factory", "init_viewport", "init_vector2", "init_vector3", "init_utils", "options", "Session", "Speedy", "TrackerFactory", "SourceFactory", "settings", "Viewport", "x", "y", "Vector2", "z", "Vector3", "Settings", "window", "Utils", "require_src", "__commonJSMin", "exports", "module", "init_main", "AR"]
}
