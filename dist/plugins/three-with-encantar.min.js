"use strict";/*!
 * three.js plugin for encantar.js
 * @author Alexandre Martins <alemartf(at)gmail.com> (https://github.com/alemart/encantar-js)
 * @license LGPL-3.0-or-later
 */import*as a from"three";w({"encantar.js":{version:"0.4.6"},"three.js":{version:"173"}});export class ARDemo{startSession(){throw new Error("Abstract method")}init(){return Promise.resolve()}update(){}release(){}preload(){return Promise.resolve()}get canvas(){return null}get ar(){return this._ar}constructor(){this._ar=null}}class f{convertVector2(e){return new a.Vector2(e.x,e.y)}convertVector3(e){return new a.Vector3(e.x,e.y,e.z)}convertQuaternion(e){return new a.Quaternion(e.x,e.y,e.z,e.w)}convertRay(e){const o=this.convertVector3(e.origin),s=this.convertVector3(e.direction);return new a.Ray(o,s)}}class m{get session(){return this._session}get frame(){return this._frame}get viewer(){return this._viewer}get pointers(){return this._pointers}get root(){return this._root}get scene(){return this._scene}get camera(){return this._camera}get renderer(){return this._renderer}get utils(){return this._utils}constructor(){this._session=null,this._frame=null,this._viewer=null,this._pointers=[],this._origin=null,this._root=null,this._scene=null,this._camera=null,this._renderer=null,this._utils=new f}}export function encantar(t){const e=new m;let o=null;function s(r,i){e._frame=i,c(i),t.update(),e._renderer.render(e._scene,e._camera),e._session.requestAnimationFrame(s)}function c(r){let i=!1;e._viewer=null,e._pointers.length=0;for(const n of r.results)if(n.of("image-tracker")){if(n.trackables.length>0){const h=n.trackables[0],v=n.viewer.view.projectionMatrix,d=n.viewer.pose.transform.matrix,p=h.pose.transform.matrix;l(v,d,p),e._origin.visible=!0,e._viewer=n.viewer,i=!0}}else n.of("pointer-tracker")&&n.trackables.length>0&&e._pointers.push.apply(e._pointers,n.trackables);i||(e._origin.visible=!1)}function l(r,i,n){e._camera.projectionMatrix.fromArray(r.read()),e._camera.projectionMatrixInverse.copy(e._camera.projectionMatrix).invert(),o.fromArray(i.read()),o.decompose(e._camera.position,e._camera.quaternion,e._camera.scale),o.fromArray(n.read()),o.decompose(e._origin.position,e._origin.quaternion,e._origin.scale)}function u(r){e._scene=new a.Scene,e._renderer=new a.WebGLRenderer({canvas:r,alpha:!0})}function _(){t._ar=e,t.canvas!==null&&(u(t.canvas),t.canvas.hidden=!0)}return Promise.resolve().then(()=>_()).then(()=>t.preload()).then(()=>t.startSession()).then(r=>{if(e._session=r,!e._renderer)u(r.viewport.canvas);else if(t.canvas===r.viewport.canvas)t.canvas.hidden=!1;else throw r.end(),new Error("ar-canvas mismatch");return o=new a.Matrix4,e._camera=new a.PerspectiveCamera,e._scene.add(e._camera),e._origin=new a.Group,e._origin.visible=!1,e._scene.add(e._origin),e._root=new a.Group,e._origin.add(e._root),r.addEventListener("end",i=>{e._origin.visible=!1,e._viewer=null,e._frame=null,e._pointers.length=0}),r.viewport.addEventListener("resize",i=>{const n=r.viewport.virtualSize;e._renderer.setPixelRatio(1),e._renderer.setSize(n.width,n.height,!1)}),Promise.resolve().then(()=>t.init()).then(()=>(r.addEventListener("end",i=>{t.release()}),r.requestAnimationFrame(s),e)).catch(i=>{throw r.end(),i})}).catch(r=>{throw console.error(r),r})}function w(t){window.addEventListener("load",()=>{try{AR;const e={"encantar.js":AR.version.replace(/-.*$/,""),"three.js":a.REVISION},o=(s,c,l)=>c!=l?console.warn(`


WARNING

This plugin has been tested with ${s} version ${c}. The version in use is ${l}. Usage of ${s} version ${c} is recommended instead.


`):void 0;for(const[s,c]of Object.entries(t))o(s,c.version,e[s])}catch(e){alert(e.message)}})}
