<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1, maximum-scale=1">
        <title>Street art with WebAR | encantar.js and A-Frame</title>
        <link href="../assets/demo.css" rel="stylesheet">
        <script src="../../dist/encantar.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/aframe@1.7.1/dist/aframe-v1.7.1.min.js"></script>
        <script src="../../dist/plugins/aframe-with-encantar.min.js"></script>
        <script src="../../dist/addons/gltf-anim.min.js"></script>
        <script src="../../dist/addons/ar-scan-gimmick.min.js"></script>
        <script>
        function changeVideo(filepath)
        {
            const video = document.getElementById('my-video');

            video.src = filepath;
            video.load();
            video.play();
        }
        </script>
        <style>
        #video-select
        {
            position: absolute;
            top: 0;
            left: calc(50% - 160px);
            width: 320px;
            font-size: 32px;
            text-align: center;
            border: 0;
            outline: none;
            color: black;
            background: rgba(255,255,255,0.8);
        }
        </style>
    </head>
    <body>

        <!-- The AR scene -->
        <a-scene encantar="stats: true; gizmos: true" loading-screen="enabled: false">

            <!--
            +============================+
            | Let's set up an AR session |
            +============================+
            -->

            <!-- The inputs that will feed the AR engine -->
            <ar-sources>

                <!-- Use a webcam -->
                <!--
                <ar-camera-source></ar-camera-source>
                -->

                <!-- Use a video element -->
                <ar-video-source video="#my-video"></ar-video-source>

            </ar-sources>

            <!-- The trackers we'll be using in AR -->
            <ar-trackers>

                <!-- We'll track images -->
                <ar-image-tracker resolution="360p">

                    <!-- List the images that you intend to track
                         Make sure to follow the guidelines for images (see the docs) -->
                    <ar-reference-image name="butterfly" src="assets/butterfly-target.jpg"></ar-reference-image>
                    <ar-reference-image name="pilot" src="assets/pilot-target.jpg"></ar-reference-image>
                    <ar-reference-image name="monster" src="assets/monster-target.jpg"></ar-reference-image>

                </ar-image-tracker>

            </ar-trackers>

            <!-- The AR viewport -->
            <ar-viewport>

                <!-- A 2D overlay displayed in front of the AR scene -->
                <ar-hud>

                    <!-- The info button -->
                    <a id="info" href="NOTICE.html" draggable="false"></a>

                    <!-- The like button -->
                    <a id="like" href="https://ko-fi.com/alemart" draggable="false"></a>

                    <!-- The scan gimmick -->
                    <ar-scan-gimmick opacity="0.75"></ar-scan-gimmick>

                    <!-- Video select -->
                    <select id="video-select" onchange="changeVideo(this.value)">
                        <option selected disabled>- Select a scene -</option>
                        <option value="assets/butterfly-video.mp4">Butterflies</option>
                        <option value="assets/pilot-video.mp4">Pilot</option>
                        <option value="assets/monster-video.mp4">Monster</option>
                    </select>

                </ar-hud>

            </ar-viewport>




            <!--
            +=================================================+
            | Now let's create the virtual elements           |
            | Whatever you add to <ar-root> will appear in AR |
            +=================================================+
            -->

            <!-- A 3D camera adapted for AR -->
            <ar-camera></ar-camera>

            <!-- Light -->
            <a-light type="ambient" intensity="3.1416"></a-light>

            <!-- Monster -->
            <ar-root reference-image="monster">

                <a-entity
                    position="0.25 -2.2 0.0"
                    rotation="0 0 0"
                    scale="0.1 0.1 0.1"
                    gltf-model="#monster-model"
                    gltf-anim="clip: Melee_Hold"
                >
                    <a-sound src="#monster-sound" autoplay="true" loop="true"></a-sound>
                </a-entity>

            </ar-root>

            <!-- Pilot -->
            <ar-root reference-image="pilot">

                <!-- Character -->
                <a-entity
                    position="1.0 -1.4 0.0"
                    rotation="0 -45 0"
                    scale="0.5 0.5 0.5"
                    gltf-model="#pilot-model"
                    gltf-anim="clip: Cheer"
                ></a-entity>

                <!-- Toy plane -->
                <a-entity
                    position="-2.0 0.1 2.5"
                    animation="property: rotation.y; from: 0; to: 360; dur: 2500; loop: true; easing: linear"
                >
                    <a-entity
                        position="0.0 0.0 1.0"
                        scale="0.5 0.5 0.5"
                        gltf-model="#toyplane-model"
                        gltf-anim="clip: Flying"
                    >
                        <a-sound src="#toyplane-sound" autoplay="true" loop="true"></a-sound>
                    </a-entity>
                </a-entity>

                <!-- Light -->
                <a-light
                    type="directional"
                    position="0 10 -3"
                    intensity="3.1416"
                    color="#fef8d7"
                ></a-light>

            </ar-root>

            <!-- Butterflies -->
            <ar-root reference-image="butterfly">

                <!-- Group 1 -->
                <a-entity
                    position="0 0.35 0.2"
                    rotation="0 0 0"
                    scale="0.035 0.035 0.035"
                    animation="property: rotation.y; from: 0; to: 360; dur: 2000; loop: true; easing: linear"
                >

                    <a-entity
                        gltf-model="#butterfly-model"
                        gltf-anim="clip: Flying; speed: 1.4"
                        position="15 0 0"
                        rotation="0 180 0"
                    ></a-entity>
                    <a-entity
                        gltf-model="#butterfly-model"
                        gltf-anim="clip: Flying; speed: 1.2"
                        position="-15 0 0"
                        rotation="0 0 0"
                    ></a-entity>

                </a-entity>

                <!-- Group 2 -->
                <a-entity
                    position="0 0 -0.2"
                    rotation="0 0 0"
                    scale="0.035 0.035 0.035"
                    animation="property: rotation.y; from: 0; to: 360; dur: 2500; loop: true; easing: linear"
                >

                    <a-entity
                        gltf-model="#butterfly-model"
                        gltf-anim="clip: Flying; speed: 1.3"
                        position="15 0 0"
                        rotation="0 180 0"
                    ></a-entity>
                    <a-entity
                        gltf-model="#butterfly-model"
                        gltf-anim="clip: Flying; speed: 1.5"
                        position="-15 0 0"
                        rotation="0 0 0"
                    ></a-entity>

                </a-entity>

                <!-- Group 3 -->
                <a-entity
                    position="0 -0.5 0"
                    rotation="0 0 0"
                    scale="0.035 0.035 0.035"
                    animation="property: rotation.y; from: 0; to: 360; dur: 2000; loop: true; easing: linear"
                >

                    <a-entity
                        gltf-model="#butterfly-model"
                        gltf-anim="clip: Flying; speed: 1.8"
                        position="20 0 0"
                        rotation="0 180 0"
                    ></a-entity>
                    <a-entity
                        gltf-model="#butterfly-model"
                        gltf-anim="clip: Flying; speed: 1.7"
                        position="-20 0 0"
                        rotation="0 0 0"
                    ></a-entity>

                </a-entity>

                <!-- Group 4 -->
                <a-entity
                    position="-0.25 0.5 0.5"
                    rotation="45 0 0"
                    scale="0.035 0.035 0.035"
                    animation="property: rotation.y; from: 0; to: 360; dur: 1500; loop: true; easing: linear"
                >

                    <a-entity
                        gltf-model="#butterfly-model"
                        gltf-anim="clip: Flying; speed: 1.5"
                        position="11 0 0"
                        rotation="0 180 0"
                    ></a-entity>
                    <a-entity
                        gltf-model="#butterfly-model"
                        gltf-anim="clip: Flying; speed: 1.8"
                        position="-11 0 0"
                        rotation="0 0 0"
                    ></a-entity>

                </a-entity>

            </ar-root>

            <!-- Assets -->
            <a-assets>
                <a-asset-item id="butterfly-model" src="assets/butterfly.glb"></a-asset-item>
                <a-asset-item id="pilot-model" src="assets/pilot.glb"></a-asset-item>
                <a-asset-item id="toyplane-model" src="assets/toyplane.glb"></a-asset-item>
                <a-asset-item id="monster-model" src="assets/monster.glb"></a-asset-item>
                <audio id="toyplane-sound" src="assets/toyplane.wav" preload="auto"></audio>
                <audio id="monster-sound" src="assets/monster.wav" preload="auto"></audio>
            </a-assets>

        </a-scene>

        <!-- Feed the Image Tracker with this video -->
        <video id="my-video" hidden muted loop playsinline autoplay src="assets/butterfly-video.mp4">
        </video>

    </body>
</html>

