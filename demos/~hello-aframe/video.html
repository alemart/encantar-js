<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1, maximum-scale=1">
        <title>encantar.js WebAR demo with A-Frame</title>
        <link href="../assets/demo.css" rel="stylesheet">
        <script src="../../dist/encantar.min.js"></script>
        <script src="aframe-v1.6.0.js"></script>
        <script src="../../plugins/aframe-with-encantar.js"></script>
        <script src="../../plugins/extras/aframe-scan-gimmick-for-encantar.js"></script>
        <script src="../../plugins/extras/aframe-gltf-anim.js"></script>
        <script>
AFRAME.registerComponent('click-test', {
    init: function() {
        this.el.addEventListener('click', evt => {
            console.log('click', evt);
            alert(2);
        });
    },
})
AFRAME.registerComponent('myray', {
    dependencies: ['raycaster'],
    init: function() {
        console.warn('!!!',this.el.components);
        this.el.setAttribute('raycaster', { lineColor: '#00ff00'});
        this.el.addEventListener('click', evt => {
            console.log('click', evt);
            alert(2);
        });
    },
})
        </script>
    </head>
    <body>

        <!-- The AR scene -->
        <a-scene encantar="stats: true; gizmos: true" loading-screen="enabled: false">

            <!--
            +============================+
            | Let's set up an AR session |
            +============================+
            -->

            <!-- The inputs that will feed the AR engine -->
            <ar-sources>

                <!-- Use a webcam -->
                <!--
                <ar-camera-source></ar-camera-source>
                -->

                <!-- Use a video element -->
                <ar-video-source video="#my-video"></ar-video-source>
                <ar-pointer-source></ar-pointer-source>

            </ar-sources>

            <!-- The trackers we'll be using in AR -->
            <ar-trackers>

                <ar-pointer-tracker></ar-pointer-tracker>

                <!-- We'll track images -->
                <ar-image-tracker>

                    <!-- List the images that you intend to track
                         Make sure to follow the guidelines for images (see the docs) -->
                    <ar-reference-image name="mage" src="../assets/mage.webp"></ar-reference-image>
                    <ar-reference-image name="cat" src="../assets/cat.webp"></ar-reference-image>

                </ar-image-tracker>

            </ar-trackers>

            <!-- The AR viewport -->
            <ar-viewport>

                <!-- A 2D overlay displayed in front of the AR scene -->
                <ar-hud>

                    <!-- The info button -->
                    <a id="info" href="NOTICE.html" draggable="false"></a>

                    <!-- The like button -->
                    <a id="like" href="../assets/promo.html" draggable="false"></a>

                    <!-- The scan gimmick -->
                    <a-entity ar-scan-gimmick="opacity: 0.75"></a-entity>

                </ar-hud>

            </ar-viewport>




            <!--
            +=================================================+
            | Now let's create the virtual elements           |
            | Whatever you add to <ar-root> will appear in AR |
            +=================================================+
            -->

            <!-- A 3D camera adapted for AR -->
                <a-entity cursor="rayOrigin: mouse" raycaster="showLine: true; far: 1000; lineColor: red; lineOpacity: 1; direction: 0 0 -1; useWorldCoordinates: false"></a-entity>
            <ar-camera>
                    <a-entity cursor="rayOrigin: mouse" raycaster="showLine: true;"></a-entity>
            </ar-camera>

            <!-- Light -->
            <a-light type="ambient" intensity="1.0"></a-light>

            <!-- The mage -->
            <ar-root reference-image="mage">

                <a-entity myray raycaster="showLine: true; far: 1000; lineColor: blue; lineOpacity: 1: direction 0 0 -1"></a-entity>
                <a-box click-test color="yellow" position="0 0 -0.5" scale="0.2 0.2 0.2"></a-box>

            </ar-root>

            <!-- Declare external media files here -->
            <a-assets>
                <a-asset-item id="cat-model" src="../assets/cat.glb"></a-asset-item>
                <a-asset-item id="mage-model" src="../assets/mage.glb"></a-asset-item>
                <img id="magic-circle" src="../assets/magic-circle.png">
                <img id="it-works" src="../assets/it-works.png">
            </a-assets>

        </a-scene>

        <!-- Feed the Image Tracker with this video -->
        <video id="my-video" hidden muted loop playsinline autoplay>
            <source src="../assets/my-video.webm" type="video/webm" />
            <source src="../assets/my-video.mp4" type="video/mp4" />
        </video>

    </body>
</html>
